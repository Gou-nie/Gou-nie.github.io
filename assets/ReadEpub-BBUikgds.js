var Xb=Object.defineProperty;var zg=d=>{throw TypeError(d)};var Yb=(d,t,e)=>t in d?Xb(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var At=(d,t,e)=>Yb(d,typeof t!="symbol"?t+"":t,e),Ud=(d,t,e)=>t.has(d)||zg("Cannot "+e);var l=(d,t,e)=>(Ud(d,t,"read from private field"),e?e.call(d):t.get(d)),D=(d,t,e)=>t.has(d)?zg("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(d):t.set(d,e),x=(d,t,e,i)=>(Ud(d,t,"write to private field"),i?i.call(d,e):t.set(d,e),e),k=(d,t,e)=>(Ud(d,t,"access private method"),e);var ki=(d,t,e,i)=>({set _(s){x(d,t,s,e)},get _(){return l(d,t,i)}});import{l as ec,q as Kb,c as Gl,o as $l,a as ui,b as Ug,g as Zb,v as Jb,F as Qb,j as ty,t as Hd,x as ey}from"./app-DVhjLfOn.js";import{g as jl,c as xs}from"./commonjsHelpers-Cpj98o6Y.js";import{c as jr}from"./commonjs-dynamic-modules-TDtrdbi3.js";import{_ as iy}from"./plugin-vue_export-helper-DlAUqK2U.js";var ic={exports:{}},qd={exports:{}},jd,Hg;function uv(){if(Hg)return jd;Hg=1;var d=void 0;return jd=function(t){return t!==d&&t!==null},jd}var Wd,qg;function sy(){if(qg)return Wd;qg=1;var d=uv(),t={object:!0,function:!0,undefined:!0};return Wd=function(e){return d(e)?hasOwnProperty.call(t,typeof e):!1},Wd}var Vd,jg;function ny(){if(jg)return Vd;jg=1;var d=sy();return Vd=function(t){if(!d(t))return!1;try{return t.constructor?t.constructor.prototype===t:!1}catch{return!1}},Vd}var Gd,Wg;function ry(){if(Wg)return Gd;Wg=1;var d=ny();return Gd=function(t){if(typeof t!="function"||!hasOwnProperty.call(t,"length"))return!1;try{if(typeof t.length!="number"||typeof t.call!="function"||typeof t.apply!="function")return!1}catch{return!1}return!d(t)},Gd}var $d,Vg;function ay(){if(Vg)return $d;Vg=1;var d=ry(),t=/^\s*class[\s{/}]/,e=Function.prototype.toString;return $d=function(i){return!(!d(i)||t.test(e.call(i)))},$d}var Xd,Gg;function oy(){return Gg||(Gg=1,Xd=function(){var d=Object.assign,t;return typeof d!="function"?!1:(t={foo:"raz"},d(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}),Xd}var Yd,$g;function ly(){return $g||($g=1,Yd=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),Yd}var Kd,Xg;function hy(){return Xg||(Xg=1,Kd=function(){}),Kd}var Zd,Yg;function hg(){if(Yg)return Zd;Yg=1;var d=hy()();return Zd=function(t){return t!==d&&t!==null},Zd}var Jd,Kg;function uy(){if(Kg)return Jd;Kg=1;var d=hg(),t=Object.keys;return Jd=function(e){return t(d(e)?Object(e):e)},Jd}var Qd,Zg;function cy(){return Zg||(Zg=1,Qd=ly()()?Object.keys:uy()),Qd}var tf,Jg;function dy(){if(Jg)return tf;Jg=1;var d=hg();return tf=function(t){if(!d(t))throw new TypeError("Cannot use null or undefined");return t},tf}var ef,Qg;function fy(){if(Qg)return ef;Qg=1;var d=cy(),t=dy(),e=Math.max;return ef=function(i,s){var n,r,a=e(arguments.length,2),o;for(i=Object(t(i)),o=function(h){try{i[h]=s[h]}catch(u){n||(n=u)}},r=1;r<a;++r)s=arguments[r],d(s).forEach(o);if(n!==void 0)throw n;return i},ef}var sf,tm;function py(){return tm||(tm=1,sf=oy()()?Object.assign:fy()),sf}var nf,em;function gy(){if(em)return nf;em=1;var d=hg(),t=Array.prototype.forEach,e=Object.create,i=function(s,n){var r;for(r in s)n[r]=s[r]};return nf=function(s){var n=e(null);return t.call(arguments,function(r){d(r)&&i(Object(r),n)}),n},nf}var rf,im;function my(){if(im)return rf;im=1;var d="razdwatrzy";return rf=function(){return typeof d.contains!="function"?!1:d.contains("dwa")===!0&&d.contains("foo")===!1},rf}var af,sm;function vy(){if(sm)return af;sm=1;var d=String.prototype.indexOf;return af=function(t){return d.call(this,t,arguments[1])>-1},af}var of,nm;function by(){return nm||(nm=1,of=my()()?String.prototype.contains:vy()),of}var rm;function yy(){if(rm)return qd.exports;rm=1;var d=uv(),t=ay(),e=py(),i=gy(),s=by(),n=qd.exports=function(r,a){var o,h,u,c,f;return arguments.length<2||typeof r!="string"?(c=a,a=r,r=null):c=arguments[2],d(r)?(o=s.call(r,"c"),h=s.call(r,"e"),u=s.call(r,"w")):(o=u=!0,h=!1),f={value:a,configurable:o,enumerable:h,writable:u},c?e(i(c),f):f};return n.gs=function(r,a,o){var h,u,c,f;return typeof r!="string"?(c=o,o=a,a=r,r=null):c=arguments[3],d(a)?t(a)?d(o)?t(o)||(c=o,o=void 0):o=void 0:(c=a,a=o=void 0):a=void 0,d(r)?(h=s.call(r,"c"),u=s.call(r,"e")):(h=!0,u=!1),f={get:a,set:o,configurable:h,enumerable:u},c?e(i(c),f):f},qd.exports}var lf,am;function wy(){return am||(am=1,lf=function(d){if(typeof d!="function")throw new TypeError(d+" is not a function");return d}),lf}var om;function _y(){return om||(om=1,function(d,t){var e=yy(),i=wy(),s=Function.prototype.apply,n=Function.prototype.call,r=Object.create,a=Object.defineProperty,o=Object.defineProperties,h=Object.prototype.hasOwnProperty,u={configurable:!0,enumerable:!1,writable:!0},c,f,p,_,v,g,b;c=function(w,S){var T;return i(S),h.call(this,"__ee__")?T=this.__ee__:(T=u.value=r(null),a(this,"__ee__",u),u.value=null),T[w]?typeof T[w]=="object"?T[w].push(S):T[w]=[T[w],S]:T[w]=S,this},f=function(w,S){var T,A;return i(S),A=this,c.call(this,w,T=function(){p.call(A,w,T),s.call(S,this,arguments)}),T.__eeOnceListener__=S,this},p=function(w,S){var T,A,C,R;if(i(S),!h.call(this,"__ee__"))return this;if(T=this.__ee__,!T[w])return this;if(A=T[w],typeof A=="object")for(R=0;C=A[R];++R)(C===S||C.__eeOnceListener__===S)&&(A.length===2?T[w]=A[R?0:1]:A.splice(R,1));else(A===S||A.__eeOnceListener__===S)&&delete T[w];return this},_=function(w){var S,T,A,C,R;if(h.call(this,"__ee__")&&(C=this.__ee__[w],!!C))if(typeof C=="object"){for(T=arguments.length,R=new Array(T-1),S=1;S<T;++S)R[S-1]=arguments[S];for(C=C.slice(),S=0;A=C[S];++S)s.call(A,this,R)}else switch(arguments.length){case 1:n.call(C,this);break;case 2:n.call(C,this,arguments[1]);break;case 3:n.call(C,this,arguments[1],arguments[2]);break;default:for(T=arguments.length,R=new Array(T-1),S=1;S<T;++S)R[S-1]=arguments[S];s.call(C,this,R)}},v={on:c,once:f,off:p,emit:_},g={on:e(c),once:e(f),off:e(p),emit:e(_)},b=o({},g),d.exports=t=function(w){return w==null?r(b):o(Object(w),g)},t.methods=v}(ic,ic.exports)),ic.exports}var Ay=_y();const mn=jl(Ay);var Xl={},bn={},mo={},lm;function Td(){if(lm)return mo;lm=1;function d(s,n,r){if(r===void 0&&(r=Array.prototype),s&&typeof r.find=="function")return r.find.call(s,n);for(var a=0;a<s.length;a++)if(Object.prototype.hasOwnProperty.call(s,a)){var o=s[a];if(n.call(void 0,o,a,s))return o}}function t(s,n){return n===void 0&&(n=Object),n&&typeof n.freeze=="function"?n.freeze(s):s}var e=t({HTML:"text/html",isHTML:function(s){return s===e.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),i=t({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(s){return s===i.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});return mo.find=d,mo.freeze=t,mo.MIME_TYPE=e,mo.NAMESPACE=i,mo}var hm;function cv(){if(hm)return bn;hm=1;var d=Td(),t=d.find,e=d.NAMESPACE;function i(E){return E!==""}function s(E){return E?E.split(/[\t\n\f\r ]+/).filter(i):[]}function n(E,m){return E.hasOwnProperty(m)||(E[m]=!0),E}function r(E){if(!E)return[];var m=s(E);return Object.keys(m.reduce(n,{}))}function a(E){return function(m){return E&&E.indexOf(m)!==-1}}function o(E,m){for(var L in E)Object.prototype.hasOwnProperty.call(E,L)&&(m[L]=E[L])}function h(E,m){var L=E.prototype;if(!(L instanceof m)){let W=function(){};W.prototype=m.prototype,W=new W,o(L,W),E.prototype=L=W}L.constructor!=E&&(typeof E!="function"&&console.error("unknown Class:"+E),L.constructor=E)}var u={},c=u.ELEMENT_NODE=1,f=u.ATTRIBUTE_NODE=2,p=u.TEXT_NODE=3,_=u.CDATA_SECTION_NODE=4,v=u.ENTITY_REFERENCE_NODE=5,g=u.ENTITY_NODE=6,b=u.PROCESSING_INSTRUCTION_NODE=7,w=u.COMMENT_NODE=8,S=u.DOCUMENT_NODE=9,T=u.DOCUMENT_TYPE_NODE=10,A=u.DOCUMENT_FRAGMENT_NODE=11,C=u.NOTATION_NODE=12,R={},P={};R.INDEX_SIZE_ERR=(P[1]="Index size error",1),R.DOMSTRING_SIZE_ERR=(P[2]="DOMString size error",2);var N=R.HIERARCHY_REQUEST_ERR=(P[3]="Hierarchy request error",3);R.WRONG_DOCUMENT_ERR=(P[4]="Wrong document",4),R.INVALID_CHARACTER_ERR=(P[5]="Invalid character",5),R.NO_DATA_ALLOWED_ERR=(P[6]="No data allowed",6),R.NO_MODIFICATION_ALLOWED_ERR=(P[7]="No modification allowed",7);var F=R.NOT_FOUND_ERR=(P[8]="Not found",8);R.NOT_SUPPORTED_ERR=(P[9]="Not supported",9);var z=R.INUSE_ATTRIBUTE_ERR=(P[10]="Attribute in use",10);R.INVALID_STATE_ERR=(P[11]="Invalid state",11),R.SYNTAX_ERR=(P[12]="Syntax error",12),R.INVALID_MODIFICATION_ERR=(P[13]="Invalid modification",13),R.NAMESPACE_ERR=(P[14]="Invalid namespace",14),R.INVALID_ACCESS_ERR=(P[15]="Invalid access",15);function q(E,m){if(m instanceof Error)var L=m;else L=this,Error.call(this,P[E]),this.message=P[E],Error.captureStackTrace&&Error.captureStackTrace(this,q);return L.code=E,m&&(this.message=this.message+": "+m),L}q.prototype=Error.prototype,o(R,q);function X(){}X.prototype={length:0,item:function(E){return E>=0&&E<this.length?this[E]:null},toString:function(E,m){for(var L=[],W=0;W<this.length;W++)nt(this[W],L,E,m);return L.join("")},filter:function(E){return Array.prototype.filter.call(this,E)},indexOf:function(E){return Array.prototype.indexOf.call(this,E)}};function tt(E,m){this._node=E,this._refresh=m,st(this)}function st(E){var m=E._node._inc||E._node.ownerDocument._inc;if(E._inc!==m){var L=E._refresh(E._node);if(j(E,"length",L.length),!E.$$length||L.length<E.$$length)for(var W=L.length;W in E;W++)Object.prototype.hasOwnProperty.call(E,W)&&delete E[W];o(L,E),E._inc=m}}tt.prototype.item=function(E){return st(this),this[E]||null},h(tt,X);function Q(){}function J(E,m){for(var L=E.length;L--;)if(E[L]===m)return L}function et(E,m,L,W){if(W?m[J(m,W)]=L:m[m.length++]=L,E){L.ownerElement=E;var y=E.ownerDocument;y&&(W&&Yt(y,E,W),Mt(y,E,L))}}function ut(E,m,L){var W=J(m,L);if(W>=0){for(var y=m.length-1;W<y;)m[W]=m[++W];if(m.length=y,E){var V=E.ownerDocument;V&&(Yt(V,E,L),L.ownerElement=null)}}else throw new q(F,new Error(E.tagName+"@"+L))}Q.prototype={length:0,item:X.prototype.item,getNamedItem:function(E){for(var m=this.length;m--;){var L=this[m];if(L.nodeName==E)return L}},setNamedItem:function(E){var m=E.ownerElement;if(m&&m!=this._ownerElement)throw new q(z);var L=this.getNamedItem(E.nodeName);return et(this._ownerElement,this,E,L),L},setNamedItemNS:function(E){var m=E.ownerElement,L;if(m&&m!=this._ownerElement)throw new q(z);return L=this.getNamedItemNS(E.namespaceURI,E.localName),et(this._ownerElement,this,E,L),L},removeNamedItem:function(E){var m=this.getNamedItem(E);return ut(this._ownerElement,this,m),m},removeNamedItemNS:function(E,m){var L=this.getNamedItemNS(E,m);return ut(this._ownerElement,this,L),L},getNamedItemNS:function(E,m){for(var L=this.length;L--;){var W=this[L];if(W.localName==m&&W.namespaceURI==E)return W}return null}};function Dt(){}Dt.prototype={hasFeature:function(E,m){return!0},createDocument:function(E,m,L){var W=new Ct;if(W.implementation=this,W.childNodes=new X,W.doctype=L||null,L&&W.appendChild(L),m){var y=W.createElementNS(E,m);W.appendChild(y)}return W},createDocumentType:function(E,m,L){var W=new He;return W.name=E,W.nodeName=E,W.publicId=m||"",W.systemId=L||"",W}};function ot(){}ot.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(E,m){return Ue(this,E,m)},replaceChild:function(E,m){Ue(this,E,m,_e),m&&this.removeChild(m)},removeChild:function(E){return kt(this,E)},appendChild:function(E){return this.insertBefore(E,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(E){return vt(this.ownerDocument||this,this,E)},normalize:function(){for(var E=this.firstChild;E;){var m=E.nextSibling;m&&m.nodeType==p&&E.nodeType==p?(this.removeChild(m),E.appendData(m.data)):(E.normalize(),E=m)}},isSupported:function(E,m){return this.ownerDocument.implementation.hasFeature(E,m)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(E){for(var m=this;m;){var L=m._nsMap;if(L){for(var W in L)if(Object.prototype.hasOwnProperty.call(L,W)&&L[W]===E)return W}m=m.nodeType==f?m.ownerDocument:m.parentNode}return null},lookupNamespaceURI:function(E){for(var m=this;m;){var L=m._nsMap;if(L&&E in L&&Object.prototype.hasOwnProperty.call(L,E))return L[E];m=m.nodeType==f?m.ownerDocument:m.parentNode}return null},isDefaultNamespace:function(E){var m=this.lookupPrefix(E);return m==null}};function ct(E){return E=="<"&&"&lt;"||E==">"&&"&gt;"||E=="&"&&"&amp;"||E=='"'&&"&quot;"||"&#"+E.charCodeAt()+";"}o(u,ot),o(u,ot.prototype);function xt(E,m){if(m(E))return!0;if(E=E.firstChild)do if(xt(E,m))return!0;while(E=E.nextSibling)}function Ct(){this.ownerDocument=this}function Mt(E,m,L){E&&E._inc++;var W=L.namespaceURI;W===e.XMLNS&&(m._nsMap[L.prefix?L.localName:""]=L.value)}function Yt(E,m,L,W){E&&E._inc++;var y=L.namespaceURI;y===e.XMLNS&&delete m._nsMap[L.prefix?L.localName:""]}function Rt(E,m,L){if(E&&E._inc){E._inc++;var W=m.childNodes;if(L)W[W.length++]=L;else{for(var y=m.firstChild,V=0;y;)W[V++]=y,y=y.nextSibling;W.length=V,delete W[W.length]}}}function kt(E,m){var L=m.previousSibling,W=m.nextSibling;return L?L.nextSibling=W:E.firstChild=W,W?W.previousSibling=L:E.lastChild=L,m.parentNode=null,m.previousSibling=null,m.nextSibling=null,Rt(E.ownerDocument,E),m}function se(E){return E&&(E.nodeType===ot.DOCUMENT_NODE||E.nodeType===ot.DOCUMENT_FRAGMENT_NODE||E.nodeType===ot.ELEMENT_NODE)}function ie(E){return E&&(zt(E)||qt(E)||Pt(E)||E.nodeType===ot.DOCUMENT_FRAGMENT_NODE||E.nodeType===ot.COMMENT_NODE||E.nodeType===ot.PROCESSING_INSTRUCTION_NODE)}function Pt(E){return E&&E.nodeType===ot.DOCUMENT_TYPE_NODE}function zt(E){return E&&E.nodeType===ot.ELEMENT_NODE}function qt(E){return E&&E.nodeType===ot.TEXT_NODE}function Kt(E,m){var L=E.childNodes||[];if(t(L,zt)||Pt(m))return!1;var W=t(L,Pt);return!(m&&W&&L.indexOf(W)>L.indexOf(m))}function pe(E,m){var L=E.childNodes||[];function W(V){return zt(V)&&V!==m}if(t(L,W))return!1;var y=t(L,Pt);return!(m&&y&&L.indexOf(y)>L.indexOf(m))}function ae(E,m,L){if(!se(E))throw new q(N,"Unexpected parent node type "+E.nodeType);if(L&&L.parentNode!==E)throw new q(F,"child not in parent");if(!ie(m)||Pt(m)&&E.nodeType!==ot.DOCUMENT_NODE)throw new q(N,"Unexpected node type "+m.nodeType+" for parent node type "+E.nodeType)}function Jt(E,m,L){var W=E.childNodes||[],y=m.childNodes||[];if(m.nodeType===ot.DOCUMENT_FRAGMENT_NODE){var V=y.filter(zt);if(V.length>1||t(y,qt))throw new q(N,"More than one element or text in fragment");if(V.length===1&&!Kt(E,L))throw new q(N,"Element in fragment can not be inserted before doctype")}if(zt(m)&&!Kt(E,L))throw new q(N,"Only one element can be added and only after doctype");if(Pt(m)){if(t(W,Pt))throw new q(N,"Only one doctype is allowed");var K=t(W,zt);if(L&&W.indexOf(K)<W.indexOf(L))throw new q(N,"Doctype can only be inserted before an element");if(!L&&K)throw new q(N,"Doctype can not be appended since element is present")}}function _e(E,m,L){var W=E.childNodes||[],y=m.childNodes||[];if(m.nodeType===ot.DOCUMENT_FRAGMENT_NODE){var V=y.filter(zt);if(V.length>1||t(y,qt))throw new q(N,"More than one element or text in fragment");if(V.length===1&&!pe(E,L))throw new q(N,"Element in fragment can not be inserted before doctype")}if(zt(m)&&!pe(E,L))throw new q(N,"Only one element can be added and only after doctype");if(Pt(m)){if(t(W,function(U){return Pt(U)&&U!==L}))throw new q(N,"Only one doctype is allowed");var K=t(W,zt);if(L&&W.indexOf(K)<W.indexOf(L))throw new q(N,"Doctype can only be inserted before an element")}}function Ue(E,m,L,W){ae(E,m,L),E.nodeType===ot.DOCUMENT_NODE&&(W||Jt)(E,m,L);var y=m.parentNode;if(y&&y.removeChild(m),m.nodeType===A){var V=m.firstChild;if(V==null)return m;var K=m.lastChild}else V=K=m;var I=L?L.previousSibling:E.lastChild;V.previousSibling=I,K.nextSibling=L,I?I.nextSibling=V:E.firstChild=V,L==null?E.lastChild=K:L.previousSibling=K;do V.parentNode=E;while(V!==K&&(V=V.nextSibling));return Rt(E.ownerDocument||E,E),m.nodeType==A&&(m.firstChild=m.lastChild=null),m}function Pe(E,m){return m.parentNode&&m.parentNode.removeChild(m),m.parentNode=E,m.previousSibling=E.lastChild,m.nextSibling=null,m.previousSibling?m.previousSibling.nextSibling=m:E.firstChild=m,E.lastChild=m,Rt(E.ownerDocument,E,m),m}Ct.prototype={nodeName:"#document",nodeType:S,doctype:null,documentElement:null,_inc:1,insertBefore:function(E,m){if(E.nodeType==A){for(var L=E.firstChild;L;){var W=L.nextSibling;this.insertBefore(L,m),L=W}return E}return Ue(this,E,m),E.ownerDocument=this,this.documentElement===null&&E.nodeType===c&&(this.documentElement=E),E},removeChild:function(E){return this.documentElement==E&&(this.documentElement=null),kt(this,E)},replaceChild:function(E,m){Ue(this,E,m,_e),E.ownerDocument=this,m&&this.removeChild(m),zt(E)&&(this.documentElement=E)},importNode:function(E,m){return at(this,E,m)},getElementById:function(E){var m=null;return xt(this.documentElement,function(L){if(L.nodeType==c&&L.getAttribute("id")==E)return m=L,!0}),m},getElementsByClassName:function(E){var m=r(E);return new tt(this,function(L){var W=[];return m.length>0&&xt(L.documentElement,function(y){if(y!==L&&y.nodeType===c){var V=y.getAttribute("class");if(V){var K=E===V;if(!K){var I=r(V);K=m.every(a(I))}K&&W.push(y)}}}),W})},createElement:function(E){var m=new Ot;m.ownerDocument=this,m.nodeName=E,m.tagName=E,m.localName=E,m.childNodes=new X;var L=m.attributes=new Q;return L._ownerElement=m,m},createDocumentFragment:function(){var E=new Bi;return E.ownerDocument=this,E.childNodes=new X,E},createTextNode:function(E){var m=new Xe;return m.ownerDocument=this,m.appendData(E),m},createComment:function(E){var m=new Gi;return m.ownerDocument=this,m.appendData(E),m},createCDATASection:function(E){var m=new Ti;return m.ownerDocument=this,m.appendData(E),m},createProcessingInstruction:function(E,m){var L=new Di;return L.ownerDocument=this,L.tagName=L.nodeName=L.target=E,L.nodeValue=L.data=m,L},createAttribute:function(E){var m=new Ut;return m.ownerDocument=this,m.name=E,m.nodeName=E,m.localName=E,m.specified=!0,m},createEntityReference:function(E){var m=new ei;return m.ownerDocument=this,m.nodeName=E,m},createElementNS:function(E,m){var L=new Ot,W=m.split(":"),y=L.attributes=new Q;return L.childNodes=new X,L.ownerDocument=this,L.nodeName=m,L.tagName=m,L.namespaceURI=E,W.length==2?(L.prefix=W[0],L.localName=W[1]):L.localName=m,y._ownerElement=L,L},createAttributeNS:function(E,m){var L=new Ut,W=m.split(":");return L.ownerDocument=this,L.nodeName=m,L.name=m,L.namespaceURI=E,L.specified=!0,W.length==2?(L.prefix=W[0],L.localName=W[1]):L.localName=m,L}},h(Ct,ot);function Ot(){this._nsMap={}}Ot.prototype={nodeType:c,hasAttribute:function(E){return this.getAttributeNode(E)!=null},getAttribute:function(E){var m=this.getAttributeNode(E);return m&&m.value||""},getAttributeNode:function(E){return this.attributes.getNamedItem(E)},setAttribute:function(E,m){var L=this.ownerDocument.createAttribute(E);L.value=L.nodeValue=""+m,this.setAttributeNode(L)},removeAttribute:function(E){var m=this.getAttributeNode(E);m&&this.removeAttributeNode(m)},appendChild:function(E){return E.nodeType===A?this.insertBefore(E,null):Pe(this,E)},setAttributeNode:function(E){return this.attributes.setNamedItem(E)},setAttributeNodeNS:function(E){return this.attributes.setNamedItemNS(E)},removeAttributeNode:function(E){return this.attributes.removeNamedItem(E.nodeName)},removeAttributeNS:function(E,m){var L=this.getAttributeNodeNS(E,m);L&&this.removeAttributeNode(L)},hasAttributeNS:function(E,m){return this.getAttributeNodeNS(E,m)!=null},getAttributeNS:function(E,m){var L=this.getAttributeNodeNS(E,m);return L&&L.value||""},setAttributeNS:function(E,m,L){var W=this.ownerDocument.createAttributeNS(E,m);W.value=W.nodeValue=""+L,this.setAttributeNode(W)},getAttributeNodeNS:function(E,m){return this.attributes.getNamedItemNS(E,m)},getElementsByTagName:function(E){return new tt(this,function(m){var L=[];return xt(m,function(W){W!==m&&W.nodeType==c&&(E==="*"||W.tagName==E)&&L.push(W)}),L})},getElementsByTagNameNS:function(E,m){return new tt(this,function(L){var W=[];return xt(L,function(y){y!==L&&y.nodeType===c&&(E==="*"||y.namespaceURI===E)&&(m==="*"||y.localName==m)&&W.push(y)}),W})}},Ct.prototype.getElementsByTagName=Ot.prototype.getElementsByTagName,Ct.prototype.getElementsByTagNameNS=Ot.prototype.getElementsByTagNameNS,h(Ot,ot);function Ut(){}Ut.prototype.nodeType=f,h(Ut,ot);function Lt(){}Lt.prototype={data:"",substringData:function(E,m){return this.data.substring(E,E+m)},appendData:function(E){E=this.data+E,this.nodeValue=this.data=E,this.length=E.length},insertData:function(E,m){this.replaceData(E,0,m)},appendChild:function(E){throw new Error(P[N])},deleteData:function(E,m){this.replaceData(E,m,"")},replaceData:function(E,m,L){var W=this.data.substring(0,E),y=this.data.substring(E+m);L=W+L+y,this.nodeValue=this.data=L,this.length=L.length}},h(Lt,ot);function Xe(){}Xe.prototype={nodeName:"#text",nodeType:p,splitText:function(E){var m=this.data,L=m.substring(E);m=m.substring(0,E),this.data=this.nodeValue=m,this.length=m.length;var W=this.ownerDocument.createTextNode(L);return this.parentNode&&this.parentNode.insertBefore(W,this.nextSibling),W}},h(Xe,Lt);function Gi(){}Gi.prototype={nodeName:"#comment",nodeType:w},h(Gi,Lt);function Ti(){}Ti.prototype={nodeName:"#cdata-section",nodeType:_},h(Ti,Lt);function He(){}He.prototype.nodeType=T,h(He,ot);function us(){}us.prototype.nodeType=C,h(us,ot);function Fi(){}Fi.prototype.nodeType=g,h(Fi,ot);function ei(){}ei.prototype.nodeType=v,h(ei,ot);function Bi(){}Bi.prototype.nodeName="#document-fragment",Bi.prototype.nodeType=A,h(Bi,ot);function Di(){}Di.prototype.nodeType=b,h(Di,ot);function ke(){}ke.prototype.serializeToString=function(E,m,L){return hi.call(E,m,L)},ot.prototype.toString=hi;function hi(E,m){var L=[],W=this.nodeType==9&&this.documentElement||this,y=W.prefix,V=W.namespaceURI;if(V&&y==null){var y=W.lookupPrefix(V);if(y==null)var K=[{namespace:V,prefix:null}]}return nt(this,L,E,m,K),L.join("")}function Cs(E,m,L){var W=E.prefix||"",y=E.namespaceURI;if(!y||W==="xml"&&y===e.XML||y===e.XMLNS)return!1;for(var V=L.length;V--;){var K=L[V];if(K.prefix===W)return K.namespace!==y}return!0}function M(E,m,L){E.push(" ",m,'="',L.replace(/[<&"]/g,ct),'"')}function nt(E,m,L,W,y){if(y||(y=[]),W)if(E=W(E),E){if(typeof E=="string"){m.push(E);return}}else return;switch(E.nodeType){case c:var V=E.attributes,K=V.length,Gt=E.firstChild,I=E.tagName;L=e.isHTML(E.namespaceURI)||L;var U=I;if(!L&&!E.prefix&&E.namespaceURI){for(var Z,bt=0;bt<V.length;bt++)if(V.item(bt).name==="xmlns"){Z=V.item(bt).value;break}if(!Z)for(var ft=y.length-1;ft>=0;ft--){var pt=y[ft];if(pt.prefix===""&&pt.namespace===E.namespaceURI){Z=pt.namespace;break}}if(Z!==E.namespaceURI)for(var ft=y.length-1;ft>=0;ft--){var pt=y[ft];if(pt.namespace===E.namespaceURI){pt.prefix&&(U=pt.prefix+":"+I);break}}}m.push("<",U);for(var Ft=0;Ft<K;Ft++){var Re=V.item(Ft);Re.prefix=="xmlns"?y.push({prefix:Re.localName,namespace:Re.value}):Re.nodeName=="xmlns"&&y.push({prefix:"",namespace:Re.value})}for(var Ft=0;Ft<K;Ft++){var Re=V.item(Ft);if(Cs(Re,L,y)){var oe=Re.prefix||"",Wt=Re.namespaceURI;M(m,oe?"xmlns:"+oe:"xmlns",Wt),y.push({prefix:oe,namespace:Wt})}nt(Re,m,L,W,y)}if(I===U&&Cs(E,L,y)){var oe=E.prefix||"",Wt=E.namespaceURI;M(m,oe?"xmlns:"+oe:"xmlns",Wt),y.push({prefix:oe,namespace:Wt})}if(Gt||L&&!/^(?:meta|link|img|br|hr|input)$/i.test(I)){if(m.push(">"),L&&/^script$/i.test(I))for(;Gt;)Gt.data?m.push(Gt.data):nt(Gt,m,L,W,y.slice()),Gt=Gt.nextSibling;else for(;Gt;)nt(Gt,m,L,W,y.slice()),Gt=Gt.nextSibling;m.push("</",U,">")}else m.push("/>");return;case S:case A:for(var Gt=E.firstChild;Gt;)nt(Gt,m,L,W,y.slice()),Gt=Gt.nextSibling;return;case f:return M(m,E.name,E.value);case p:return m.push(E.data.replace(/[<&]/g,ct).replace(/]]>/g,"]]&gt;"));case _:return m.push("<![CDATA[",E.data,"]]>");case w:return m.push("<!--",E.data,"-->");case T:var Oe=E.publicId,Te=E.systemId;if(m.push("<!DOCTYPE ",E.name),Oe)m.push(" PUBLIC ",Oe),Te&&Te!="."&&m.push(" ",Te),m.push(">");else if(Te&&Te!=".")m.push(" SYSTEM ",Te,">");else{var vn=E.internalSubset;vn&&m.push(" [",vn,"]"),m.push(">")}return;case b:return m.push("<?",E.target," ",E.data,"?>");case v:return m.push("&",E.nodeName,";");default:m.push("??",E.nodeName)}}function at(E,m,L){var W;switch(m.nodeType){case c:W=m.cloneNode(!1),W.ownerDocument=E;case A:break;case f:L=!0;break}if(W||(W=m.cloneNode(!1)),W.ownerDocument=E,W.parentNode=null,L)for(var y=m.firstChild;y;)W.appendChild(at(E,y,L)),y=y.nextSibling;return W}function vt(E,m,L){var W=new m.constructor;for(var y in m)if(Object.prototype.hasOwnProperty.call(m,y)){var V=m[y];typeof V!="object"&&V!=W[y]&&(W[y]=V)}switch(m.childNodes&&(W.childNodes=new X),W.ownerDocument=E,W.nodeType){case c:var K=m.attributes,I=W.attributes=new Q,U=K.length;I._ownerElement=W;for(var Z=0;Z<U;Z++)W.setAttributeNode(vt(E,K.item(Z),!0));break;case f:L=!0}if(L)for(var bt=m.firstChild;bt;)W.appendChild(vt(E,bt,L)),bt=bt.nextSibling;return W}function j(E,m,L){E[m]=L}try{if(Object.defineProperty){let E=function(m){switch(m.nodeType){case c:case A:var L=[];for(m=m.firstChild;m;)m.nodeType!==7&&m.nodeType!==8&&L.push(E(m)),m=m.nextSibling;return L.join("");default:return m.nodeValue}};Object.defineProperty(tt.prototype,"length",{get:function(){return st(this),this.$$length}}),Object.defineProperty(ot.prototype,"textContent",{get:function(){return E(this)},set:function(m){switch(this.nodeType){case c:case A:for(;this.firstChild;)this.removeChild(this.firstChild);(m||String(m))&&this.appendChild(this.ownerDocument.createTextNode(m));break;default:this.data=m,this.value=m,this.nodeValue=m}}}),j=function(m,L,W){m["$$"+L]=W}}}catch{}return bn.DocumentType=He,bn.DOMException=q,bn.DOMImplementation=Dt,bn.Element=Ot,bn.Node=ot,bn.NodeList=X,bn.XMLSerializer=ke,bn}var vo={},hf={},um;function Ey(){return um||(um=1,function(d){var t=Td().freeze;d.XML_ENTITIES=t({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),d.HTML_ENTITIES=t({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:`
`,nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"	",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),d.entityMap=d.HTML_ENTITIES}(hf)),hf}var sc={},cm;function xy(){if(cm)return sc;cm=1;var d=Td().NAMESPACE,t=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,e=new RegExp("[\\-\\.0-9"+t.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),i=new RegExp("^"+t.source+e.source+"*(?::"+t.source+e.source+"*)?$"),s=0,n=1,r=2,a=3,o=4,h=5,u=6,c=7;function f(N,F){this.message=N,this.locator=F,Error.captureStackTrace&&Error.captureStackTrace(this,f)}f.prototype=new Error,f.prototype.name=f.name;function p(){}p.prototype={parse:function(N,F,z){var q=this.domBuilder;q.startDocument(),T(F,F={}),_(N,F,z,q,this.errorHandler),q.endDocument()}};function _(N,F,z,q,X){function tt(Ot){if(Ot>65535){Ot-=65536;var Ut=55296+(Ot>>10),Lt=56320+(Ot&1023);return String.fromCharCode(Ut,Lt)}else return String.fromCharCode(Ot)}function st(Ot){var Ut=Ot.slice(1,-1);return Ut in z?z[Ut]:Ut.charAt(0)==="#"?tt(parseInt(Ut.substr(1).replace("x","0x"))):(X.error("entity not found:"+Ot),Ot)}function Q(Ot){if(Ot>Ct){var Ut=N.substring(Ct,Ot).replace(/&#?\w+;/g,st);ot&&J(Ct),q.characters(Ut,0,Ot-Ct),Ct=Ot}}function J(Ot,Ut){for(;Ot>=ut&&(Ut=Dt.exec(N));)et=Ut.index,ut=et+Ut[0].length,ot.lineNumber++;ot.columnNumber=Ot-et+1}for(var et=0,ut=0,Dt=/.*(?:\r\n?|\n)|.*$/g,ot=q.locator,ct=[{currentNSMap:F}],xt={},Ct=0;;){try{var Mt=N.indexOf("<",Ct);if(Mt<0){if(!N.substr(Ct).match(/^\s*$/)){var Yt=q.doc,Rt=Yt.createTextNode(N.substr(Ct));Yt.appendChild(Rt),q.currentElement=Rt}return}switch(Mt>Ct&&Q(Mt),N.charAt(Mt+1)){case"/":var ae=N.indexOf(">",Mt+3),kt=N.substring(Mt+2,ae).replace(/[ \t\n\r]+$/g,""),se=ct.pop();ae<0?(kt=N.substring(Mt+2).replace(/[\s<].*/,""),X.error("end tag name: "+kt+" is not complete:"+se.tagName),ae=Mt+1+kt.length):kt.match(/\s</)&&(kt=kt.replace(/[\s<].*/,""),X.error("end tag name: "+kt+" maybe not complete"),ae=Mt+1+kt.length);var ie=se.localNSMap,Pt=se.tagName==kt,zt=Pt||se.tagName&&se.tagName.toLowerCase()==kt.toLowerCase();if(zt){if(q.endElement(se.uri,se.localName,kt),ie)for(var qt in ie)Object.prototype.hasOwnProperty.call(ie,qt)&&q.endPrefixMapping(qt);Pt||X.fatalError("end tag name: "+kt+" is not match the current start tagName:"+se.tagName)}else ct.push(se);ae++;break;case"?":ot&&J(Mt),ae=C(N,Mt,q);break;case"!":ot&&J(Mt),ae=A(N,Mt,q,X);break;default:ot&&J(Mt);var Kt=new R,pe=ct[ct.length-1].currentNSMap,ae=g(N,Mt,Kt,pe,st,X),Jt=Kt.length;if(!Kt.closed&&S(N,ae,Kt.tagName,xt)&&(Kt.closed=!0,z.nbsp||X.warning("unclosed xml attribute")),ot&&Jt){for(var _e=v(ot,{}),Ue=0;Ue<Jt;Ue++){var Pe=Kt[Ue];J(Pe.offset),Pe.locator=v(ot,{})}q.locator=_e,b(Kt,q,pe)&&ct.push(Kt),q.locator=ot}else b(Kt,q,pe)&&ct.push(Kt);d.isHTML(Kt.uri)&&!Kt.closed?ae=w(N,ae,Kt.tagName,st,q):ae++}}catch(Ot){if(Ot instanceof f)throw Ot;X.error("element parse error: "+Ot),ae=-1}ae>Ct?Ct=ae:Q(Math.max(Mt,Ct)+1)}}function v(N,F){return F.lineNumber=N.lineNumber,F.columnNumber=N.columnNumber,F}function g(N,F,z,q,X,tt){function st(ot,ct,xt){z.attributeNames.hasOwnProperty(ot)&&tt.fatalError("Attribute "+ot+" redefined"),z.addValue(ot,ct,xt)}for(var Q,J,et=++F,ut=s;;){var Dt=N.charAt(et);switch(Dt){case"=":if(ut===n)Q=N.slice(F,et),ut=a;else if(ut===r)ut=a;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(ut===a||ut===n)if(ut===n&&(tt.warning('attribute value must after "="'),Q=N.slice(F,et)),F=et+1,et=N.indexOf(Dt,F),et>0)J=N.slice(F,et).replace(/&#?\w+;/g,X),st(Q,J,F-1),ut=h;else throw new Error("attribute value no end '"+Dt+"' match");else if(ut==o)J=N.slice(F,et).replace(/&#?\w+;/g,X),st(Q,J,F),tt.warning('attribute "'+Q+'" missed start quot('+Dt+")!!"),F=et+1,ut=h;else throw new Error('attribute value must after "="');break;case"/":switch(ut){case s:z.setTagName(N.slice(F,et));case h:case u:case c:ut=c,z.closed=!0;case o:case n:break;case r:z.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return tt.error("unexpected end of input"),ut==s&&z.setTagName(N.slice(F,et)),et;case">":switch(ut){case s:z.setTagName(N.slice(F,et));case h:case u:case c:break;case o:case n:J=N.slice(F,et),J.slice(-1)==="/"&&(z.closed=!0,J=J.slice(0,-1));case r:ut===r&&(J=Q),ut==o?(tt.warning('attribute "'+J+'" missed quot(")!'),st(Q,J.replace(/&#?\w+;/g,X),F)):((!d.isHTML(q[""])||!J.match(/^(?:disabled|checked|selected)$/i))&&tt.warning('attribute "'+J+'" missed value!! "'+J+'" instead!!'),st(J,J,F));break;case a:throw new Error("attribute value missed!!")}return et;case"":Dt=" ";default:if(Dt<=" ")switch(ut){case s:z.setTagName(N.slice(F,et)),ut=u;break;case n:Q=N.slice(F,et),ut=r;break;case o:var J=N.slice(F,et).replace(/&#?\w+;/g,X);tt.warning('attribute "'+J+'" missed quot(")!!'),st(Q,J,F);case h:ut=u;break}else switch(ut){case r:z.tagName,(!d.isHTML(q[""])||!Q.match(/^(?:disabled|checked|selected)$/i))&&tt.warning('attribute "'+Q+'" missed value!! "'+Q+'" instead2!!'),st(Q,Q,F),F=et,ut=n;break;case h:tt.warning('attribute space is required"'+Q+'"!!');case u:ut=n,F=et;break;case a:ut=o,F=et;break;case c:throw new Error("elements closed character '/' and '>' must be connected to")}}et++}}function b(N,F,z){for(var q=N.tagName,X=null,Dt=N.length;Dt--;){var tt=N[Dt],st=tt.qName,Q=tt.value,ot=st.indexOf(":");if(ot>0)var J=tt.prefix=st.slice(0,ot),et=st.slice(ot+1),ut=J==="xmlns"&&et;else et=st,J=null,ut=st==="xmlns"&&"";tt.localName=et,ut!==!1&&(X==null&&(X={},T(z,z={})),z[ut]=X[ut]=Q,tt.uri=d.XMLNS,F.startPrefixMapping(ut,Q))}for(var Dt=N.length;Dt--;){tt=N[Dt];var J=tt.prefix;J&&(J==="xml"&&(tt.uri=d.XML),J!=="xmlns"&&(tt.uri=z[J||""]))}var ot=q.indexOf(":");ot>0?(J=N.prefix=q.slice(0,ot),et=N.localName=q.slice(ot+1)):(J=null,et=N.localName=q);var ct=N.uri=z[J||""];if(F.startElement(ct,et,q,N),N.closed){if(F.endElement(ct,et,q),X)for(J in X)Object.prototype.hasOwnProperty.call(X,J)&&F.endPrefixMapping(J)}else return N.currentNSMap=z,N.localNSMap=X,!0}function w(N,F,z,q,X){if(/^(?:script|textarea)$/i.test(z)){var tt=N.indexOf("</"+z+">",F),st=N.substring(F+1,tt);if(/[&<]/.test(st))return/^script$/i.test(z)?(X.characters(st,0,st.length),tt):(st=st.replace(/&#?\w+;/g,q),X.characters(st,0,st.length),tt)}return F+1}function S(N,F,z,q){var X=q[z];return X==null&&(X=N.lastIndexOf("</"+z+">"),X<F&&(X=N.lastIndexOf("</"+z)),q[z]=X),X<F}function T(N,F){for(var z in N)Object.prototype.hasOwnProperty.call(N,z)&&(F[z]=N[z])}function A(N,F,z,q){var X=N.charAt(F+2);switch(X){case"-":if(N.charAt(F+3)==="-"){var tt=N.indexOf("-->",F+4);return tt>F?(z.comment(N,F+4,tt-F-4),tt+3):(q.error("Unclosed comment"),-1)}else return-1;default:if(N.substr(F+3,6)=="CDATA["){var tt=N.indexOf("]]>",F+9);return z.startCDATA(),z.characters(N,F+9,tt-F-9),z.endCDATA(),tt+3}var st=P(N,F),Q=st.length;if(Q>1&&/!doctype/i.test(st[0][0])){var J=st[1][0],et=!1,ut=!1;Q>3&&(/^public$/i.test(st[2][0])?(et=st[3][0],ut=Q>4&&st[4][0]):/^system$/i.test(st[2][0])&&(ut=st[3][0]));var Dt=st[Q-1];return z.startDTD(J,et,ut),z.endDTD(),Dt.index+Dt[0].length}}return-1}function C(N,F,z){var q=N.indexOf("?>",F);if(q){var X=N.substring(F,q).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return X?(X[0].length,z.processingInstruction(X[1],X[2]),q+2):-1}return-1}function R(){this.attributeNames={}}R.prototype={setTagName:function(N){if(!i.test(N))throw new Error("invalid tagName:"+N);this.tagName=N},addValue:function(N,F,z){if(!i.test(N))throw new Error("invalid attribute:"+N);this.attributeNames[N]=this.length,this[this.length++]={qName:N,value:F,offset:z}},length:0,getLocalName:function(N){return this[N].localName},getLocator:function(N){return this[N].locator},getQName:function(N){return this[N].qName},getURI:function(N){return this[N].uri},getValue:function(N){return this[N].value}};function P(N,F){var z,q=[],X=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(X.lastIndex=F,X.exec(N);z=X.exec(N);)if(q.push(z),z[1])return q}return sc.XMLReader=p,sc.ParseError=f,sc}var dm;function Sy(){if(dm)return vo;dm=1;var d=Td(),t=cv(),e=Ey(),i=xy(),s=t.DOMImplementation,n=d.NAMESPACE,r=i.ParseError,a=i.XMLReader;function o(v){this.options=v||{locator:{}}}o.prototype.parseFromString=function(v,g){var b=this.options,w=new a,S=b.domBuilder||new u,T=b.errorHandler,A=b.locator,C=b.xmlns||{},R=/\/x?html?$/.test(g),P=R?e.HTML_ENTITIES:e.XML_ENTITIES;return A&&S.setDocumentLocator(A),w.errorHandler=h(T,S,A),w.domBuilder=b.domBuilder||S,R&&(C[""]=n.HTML),C.xml=C.xml||n.XML,v&&typeof v=="string"?w.parse(v,C,P):w.errorHandler.error("invalid doc source"),S.doc};function h(v,g,b){if(!v){if(g instanceof u)return g;v=g}var w={},S=v instanceof Function;b=b||{};function T(A){var C=v[A];!C&&S&&(C=v.length==2?function(R){v(A,R)}:v),w[A]=C&&function(R){C("[xmldom "+A+"]	"+R+f(b))}||function(){}}return T("warning"),T("error"),T("fatalError"),w}function u(){this.cdata=!1}function c(v,g){g.lineNumber=v.lineNumber,g.columnNumber=v.columnNumber}u.prototype={startDocument:function(){this.doc=new s().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(v,g,b,w){var S=this.doc,T=S.createElementNS(v,b||g),A=w.length;_(this,T),this.currentElement=T,this.locator&&c(this.locator,T);for(var C=0;C<A;C++){var v=w.getURI(C),R=w.getValue(C),b=w.getQName(C),P=S.createAttributeNS(v,b);this.locator&&c(w.getLocator(C),P),P.value=P.nodeValue=R,T.setAttributeNode(P)}},endElement:function(v,g,b){var w=this.currentElement;w.tagName,this.currentElement=w.parentNode},startPrefixMapping:function(v,g){},endPrefixMapping:function(v){},processingInstruction:function(v,g){var b=this.doc.createProcessingInstruction(v,g);this.locator&&c(this.locator,b),_(this,b)},ignorableWhitespace:function(v,g,b){},characters:function(v,g,b){if(v=p.apply(this,arguments),v){if(this.cdata)var w=this.doc.createCDATASection(v);else var w=this.doc.createTextNode(v);this.currentElement?this.currentElement.appendChild(w):/^\s*$/.test(v)&&this.doc.appendChild(w),this.locator&&c(this.locator,w)}},skippedEntity:function(v){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(v){(this.locator=v)&&(v.lineNumber=0)},comment:function(v,g,b){v=p.apply(this,arguments);var w=this.doc.createComment(v);this.locator&&c(this.locator,w),_(this,w)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(v,g,b){var w=this.doc.implementation;if(w&&w.createDocumentType){var S=w.createDocumentType(v,g,b);this.locator&&c(this.locator,S),_(this,S),this.doc.doctype=S}},warning:function(v){console.warn("[xmldom warning]	"+v,f(this.locator))},error:function(v){console.error("[xmldom error]	"+v,f(this.locator))},fatalError:function(v){throw new r(v,this.locator)}};function f(v){if(v)return`
@`+(v.systemId||"")+"#[line:"+v.lineNumber+",col:"+v.columnNumber+"]"}function p(v,g,b){return typeof v=="string"?v.substr(g,b):v.length>=g+b||g?new java.lang.String(v,g,b)+"":v}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(v){u.prototype[v]=function(){return null}});function _(v,g){v.currentElement?v.currentElement.appendChild(g):v.doc.appendChild(g)}return vo.__DOMHandler=u,vo.DOMParser=o,vo.DOMImplementation=t.DOMImplementation,vo.XMLSerializer=t.XMLSerializer,vo}var fm;function Cy(){if(fm)return Xl;fm=1;var d=cv();return Xl.DOMImplementation=d.DOMImplementation,Xl.XMLSerializer=d.XMLSerializer,Xl.DOMParser=Sy().DOMParser,Xl}var dv=Cy();const ug=typeof window<"u"?window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame:!1,Ty=1,Dy=3,fv=typeof URL<"u"?URL:typeof window<"u"?window.URL||window.webkitURL||window.mozURL:void 0;function Dd(){var d=new Date().getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(d+Math.random()*16)%16|0;return d=Math.floor(d/16),(e=="x"?i:i&7|8).toString(16)});return t}function ky(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)}function pv(d){return!!(d&&d.nodeType==1)}function Le(d){return!isNaN(parseFloat(d))&&isFinite(d)}function gv(d){let t=parseFloat(d);return Le(d)===!1?!1:typeof d=="string"&&d.indexOf(".")>-1?!0:Math.floor(t)!==t}function wo(d){var t=["Webkit","webkit","Moz","O","ms"],e=["-webkit-","-webkit-","-moz-","-o-","-ms-"],i=d.toLowerCase(),s=t.length;if(typeof document>"u"||typeof document.body.style[i]<"u")return d;for(var n=0;n<s;n++)if(typeof document.body.style[e[n]+i]<"u")return e[n]+i;return d}function mv(d){for(var t=1,e=arguments.length;t<e;t++){var i=arguments[t];for(var s in i)d[s]===void 0&&(d[s]=i[s])}return d}function yi(d){var t=[].slice.call(arguments,1);return t.forEach(function(e){e&&Object.getOwnPropertyNames(e).forEach(function(i){Object.defineProperty(d,i,Object.getOwnPropertyDescriptor(e,i))})}),d}function Ry(d,t,e){var i=ql(d,t,e);return t.splice(i,0,d),i}function ql(d,t,e,i,s){var n=i||0,r=s||t.length,a=parseInt(n+(r-n)/2),o;return e||(e=function(h,u){if(h>u)return 1;if(h<u)return-1;if(h==u)return 0}),r-n<=0?a:(o=e(t[a],d),r-n===1?o>=0?a:a+1:o===0?a:o===-1?ql(d,t,e,a,r):ql(d,t,e,n,a))}function Vc(d,t,e,i,s){var n=i||0,r=s||t.length,a=parseInt(n+(r-n)/2),o;return e||(e=function(h,u){if(h>u)return 1;if(h<u)return-1;if(h==u)return 0}),r-n<=0?-1:(o=e(t[a],d),r-n===1?o===0?a:-1:o===0?a:o===-1?Vc(d,t,e,a,r):Vc(d,t,e,n,a))}function dc(d){var t=window.getComputedStyle(d),e=["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],i=["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],s=0,n=0;return e.forEach(function(r){s+=parseFloat(t[r])||0}),i.forEach(function(r){n+=parseFloat(t[r])||0}),{height:n,width:s}}function Gc(d){var t=window.getComputedStyle(d),e=["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],i=["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],s=0,n=0;return e.forEach(function(r){s+=parseFloat(t[r])||0}),i.forEach(function(r){n+=parseFloat(t[r])||0}),{height:n,width:s}}function Uf(d){let t,e=d.ownerDocument;if(d.nodeType==Node.TEXT_NODE){let i=e.createRange();i.selectNodeContents(d),t=i.getBoundingClientRect()}else t=d.getBoundingClientRect();return t}function $c(){var d=window.innerWidth,t=window.innerHeight;return{top:0,left:0,right:d,bottom:t,width:d,height:t}}function cg(d,t){for(var e=d.parentNode,i=e.childNodes,s,n=-1,r=0;r<i.length&&(s=i[r],s.nodeType===t&&n++,s!=d);r++);return n}function Iy(d){return cg(d,Dy)}function vv(d){return cg(d,Ty)}function yh(d){return["xml","opf","ncx"].indexOf(d)>-1}function bv(d,t){return new Blob([d],{type:t})}function Xc(d,t){var e,i=bv(d,t);return e=fv.createObjectURL(i),e}function yv(d){return fv.revokeObjectURL(d)}function Hf(d,t){var e,i;if(typeof d=="string")return e=btoa(d),i="data:"+t+";base64,"+e,i}function wv(d){return Object.prototype.toString.call(d).slice(8,-1)}function pn(d,t,e){var i,s;return typeof DOMParser>"u"||e?s=dv.DOMParser:s=DOMParser,d.charCodeAt(0)===65279&&(d=d.slice(1)),i=new s().parseFromString(d,t),i}function be(d,t){var e;if(!d)throw new Error("No Element Provided");if(typeof d.querySelector<"u")return d.querySelector(t);if(e=d.getElementsByTagName(t),e.length)return e[0]}function er(d,t){return typeof d.querySelector<"u"?d.querySelectorAll(t):d.getElementsByTagName(t)}function _o(d,t,e){var i,s;if(typeof d.querySelector<"u"){t+="[";for(var n in e)t+=n+"~='"+e[n]+"'";return t+="]",d.querySelector(t)}else if(i=d.getElementsByTagName(t),s=Array.prototype.slice.call(i,0).filter(function(r){for(var a in e)if(r.getAttribute(a)===e[a])return!0;return!1}),s)return s[0]}function Yc(d,t){var e=d.ownerDocument||d;typeof e.createTreeWalker<"u"?_v(d,t,NodeFilter.SHOW_TEXT):dg(d,function(i){i&&i.nodeType===3&&t(i)})}function _v(d,t,e){var i=document.createTreeWalker(d,e,null,!1);let s;for(;s=i.nextNode();)t(s)}function dg(d,t){if(t(d))return!0;if(d=d.firstChild,d)do{if(dg(d,t))return!0;d=d.nextSibling}while(d)}function Av(d){return new Promise(function(t,e){var i=new FileReader;i.readAsDataURL(d),i.onloadend=function(){t(i.result)}})}function te(){this.resolve=null,this.reject=null,this.id=Dd(),this.promise=new Promise((d,t)=>{this.resolve=d,this.reject=t}),Object.freeze(this)}function Kc(d,t,e){var i;if(typeof d.querySelector<"u"&&(i=d.querySelector(`${t}[*|type="${e}"]`)),!i||i.length===0){i=er(d,t);for(var s=0;s<i.length;s++)if(i[s].getAttributeNS("http://www.idpf.org/2007/ops","type")===e||i[s].getAttribute("epub:type")===e)return i[s]}else return i}function qf(d){for(var t=[],e=d.childNodes,i=0;i<e.length;i++){let s=e[i];s.nodeType===1&&t.push(s)}return t}function jf(d){for(var t=[d];d;d=d.parentNode)t.unshift(d);return t}function Ao(d,t,e){for(var i=[],s=d.childNodes,n=0;n<s.length;n++){let r=s[n];if(r.nodeType===1&&r.nodeName.toLowerCase()===t){if(e)return r;i.push(r)}}if(!e)return i}function Ny(d,t){let e;if(!(d===null||t===""))for(e=d.parentNode;e.nodeType===1;){if(e.tagName.toLowerCase()===t)return e;e=e.parentNode}}class Ev{constructor(){this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}setStart(t,e){this.startContainer=t,this.startOffset=e,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}setEnd(t,e){this.endContainer=t,this.endOffset=e,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}collapse(t){this.collapsed=!0,t?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}selectNode(t){let e=t.parentNode,i=Array.prototype.indexOf.call(e.childNodes,t);this.setStart(e,i),this.setEnd(e,i+1)}selectNodeContents(t){t.childNodes[t.childNodes-1];let e=t.nodeType===3?t.textContent.length:parent.childNodes.length;this.setStart(t,0),this.setEnd(t,e)}_commonAncestorContainer(t,e){var i=jf(t||this.startContainer),s=jf(e||this.endContainer);if(i[0]==s[0]){for(var n=0;n<i.length;n++)if(i[n]!=s[n])return i[n-1]}}_checkCollapsed(){this.startContainer===this.endContainer&&this.startOffset===this.endOffset?this.collapsed=!0:this.collapsed=!1}toString(){}}const Ly=Object.freeze(Object.defineProperty({__proto__:null,RangeObject:Ev,blob2base64:Av,borders:Gc,bounds:dc,createBase64Url:Hf,createBlob:bv,createBlobUrl:Xc,defaults:mv,defer:te,documentHeight:ky,extend:yi,filterChildren:Ao,findChildren:qf,getParentByTagName:Ny,indexOfElementNode:vv,indexOfNode:cg,indexOfSorted:Vc,indexOfTextNode:Iy,insert:Ry,isElement:pv,isFloat:gv,isNumber:Le,isXml:yh,locationOf:ql,nodeBounds:Uf,parents:jf,parse:pn,prefixed:wo,qs:be,qsa:er,qsp:_o,querySelectorByType:Kc,requestAnimationFrame:ug,revokeBlobUrl:yv,sprint:Yc,treeWalker:_v,type:wv,uuid:Dd,walk:dg,windowBounds:$c},Symbol.toStringTag,{value:"Module"}));var uf,pm;function Py(){if(pm)return uf;if(pm=1,!d)var d={cwd:function(){return"/"}};function t(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+n)}function e(n,r){for(var a="",o=-1,h=0,u,c=0;c<=n.length;++c){if(c<n.length)u=n.charCodeAt(c);else{if(u===47)break;u=47}if(u===47){if(!(o===c-1||h===1))if(o!==c-1&&h===2){if(a.length<2||a.charCodeAt(a.length-1)!==46||a.charCodeAt(a.length-2)!==46){if(a.length>2){for(var f=a.length-1,p=f;p>=0&&a.charCodeAt(p)!==47;--p);if(p!==f){p===-1?a="":a=a.slice(0,p),o=c,h=0;continue}}else if(a.length===2||a.length===1){a="",o=c,h=0;continue}}r&&(a.length>0?a+="/..":a="..")}else a.length>0?a+="/"+n.slice(o+1,c):a=n.slice(o+1,c);o=c,h=0}else u===46&&h!==-1?++h:h=-1}return a}function i(n,r){var a=r.dir||r.root,o=r.base||(r.name||"")+(r.ext||"");return a?a===r.root?a+o:a+n+o:o}var s={resolve:function(){for(var r="",a=!1,o,h=arguments.length-1;h>=-1&&!a;h--){var u;h>=0?u=arguments[h]:(o===void 0&&(o=d.cwd()),u=o),t(u),u.length!==0&&(r=u+"/"+r,a=u.charCodeAt(0)===47)}return r=e(r,!a),a?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(r){if(t(r),r.length===0)return".";var a=r.charCodeAt(0)===47,o=r.charCodeAt(r.length-1)===47;return r=e(r,!a),r.length===0&&!a&&(r="."),r.length>0&&o&&(r+="/"),a?"/"+r:r},isAbsolute:function(r){return t(r),r.length>0&&r.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var r,a=0;a<arguments.length;++a){var o=arguments[a];t(o),o.length>0&&(r===void 0?r=o:r+="/"+o)}return r===void 0?".":s.normalize(r)},relative:function(r,a){if(t(r),t(a),r===a||(r=s.resolve(r),a=s.resolve(a),r===a))return"";for(var o=1;o<r.length&&r.charCodeAt(o)===47;++o);for(var h=r.length,u=h-o,c=1;c<a.length&&a.charCodeAt(c)===47;++c);for(var f=a.length,p=f-c,_=u<p?u:p,v=-1,g=0;g<=_;++g){if(g===_){if(p>_){if(a.charCodeAt(c+g)===47)return a.slice(c+g+1);if(g===0)return a.slice(c+g)}else u>_&&(r.charCodeAt(o+g)===47?v=g:g===0&&(v=0));break}var b=r.charCodeAt(o+g),w=a.charCodeAt(c+g);if(b!==w)break;b===47&&(v=g)}var S="";for(g=o+v+1;g<=h;++g)(g===h||r.charCodeAt(g)===47)&&(S.length===0?S+="..":S+="/..");return S.length>0?S+a.slice(c+v):(c+=v,a.charCodeAt(c)===47&&++c,a.slice(c))},_makeLong:function(r){return r},dirname:function(r){if(t(r),r.length===0)return".";for(var a=r.charCodeAt(0),o=a===47,h=-1,u=!0,c=r.length-1;c>=1;--c)if(a=r.charCodeAt(c),a===47){if(!u){h=c;break}}else u=!1;return h===-1?o?"/":".":o&&h===1?"//":r.slice(0,h)},basename:function(r,a){if(a!==void 0&&typeof a!="string")throw new TypeError('"ext" argument must be a string');t(r);var o=0,h=-1,u=!0,c;if(a!==void 0&&a.length>0&&a.length<=r.length){if(a.length===r.length&&a===r)return"";var f=a.length-1,p=-1;for(c=r.length-1;c>=0;--c){var _=r.charCodeAt(c);if(_===47){if(!u){o=c+1;break}}else p===-1&&(u=!1,p=c+1),f>=0&&(_===a.charCodeAt(f)?--f===-1&&(h=c):(f=-1,h=p))}return o===h?h=p:h===-1&&(h=r.length),r.slice(o,h)}else{for(c=r.length-1;c>=0;--c)if(r.charCodeAt(c)===47){if(!u){o=c+1;break}}else h===-1&&(u=!1,h=c+1);return h===-1?"":r.slice(o,h)}},extname:function(r){t(r);for(var a=-1,o=0,h=-1,u=!0,c=0,f=r.length-1;f>=0;--f){var p=r.charCodeAt(f);if(p===47){if(!u){o=f+1;break}continue}h===-1&&(u=!1,h=f+1),p===46?a===-1?a=f:c!==1&&(c=1):a!==-1&&(c=-1)}return a===-1||h===-1||c===0||c===1&&a===h-1&&a===o+1?"":r.slice(a,h)},format:function(r){if(r===null||typeof r!="object")throw new TypeError('Parameter "pathObject" must be an object, not '+typeof r);return i("/",r)},parse:function(r){t(r);var a={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return a;var o=r.charCodeAt(0),h=o===47,u;h?(a.root="/",u=1):u=0;for(var c=-1,f=0,p=-1,_=!0,v=r.length-1,g=0;v>=u;--v){if(o=r.charCodeAt(v),o===47){if(!_){f=v+1;break}continue}p===-1&&(_=!1,p=v+1),o===46?c===-1?c=v:g!==1&&(g=1):c!==-1&&(g=-1)}return c===-1||p===-1||g===0||g===1&&c===p-1&&c===f+1?p!==-1&&(f===0&&h?a.base=a.name=r.slice(1,p):a.base=a.name=r.slice(f,p)):(f===0&&h?(a.name=r.slice(1,c),a.base=r.slice(1,p)):(a.name=r.slice(f,c),a.base=r.slice(f,p)),a.ext=r.slice(c,p)),f>0?a.dir=r.slice(0,f-1):h&&(a.dir="/"),a},sep:"/",delimiter:":",posix:null};return uf=s,uf}var Oy=Py();const Wr=jl(Oy);class ir{constructor(t){var e,i;e=t.indexOf("://"),e>-1&&(t=new URL(t).pathname),i=this.parse(t),this.path=t,this.isDirectory(t)?this.directory=t:this.directory=i.dir+"/",this.filename=i.base,this.extension=i.ext.slice(1)}parse(t){return Wr.parse(t)}isAbsolute(t){return Wr.isAbsolute(t||this.path)}isDirectory(t){return t.charAt(t.length-1)==="/"}resolve(t){return Wr.resolve(this.directory,t)}relative(t){var e=t&&t.indexOf("://")>-1;return e?t:Wr.relative(this.directory,t)}splitPath(t){return this.splitPathRe.exec(t).slice(1)}toString(){return this.path}}class Is{constructor(t,e){var i=t.indexOf("://")>-1,s=t,n;if(this.Url=void 0,this.href=t,this.protocol="",this.origin="",this.hash="",this.hash="",this.search="",this.base=e,!i&&e!==!1&&typeof e!="string"&&window&&window.location&&(this.base=window.location.href),i||this.base)try{this.base?this.Url=new URL(t,this.base):this.Url=new URL(t),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,s=this.Url.pathname+(this.Url.search?this.Url.search:"")}catch{this.Url=void 0,this.base&&(n=new ir(this.base),s=n.resolve(s))}this.Path=new ir(s),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}path(){return this.Path}resolve(t){var e=t.indexOf("://")>-1,i;return e?t:(i=Wr.resolve(this.directory,t),this.origin+i)}relative(t){return Wr.relative(t,this.directory)}toString(){return this.href}}const bo=1,fs=3,My=9;class ee{constructor(t,e,i){var s;if(this.str="",this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof ee))return new ee(t,e,i);if(typeof e=="string"?this.base=this.parseComponent(e):typeof e=="object"&&e.steps&&(this.base=e),s=this.checkType(t),s==="string")return this.str=t,yi(this,this.parse(t));if(s==="range")return yi(this,this.fromRange(t,this.base,i));if(s==="node")return yi(this,this.fromNode(t,this.base,i));if(s==="EpubCFI"&&t.path)return t;if(t)throw new TypeError("not a valid argument for EpubCFI");return this}checkType(t){return this.isCfiString(t)?"string":t&&typeof t=="object"&&(wv(t)==="Range"||typeof t.startContainer<"u")?"range":t&&typeof t=="object"&&typeof t.nodeType<"u"?"node":t&&typeof t=="object"&&t instanceof ee?"EpubCFI":!1}parse(t){var e={spinePos:-1,range:!1,base:{},path:{},start:null,end:null},i,s,n;return typeof t!="string"?{spinePos:-1}:(t.indexOf("epubcfi(")===0&&t[t.length-1]===")"&&(t=t.slice(8,t.length-1)),i=this.getChapterComponent(t),i?(e.base=this.parseComponent(i),s=this.getPathComponent(t),e.path=this.parseComponent(s),n=this.getRange(t),n&&(e.range=!0,e.start=this.parseComponent(n[0]),e.end=this.parseComponent(n[1])),e.spinePos=e.base.steps[1].index,e):{spinePos:-1})}parseComponent(t){var e={steps:[],terminal:{offset:null,assertion:null}},i=t.split(":"),s=i[0].split("/"),n;return i.length>1&&(n=i[1],e.terminal=this.parseTerminal(n)),s[0]===""&&s.shift(),e.steps=s.map((function(r){return this.parseStep(r)}).bind(this)),e}parseStep(t){var e,i,s,n,r;if(n=t.match(/\[(.*)\]/),n&&n[1]&&(r=n[1]),i=parseInt(t),!isNaN(i))return i%2===0?(e="element",s=i/2-1):(e="text",s=(i-1)/2),{type:e,index:s,id:r||null}}parseTerminal(t){var e,i,s=t.match(/\[(.*)\]/);return s&&s[1]?(e=parseInt(t.split("[")[0]),i=s[1]):e=parseInt(t),Le(e)||(e=null),{offset:e,assertion:i}}getChapterComponent(t){var e=t.split("!");return e[0]}getPathComponent(t){var e=t.split("!");if(e[1])return e[1].split(",")[0]}getRange(t){var e=t.split(",");return e.length===3?[e[1],e[2]]:!1}getCharecterOffsetComponent(t){var e=t.split(":");return e[1]||""}joinSteps(t){return t?t.map(function(e){var i="";return e.type==="element"&&(i+=(e.index+1)*2),e.type==="text"&&(i+=1+2*e.index),e.id&&(i+="["+e.id+"]"),i}).join("/"):""}segmentString(t){var e="/";return e+=this.joinSteps(t.steps),t.terminal&&t.terminal.offset!=null&&(e+=":"+t.terminal.offset),t.terminal&&t.terminal.assertion!=null&&(e+="["+t.terminal.assertion+"]"),e}toString(){var t="epubcfi(";return t+=this.segmentString(this.base),t+="!",t+=this.segmentString(this.path),this.range&&this.start&&(t+=",",t+=this.segmentString(this.start)),this.range&&this.end&&(t+=",",t+=this.segmentString(this.end)),t+=")",t}compare(t,e){var i,s,n,r;if(typeof t=="string"&&(t=new ee(t)),typeof e=="string"&&(e=new ee(e)),t.spinePos>e.spinePos)return 1;if(t.spinePos<e.spinePos)return-1;t.range?(i=t.path.steps.concat(t.start.steps),n=t.start.terminal):(i=t.path.steps,n=t.path.terminal),e.range?(s=e.path.steps.concat(e.start.steps),r=e.start.terminal):(s=e.path.steps,r=e.path.terminal);for(var a=0;a<i.length;a++){if(!i[a])return-1;if(!s[a]||i[a].index>s[a].index)return 1;if(i[a].index<s[a].index)return-1}return i.length<s.length?-1:n.offset>r.offset?1:n.offset<r.offset?-1:0}step(t){var e=t.nodeType===fs?"text":"element";return{id:t.id,tagName:t.tagName,type:e,index:this.position(t)}}filteredStep(t,e){var i=this.filter(t,e),s;if(i)return s=i.nodeType===fs?"text":"element",{id:i.id,tagName:i.tagName,type:s,index:this.filteredPosition(i,e)}}pathTo(t,e,i){for(var s={steps:[],terminal:{offset:null,assertion:null}},n=t,r;n&&n.parentNode&&n.parentNode.nodeType!=My;)i?r=this.filteredStep(n,i):r=this.step(n),r&&s.steps.unshift(r),n=n.parentNode;return e!=null&&e>=0&&(s.terminal.offset=e,s.steps[s.steps.length-1].type!="text"&&s.steps.push({type:"text",index:0})),s}equalStep(t,e){return!t||!e?!1:t.index===e.index&&t.id===e.id&&t.type===e.type}fromRange(t,e,i){var s={range:!1,base:{},path:{},start:null,end:null},n=t.startContainer,r=t.endContainer,a=t.startOffset,o=t.endOffset,h=!1;if(i&&(h=n.ownerDocument.querySelector("."+i)!=null),typeof e=="string"?(s.base=this.parseComponent(e),s.spinePos=s.base.steps[1].index):typeof e=="object"&&(s.base=e),t.collapsed)h&&(a=this.patchOffset(n,a,i)),s.path=this.pathTo(n,a,i);else{s.range=!0,h&&(a=this.patchOffset(n,a,i)),s.start=this.pathTo(n,a,i),h&&(o=this.patchOffset(r,o,i)),s.end=this.pathTo(r,o,i),s.path={steps:[],terminal:null};var u=s.start.steps.length,c;for(c=0;c<u&&this.equalStep(s.start.steps[c],s.end.steps[c]);c++)c===u-1?s.start.terminal===s.end.terminal&&(s.path.steps.push(s.start.steps[c]),s.range=!1):s.path.steps.push(s.start.steps[c]);s.start.steps=s.start.steps.slice(s.path.steps.length),s.end.steps=s.end.steps.slice(s.path.steps.length)}return s}fromNode(t,e,i){var s={range:!1,base:{},path:{},start:null,end:null};return typeof e=="string"?(s.base=this.parseComponent(e),s.spinePos=s.base.steps[1].index):typeof e=="object"&&(s.base=e),s.path=this.pathTo(t,null,i),s}filter(t,e){var i,s,n,r,a,o=!1;return t.nodeType===fs?(o=!0,n=t.parentNode,i=t.parentNode.classList.contains(e)):(o=!1,i=t.classList.contains(e)),i&&o?(r=n.previousSibling,a=n.nextSibling,r&&r.nodeType===fs?s=r:a&&a.nodeType===fs&&(s=a),s||t):i&&!o?!1:t}patchOffset(t,e,i){if(t.nodeType!=fs)throw new Error("Anchor must be a text node");var s=t,n=e;for(t.parentNode.classList.contains(i)&&(s=t.parentNode);s.previousSibling;){if(s.previousSibling.nodeType===bo)if(s.previousSibling.classList.contains(i))n+=s.previousSibling.textContent.length;else break;else n+=s.previousSibling.textContent.length;s=s.previousSibling}return n}normalizedMap(t,e,i){var s={},n=-1,r,a=t.length,o,h;for(r=0;r<a;r++)o=t[r].nodeType,o===bo&&t[r].classList.contains(i)&&(o=fs),r>0&&o===fs&&h===fs?s[r]=n:e===o&&(n=n+1,s[r]=n),h=o;return s}position(t){var e,i;return t.nodeType===bo?(e=t.parentNode.children,e||(e=qf(t.parentNode)),i=Array.prototype.indexOf.call(e,t)):(e=this.textNodes(t.parentNode),i=e.indexOf(t)),i}filteredPosition(t,e){var i,s,n;return t.nodeType===bo?(i=t.parentNode.children,n=this.normalizedMap(i,bo,e)):(i=t.parentNode.childNodes,t.parentNode.classList.contains(e)&&(t=t.parentNode,i=t.parentNode.childNodes),n=this.normalizedMap(i,fs,e)),s=Array.prototype.indexOf.call(i,t),n[s]}stepsToXpath(t){var e=[".","*"];return t.forEach(function(i){var s=i.index+1;i.id?e.push("*[position()="+s+" and @id='"+i.id+"']"):i.type==="text"?e.push("text()["+s+"]"):e.push("*["+s+"]")}),e.join("/")}stepsToQuerySelector(t){var e=["html"];return t.forEach(function(i){var s=i.index+1;i.id?e.push("#"+i.id):i.type==="text"||e.push("*:nth-child("+s+")")}),e.join(">")}textNodes(t,e){return Array.prototype.slice.call(t.childNodes).filter(function(i){return i.nodeType===fs?!0:!!(e&&i.classList.contains(e))})}walkToNode(t,e,i){var s=e||document,n=s.documentElement,r,a,o=t.length,h;for(h=0;h<o&&(a=t[h],a.type==="element"?a.id?n=s.getElementById(a.id):(r=n.children||qf(n),n=r[a.index]):a.type==="text"&&(n=this.textNodes(n,i)[a.index]),!!n);h++);return n}findNode(t,e,i){var s=e||document,n,r;return!i&&typeof s.evaluate<"u"?(r=this.stepsToXpath(t),n=s.evaluate(r,s,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue):i?n=this.walkToNode(t,s,i):n=this.walkToNode(t,s),n}fixMiss(t,e,i,s){var n=this.findNode(t.slice(0,-1),i,s),r=n.childNodes,a=this.normalizedMap(r,fs,s),o,h,u=t[t.length-1].index;for(let c in a){if(!a.hasOwnProperty(c))return;if(a[c]===u)if(o=r[c],h=o.textContent.length,e>h)e=e-h;else{o.nodeType===bo?n=o.childNodes[0]:n=o;break}}return{container:n,offset:e}}toRange(t,e){var i=t||document,s,n,r,a,o,h=this,u,c,f=e?i.querySelector("."+e)!=null:!1,p;if(typeof i.createRange<"u"?s=i.createRange():s=new Ev,h.range?(n=h.start,u=h.path.steps.concat(n.steps),a=this.findNode(u,i,f?e:null),r=h.end,c=h.path.steps.concat(r.steps),o=this.findNode(c,i,f?e:null)):(n=h.path,u=h.path.steps,a=this.findNode(h.path.steps,i,f?e:null)),a)try{n.terminal.offset!=null?s.setStart(a,n.terminal.offset):s.setStart(a,0)}catch{p=this.fixMiss(u,n.terminal.offset,i,f?e:null),s.setStart(p.container,p.offset)}else return console.log("No startContainer found for",this.toString()),null;if(o)try{r.terminal.offset!=null?s.setEnd(o,r.terminal.offset):s.setEnd(o,0)}catch{p=this.fixMiss(c,h.end.terminal.offset,i,f?e:null),s.setEnd(p.container,p.offset)}return s}isCfiString(t){return typeof t=="string"&&t.indexOf("epubcfi(")===0&&t[t.length-1]===")"}generateChapterComponent(t,e,i){var s=parseInt(e),n=(t+1)*2,r="/"+n+"/";return r+=(s+1)*2,i&&(r+="["+i+"]"),r}collapse(t){this.range&&(this.range=!1,t?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}class Ws{constructor(t){this.context=t||this,this.hooks=[]}register(){for(var t=0;t<arguments.length;++t)if(typeof arguments[t]=="function")this.hooks.push(arguments[t]);else for(var e=0;e<arguments[t].length;++e)this.hooks.push(arguments[t][e])}deregister(t){let e;for(let i=0;i<this.hooks.length;i++)if(e=this.hooks[i],e===t){this.hooks.splice(i,1);break}}trigger(){var t=arguments,e=this.context,i=[];return this.hooks.forEach(function(s){try{var n=s.apply(e,t)}catch(r){console.log(r)}n&&typeof n.then=="function"&&i.push(n)}),Promise.all(i)}list(){return this.hooks}clear(){return this.hooks=[]}}function xv(d,t){var e,i,s=t.url,n=s.indexOf("://")>-1;d&&(i=be(d,"head"),e=be(i,"base"),e||(e=d.createElement("base"),i.insertBefore(e,i.firstChild)),!n&&window&&window.location&&(s=window.location.origin+s),e.setAttribute("href",s))}function Fy(d,t){var e,i,s=t.canonical;d&&(e=be(d,"head"),i=be(e,"link[rel='canonical']"),i?i.setAttribute("href",s):(i=d.createElement("link"),i.setAttribute("rel","canonical"),i.setAttribute("href",s),e.appendChild(i)))}function By(d,t){var e,i,s=t.idref;d&&(e=be(d,"head"),i=be(e,"link[property='dc.identifier']"),i?i.setAttribute("content",s):(i=d.createElement("meta"),i.setAttribute("name","dc.identifier"),i.setAttribute("content",s),e.appendChild(i)))}function zy(d,t){var e=d.querySelectorAll("a[href]");if(e.length)for(var i=be(d.ownerDocument,"base"),s=i?i.getAttribute("href"):void 0,n=(function(a){var o=a.getAttribute("href");if(o.indexOf("mailto:")!==0){var h=o.indexOf("://")>-1;if(h)a.setAttribute("target","_blank");else{var u;try{u=new Is(o,s)}catch{}a.onclick=function(){return u&&u.hash?t(u.Path.path+u.hash):t(u?u.Path.path:o),!1}}}}).bind(this),r=0;r<e.length;r++)n(e[r])}function gm(d,t,e){return t.forEach(function(i,s){i&&e[s]&&(i=i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=d.replace(new RegExp(i,"g"),e[s]))}),d}function wh(d,t,e,i){var s=typeof window<"u"?window.URL:!1,n=s?"blob":"arraybuffer",r=new te,a=new XMLHttpRequest,o=XMLHttpRequest.prototype,h;"overrideMimeType"in o||Object.defineProperty(o,"overrideMimeType",{value:function(){}}),e&&(a.withCredentials=!0),a.onreadystatechange=c,a.onerror=u,a.open("GET",d,!0);for(h in i)a.setRequestHeader(h,i[h]);t=="json"&&a.setRequestHeader("Accept","application/json"),t||(t=new ir(d).extension),t=="blob"&&(a.responseType=n),yh(t)&&a.overrideMimeType("text/xml"),t=="binary"&&(a.responseType="arraybuffer"),a.send();function u(f){r.reject(f)}function c(){if(this.readyState===XMLHttpRequest.DONE){var f=!1;if((this.responseType===""||this.responseType==="document")&&(f=this.responseXML),this.status===200||this.status===0||f){var p;if(!this.response&&!f)return r.reject({status:this.status,message:"Empty Response",stack:new Error().stack}),r.promise;if(this.status===403)return r.reject({status:this.status,response:this.response,message:"Forbidden",stack:new Error().stack}),r.promise;f?p=this.responseXML:yh(t)?p=pn(this.response,"text/xml"):t=="xhtml"?p=pn(this.response,"application/xhtml+xml"):t=="html"||t=="htm"?p=pn(this.response,"text/html"):t=="json"?p=JSON.parse(this.response):t=="blob"?s?p=this.response:p=new Blob([this.response]):p=this.response,r.resolve(p)}else r.reject({status:this.status,message:this.response,stack:new Error().stack})}}return r.promise}class Uy{constructor(t,e){this.idref=t.idref,this.linear=t.linear==="yes",this.properties=t.properties,this.index=t.index,this.href=t.href,this.url=t.url,this.canonical=t.canonical,this.next=t.next,this.prev=t.prev,this.cfiBase=t.cfiBase,e?this.hooks=e:(this.hooks={},this.hooks.serialize=new Ws(this),this.hooks.content=new Ws(this)),this.document=void 0,this.contents=void 0,this.output=void 0}load(t){var e=t||this.request||wh,i=new te,s=i.promise;return this.contents?i.resolve(this.contents):e(this.url).then((function(n){return this.document=n,this.contents=n.documentElement,this.hooks.content.trigger(this.document,this)}).bind(this)).then((function(){i.resolve(this.contents)}).bind(this)).catch(function(n){i.reject(n)}),s}base(){return xv(this.document,this)}render(t){var e=new te,i=e.promise;return this.output,this.load(t).then((function(s){var n=typeof navigator<"u"&&navigator.userAgent||"",r=n.indexOf("Trident")>=0,a;typeof XMLSerializer>"u"||r?a=dv.DOMParser:a=XMLSerializer;var o=new a;return this.output=o.serializeToString(s),this.output}).bind(this)).then((function(){return this.hooks.serialize.trigger(this.output,this)}).bind(this)).then((function(){e.resolve(this.output)}).bind(this)).catch(function(s){e.reject(s)}),i}find(t){var e=this,i=[],s=t.toLowerCase(),n=function(r){for(var a=r.textContent.toLowerCase(),o=e.document.createRange(),h,u,c=-1,f,p=150;u!=-1;)u=a.indexOf(s,c+1),u!=-1&&(o=e.document.createRange(),o.setStart(r,u),o.setEnd(r,u+s.length),h=e.cfiFromRange(o),r.textContent.length<p?f=r.textContent:(f=r.textContent.substring(u-p/2,u+p/2),f="..."+f+"..."),i.push({cfi:h,excerpt:f})),c=u};return Yc(e.document,function(r){n(r)}),i}search(t,e=5){if(typeof document.createTreeWalker>"u")return this.find(t);let i=[];const s=150,n=this,r=t.toLowerCase(),a=function(c){const _=c.reduce((v,g)=>v+g.textContent,"").toLowerCase().indexOf(r);if(_!=-1){const g=_+r.length;let b=0,w=0;if(_<c[0].length){let S;for(;b<c.length-1&&(w+=c[b].length,!(g<=w));)b+=1;let T=c[0],A=c[b],C=n.document.createRange();C.setStart(T,_);let R=c.slice(0,b).reduce((N,F)=>N+F.textContent.length,0);C.setEnd(A,R>g?g:g-R),S=n.cfiFromRange(C);let P=c.slice(0,b+1).reduce((N,F)=>N+F.textContent,"");P.length>s&&(P=P.substring(_-s/2,_+s/2),P="..."+P+"..."),i.push({cfi:S,excerpt:P})}}},o=document.createTreeWalker(n.document,NodeFilter.SHOW_TEXT,null,!1);let h,u=[];for(;h=o.nextNode();)u.push(h),u.length==e&&(a(u.slice(0,e)),u=u.slice(1,e));return u.length>0&&a(u),i}reconcileLayoutSettings(t){var e={layout:t.layout,spread:t.spread,orientation:t.orientation};return this.properties.forEach(function(i){var s=i.replace("rendition:",""),n=s.indexOf("-"),r,a;n!=-1&&(r=s.slice(0,n),a=s.slice(n+1),e[r]=a)}),e}cfiFromRange(t){return new ee(t,this.cfiBase).toString()}cfiFromElement(t){return new ee(t,this.cfiBase).toString()}unload(){this.document=void 0,this.contents=void 0,this.output=void 0}destroy(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}class Hy{constructor(){this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new Ws,this.hooks.content=new Ws,this.hooks.content.register(xv),this.hooks.content.register(Fy),this.hooks.content.register(By),this.epubcfi=new ee,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}unpack(t,e,i){this.items=t.spine,this.manifest=t.manifest,this.spineNodeIndex=t.spineNodeIndex,this.baseUrl=t.baseUrl||t.basePath||"",this.length=this.items.length,this.items.forEach((s,n)=>{var r=this.manifest[s.idref],a;s.index=n,s.cfiBase=this.epubcfi.generateChapterComponent(this.spineNodeIndex,s.index,s.id),s.href&&(s.url=e(s.href,!0),s.canonical=i(s.href)),r&&(s.href=r.href,s.url=e(s.href,!0),s.canonical=i(s.href),r.properties.length&&s.properties.push.apply(s.properties,r.properties)),s.linear==="yes"?(s.prev=(function(){let o=s.index;for(;o>0;){let h=this.get(o-1);if(h&&h.linear)return h;o-=1}}).bind(this),s.next=(function(){let o=s.index;for(;o<this.spineItems.length-1;){let h=this.get(o+1);if(h&&h.linear)return h;o+=1}}).bind(this)):(s.prev=function(){},s.next=function(){}),a=new Uy(s,this.hooks),this.append(a)}),this.loaded=!0}get(t){var e=0;if(typeof t>"u")for(;e<this.spineItems.length;){let i=this.spineItems[e];if(i&&i.linear)break;e+=1}else this.epubcfi.isCfiString(t)?e=new ee(t).spinePos:typeof t=="number"||isNaN(t)===!1?e=t:typeof t=="string"&&t.indexOf("#")===0?e=this.spineById[t.substring(1)]:typeof t=="string"&&(t=t.split("#")[0],e=this.spineByHref[t]||this.spineByHref[encodeURI(t)]);return this.spineItems[e]||null}append(t){var e=this.spineItems.length;return t.index=e,this.spineItems.push(t),this.spineByHref[decodeURI(t.href)]=e,this.spineByHref[encodeURI(t.href)]=e,this.spineByHref[t.href]=e,this.spineById[t.idref]=e,e}prepend(t){return this.spineByHref[t.href]=0,this.spineById[t.idref]=0,this.spineItems.forEach(function(e,i){e.index=i}),0}remove(t){var e=this.spineItems.indexOf(t);if(e>-1)return delete this.spineByHref[t.href],delete this.spineById[t.idref],this.spineItems.splice(e,1)}each(){return this.spineItems.forEach.apply(this.spineItems,arguments)}first(){let t=0;do{let e=this.get(t);if(e&&e.linear)return e;t+=1}while(t<this.spineItems.length)}last(){let t=this.spineItems.length-1;do{let e=this.get(t);if(e&&e.linear)return e;t-=1}while(t>=0)}destroy(){this.each(t=>t.destroy()),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}}class fg{constructor(t){this._q=[],this.context=t,this.tick=ug,this.running=!1,this.paused=!1}enqueue(){var t,e,i,s=[].shift.call(arguments),n=arguments;if(!s)throw new Error("No Task Provided");return typeof s=="function"?(t=new te,e=t.promise,i={task:s,args:n,deferred:t,promise:e}):i={promise:s},this._q.push(i),this.paused==!1&&!this.running&&this.run(),i.promise}dequeue(){var t,e,i;if(this._q.length&&!this.paused){if(t=this._q.shift(),e=t.task,e)return i=e.apply(this.context,t.args),i&&typeof i.then=="function"?i.then((function(){t.deferred.resolve.apply(this.context,arguments)}).bind(this),(function(){t.deferred.reject.apply(this.context,arguments)}).bind(this)):(t.deferred.resolve.apply(this.context,i),t.promise);if(t.promise)return t.promise}else return t=new te,t.deferred.resolve(),t.promise}dump(){for(;this._q.length;)this.dequeue()}run(){return this.running||(this.running=!0,this.defered=new te),this.tick.call(window,()=>{this._q.length?this.dequeue().then((function(){this.run()}).bind(this)):(this.defered.resolve(),this.running=void 0)}),this.paused==!0&&(this.paused=!1),this.defered.promise}flush(){if(this.running)return this.running;if(this._q.length)return this.running=this.dequeue().then((function(){return this.running=void 0,this.flush()}).bind(this)),this.running}clear(){this._q=[]}length(){return this._q.length}pause(){this.paused=!0}stop(){this._q=[],this.running=!1,this.paused=!0}}const kd="0.3",fc=["keydown","keyup","keypressed","mouseup","mousedown","mousemove","click","touchend","touchstart","touchmove"],mt={BOOK:{OPEN_FAILED:"openFailed"},CONTENTS:{EXPAND:"expand",RESIZE:"resize",SELECTED:"selected",SELECTED_RANGE:"selectedRange",LINK_CLICKED:"linkClicked"},LOCATIONS:{CHANGED:"changed"},MANAGERS:{RESIZE:"resize",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",ADDED:"added",SCROLL:"scroll",SCROLLED:"scrolled",REMOVED:"removed"},VIEWS:{AXIS:"axis",WRITING_MODE:"writingMode",LOAD_ERROR:"loaderror",RENDERED:"rendered",RESIZED:"resized",DISPLAYED:"displayed",SHOWN:"shown",HIDDEN:"hidden",MARK_CLICKED:"markClicked"},RENDITION:{STARTED:"started",ATTACHED:"attached",DISPLAYED:"displayed",DISPLAY_ERROR:"displayerror",RENDERED:"rendered",REMOVED:"removed",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",LOCATION_CHANGED:"locationChanged",RELOCATED:"relocated",MARK_CLICKED:"markClicked",SELECTED:"selected",LAYOUT:"layout"},LAYOUT:{UPDATED:"updated"},ANNOTATION:{ATTACH:"attach",DETACH:"detach"}};class Sv{constructor(t,e,i){this.spine=t,this.request=e,this.pause=i||100,this.q=new fg(this),this.epubcfi=new ee,this._locations=[],this._locationsWords=[],this.total=0,this.break=150,this._current=0,this._wordCounter=0,this.currentLocation="",this._currentCfi="",this.processingTimeout=void 0}generate(t){return t&&(this.break=t),this.q.pause(),this.spine.each((function(e){e.linear&&this.q.enqueue(this.process.bind(this),e)}).bind(this)),this.q.run().then((function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}).bind(this))}createRange(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}process(t){return t.load(this.request).then((function(e){var i=new te,s=this.parse(e,t.cfiBase);return this._locations=this._locations.concat(s),t.unload(),this.processingTimeout=setTimeout(()=>i.resolve(s),this.pause),i.promise}).bind(this))}parse(t,e,i){var s=[],n,r=t.ownerDocument,a=be(r,"body"),o=0,h,u=i||this.break,c=function(f){var p=f.length,_,v=0;if(f.textContent.trim().length===0)return!1;for(o==0&&(n=this.createRange(),n.startContainer=f,n.startOffset=0),_=u-o,_>p&&(o+=p,v=p);v<p;)if(_=u-o,o===0&&(v+=1,n=this.createRange(),n.startContainer=f,n.startOffset=v),v+_>=p)o+=p-v,v=p;else{v+=_,n.endContainer=f,n.endOffset=v;let g=new ee(n,e).toString();s.push(g),o=0}h=f};if(Yc(a,c.bind(this)),n&&n.startContainer&&h){n.endContainer=h,n.endOffset=h.length;let f=new ee(n,e).toString();s.push(f),o=0}return s}generateFromWords(t,e,i){var s=t?new ee(t):void 0;return this.q.pause(),this._locationsWords=[],this._wordCounter=0,this.spine.each((function(n){n.linear&&(s?n.index>=s.spinePos&&this.q.enqueue(this.processWords.bind(this),n,e,s,i):this.q.enqueue(this.processWords.bind(this),n,e,s,i))}).bind(this)),this.q.run().then((function(){return this._currentCfi&&(this.currentLocation=this._currentCfi),this._locationsWords}).bind(this))}processWords(t,e,i,s){return s&&this._locationsWords.length>=s?Promise.resolve():t.load(this.request).then((function(n){var r=new te,a=this.parseWords(n,t,e,i),o=s-this._locationsWords.length;return this._locationsWords=this._locationsWords.concat(a.length>=s?a.slice(0,o):a),t.unload(),this.processingTimeout=setTimeout(()=>r.resolve(a),this.pause),r.promise}).bind(this))}countWords(t){return t=t.replace(/(^\s*)|(\s*$)/gi,""),t=t.replace(/[ ]{2,}/gi," "),t=t.replace(/\n /,`
`),t.split(" ").length}parseWords(t,e,i,s){var n=e.cfiBase,r=[],a=t.ownerDocument,o=be(a,"body"),h=i,u=s?s.spinePos!==e.index:!0,c;s&&e.index===s.spinePos&&(c=s.findNode(s.range?s.path.steps.concat(s.start.steps):s.path.steps,t.ownerDocument));var f=function(p){if(!u)if(p===c)u=!0;else return!1;if(p.textContent.length<10&&p.textContent.trim().length===0)return!1;var _=this.countWords(p.textContent),v,g=0;if(_===0)return!1;for(v=h-this._wordCounter,v>_&&(this._wordCounter+=_,g=_);g<_;)if(v=h-this._wordCounter,g+v>=_)this._wordCounter+=_-g,g=_;else{g+=v;let b=new ee(p,n);r.push({cfi:b.toString(),wordCount:this._wordCounter}),this._wordCounter=0}};return Yc(o,f.bind(this)),r}locationFromCfi(t){let e;return ee.prototype.isCfiString(t)&&(t=new ee(t)),this._locations.length===0?-1:(e=ql(t,this._locations,this.epubcfi.compare),e>this.total?this.total:e)}percentageFromCfi(t){if(this._locations.length===0)return null;var e=this.locationFromCfi(t);return this.percentageFromLocation(e)}percentageFromLocation(t){return!t||!this.total?0:t/this.total}cfiFromLocation(t){var e=-1;return typeof t!="number"&&(t=parseInt(t)),t>=0&&t<this._locations.length&&(e=this._locations[t]),e}cfiFromPercentage(t){let e;if(t>1&&console.warn("Normalize cfiFromPercentage value to between 0 - 1"),t>=1){let i=new ee(this._locations[this.total]);return i.collapse(),i.toString()}return e=Math.ceil(this.total*t),this.cfiFromLocation(e)}load(t){return typeof t=="string"?this._locations=JSON.parse(t):this._locations=t,this.total=this._locations.length-1,this._locations}save(){return JSON.stringify(this._locations)}getCurrent(){return this._current}setCurrent(t){var e;if(typeof t=="string")this._currentCfi=t;else if(typeof t=="number")this._current=t;else return;this._locations.length!==0&&(typeof t=="string"?(e=this.locationFromCfi(t),this._current=e):e=t,this.emit(mt.LOCATIONS.CHANGED,{percentage:this.percentageFromLocation(e)}))}get currentLocation(){return this._current}set currentLocation(t){this.setCurrent(t)}length(){return this._locations.length}destroy(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.stop(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}}mn(Sv.prototype);class qy{constructor(t){this.packagePath="",this.directory="",this.encoding="",t&&this.parse(t)}parse(t){var e;if(!t)throw new Error("Container File Not Found");if(e=be(t,"rootfile"),!e)throw new Error("No RootFile Found");this.packagePath=e.getAttribute("full-path"),this.directory=Wr.dirname(this.packagePath),this.encoding=t.xmlEncoding}destroy(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}}class mm{constructor(t){this.manifest={},this.navPath="",this.ncxPath="",this.coverPath="",this.spineNodeIndex=0,this.spine=[],this.metadata={},t&&this.parse(t)}parse(t){var e,i,s;if(!t)throw new Error("Package File Not Found");if(e=be(t,"metadata"),!e)throw new Error("No Metadata Found");if(i=be(t,"manifest"),!i)throw new Error("No Manifest Found");if(s=be(t,"spine"),!s)throw new Error("No Spine Found");return this.manifest=this.parseManifest(i),this.navPath=this.findNavPath(i),this.ncxPath=this.findNcxPath(i,s),this.coverPath=this.findCoverPath(t),this.spineNodeIndex=vv(s),this.spine=this.parseSpine(s,this.manifest),this.uniqueIdentifier=this.findUniqueIdentifier(t),this.metadata=this.parseMetadata(e),this.metadata.direction=s.getAttribute("page-progression-direction"),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}parseMetadata(t){var e={};return e.title=this.getElementText(t,"title"),e.creator=this.getElementText(t,"creator"),e.description=this.getElementText(t,"description"),e.pubdate=this.getElementText(t,"date"),e.publisher=this.getElementText(t,"publisher"),e.identifier=this.getElementText(t,"identifier"),e.language=this.getElementText(t,"language"),e.rights=this.getElementText(t,"rights"),e.modified_date=this.getPropertyText(t,"dcterms:modified"),e.layout=this.getPropertyText(t,"rendition:layout"),e.orientation=this.getPropertyText(t,"rendition:orientation"),e.flow=this.getPropertyText(t,"rendition:flow"),e.viewport=this.getPropertyText(t,"rendition:viewport"),e.media_active_class=this.getPropertyText(t,"media:active-class"),e.spread=this.getPropertyText(t,"rendition:spread"),e}parseManifest(t){var e={},i=er(t,"item"),s=Array.prototype.slice.call(i);return s.forEach(function(n){var r=n.getAttribute("id"),a=n.getAttribute("href")||"",o=n.getAttribute("media-type")||"",h=n.getAttribute("media-overlay")||"",u=n.getAttribute("properties")||"";e[r]={href:a,type:o,overlay:h,properties:u.length?u.split(" "):[]}}),e}parseSpine(t,e){var i=[],s=er(t,"itemref"),n=Array.prototype.slice.call(s);return n.forEach(function(r,a){var o=r.getAttribute("idref"),h=r.getAttribute("properties")||"",u=h.length?h.split(" "):[],c={id:r.getAttribute("id"),idref:o,linear:r.getAttribute("linear")||"yes",properties:u,index:a};i.push(c)}),i}findUniqueIdentifier(t){var e=t.documentElement.getAttribute("unique-identifier");if(!e)return"";var i=t.getElementById(e);return i&&i.localName==="identifier"&&i.namespaceURI==="http://purl.org/dc/elements/1.1/"&&i.childNodes.length>0?i.childNodes[0].nodeValue.trim():""}findNavPath(t){var e=_o(t,"item",{properties:"nav"});return e?e.getAttribute("href"):!1}findNcxPath(t,e){var i=_o(t,"item",{"media-type":"application/x-dtbncx+xml"}),s;return i||(s=e.getAttribute("toc"),s&&(i=t.querySelector(`#${s}`))),i?i.getAttribute("href"):!1}findCoverPath(t){var e=be(t,"package");e.getAttribute("version");var i=_o(t,"item",{properties:"cover-image"});if(i)return i.getAttribute("href");var s=_o(t,"meta",{name:"cover"});if(s){var n=s.getAttribute("content"),r=t.getElementById(n);return r?r.getAttribute("href"):""}else return!1}getElementText(t,e){var i=t.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",e),s;return!i||i.length===0?"":(s=i[0],s.childNodes.length?s.childNodes[0].nodeValue:"")}getPropertyText(t,e){var i=_o(t,"meta",{property:e});return i&&i.childNodes.length?i.childNodes[0].nodeValue:""}load(t){this.metadata=t.metadata;let e=t.readingOrder||t.spine;return this.spine=e.map((i,s)=>(i.index=s,i.linear=i.linear||"yes",i)),t.resources.forEach((i,s)=>{this.manifest[s]=i,i.rel&&i.rel[0]==="cover"&&(this.coverPath=i.href)}),this.spineNodeIndex=0,this.toc=t.toc.map((i,s)=>(i.label=i.title,i)),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}destroy(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}}class cf{constructor(t){this.toc=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0,t&&this.parse(t)}parse(t){let e=t.nodeType,i,s;e&&(i=be(t,"html"),s=be(t,"ncx")),e?i?(this.toc=this.parseNav(t),this.landmarks=this.parseLandmarks(t)):s&&(this.toc=this.parseNcx(t)):this.toc=this.load(t),this.length=0,this.unpack(this.toc)}unpack(t){for(var e,i=0;i<t.length;i++)e=t[i],e.href&&(this.tocByHref[e.href]=i),e.id&&(this.tocById[e.id]=i),this.length++,e.subitems.length&&this.unpack(e.subitems)}get(t){var e;return t?(t.indexOf("#")===0?e=this.tocById[t.substring(1)]:t in this.tocByHref&&(e=this.tocByHref[t]),this.getByIndex(t,e,this.toc)):this.toc}getByIndex(t,e,i){if(i.length===0)return;const s=i[e];if(s&&(t===s.id||t===s.href))return s;{let n;for(let r=0;r<i.length&&(n=this.getByIndex(t,e,i[r].subitems),!n);++r);return n}}landmark(t){var e;return t?(e=this.landmarksByType[t],this.landmarks[e]):this.landmarks}parseNav(t){var e=Kc(t,"nav","toc"),i=[];if(!e)return i;let s=Ao(e,"ol",!0);return s&&(i=this.parseNavList(s)),i}parseNavList(t,e){const i=[];if(!t||!t.children)return i;for(let s=0;s<t.children.length;s++){const n=this.navItem(t.children[s],e);n&&i.push(n)}return i}navItem(t,e){let i=t.getAttribute("id")||void 0,s=Ao(t,"a",!0)||Ao(t,"span",!0);if(!s)return;let n=s.getAttribute("href")||"";i||(i=n);let r=s.textContent||"",a=[],o=Ao(t,"ol",!0);return o&&(a=this.parseNavList(o,i)),{id:i,href:n,label:r,subitems:a,parent:e}}parseLandmarks(t){var e=Kc(t,"nav","landmarks"),i=e?er(e,"li"):[],s=i.length,n,r=[],a;if(!i||s===0)return r;for(n=0;n<s;++n)a=this.landmarkItem(i[n]),a&&(r.push(a),this.landmarksByType[a.type]=n);return r}landmarkItem(t){let e=Ao(t,"a",!0);if(!e)return;let i=e.getAttributeNS("http://www.idpf.org/2007/ops","type")||void 0,s=e.getAttribute("href")||"",n=e.textContent||"";return{href:s,label:n,type:i}}parseNcx(t){var e=er(t,"navPoint"),i=e.length,s,n={},r=[],a,o;if(!e||i===0)return r;for(s=0;s<i;++s)a=this.ncxItem(e[s]),n[a.id]=a,a.parent?(o=n[a.parent],o.subitems.push(a)):r.push(a);return r}ncxItem(t){var e=t.getAttribute("id")||!1,i=be(t,"content"),s=i.getAttribute("src"),n=be(t,"navLabel"),r=n.textContent?n.textContent:"",a=[],o=t.parentNode,h;return o&&(o.nodeName==="navPoint"||o.nodeName.split(":").slice(-1)[0]==="navPoint")&&(h=o.getAttribute("id")),{id:e,href:s,label:r,subitems:a,parent:h}}load(t){return t.map(e=>(e.label=e.title,e.subitems=e.children?this.load(e.children):[],e))}forEach(t){return this.toc.forEach(t)}}var Yl={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},jy=function(){var d,t,e,i,s={};for(d in Yl)if(Yl.hasOwnProperty(d)){for(t in Yl[d])if(Yl[d].hasOwnProperty(t))if(e=Yl[d][t],typeof e=="string")s[e]=d+"/"+t;else for(i=0;i<e.length;i++)s[e[i]]=d+"/"+t}return s}(),Wy="text/plain";function Vy(d){return d&&jy[d.split(".").pop().toLowerCase()]||Wy}const Lo={lookup:Vy};class Gy{constructor(t,e){this.settings={replacements:e&&e.replacements||"base64",archive:e&&e.archive,resolver:e&&e.resolver,request:e&&e.request},this.process(t)}process(t){this.manifest=t,this.resources=Object.keys(t).map(function(e){return t[e]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}split(){this.html=this.resources.filter(function(t){if(t.type==="application/xhtml+xml"||t.type==="text/html")return!0}),this.assets=this.resources.filter(function(t){if(t.type!=="application/xhtml+xml"&&t.type!=="text/html")return!0}),this.css=this.resources.filter(function(t){if(t.type==="text/css")return!0})}splitUrls(){this.urls=this.assets.map((function(t){return t.href}).bind(this)),this.cssUrls=this.css.map(function(t){return t.href})}createUrl(t){var e=new Is(t),i=Lo.lookup(e.filename);return this.settings.archive?this.settings.archive.createUrl(t,{base64:this.settings.replacements==="base64"}):this.settings.replacements==="base64"?this.settings.request(t,"blob").then(s=>Av(s)).then(s=>Hf(s,i)):this.settings.request(t,"blob").then(s=>Xc(s,i))}replacements(){if(this.settings.replacements==="none")return new Promise((function(e){e(this.urls)}).bind(this));var t=this.urls.map(e=>{var i=this.settings.resolver(e);return this.createUrl(i).catch(s=>(console.error(s),null))});return Promise.all(t).then(e=>(this.replacementUrls=e.filter(i=>typeof i=="string"),e))}replaceCss(t,e){var i=[];return t=t||this.settings.archive,e=e||this.settings.resolver,this.cssUrls.forEach((function(s){var n=this.createCssFile(s,t,e).then((function(r){var a=this.urls.indexOf(s);a>-1&&(this.replacementUrls[a]=r)}).bind(this));i.push(n)}).bind(this)),Promise.all(i)}createCssFile(t){var e;if(Wr.isAbsolute(t))return new Promise(function(r){r()});var i=this.settings.resolver(t),s;this.settings.archive?s=this.settings.archive.getText(i):s=this.settings.request(i,"text");var n=this.urls.map(r=>{var a=this.settings.resolver(r),o=new ir(i).relative(a);return o});return s?s.then(r=>(r=gm(r,n,this.replacementUrls),this.settings.replacements==="base64"?e=Hf(r,"text/css"):e=Xc(r,"text/css"),e),r=>new Promise(function(a){a()})):new Promise(function(r){r()})}relativeTo(t,e){return e=e||this.settings.resolver,this.urls.map((function(i){var s=e(i),n=new ir(t).relative(s);return n}).bind(this))}get(t){var e=this.urls.indexOf(t);if(e!==-1)return this.replacementUrls.length?new Promise((function(i,s){i(this.replacementUrls[e])}).bind(this)):this.createUrl(t)}substitute(t,e){var i;return e?i=this.relativeTo(e):i=this.urls,gm(t,i,this.replacementUrls)}destroy(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}}class df{constructor(t){this.pages=[],this.locations=[],this.epubcfi=new ee,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,t&&(this.pageList=this.parse(t)),this.pageList&&this.pageList.length&&this.process(this.pageList)}parse(t){var e=be(t,"html"),i=be(t,"ncx");if(e)return this.parseNav(t);if(i)return this.parseNcx(t)}parseNav(t){var e=Kc(t,"nav","page-list"),i=e?er(e,"li"):[],s=i.length,n,r=[],a;if(!i||s===0)return r;for(n=0;n<s;++n)a=this.item(i[n]),r.push(a);return r}parseNcx(t){var e=[],i=0,s,n,r,a=0;if(n=be(t,"pageList"),!n||(r=er(n,"pageTarget"),a=r.length,!r||r.length===0))return e;for(i=0;i<a;++i)s=this.ncxItem(r[i]),e.push(s);return e}ncxItem(t){var e=be(t,"navLabel"),i=be(e,"text"),s=i.textContent,n=be(t,"content"),r=n.getAttribute("src"),a=parseInt(s,10);return{href:r,page:a}}item(t){var e=be(t,"a"),i=e.getAttribute("href")||"",s=e.textContent||"",n=parseInt(s),r=i.indexOf("epubcfi"),a,o,h;return r!=-1?(a=i.split("#"),o=a[0],h=a.length>1?a[1]:!1,{cfi:h,href:i,packageUrl:o,page:n}):{href:i,page:n}}process(t){t.forEach(function(e){this.pages.push(e.page),e.cfi&&this.locations.push(e.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}pageFromCfi(t){var e=-1;if(this.locations.length===0)return-1;var i=Vc(t,this.locations,this.epubcfi.compare);return i!=-1?e=this.pages[i]:(i=ql(t,this.locations,this.epubcfi.compare),e=i-1>=0?this.pages[i-1]:this.pages[0],e!==void 0||(e=-1)),e}cfiFromPage(t){var e=-1;typeof t!="number"&&(t=parseInt(t));var i=this.pages.indexOf(t);return i!=-1&&(e=this.locations[i]),e}pageFromPercentage(t){var e=Math.round(this.totalPages*t);return e}percentageFromPage(t){var e=(t-this.firstPage)/this.totalPages;return Math.round(e*1e3)/1e3}percentageFromCfi(t){var e=this.pageFromCfi(t),i=this.percentageFromPage(e);return i}destroy(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}class Cv{constructor(t){this.settings=t,this.name=t.layout||"reflowable",this._spread=t.spread!=="none",this._minSpreadWidth=t.minSpreadWidth||800,this._evenSpreads=t.evenSpreads||!1,t.flow==="scrolled"||t.flow==="scrolled-continuous"||t.flow==="scrolled-doc"?this._flow="scrolled":this._flow="paginated",this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}flow(t){return typeof t<"u"&&(t==="scrolled"||t==="scrolled-continuous"||t==="scrolled-doc"?this._flow="scrolled":this._flow="paginated",this.update({flow:this._flow})),this._flow}spread(t,e){return t&&(this._spread=t!=="none",this.update({spread:this._spread})),e>=0&&(this._minSpreadWidth=e),this._spread}calculate(t,e,i){var s=1,n=i||0,r=t,a=e,o=Math.floor(r/12),h,u,c,f;this._spread&&r>=this._minSpreadWidth?s=2:s=1,this.name==="reflowable"&&this._flow==="paginated"&&!(i>=0)&&(n=o%2===0?o:o-1),this.name==="pre-paginated"&&(n=0),s>1?(h=r/s-n,c=h+n):(h=r,c=r),this.name==="pre-paginated"&&s>1&&(r=h),u=h*s+n,f=r,this.width=r,this.height=a,this.spreadWidth=u,this.pageWidth=c,this.delta=f,this.columnWidth=h,this.gap=n,this.divisor=s,this.update({width:r,height:a,spreadWidth:u,pageWidth:c,delta:f,columnWidth:h,gap:n,divisor:s})}format(t,e,i){var s;return this.name==="pre-paginated"?s=t.fit(this.columnWidth,this.height,e):this._flow==="paginated"?s=t.columns(this.width,this.height,this.columnWidth,this.gap,this.settings.direction):i&&i==="horizontal"?s=t.size(null,this.height):s=t.size(this.width,null),s}count(t,e){let i,s;return this.name==="pre-paginated"?(i=1,s=1):this._flow==="paginated"?(e=e||this.delta,i=Math.ceil(t/e),s=i*this.divisor):(e=e||this.height,i=Math.ceil(t/e),s=i),{spreads:i,pages:s}}update(t){if(Object.keys(t).forEach(e=>{this.props[e]===t[e]&&delete t[e]}),Object.keys(t).length>0){let e=yi(this.props,t);this.emit(mt.LAYOUT.UPDATED,e,t)}}}mn(Cv.prototype);class $y{constructor(t){this.rendition=t,this._themes={default:{rules:{},url:"",serialized:""}},this._overrides={},this._current="default",this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}register(){if(arguments.length!==0){if(arguments.length===1&&typeof arguments[0]=="object")return this.registerThemes(arguments[0]);if(arguments.length===1&&typeof arguments[0]=="string")return this.default(arguments[0]);if(arguments.length===2&&typeof arguments[1]=="string")return this.registerUrl(arguments[0],arguments[1]);if(arguments.length===2&&typeof arguments[1]=="object")return this.registerRules(arguments[0],arguments[1])}}default(t){if(t){if(typeof t=="string")return this.registerUrl("default",t);if(typeof t=="object")return this.registerRules("default",t)}}registerThemes(t){for(var e in t)t.hasOwnProperty(e)&&(typeof t[e]=="string"?this.registerUrl(e,t[e]):this.registerRules(e,t[e]))}registerCss(t,e){this._themes[t]={serialized:e},(this._injected[t]||t=="default")&&this.update(t)}registerUrl(t,e){var i=new Is(e);this._themes[t]={url:i.toString()},(this._injected[t]||t=="default")&&this.update(t)}registerRules(t,e){this._themes[t]={rules:e},(this._injected[t]||t=="default")&&this.update(t)}select(t){var e=this._current,i;this._current=t,this.update(t),i=this.rendition.getContents(),i.forEach(s=>{s.removeClass(e),s.addClass(t)})}update(t){var e=this.rendition.getContents();e.forEach(i=>{this.add(t,i)})}inject(t){var e=[],i=this._themes,s;for(var n in i)i.hasOwnProperty(n)&&(n===this._current||n==="default")&&(s=i[n],(s.rules&&Object.keys(s.rules).length>0||s.url&&e.indexOf(s.url)===-1)&&this.add(n,t),this._injected.push(n));this._current!="default"&&t.addClass(this._current)}add(t,e){var i=this._themes[t];!i||!e||(i.url?e.addStylesheet(i.url):i.serialized?(e.addStylesheetCss(i.serialized,t),i.injected=!0):i.rules&&(e.addStylesheetRules(i.rules,t),i.injected=!0))}override(t,e,i){var s=this.rendition.getContents();this._overrides[t]={value:e,priority:i===!0},s.forEach(n=>{n.css(t,this._overrides[t].value,this._overrides[t].priority)})}removeOverride(t){var e=this.rendition.getContents();delete this._overrides[t],e.forEach(i=>{i.css(t)})}overrides(t){var e=this._overrides;for(var i in e)e.hasOwnProperty(i)&&t.css(i,e[i].value,e[i].priority)}fontSize(t){this.override("font-size",t)}font(t){this.override("font-family",t,!0)}destroy(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}}class Zc{constructor(t,e,i,s=!1){this.layout=t,this.horizontal=i==="horizontal",this.direction=e||"ltr",this._dev=s}section(t){var e=this.findRanges(t),i=this.rangeListToCfiList(t.section.cfiBase,e);return i}page(t,e,i,s){var n=t&&t.document?t.document.body:!1,r;if(n){if(r=this.rangePairToCfiPair(e,{start:this.findStart(n,i,s),end:this.findEnd(n,i,s)}),this._dev===!0){let a=t.document,o=new ee(r.start).toRange(a),h=new ee(r.end).toRange(a),u=a.defaultView.getSelection(),c=a.createRange();u.removeAllRanges(),c.setStart(o.startContainer,o.startOffset),c.setEnd(h.endContainer,h.endOffset),u.addRange(c)}return r}}walk(t,e){if(!(t&&t.nodeType===Node.TEXT_NODE)){var i={acceptNode:function(o){return o.data.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},s=i.acceptNode;s.acceptNode=i.acceptNode;for(var n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,s,!1),r,a;(r=n.nextNode())&&(a=e(r),!a););return a}}findRanges(t){for(var e=[],i=t.contents.scrollWidth(),s=Math.ceil(i/this.layout.spreadWidth),n=s*this.layout.divisor,r=this.layout.columnWidth,a=this.layout.gap,o,h,u=0;u<n.pages;u++)o=(r+a)*u,h=r*(u+1)+a*u,e.push({start:this.findStart(t.document.body,o,h),end:this.findEnd(t.document.body,o,h)});return e}findStart(t,e,i){for(var s=[t],n,r,a=t;s.length;)if(n=s.shift(),r=this.walk(n,o=>{var h,u,c,f,p;if(p=Uf(o),this.horizontal&&this.direction==="ltr"){if(h=this.horizontal?p.left:p.top,u=this.horizontal?p.right:p.bottom,h>=e&&h<=i)return o;if(u>e)return o;a=o,s.push(o)}else if(this.horizontal&&this.direction==="rtl"){if(h=p.left,u=p.right,u<=i&&u>=e)return o;if(h<i)return o;a=o,s.push(o)}else{if(c=p.top,f=p.bottom,c>=e&&c<=i)return o;if(f>e)return o;a=o,s.push(o)}}),r)return this.findTextStartRange(r,e,i);return this.findTextStartRange(a,e,i)}findEnd(t,e,i){for(var s=[t],n,r=t,a;s.length;)if(n=s.shift(),a=this.walk(n,o=>{var h,u,c,f,p;if(p=Uf(o),this.horizontal&&this.direction==="ltr"){if(h=Math.round(p.left),u=Math.round(p.right),h>i&&r)return r;if(u>i)return o;r=o,s.push(o)}else if(this.horizontal&&this.direction==="rtl"){if(h=Math.round(this.horizontal?p.left:p.top),u=Math.round(this.horizontal?p.right:p.bottom),u<e&&r)return r;if(h<e)return o;r=o,s.push(o)}else{if(c=Math.round(p.top),f=Math.round(p.bottom),c>i&&r)return r;if(f>i)return o;r=o,s.push(o)}}),a)return this.findTextEndRange(a,e,i);return this.findTextEndRange(r,e,i)}findTextStartRange(t,e,i){for(var s=this.splitTextNodeIntoRanges(t),n,r,a,o,h,u=0;u<s.length;u++)if(n=s[u],r=n.getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(a=r.left,a>=e)return n}else if(this.horizontal&&this.direction==="rtl"){if(h=r.right,h<=i)return n}else if(o=r.top,o>=e)return n;return s[0]}findTextEndRange(t,e,i){for(var s=this.splitTextNodeIntoRanges(t),n,r,a,o,h,u,c,f=0;f<s.length;f++){if(r=s[f],a=r.getBoundingClientRect(),this.horizontal&&this.direction==="ltr"){if(o=a.left,h=a.right,o>i&&n)return n;if(h>i)return r}else if(this.horizontal&&this.direction==="rtl"){if(o=a.left,h=a.right,h<e&&n)return n;if(o<e)return r}else{if(u=a.top,c=a.bottom,u>i&&n)return n;if(c>i)return r}n=r}return s[s.length-1]}splitTextNodeIntoRanges(t,e){var i=[],s=t.textContent||"",n=s.trim(),r,a=t.ownerDocument,o=e||" ",h=n.indexOf(o);if(h===-1||t.nodeType!=Node.TEXT_NODE)return r=a.createRange(),r.selectNodeContents(t),[r];for(r=a.createRange(),r.setStart(t,0),r.setEnd(t,h),i.push(r),r=!1;h!=-1;)h=n.indexOf(o,h+1),h>0&&(r&&(r.setEnd(t,h),i.push(r)),r=a.createRange(),r.setStart(t,h+1));return r&&(r.setEnd(t,n.length),i.push(r)),i}rangePairToCfiPair(t,e){var i=e.start,s=e.end;i.collapse(!0),s.collapse(!1);let n=new ee(i,t).toString(),r=new ee(s,t).toString();return{start:n,end:r}}rangeListToCfiList(t,e){for(var i=[],s,n=0;n<e.length;n++)s=this.rangePairToCfiPair(t,e[n]),i.push(s);return i}axis(t){return t&&(this.horizontal=t==="horizontal"),this.horizontal}}const Tv=typeof navigator<"u",Xy=Tv&&/Chrome/.test(navigator.userAgent),vm=Tv&&!Xy&&/AppleWebKit/.test(navigator.userAgent),Yy=1;class pg{constructor(t,e,i,s){this.epubcfi=new ee,this.document=t,this.documentElement=this.document.documentElement,this.content=e||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=s||0,this.cfiBase=i||"",this.epubReadingSystem("epub.js",kd),this.called=0,this.active=!0,this.listeners()}static get listenedEvents(){return fc}width(t){var e=this.content;return t&&Le(t)&&(t=t+"px"),t&&(e.style.width=t),parseInt(this.window.getComputedStyle(e).width)}height(t){var e=this.content;return t&&Le(t)&&(t=t+"px"),t&&(e.style.height=t),parseInt(this.window.getComputedStyle(e).height)}contentWidth(t){var e=this.content||this.document.body;return t&&Le(t)&&(t=t+"px"),t&&(e.style.width=t),parseInt(this.window.getComputedStyle(e).width)}contentHeight(t){var e=this.content||this.document.body;return t&&Le(t)&&(t=t+"px"),t&&(e.style.height=t),parseInt(this.window.getComputedStyle(e).height)}textWidth(){let t,e,i=this.document.createRange(),s=this.content||this.document.body,n=Gc(s);return i.selectNodeContents(s),t=i.getBoundingClientRect(),e=t.width,n&&n.width&&(e+=n.width),Math.round(e)}textHeight(){let t,e,i=this.document.createRange(),s=this.content||this.document.body;return i.selectNodeContents(s),t=i.getBoundingClientRect(),e=t.bottom,Math.round(e)}scrollWidth(){var t=this.documentElement.scrollWidth;return t}scrollHeight(){var t=this.documentElement.scrollHeight;return t}overflow(t){return t&&(this.documentElement.style.overflow=t),this.window.getComputedStyle(this.documentElement).overflow}overflowX(t){return t&&(this.documentElement.style.overflowX=t),this.window.getComputedStyle(this.documentElement).overflowX}overflowY(t){return t&&(this.documentElement.style.overflowY=t),this.window.getComputedStyle(this.documentElement).overflowY}css(t,e,i){var s=this.content||this.document.body;return e?s.style.setProperty(t,e,i?"important":""):s.style.removeProperty(t),this.window.getComputedStyle(s)[t]}viewport(t){var e=this.document.querySelector("meta[name='viewport']"),i={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},s=[],n={};if(e&&e.hasAttribute("content")){let r=e.getAttribute("content"),a=r.match(/width\s*=\s*([^,]*)/),o=r.match(/height\s*=\s*([^,]*)/),h=r.match(/initial-scale\s*=\s*([^,]*)/),u=r.match(/minimum-scale\s*=\s*([^,]*)/),c=r.match(/maximum-scale\s*=\s*([^,]*)/),f=r.match(/user-scalable\s*=\s*([^,]*)/);a&&a.length&&typeof a[1]<"u"&&(i.width=a[1]),o&&o.length&&typeof o[1]<"u"&&(i.height=o[1]),h&&h.length&&typeof h[1]<"u"&&(i.scale=h[1]),u&&u.length&&typeof u[1]<"u"&&(i.minimum=u[1]),c&&c.length&&typeof c[1]<"u"&&(i.maximum=c[1]),f&&f.length&&typeof f[1]<"u"&&(i.scalable=f[1])}return n=mv(t||{},i),t&&(n.width&&s.push("width="+n.width),n.height&&s.push("height="+n.height),n.scale&&s.push("initial-scale="+n.scale),n.scalable==="no"?(s.push("minimum-scale="+n.scale),s.push("maximum-scale="+n.scale),s.push("user-scalable="+n.scalable)):(n.scalable&&s.push("user-scalable="+n.scalable),n.minimum&&s.push("minimum-scale="+n.minimum),n.maximum&&s.push("minimum-scale="+n.maximum)),e||(e=this.document.createElement("meta"),e.setAttribute("name","viewport"),this.document.querySelector("head").appendChild(e)),e.setAttribute("content",s.join(", ")),this.window.scrollTo(0,0)),n}expand(){this.emit(mt.CONTENTS.EXPAND)}listeners(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),typeof ResizeObserver>"u"?(this.resizeListeners(),this.visibilityListeners()):this.resizeObservers(),this.linksHandler()}removeListeners(){this.removeEventListeners(),this.removeSelectionListeners(),this.observer&&this.observer.disconnect(),clearTimeout(this.expanding)}resizeCheck(){let t=this.textWidth(),e=this.textHeight();(t!=this._size.width||e!=this._size.height)&&(this._size={width:t,height:e},this.onResize&&this.onResize(this._size),this.emit(mt.CONTENTS.RESIZE,this._size))}resizeListeners(){clearTimeout(this.expanding),requestAnimationFrame(this.resizeCheck.bind(this)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}visibilityListeners(){document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.active===!1?(this.active=!0,this.resizeListeners()):(this.active=!1,clearTimeout(this.expanding))})}transitionListeners(){let t=this.content;t.style.transitionProperty="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height",t.style.transitionDuration="0.001ms",t.style.transitionTimingFunction="linear",t.style.transitionDelay="0",this._resizeCheck=this.resizeCheck.bind(this),this.document.addEventListener("transitionend",this._resizeCheck)}mediaQueryListeners(){for(var t=this.document.styleSheets,e=(function(a){a.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}).bind(this),i=0;i<t.length;i+=1){var s;try{s=t[i].cssRules}catch{return}if(!s)return;for(var n=0;n<s.length;n+=1)if(s[n].media){var r=this.window.matchMedia(s[n].media.mediaText);r.addListener(e)}}}resizeObservers(){this.observer=new ResizeObserver(t=>{requestAnimationFrame(this.resizeCheck.bind(this))}),this.observer.observe(this.document.documentElement)}mutationObservers(){this.observer=new MutationObserver(e=>{this.resizeCheck()});let t={attributes:!0,childList:!0,characterData:!0,subtree:!0};this.observer.observe(this.document,t)}imageLoadListeners(){for(var t=this.document.querySelectorAll("img"),e,i=0;i<t.length;i++)e=t[i],typeof e.naturalWidth<"u"&&e.naturalWidth===0&&(e.onload=this.expand.bind(this))}fontLoadListeners(){!this.document||!this.document.fonts||this.document.fonts.ready.then((function(){this.resizeCheck()}).bind(this))}root(){return this.document?this.document.documentElement:null}locationOf(t,e){var i,s={left:0,top:0};if(!this.document)return s;if(this.epubcfi.isCfiString(t)){let n=new ee(t).toRange(this.document,e);if(n){try{if(!n.endContainer||n.startContainer==n.endContainer&&n.startOffset==n.endOffset){let r=n.startContainer.textContent.indexOf(" ",n.startOffset);r==-1&&(r=n.startContainer.textContent.length),n.setEnd(n.startContainer,r)}}catch(r){console.error("setting end offset to start container length failed",r)}if(n.startContainer.nodeType===Node.ELEMENT_NODE)i=n.startContainer.getBoundingClientRect(),s.left=i.left,s.top=i.top;else if(vm){let r=n.startContainer,a=new Range;try{r.nodeType===Yy?i=r.getBoundingClientRect():n.startOffset+2<r.length?(a.setStart(r,n.startOffset),a.setEnd(r,n.startOffset+2),i=a.getBoundingClientRect()):n.startOffset-2>0?(a.setStart(r,n.startOffset-2),a.setEnd(r,n.startOffset),i=a.getBoundingClientRect()):i=r.parentNode.getBoundingClientRect()}catch(o){console.error(o,o.stack)}}else i=n.getBoundingClientRect()}}else if(typeof t=="string"&&t.indexOf("#")>-1){let n=t.substring(t.indexOf("#")+1),r=this.document.getElementById(n);if(r)if(vm){let a=new Range;a.selectNode(r),i=a.getBoundingClientRect()}else i=r.getBoundingClientRect()}return i&&(s.left=i.left,s.top=i.top),s}addStylesheet(t){return new Promise((function(e,i){var s,n=!1;if(!this.document){e(!1);return}if(s=this.document.querySelector("link[href='"+t+"']"),s){e(!0);return}s=this.document.createElement("link"),s.type="text/css",s.rel="stylesheet",s.href=t,s.onload=s.onreadystatechange=function(){!n&&(!this.readyState||this.readyState=="complete")&&(n=!0,setTimeout(()=>{e(!0)},1))},this.document.head.appendChild(s)}).bind(this))}_getStylesheetNode(t){var e;return t="epubjs-inserted-css-"+(t||""),this.document?(e=this.document.getElementById(t),e||(e=this.document.createElement("style"),e.id=t,this.document.head.appendChild(e)),e):!1}addStylesheetCss(t,e){if(!this.document||!t)return!1;var i;return i=this._getStylesheetNode(e),i.innerHTML=t,!0}addStylesheetRules(t,e){var i;if(!(!this.document||!t||t.length===0))if(i=this._getStylesheetNode(e).sheet,Object.prototype.toString.call(t)==="[object Array]")for(var s=0,n=t.length;s<n;s++){var r=1,a=t[s],o=t[s][0],h="";Object.prototype.toString.call(a[1][0])==="[object Array]"&&(a=a[1],r=0);for(var u=a.length;r<u;r++){var c=a[r];h+=c[0]+":"+c[1]+(c[2]?" !important":"")+`;
`}i.insertRule(o+"{"+h+"}",i.cssRules.length)}else Object.keys(t).forEach(p=>{const _=t[p];if(Array.isArray(_))_.forEach(v=>{const b=Object.keys(v).map(w=>`${w}:${v[w]}`).join(";");i.insertRule(`${p}{${b}}`,i.cssRules.length)});else{const g=Object.keys(_).map(b=>`${b}:${_[b]}`).join(";");i.insertRule(`${p}{${g}}`,i.cssRules.length)}})}addScript(t){return new Promise((function(e,i){var s,n=!1;if(!this.document){e(!1);return}s=this.document.createElement("script"),s.type="text/javascript",s.async=!0,s.src=t,s.onload=s.onreadystatechange=function(){!n&&(!this.readyState||this.readyState=="complete")&&(n=!0,setTimeout(function(){e(!0)},1))},this.document.head.appendChild(s)}).bind(this))}addClass(t){var e;this.document&&(e=this.content||this.document.body,e&&e.classList.add(t))}removeClass(t){var e;this.document&&(e=this.content||this.document.body,e&&e.classList.remove(t))}addEventListeners(){this.document&&(this._triggerEvent=this.triggerEvent.bind(this),fc.forEach(function(t){this.document.addEventListener(t,this._triggerEvent,{passive:!0})},this))}removeEventListeners(){this.document&&(fc.forEach(function(t){this.document.removeEventListener(t,this._triggerEvent,{passive:!0})},this),this._triggerEvent=void 0)}triggerEvent(t){this.emit(t.type,t)}addSelectionListeners(){this.document&&(this._onSelectionChange=this.onSelectionChange.bind(this),this.document.addEventListener("selectionchange",this._onSelectionChange,{passive:!0}))}removeSelectionListeners(){this.document&&(this.document.removeEventListener("selectionchange",this._onSelectionChange,{passive:!0}),this._onSelectionChange=void 0)}onSelectionChange(t){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout((function(){var e=this.window.getSelection();this.triggerSelectedEvent(e)}).bind(this),250)}triggerSelectedEvent(t){var e,i;t&&t.rangeCount>0&&(e=t.getRangeAt(0),e.collapsed||(i=new ee(e,this.cfiBase).toString(),this.emit(mt.CONTENTS.SELECTED,i),this.emit(mt.CONTENTS.SELECTED_RANGE,e)))}range(t,e){var i=new ee(t);return i.toRange(this.document,e)}cfiFromRange(t,e){return new ee(t,this.cfiBase,e).toString()}cfiFromNode(t,e){return new ee(t,this.cfiBase,e).toString()}map(t){var e=new Zc(t);return e.section()}size(t,e){var i={scale:1,scalable:"no"};this.layoutStyle("scrolling"),t>=0&&(this.width(t),i.width=t,this.css("padding","0 "+t/12+"px")),e>=0&&(this.height(e),i.height=e),this.css("margin","0"),this.css("box-sizing","border-box"),this.viewport(i)}columns(t,e,i,s,n){let r=wo("column-axis"),a=wo("column-gap"),o=wo("column-width"),h=wo("column-fill"),c=this.writingMode().indexOf("vertical")===0?"vertical":"horizontal";this.layoutStyle("paginated"),n==="rtl"&&c==="horizontal"&&this.direction(n),this.width(t),this.height(e),this.viewport({width:t,height:e,scale:1,scalable:"no"}),this.css("overflow-y","hidden"),this.css("margin","0",!0),c==="vertical"?(this.css("padding-top",s/2+"px",!0),this.css("padding-bottom",s/2+"px",!0),this.css("padding-left","20px"),this.css("padding-right","20px"),this.css(r,"vertical")):(this.css("padding-top","20px"),this.css("padding-bottom","20px"),this.css("padding-left",s/2+"px",!0),this.css("padding-right",s/2+"px",!0),this.css(r,"horizontal")),this.css("box-sizing","border-box"),this.css("max-width","inherit"),this.css(h,"auto"),this.css(a,s+"px"),this.css(o,i+"px"),this.css("-webkit-line-box-contain","block glyphs replaced")}scaler(t,e,i){var s="scale("+t+")",n="";this.css("transform-origin","top left"),(e>=0||i>=0)&&(n=" translate("+(e||0)+"px, "+(i||0)+"px )"),this.css("transform",s+n)}fit(t,e,i){var s=this.viewport(),n=parseInt(s.width),r=parseInt(s.height),a=t/n,o=e/r,h=a<o?a:o;if(this.layoutStyle("paginated"),this.width(n),this.height(r),this.overflow("hidden"),this.scaler(h,0,0),this.css("background-size",n*h+"px "+r*h+"px"),this.css("background-color","transparent"),i&&i.properties.includes("page-spread-left")){var u=t-n*h;this.css("margin-left",u+"px")}}direction(t){this.documentElement&&(this.documentElement.style.direction=t)}mapPage(t,e,i,s,n){var r=new Zc(e,n);return r.page(this,t,i,s)}linksHandler(){zy(this.content,t=>{this.emit(mt.CONTENTS.LINK_CLICKED,t)})}writingMode(t){let e=wo("writing-mode");return t&&this.documentElement&&(this.documentElement.style[e]=t),this.window.getComputedStyle(this.documentElement)[e]||""}layoutStyle(t){return t&&(this._layoutStyle=t,navigator.epubReadingSystem.layoutStyle=this._layoutStyle),this._layoutStyle||"paginated"}epubReadingSystem(t,e){return navigator.epubReadingSystem={name:t,version:e,layoutStyle:this.layoutStyle(),hasFeature:function(i){switch(i){case"dom-manipulation":return!0;case"layout-changes":return!0;case"touch-events":return!0;case"mouse-events":return!0;case"keyboard-events":return!0;case"spine-scripting":return!1;default:return!1}}},navigator.epubReadingSystem}destroy(){this.removeListeners()}}mn(pg.prototype);class Ky{constructor(t){this.rendition=t,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}add(t,e,i,s,n,r){let a=encodeURI(e+t),h=new ee(e).spinePos,u=new Dv({type:t,cfiRange:e,data:i,sectionIndex:h,cb:s,className:n,styles:r});return this._annotations[a]=u,h in this._annotationsBySectionIndex?this._annotationsBySectionIndex[h].push(a):this._annotationsBySectionIndex[h]=[a],this.rendition.views().forEach(f=>{u.sectionIndex===f.index&&u.attach(f)}),u}remove(t,e){let i=encodeURI(t+e);if(i in this._annotations){let s=this._annotations[i];if(e&&s.type!==e)return;this.rendition.views().forEach(r=>{this._removeFromAnnotationBySectionIndex(s.sectionIndex,i),s.sectionIndex===r.index&&s.detach(r)}),delete this._annotations[i]}}_removeFromAnnotationBySectionIndex(t,e){this._annotationsBySectionIndex[t]=this._annotationsAt(t).filter(i=>i!==e)}_annotationsAt(t){return this._annotationsBySectionIndex[t]}highlight(t,e,i,s,n){return this.add("highlight",t,e,i,s,n)}underline(t,e,i,s,n){return this.add("underline",t,e,i,s,n)}mark(t,e,i){return this.add("mark",t,e,i)}each(){return this._annotations.forEach.apply(this._annotations,arguments)}inject(t){let e=t.index;e in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[e].forEach(s=>{this._annotations[s].attach(t)})}clear(t){let e=t.index;e in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[e].forEach(s=>{this._annotations[s].detach(t)})}show(){}hide(){}}class Dv{constructor({type:t,cfiRange:e,data:i,sectionIndex:s,cb:n,className:r,styles:a}){this.type=t,this.cfiRange=e,this.data=i,this.sectionIndex=s,this.mark=void 0,this.cb=n,this.className=r,this.styles=a}update(t){this.data=t}attach(t){let{cfiRange:e,data:i,type:s,mark:n,cb:r,className:a,styles:o}=this,h;return s==="highlight"?h=t.highlight(e,i,r,a,o):s==="underline"?h=t.underline(e,i,r,a,o):s==="mark"&&(h=t.mark(e,i,r)),this.mark=h,this.emit(mt.ANNOTATION.ATTACH,h),h}detach(t){let{cfiRange:e,type:i}=this,s;return t&&(i==="highlight"?s=t.unhighlight(e):i==="underline"?s=t.ununderline(e):i==="mark"&&(s=t.unmark(e))),this.mark=void 0,this.emit(mt.ANNOTATION.DETACH,s),s}text(){}}mn(Dv.prototype);var Ds={},Kl={},bm;function Zy(){if(bm)return Kl;bm=1,Object.defineProperty(Kl,"__esModule",{value:!0}),Kl.createElement=d;function d(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}return Kl.default={createElement:d},Kl}var yo={},ym;function Jy(){if(ym)return yo;ym=1,Object.defineProperty(yo,"__esModule",{value:!0}),yo.proxyMouse=d,yo.clone=t,yo.default={proxyMouse:d};function d(i,s){function n(h){for(var u=s.length-1;u>=0;u--){var c=s[u],f=h.clientX,p=h.clientY;if(h.touches&&h.touches.length&&(f=h.touches[0].clientX,p=h.touches[0].clientY),!!e(c,i,f,p)){c.dispatchEvent(t(h));break}}}if(i.nodeName==="iframe"||i.nodeName==="IFRAME")try{this.target=i.contentDocument}catch{this.target=i}else this.target=i;for(var r=["mouseup","mousedown","click","touchstart"],a=0;a<r.length;a++){var o=r[a];this.target.addEventListener(o,function(h){return n(h)},!1)}}function t(i){var s=Object.assign({},i,{bubbles:!1});try{return new MouseEvent(i.type,s)}catch{var n=document.createEvent("MouseEvents");return n.initMouseEvent(i.type,!1,s.cancelable,s.view,s.detail,s.screenX,s.screenY,s.clientX,s.clientY,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.button,s.relatedTarget),n}}function e(i,s,n,r){var a=s.getBoundingClientRect();function o(p,_,v){var g=p.top-a.top,b=p.left-a.left,w=g+p.height,S=b+p.width;return g<=v&&b<=_&&w>v&&S>_}var h=i.getBoundingClientRect();if(!o(h,n,r))return!1;for(var u=i.getClientRects(),c=0,f=u.length;c<f;c++)if(o(u[c],n,r))return!0;return!1}return yo}var wm;function Qy(){if(wm)return Ds;wm=1,Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.Underline=Ds.Highlight=Ds.Mark=Ds.Pane=void 0;var d=function v(g,b,w){g===null&&(g=Function.prototype);var S=Object.getOwnPropertyDescriptor(g,b);if(S===void 0){var T=Object.getPrototypeOf(g);return T===null?void 0:v(T,b,w)}else{if("value"in S)return S.value;var A=S.get;return A===void 0?void 0:A.call(w)}},t=function(){function v(g,b){for(var w=0;w<b.length;w++){var S=b[w];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(g,S.key,S)}}return function(g,b,w){return b&&v(g.prototype,b),w&&v(g,w),g}}(),e=Zy(),i=r(e),s=Jy(),n=r(s);function r(v){return v&&v.__esModule?v:{default:v}}function a(v,g){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&(typeof g=="object"||typeof g=="function")?g:v}function o(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);v.prototype=Object.create(g&&g.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(v,g):v.__proto__=g)}function h(v,g){if(!(v instanceof g))throw new TypeError("Cannot call a class as a function")}Ds.Pane=function(){function v(g){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document.body;h(this,v),this.target=g,this.element=i.default.createElement("svg"),this.marks=[],this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),n.default.proxyMouse(this.target,this.marks),this.container=b,this.container.appendChild(this.element),this.render()}return t(v,[{key:"addMark",value:function(b){var w=i.default.createElement("g");return this.element.appendChild(w),b.bind(w,this.container),this.marks.push(b),b.render(),b}},{key:"removeMark",value:function(b){var w=this.marks.indexOf(b);if(w!==-1){var S=b.unbind();this.element.removeChild(S),this.marks.splice(w,1)}}},{key:"render",value:function(){p(this.element,f(this.target,this.container));var b=!0,w=!1,S=void 0;try{for(var T=this.marks[Symbol.iterator](),A;!(b=(A=T.next()).done);b=!0){var C=A.value;C.render()}}catch(R){w=!0,S=R}finally{try{!b&&T.return&&T.return()}finally{if(w)throw S}}}}]),v}();var u=Ds.Mark=function(){function v(){h(this,v),this.element=null}return t(v,[{key:"bind",value:function(b,w){this.element=b,this.container=w}},{key:"unbind",value:function(){var b=this.element;return this.element=null,b}},{key:"render",value:function(){}},{key:"dispatchEvent",value:function(b){this.element&&this.element.dispatchEvent(b)}},{key:"getBoundingClientRect",value:function(){return this.element.getBoundingClientRect()}},{key:"getClientRects",value:function(){for(var b=[],w=this.element.firstChild;w;)b.push(w.getBoundingClientRect()),w=w.nextSibling;return b}},{key:"filteredRanges",value:function(){var b=Array.from(this.range.getClientRects());return b.filter(function(w){for(var S=0;S<b.length;S++){if(b[S]===w)return!0;var T=_(b[S],w);if(T)return!1}return!0})}}]),v}(),c=Ds.Highlight=function(v){o(g,v);function g(b,w,S,T){h(this,g);var A=a(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return A.range=b,A.className=w,A.data=S||{},A.attributes=T||{},A}return t(g,[{key:"bind",value:function(w,S){d(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"bind",this).call(this,w,S);for(var T in this.data)this.data.hasOwnProperty(T)&&(this.element.dataset[T]=this.data[T]);for(var T in this.attributes)this.attributes.hasOwnProperty(T)&&this.element.setAttribute(T,this.attributes[T]);this.className&&this.element.classList.add(this.className)}},{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var w=this.element.ownerDocument.createDocumentFragment(),S=this.filteredRanges(),T=this.element.getBoundingClientRect(),A=this.container.getBoundingClientRect(),C=0,R=S.length;C<R;C++){var P=S[C],N=i.default.createElement("rect");N.setAttribute("x",P.left-T.left+A.left),N.setAttribute("y",P.top-T.top+A.top),N.setAttribute("height",P.height),N.setAttribute("width",P.width),w.appendChild(N)}this.element.appendChild(w)}}]),g}(u);Ds.Underline=function(v){o(g,v);function g(b,w,S,T){return h(this,g),a(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,b,w,S,T))}return t(g,[{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var w=this.element.ownerDocument.createDocumentFragment(),S=this.filteredRanges(),T=this.element.getBoundingClientRect(),A=this.container.getBoundingClientRect(),C=0,R=S.length;C<R;C++){var P=S[C],N=i.default.createElement("rect");N.setAttribute("x",P.left-T.left+A.left),N.setAttribute("y",P.top-T.top+A.top),N.setAttribute("height",P.height),N.setAttribute("width",P.width),N.setAttribute("fill","none");var F=i.default.createElement("line");F.setAttribute("x1",P.left-T.left+A.left),F.setAttribute("x2",P.left-T.left+A.left+P.width),F.setAttribute("y1",P.top-T.top+A.top+P.height-1),F.setAttribute("y2",P.top-T.top+A.top+P.height-1),F.setAttribute("stroke-width",1),F.setAttribute("stroke","black"),F.setAttribute("stroke-linecap","square"),w.appendChild(N),w.appendChild(F)}this.element.appendChild(w)}}]),g}(c);function f(v,g){var b=g.getBoundingClientRect(),w=v.getBoundingClientRect();return{top:w.top-b.top,left:w.left-b.left,height:v.scrollHeight,width:v.scrollWidth}}function p(v,g){v.style.setProperty("top",g.top+"px","important"),v.style.setProperty("left",g.left+"px","important"),v.style.setProperty("height",g.height+"px","important"),v.style.setProperty("width",g.width+"px","important")}function _(v,g){return g.right<=v.right&&g.left>=v.left&&g.top>=v.top&&g.bottom<=v.bottom}return Ds}var nc=Qy();class kv{constructor(t,e){this.settings=yi({ignoreClass:"",axis:void 0,direction:void 0,width:0,height:0,layout:void 0,globalLayoutProperties:{},method:void 0,forceRight:!1,allowScriptedContent:!1,allowPopups:!1},e||{}),this.id="epubjs-view-"+Dd(),this.section=t,this.index=t.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new ee,this.layout=this.settings.layout,this.pane=void 0,this.highlights={},this.underlines={},this.marks={}}container(t){var e=document.createElement("div");return e.classList.add("epub-view"),e.style.height="0px",e.style.width="0px",e.style.overflow="hidden",e.style.position="relative",e.style.display="block",t&&t=="horizontal"?e.style.flex="none":e.style.flex="initial",e}create(){return this.iframe?this.iframe:(this.element||(this.element=this.createContainer()),this.iframe=document.createElement("iframe"),this.iframe.id=this.id,this.iframe.scrolling="no",this.iframe.style.overflow="hidden",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.sandbox="allow-same-origin",this.settings.allowScriptedContent&&(this.iframe.sandbox+=" allow-scripts"),this.settings.allowPopups&&(this.iframe.sandbox+=" allow-popups"),this.iframe.setAttribute("enable-annotation","true"),this.resizing=!0,this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this.element.setAttribute("ref",this.index),this.added=!0,this.elementBounds=dc(this.element),"srcdoc"in this.iframe?this.supportsSrcdoc=!0:this.supportsSrcdoc=!1,this.settings.method||(this.settings.method=this.supportsSrcdoc?"srcdoc":"write"),this.iframe)}render(t,e){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(t)),this.sectionRender.then((function(i){return this.load(i)}).bind(this)).then((function(){let i=this.contents.writingMode(),s;return this.settings.flow==="scrolled"?s=i.indexOf("vertical")===0?"horizontal":"vertical":s=i.indexOf("vertical")===0?"vertical":"horizontal",i.indexOf("vertical")===0&&this.settings.flow==="paginated"&&(this.layout.delta=this.layout.height),this.setAxis(s),this.emit(mt.VIEWS.AXIS,s),this.setWritingMode(i),this.emit(mt.VIEWS.WRITING_MODE,i),this.layout.format(this.contents,this.section,this.axis),this.addListeners(),new Promise((n,r)=>{this.expand(),this.settings.forceRight&&(this.element.style.marginLeft=this.width()+"px"),n()})}).bind(this),(function(i){return this.emit(mt.VIEWS.LOAD_ERROR,i),new Promise((s,n)=>{n(i)})}).bind(this)).then((function(){this.emit(mt.VIEWS.RENDERED,this.section)}).bind(this))}reset(){this.iframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this._textWidth=void 0,this._contentWidth=void 0,this._textHeight=void 0,this._contentHeight=void 0),this._needsReframe=!0}size(t,e){var i=t||this.settings.width,s=e||this.settings.height;this.layout.name==="pre-paginated"?this.lock("both",i,s):this.settings.axis==="horizontal"?this.lock("height",i,s):this.lock("width",i,s),this.settings.width=i,this.settings.height=s}lock(t,e,i){var s=Gc(this.element),n;this.iframe?n=Gc(this.iframe):n={width:0,height:0},t=="width"&&Le(e)&&(this.lockedWidth=e-s.width-n.width),t=="height"&&Le(i)&&(this.lockedHeight=i-s.height-n.height),t==="both"&&Le(e)&&Le(i)&&(this.lockedWidth=e-s.width-n.width,this.lockedHeight=i-s.height-n.height),this.displayed&&this.iframe&&this.expand()}expand(t){var e=this.lockedWidth,i=this.lockedHeight,s;!this.iframe||this._expanding||(this._expanding=!0,this.layout.name==="pre-paginated"?(e=this.layout.columnWidth,i=this.layout.height):this.settings.axis==="horizontal"?(e=this.contents.textWidth(),e%this.layout.pageWidth>0&&(e=Math.ceil(e/this.layout.pageWidth)*this.layout.pageWidth),this.settings.forceEvenPages&&(s=e/this.layout.pageWidth,this.layout.divisor>1&&this.layout.name==="reflowable"&&s%2>0&&(e+=this.layout.pageWidth))):this.settings.axis==="vertical"&&(i=this.contents.textHeight(),this.settings.flow==="paginated"&&i%this.layout.height>0&&(i=Math.ceil(i/this.layout.height)*this.layout.height)),(this._needsReframe||e!=this._width||i!=this._height)&&this.reframe(e,i),this._expanding=!1)}reframe(t,e){var i;Le(t)&&(this.element.style.width=t+"px",this.iframe.style.width=t+"px",this._width=t),Le(e)&&(this.element.style.height=e+"px",this.iframe.style.height=e+"px",this._height=e);let s=this.prevBounds?t-this.prevBounds.width:t,n=this.prevBounds?e-this.prevBounds.height:e;i={width:t,height:e,widthDelta:s,heightDelta:n},this.pane&&this.pane.render(),requestAnimationFrame(()=>{let r;for(let a in this.marks)this.marks.hasOwnProperty(a)&&(r=this.marks[a],this.placeMark(r.element,r.range))}),this.onResize(this,i),this.emit(mt.VIEWS.RESIZED,i),this.prevBounds=i,this.elementBounds=dc(this.element)}load(t){var e=new te,i=e.promise;if(!this.iframe)return e.reject(new Error("No Iframe Available")),i;if(this.iframe.onload=(function(n){this.onLoad(n,e)}).bind(this),this.settings.method==="blobUrl")this.blobUrl=Xc(t,"application/xhtml+xml"),this.iframe.src=this.blobUrl,this.element.appendChild(this.iframe);else if(this.settings.method==="srcdoc")this.iframe.srcdoc=t,this.element.appendChild(this.iframe);else{if(this.element.appendChild(this.iframe),this.document=this.iframe.contentDocument,!this.document)return e.reject(new Error("No Document Available")),i;if(this.iframe.contentDocument.open(),window.MSApp&&MSApp.execUnsafeLocalFunction){var s=this;MSApp.execUnsafeLocalFunction(function(){s.iframe.contentDocument.write(t)})}else this.iframe.contentDocument.write(t);this.iframe.contentDocument.close()}return i}onLoad(t,e){this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new pg(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var i=this.document.querySelector("link[rel='canonical']");i?i.setAttribute("href",this.section.canonical):(i=this.document.createElement("link"),i.setAttribute("rel","canonical"),i.setAttribute("href",this.section.canonical),this.document.querySelector("head").appendChild(i)),this.contents.on(mt.CONTENTS.EXPAND,()=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),this.contents.on(mt.CONTENTS.RESIZE,s=>{this.displayed&&this.iframe&&(this.expand(),this.contents&&this.layout.format(this.contents))}),e.resolve(this.contents)}setLayout(t){this.layout=t,this.contents&&(this.layout.format(this.contents),this.expand())}setAxis(t){this.settings.axis=t,t=="horizontal"?this.element.style.flex="none":this.element.style.flex="initial",this.size()}setWritingMode(t){this.writingMode=t}addListeners(){}removeListeners(t){}display(t){var e=new te;return this.displayed?e.resolve(this):this.render(t).then((function(){this.emit(mt.VIEWS.DISPLAYED,this),this.onDisplayed(this),this.displayed=!0,e.resolve(this)}).bind(this),function(i){e.reject(i,this)}),e.promise}show(){this.element.style.visibility="visible",this.iframe&&(this.iframe.style.visibility="visible",this.iframe.style.transform="translateZ(0)",this.iframe.offsetWidth,this.iframe.style.transform=null),this.emit(mt.VIEWS.SHOWN,this)}hide(){this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.stopExpanding=!0,this.emit(mt.VIEWS.HIDDEN,this)}offset(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}width(){return this._width}height(){return this._height}position(){return this.element.getBoundingClientRect()}locationOf(t){this.iframe.getBoundingClientRect();var e=this.contents.locationOf(t,this.settings.ignoreClass);return{left:e.left,top:e.top}}onDisplayed(t){}onResize(t,e){}bounds(t){return(t||!this.elementBounds)&&(this.elementBounds=dc(this.element)),this.elementBounds}highlight(t,e={},i,s="epubjs-hl",n={}){if(!this.contents)return;const r=Object.assign({fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"},n);let a=this.contents.range(t),o=()=>{this.emit(mt.VIEWS.MARK_CLICKED,t,e)};e.epubcfi=t,this.pane||(this.pane=new nc.Pane(this.iframe,this.element));let h=new nc.Highlight(a,s,e,r),u=this.pane.addMark(h);return this.highlights[t]={mark:u,element:u.element,listeners:[o,i]},u.element.setAttribute("ref",s),u.element.addEventListener("click",o),u.element.addEventListener("touchstart",o),i&&(u.element.addEventListener("click",i),u.element.addEventListener("touchstart",i)),u}underline(t,e={},i,s="epubjs-ul",n={}){if(!this.contents)return;const r=Object.assign({stroke:"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"},n);let a=this.contents.range(t),o=()=>{this.emit(mt.VIEWS.MARK_CLICKED,t,e)};e.epubcfi=t,this.pane||(this.pane=new nc.Pane(this.iframe,this.element));let h=new nc.Underline(a,s,e,r),u=this.pane.addMark(h);return this.underlines[t]={mark:u,element:u.element,listeners:[o,i]},u.element.setAttribute("ref",s),u.element.addEventListener("click",o),u.element.addEventListener("touchstart",o),i&&(u.element.addEventListener("click",i),u.element.addEventListener("touchstart",i)),u}mark(t,e={},i){if(!this.contents)return;if(t in this.marks)return this.marks[t];let s=this.contents.range(t);if(!s)return;let n=s.commonAncestorContainer,r=n.nodeType===1?n:n.parentNode,a=h=>{this.emit(mt.VIEWS.MARK_CLICKED,t,e)};s.collapsed&&n.nodeType===1?(s=new Range,s.selectNodeContents(n)):s.collapsed&&(s=new Range,s.selectNodeContents(r));let o=this.document.createElement("a");return o.setAttribute("ref","epubjs-mk"),o.style.position="absolute",o.dataset.epubcfi=t,e&&Object.keys(e).forEach(h=>{o.dataset[h]=e[h]}),i&&(o.addEventListener("click",i),o.addEventListener("touchstart",i)),o.addEventListener("click",a),o.addEventListener("touchstart",a),this.placeMark(o,s),this.element.appendChild(o),this.marks[t]={element:o,range:s,listeners:[a,i]},r}placeMark(t,e){let i,s,n;if(this.layout.name==="pre-paginated"||this.settings.axis!=="horizontal"){let a=e.getBoundingClientRect();i=a.top,s=a.right}else{let a=e.getClientRects(),o;for(var r=0;r!=a.length;r++)o=a[r],(!n||o.left<n)&&(n=o.left,s=Math.ceil(n/this.layout.props.pageWidth)*this.layout.props.pageWidth-this.layout.gap/2,i=o.top)}t.style.top=`${i}px`,t.style.left=`${s}px`}unhighlight(t){let e;t in this.highlights&&(e=this.highlights[t],this.pane.removeMark(e.mark),e.listeners.forEach(i=>{i&&(e.element.removeEventListener("click",i),e.element.removeEventListener("touchstart",i))}),delete this.highlights[t])}ununderline(t){let e;t in this.underlines&&(e=this.underlines[t],this.pane.removeMark(e.mark),e.listeners.forEach(i=>{i&&(e.element.removeEventListener("click",i),e.element.removeEventListener("touchstart",i))}),delete this.underlines[t])}unmark(t){let e;t in this.marks&&(e=this.marks[t],this.element.removeChild(e.element),e.listeners.forEach(i=>{i&&(e.element.removeEventListener("click",i),e.element.removeEventListener("touchstart",i))}),delete this.marks[t])}destroy(){for(let t in this.highlights)this.unhighlight(t);for(let t in this.underlines)this.ununderline(t);for(let t in this.marks)this.unmark(t);this.blobUrl&&yv(this.blobUrl),this.displayed&&(this.displayed=!1,this.removeListeners(),this.contents.destroy(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.pane&&(this.pane.element.remove(),this.pane=void 0),this.iframe=void 0,this.contents=void 0,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}mn(kv.prototype);function tw(){var d="reverse",t=ew();return document.body.appendChild(t),t.scrollLeft>0?d="default":typeof Element<"u"&&Element.prototype.scrollIntoView?(t.children[0].children[1].scrollIntoView(),t.scrollLeft<0&&(d="negative")):(t.scrollLeft=1,t.scrollLeft===0&&(d="negative")),document.body.removeChild(t),d}function ew(){var d=document.createElement("div");d.dir="rtl",d.style.position="fixed",d.style.width="1px",d.style.height="1px",d.style.top="0px",d.style.left="0px",d.style.overflow="hidden";var t=document.createElement("div");t.style.width="2px";var e=document.createElement("span");e.style.width="1px",e.style.display="inline-block";var i=document.createElement("span");return i.style.width="1px",i.style.display="inline-block",t.appendChild(e),t.appendChild(i),d.appendChild(t),d}var ff,_m;function gg(){if(_m)return ff;_m=1;function d(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}return ff=d,ff}var pf,Am;function iw(){if(Am)return pf;Am=1;var d=typeof xs=="object"&&xs&&xs.Object===Object&&xs;return pf=d,pf}var gf,Em;function Rv(){if(Em)return gf;Em=1;var d=iw(),t=typeof self=="object"&&self&&self.Object===Object&&self,e=d||t||Function("return this")();return gf=e,gf}var mf,xm;function sw(){if(xm)return mf;xm=1;var d=Rv(),t=function(){return d.Date.now()};return mf=t,mf}var vf,Sm;function nw(){if(Sm)return vf;Sm=1;var d=/\s/;function t(e){for(var i=e.length;i--&&d.test(e.charAt(i)););return i}return vf=t,vf}var bf,Cm;function rw(){if(Cm)return bf;Cm=1;var d=nw(),t=/^\s+/;function e(i){return i&&i.slice(0,d(i)+1).replace(t,"")}return bf=e,bf}var yf,Tm;function Iv(){if(Tm)return yf;Tm=1;var d=Rv(),t=d.Symbol;return yf=t,yf}var wf,Dm;function aw(){if(Dm)return wf;Dm=1;var d=Iv(),t=Object.prototype,e=t.hasOwnProperty,i=t.toString,s=d?d.toStringTag:void 0;function n(r){var a=e.call(r,s),o=r[s];try{r[s]=void 0;var h=!0}catch{}var u=i.call(r);return h&&(a?r[s]=o:delete r[s]),u}return wf=n,wf}var _f,km;function ow(){if(km)return _f;km=1;var d=Object.prototype,t=d.toString;function e(i){return t.call(i)}return _f=e,_f}var Af,Rm;function lw(){if(Rm)return Af;Rm=1;var d=Iv(),t=aw(),e=ow(),i="[object Null]",s="[object Undefined]",n=d?d.toStringTag:void 0;function r(a){return a==null?a===void 0?s:i:n&&n in Object(a)?t(a):e(a)}return Af=r,Af}var Ef,Im;function hw(){if(Im)return Ef;Im=1;function d(t){return t!=null&&typeof t=="object"}return Ef=d,Ef}var xf,Nm;function uw(){if(Nm)return xf;Nm=1;var d=lw(),t=hw(),e="[object Symbol]";function i(s){return typeof s=="symbol"||t(s)&&d(s)==e}return xf=i,xf}var Sf,Lm;function cw(){if(Lm)return Sf;Lm=1;var d=rw(),t=gg(),e=uw(),i=NaN,s=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,r=/^0o[0-7]+$/i,a=parseInt;function o(h){if(typeof h=="number")return h;if(e(h))return i;if(t(h)){var u=typeof h.valueOf=="function"?h.valueOf():h;h=t(u)?u+"":u}if(typeof h!="string")return h===0?h:+h;h=d(h);var c=n.test(h);return c||r.test(h)?a(h.slice(2),c?2:8):s.test(h)?i:+h}return Sf=o,Sf}var Cf,Pm;function Nv(){if(Pm)return Cf;Pm=1;var d=gg(),t=sw(),e=cw(),i="Expected a function",s=Math.max,n=Math.min;function r(a,o,h){var u,c,f,p,_,v,g=0,b=!1,w=!1,S=!0;if(typeof a!="function")throw new TypeError(i);o=e(o)||0,d(h)&&(b=!!h.leading,w="maxWait"in h,f=w?s(e(h.maxWait)||0,o):f,S="trailing"in h?!!h.trailing:S);function T(X){var tt=u,st=c;return u=c=void 0,g=X,p=a.apply(st,tt),p}function A(X){return g=X,_=setTimeout(P,o),b?T(X):p}function C(X){var tt=X-v,st=X-g,Q=o-tt;return w?n(Q,f-st):Q}function R(X){var tt=X-v,st=X-g;return v===void 0||tt>=o||tt<0||w&&st>=f}function P(){var X=t();if(R(X))return N(X);_=setTimeout(P,C(X))}function N(X){return _=void 0,S&&u?T(X):(u=c=void 0,p)}function F(){_!==void 0&&clearTimeout(_),g=0,u=v=c=_=void 0}function z(){return _===void 0?p:N(t())}function q(){var X=t(),tt=R(X);if(u=arguments,c=this,v=X,tt){if(_===void 0)return A(v);if(w)return clearTimeout(_),_=setTimeout(P,o),T(v)}return _===void 0&&(_=setTimeout(P,o)),p}return q.cancel=F,q.flush=z,q}return Cf=r,Cf}var Tf,Om;function dw(){if(Om)return Tf;Om=1;var d=Nv(),t=gg(),e="Expected a function";function i(s,n,r){var a=!0,o=!0;if(typeof s!="function")throw new TypeError(e);return t(r)&&(a="leading"in r?!!r.leading:a,o="trailing"in r?!!r.trailing:o),d(s,n,{leading:a,maxWait:n,trailing:o})}return Tf=i,Tf}var fw=dw();const pw=jl(fw);class gw{constructor(t){this.settings=t||{},this.id="epubjs-container-"+Dd(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}create(t){let e=t.height,i=t.width,s=t.overflow||!1,n=t.axis||"vertical",r=t.direction;yi(this.settings,t),t.height&&Le(t.height)&&(e=t.height+"px"),t.width&&Le(t.width)&&(i=t.width+"px");let a=document.createElement("div");return a.id=this.id,a.classList.add("epub-container"),a.style.wordSpacing="0",a.style.lineHeight="0",a.style.verticalAlign="top",a.style.position="relative",n==="horizontal"&&(a.style.display="flex",a.style.flexDirection="row",a.style.flexWrap="nowrap"),i&&(a.style.width=i),e&&(a.style.height=e),s&&(s==="scroll"&&n==="vertical"?(a.style["overflow-y"]=s,a.style["overflow-x"]="hidden"):s==="scroll"&&n==="horizontal"?(a.style["overflow-y"]="hidden",a.style["overflow-x"]=s):a.style.overflow=s),r&&(a.dir=r,a.style.direction=r),r&&this.settings.fullsize&&(document.body.style.direction=r),a}wrap(t){var e=document.createElement("div");return e.style.visibility="hidden",e.style.overflow="hidden",e.style.width="0",e.style.height="0",e.appendChild(t),e}getElement(t){var e;if(pv(t)?e=t:typeof t=="string"&&(e=document.getElementById(t)),!e)throw new Error("Not an Element");return e}attachTo(t){var e=this.getElement(t),i;if(e)return this.settings.hidden?i=this.wrapper:i=this.container,e.appendChild(i),this.element=e,e}getContainer(){return this.container}onResize(t){(!Le(this.settings.width)||!Le(this.settings.height))&&(this.resizeFunc=pw(t,50),window.addEventListener("resize",this.resizeFunc,!1))}onOrientationChange(t){this.orientationChangeFunc=t,window.addEventListener("orientationchange",this.orientationChangeFunc,!1)}size(t,e){var i;let s=t||this.settings.width,n=e||this.settings.height;t===null?(i=this.element.getBoundingClientRect(),i.width&&(t=Math.floor(i.width),this.container.style.width=t+"px")):Le(t)?this.container.style.width=t+"px":this.container.style.width=t,e===null?(i=i||this.element.getBoundingClientRect(),i.height&&(e=i.height,this.container.style.height=e+"px")):Le(e)?this.container.style.height=e+"px":this.container.style.height=e,Le(t)||(t=this.container.clientWidth),Le(e)||(e=this.container.clientHeight),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0};let r=$c(),a=window.getComputedStyle(document.body),o={left:parseFloat(a["padding-left"])||0,right:parseFloat(a["padding-right"])||0,top:parseFloat(a["padding-top"])||0,bottom:parseFloat(a["padding-bottom"])||0};return s||(t=r.width-o.left-o.right),(this.settings.fullsize&&!n||!n)&&(e=r.height-o.top-o.bottom),{width:t-this.containerPadding.left-this.containerPadding.right,height:e-this.containerPadding.top-this.containerPadding.bottom}}bounds(){let t;return this.container.style.overflow!=="visible"&&(t=this.container&&this.container.getBoundingClientRect()),!t||!t.width||!t.height?$c():t}getSheet(){var t=document.createElement("style");return t.appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet}addStyleRules(t,e){var i="#"+this.id+" ",s="";this.sheet||(this.sheet=this.getSheet()),e.forEach(function(n){for(var r in n)n.hasOwnProperty(r)&&(s+=r+":"+n[r]+";")}),this.sheet.insertRule(i+t+" {"+s+"}",0)}axis(t){t==="horizontal"?(this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.flexWrap="nowrap"):this.container.style.display="block",this.settings.axis=t}direction(t){this.container&&(this.container.dir=t,this.container.style.direction=t),this.settings.fullsize&&(document.body.style.direction=t),this.settings.dir=t}overflow(t){this.container&&(t==="scroll"&&this.settings.axis==="vertical"?(this.container.style["overflow-y"]=t,this.container.style["overflow-x"]="hidden"):t==="scroll"&&this.settings.axis==="horizontal"?(this.container.style["overflow-y"]="hidden",this.container.style["overflow-x"]=t):this.container.style.overflow=t),this.settings.overflow=t}destroy(){this.element&&(this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container),window.removeEventListener("resize",this.resizeFunc),window.removeEventListener("orientationChange",this.orientationChangeFunc))}}class mw{constructor(t){this.container=t,this._views=[],this.length=0,this.hidden=!1}all(){return this._views}first(){return this._views[0]}last(){return this._views[this._views.length-1]}indexOf(t){return this._views.indexOf(t)}slice(){return this._views.slice.apply(this._views,arguments)}get(t){return this._views[t]}append(t){return this._views.push(t),this.container&&this.container.appendChild(t.element),this.length++,t}prepend(t){return this._views.unshift(t),this.container&&this.container.insertBefore(t.element,this.container.firstChild),this.length++,t}insert(t,e){return this._views.splice(e,0,t),this.container&&(e<this.container.children.length?this.container.insertBefore(t.element,this.container.children[e]):this.container.appendChild(t.element)),this.length++,t}remove(t){var e=this._views.indexOf(t);e>-1&&this._views.splice(e,1),this.destroy(t),this.length--}destroy(t){t.displayed&&t.destroy(),this.container&&this.container.removeChild(t.element),t=null}forEach(){return this._views.forEach.apply(this._views,arguments)}clear(){var t,e=this.length;if(this.length){for(var i=0;i<e;i++)t=this._views[i],this.destroy(t);this._views=[],this.length=0}}find(t){for(var e,i=this.length,s=0;s<i;s++)if(e=this._views[s],e.displayed&&e.section.index==t.index)return e}displayed(){for(var t=[],e,i=this.length,s=0;s<i;s++)e=this._views[s],e.displayed&&t.push(e);return t}show(){for(var t,e=this.length,i=0;i<e;i++)t=this._views[i],t.displayed&&t.show();this.hidden=!1}hide(){for(var t,e=this.length,i=0;i<e;i++)t=this._views[i],t.displayed&&t.hide();this.hidden=!0}}class Jc{constructor(t){this.name="default",this.optsSettings=t.settings,this.View=t.view,this.request=t.request,this.renditionQueue=t.queue,this.q=new fg(this),this.settings=yi(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:void 0,writingMode:void 0,flow:"scrolled",ignoreClass:"",fullsize:void 0,allowScriptedContent:!1,allowPopups:!1}),yi(this.settings,t.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,method:this.settings.method,width:0,height:0,forceEvenPages:!0,allowScriptedContent:this.settings.allowScriptedContent,allowPopups:this.settings.allowPopups},this.rendered=!1}render(t,e){let i=t.tagName;typeof this.settings.fullsize>"u"&&i&&(i.toLowerCase()=="body"||i.toLowerCase()=="html")&&(this.settings.fullsize=!0),this.settings.fullsize&&(this.settings.overflow="visible",this.overflow=this.settings.overflow),this.settings.size=e,this.settings.rtlScrollType=tw(),this.stage=new gw({width:e.width,height:e.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.settings.fullsize,direction:this.settings.direction}),this.stage.attachTo(t),this.container=this.stage.getContainer(),this.views=new mw(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.stage.onOrientationChange(this.onOrientationChange.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout(),this.rendered=!0}addEventListeners(){var t;window.addEventListener("unload",(function(e){this.destroy()}).bind(this)),this.settings.fullsize?t=window:t=this.container,this._onScroll=this.onScroll.bind(this),t.addEventListener("scroll",this._onScroll)}removeEventListeners(){var t;this.settings.fullsize?t=window:t=this.container,t.removeEventListener("scroll",this._onScroll),this._onScroll=void 0}destroy(){clearTimeout(this.orientationTimeout),clearTimeout(this.resizeTimeout),clearTimeout(this.afterScrolled),this.clear(),this.removeEventListeners(),this.stage.destroy(),this.rendered=!1}onOrientationChange(t){let{orientation:e}=window;this.optsSettings.resizeOnOrientationChange&&this.resize(),clearTimeout(this.orientationTimeout),this.orientationTimeout=setTimeout((function(){this.orientationTimeout=void 0,this.optsSettings.resizeOnOrientationChange&&this.resize(),this.emit(mt.MANAGERS.ORIENTATION_CHANGE,e)}).bind(this),500)}onResized(t){this.resize()}resize(t,e,i){let s=this.stage.size(t,e);if(this.winBounds=$c(),this.orientationTimeout&&this.winBounds.width===this.winBounds.height){this._stageSize=void 0;return}this._stageSize&&this._stageSize.width===s.width&&this._stageSize.height===s.height||(this._stageSize=s,this._bounds=this.bounds(),this.clear(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.emit(mt.MANAGERS.RESIZED,{width:this._stageSize.width,height:this._stageSize.height},i))}createView(t,e){return new this.View(t,yi(this.viewSettings,{forceRight:e}))}handleNextPrePaginated(t,e,i){let s;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1){if(t||e.index===0)return;if(s=e.next(),s&&!s.properties.includes("page-spread-left"))return i.call(this,s)}}display(t,e){var i=new te,s=i.promise;(e===t.href||Le(e))&&(e=void 0);var n=this.views.find(t);if(n&&t&&this.layout.name!=="pre-paginated"){let a=n.offset();if(this.settings.direction==="ltr")this.scrollTo(a.left,a.top,!0);else{let o=n.width();this.scrollTo(a.left+o,a.top,!0)}if(e){let o=n.locationOf(e),h=n.width();this.moveTo(o,h)}return i.resolve(),s}this.clear();let r=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&t.properties.includes("page-spread-right")&&(r=!0),this.add(t,r).then((function(a){if(e){let o=a.locationOf(e),h=a.width();this.moveTo(o,h)}}).bind(this),a=>{i.reject(a)}).then((function(){return this.handleNextPrePaginated(r,t,this.add)}).bind(this)).then((function(){this.views.show(),i.resolve()}).bind(this)),s}afterDisplayed(t){this.emit(mt.MANAGERS.ADDED,t)}afterResized(t){this.emit(mt.MANAGERS.RESIZE,t.section)}moveTo(t,e){var i=0,s=0;this.isPaginated?(i=Math.floor(t.left/this.layout.delta)*this.layout.delta,i+this.layout.delta>this.container.scrollWidth&&(i=this.container.scrollWidth-this.layout.delta),s=Math.floor(t.top/this.layout.delta)*this.layout.delta,s+this.layout.delta>this.container.scrollHeight&&(s=this.container.scrollHeight-this.layout.delta)):s=t.top,this.settings.direction==="rtl"&&(i=i+this.layout.delta,i=i-e),this.scrollTo(i,s,!0)}add(t,e){var i=this.createView(t,e);return this.views.append(i),i.onDisplayed=this.afterDisplayed.bind(this),i.onResize=this.afterResized.bind(this),i.on(mt.VIEWS.AXIS,s=>{this.updateAxis(s)}),i.on(mt.VIEWS.WRITING_MODE,s=>{this.updateWritingMode(s)}),i.display(this.request)}append(t,e){var i=this.createView(t,e);return this.views.append(i),i.onDisplayed=this.afterDisplayed.bind(this),i.onResize=this.afterResized.bind(this),i.on(mt.VIEWS.AXIS,s=>{this.updateAxis(s)}),i.on(mt.VIEWS.WRITING_MODE,s=>{this.updateWritingMode(s)}),i.display(this.request)}prepend(t,e){var i=this.createView(t,e);return i.on(mt.VIEWS.RESIZED,s=>{this.counter(s)}),this.views.prepend(i),i.onDisplayed=this.afterDisplayed.bind(this),i.onResize=this.afterResized.bind(this),i.on(mt.VIEWS.AXIS,s=>{this.updateAxis(s)}),i.on(mt.VIEWS.WRITING_MODE,s=>{this.updateWritingMode(s)}),i.display(this.request)}counter(t){this.settings.axis==="vertical"?this.scrollBy(0,t.heightDelta,!0):this.scrollBy(t.widthDelta,0,!0)}next(){var t,e;let i=this.settings.direction;if(this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"&&(!i||i==="ltr")?(this.scrollLeft=this.container.scrollLeft,e=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,e<=this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):t=this.views.last().section.next()):this.isPaginated&&this.settings.axis==="horizontal"&&i==="rtl"?(this.scrollLeft=this.container.scrollLeft,this.settings.rtlScrollType==="default"?(e=this.container.scrollLeft,e>0?this.scrollBy(this.layout.delta,0,!0):t=this.views.last().section.next()):(e=this.container.scrollLeft+this.layout.delta*-1,e>this.container.scrollWidth*-1?this.scrollBy(this.layout.delta,0,!0):t=this.views.last().section.next())):this.isPaginated&&this.settings.axis==="vertical"?(this.scrollTop=this.container.scrollTop,this.container.scrollTop+this.container.offsetHeight<this.container.scrollHeight?this.scrollBy(0,this.layout.height,!0):t=this.views.last().section.next()):t=this.views.last().section.next(),t)){this.clear(),this.updateLayout();let s=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&t.properties.includes("page-spread-right")&&(s=!0),this.append(t,s).then((function(){return this.handleNextPrePaginated(s,t,this.append)}).bind(this),n=>n).then((function(){!this.isPaginated&&this.settings.axis==="horizontal"&&this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"&&this.scrollTo(this.container.scrollWidth,0,!0),this.views.show()}).bind(this))}}prev(){var t,e;let i=this.settings.direction;if(this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"&&(!i||i==="ltr")?(this.scrollLeft=this.container.scrollLeft,e=this.container.scrollLeft,e>0?this.scrollBy(-this.layout.delta,0,!0):t=this.views.first().section.prev()):this.isPaginated&&this.settings.axis==="horizontal"&&i==="rtl"?(this.scrollLeft=this.container.scrollLeft,this.settings.rtlScrollType==="default"?(e=this.container.scrollLeft+this.container.offsetWidth,e<this.container.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):t=this.views.first().section.prev()):(e=this.container.scrollLeft,e<0?this.scrollBy(-this.layout.delta,0,!0):t=this.views.first().section.prev())):this.isPaginated&&this.settings.axis==="vertical"?(this.scrollTop=this.container.scrollTop,this.container.scrollTop>0?this.scrollBy(0,-this.layout.height,!0):t=this.views.first().section.prev()):t=this.views.first().section.prev(),t)){this.clear(),this.updateLayout();let s=!1;return this.layout.name==="pre-paginated"&&this.layout.divisor===2&&typeof t.prev()!="object"&&(s=!0),this.prepend(t,s).then((function(){var n;if(this.layout.name==="pre-paginated"&&this.layout.divisor>1&&(n=t.prev(),n))return this.prepend(n)}).bind(this),n=>n).then((function(){this.isPaginated&&this.settings.axis==="horizontal"&&(this.settings.direction==="rtl"?this.settings.rtlScrollType==="default"?this.scrollTo(0,0,!0):this.scrollTo(this.container.scrollWidth*-1+this.layout.delta,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)),this.views.show()}).bind(this))}}current(){var t=this.visible();return t.length?t[t.length-1]:null}clear(){this.views&&(this.views.hide(),this.scrollTo(0,0,!0),this.views.clear())}currentLocation(){return this.updateLayout(),this.isPaginated&&this.settings.axis==="horizontal"?this.location=this.paginatedLocation():this.location=this.scrolledLocation(),this.location}scrolledLocation(){let t=this.visible(),e=this.container.getBoundingClientRect(),i=e.height<window.innerHeight?e.height:window.innerHeight,s=e.width<window.innerWidth?e.width:window.innerWidth,n=this.settings.axis==="vertical";this.settings.direction;let r=0,a=0;return this.settings.fullsize&&(r=n?window.scrollY:window.scrollX),t.map(h=>{let{index:u,href:c}=h.section,f=h.position(),p=h.width(),_=h.height(),v,g,b,w;n?(v=r+e.top-f.top+a,g=v+i-a,w=this.layout.count(_,i).pages,b=i):(v=r+e.left-f.left+a,g=v+s-a,w=this.layout.count(p,s).pages,b=s);let S=Math.ceil(v/b),T=[],A=Math.ceil(g/b);if(this.settings.direction==="rtl"&&!n){let P=S;S=w-A,A=w-P}T=[];for(var C=S;C<=A;C++){let P=C+1;T.push(P)}let R=this.mapping.page(h.contents,h.section.cfiBase,v,g);return{index:u,href:c,pages:T,totalPages:w,mapping:R}})}paginatedLocation(){let t=this.visible(),e=this.container.getBoundingClientRect(),i=0,s=0;return this.settings.fullsize&&(i=window.scrollX),t.map(r=>{let{index:a,href:o}=r.section,h,u=r.position(),c=r.width(),f,p,_;this.settings.direction==="rtl"?(h=e.right-i,_=Math.min(Math.abs(h-u.left),this.layout.width)-s,p=u.width-(u.right-h)-s,f=p-_):(h=e.left+i,_=Math.min(u.right-h,this.layout.width)-s,f=h-u.left+s,p=f+_),s+=_;let v=this.mapping.page(r.contents,r.section.cfiBase,f,p),g=this.layout.count(c).pages,b=Math.floor(f/this.layout.pageWidth),w=[],S=Math.floor(p/this.layout.pageWidth);if(b<0&&(b=0,S=S+1),this.settings.direction==="rtl"){let A=b;b=g-S,S=g-A}for(var T=b+1;T<=S;T++){let A=T;w.push(A)}return{index:a,href:o,pages:w,totalPages:g,mapping:v}})}isVisible(t,e,i,s){var n=t.position(),r=s||this.bounds();return this.settings.axis==="horizontal"&&n.right>r.left-e&&n.left<r.right+i?!0:this.settings.axis==="vertical"&&n.bottom>r.top-e&&n.top<r.bottom+i}visible(){for(var t=this.bounds(),e=this.views.displayed(),i=e.length,s=[],n,r,a=0;a<i;a++)r=e[a],n=this.isVisible(r,0,0,t),n===!0&&s.push(r);return s}scrollBy(t,e,i){let s=this.settings.direction==="rtl"?-1:1;i&&(this.ignore=!0),this.settings.fullsize?window.scrollBy(t*s,e*s):(t&&(this.container.scrollLeft+=t*s),e&&(this.container.scrollTop+=e)),this.scrolled=!0}scrollTo(t,e,i){i&&(this.ignore=!0),this.settings.fullsize?window.scrollTo(t,e):(this.container.scrollLeft=t,this.container.scrollTop=e),this.scrolled=!0}onScroll(){let t,e;this.settings.fullsize?(t=window.scrollY,e=window.scrollX):(t=this.container.scrollTop,e=this.container.scrollLeft),this.scrollTop=t,this.scrollLeft=e,this.ignore?this.ignore=!1:(this.emit(mt.MANAGERS.SCROLL,{top:t,left:e}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout((function(){this.emit(mt.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}).bind(this),20))}bounds(){var t;return t=this.stage.bounds(),t}applyLayout(t){this.layout=t,this.updateLayout(),this.views&&this.views.length>0&&this.layout.name==="pre-paginated"&&this.display(this.views.first().section)}updateLayout(){this.stage&&(this._stageSize=this.stage.size(),this.isPaginated?(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta/this.layout.divisor):this.layout.calculate(this._stageSize.width,this._stageSize.height),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}setLayout(t){this.viewSettings.layout=t,this.mapping=new Zc(t.props,this.settings.direction,this.settings.axis),this.views&&this.views.forEach(function(e){e&&e.setLayout(t)})}updateWritingMode(t){this.writingMode=t}updateAxis(t,e){!e&&t===this.settings.axis||(this.settings.axis=t,this.stage&&this.stage.axis(t),this.viewSettings.axis=t,this.mapping&&(this.mapping=new Zc(this.layout.props,this.settings.direction,this.settings.axis)),this.layout&&(t==="vertical"?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)))}updateFlow(t,e="auto"){let i=t==="paginated"||t==="auto";this.isPaginated=i,t==="scrolled-doc"||t==="scrolled-continuous"||t==="scrolled"?this.updateAxis("vertical"):this.updateAxis("horizontal"),this.viewSettings.flow=t,this.settings.overflow?this.overflow=this.settings.overflow:this.overflow=i?"hidden":e,this.stage&&this.stage.overflow(this.overflow),this.updateLayout()}getContents(){var t=[];return this.views&&this.views.forEach(function(e){const i=e&&e.contents;i&&t.push(i)}),t}direction(t="ltr"){this.settings.direction=t,this.stage&&this.stage.direction(t),this.viewSettings.direction=t,this.updateLayout()}isRendered(){return this.rendered}}mn(Jc.prototype);const vw={easeInCubic:function(d){return Math.pow(d,3)}};class Wf{constructor(t,e){this.settings=yi({duration:80,minVelocity:.2,minDistance:10,easing:vw.easeInCubic},e||{}),this.supportsTouch=this.supportsTouch(),this.supportsTouch&&this.setup(t)}setup(t){this.manager=t,this.layout=this.manager.layout,this.fullsize=this.manager.settings.fullsize,this.fullsize?(this.element=this.manager.stage.element,this.scroller=window,this.disableScroll()):(this.element=this.manager.stage.container,this.scroller=this.element,this.element.style.WebkitOverflowScrolling="touch"),this.manager.settings.offset=this.layout.width,this.manager.settings.afterScrolledTimeout=this.settings.duration*2,this.isVertical=this.manager.settings.axis==="vertical",!(!this.manager.isPaginated||this.isVertical)&&(this.touchCanceler=!1,this.resizeCanceler=!1,this.snapping=!1,this.scrollLeft,this.scrollTop,this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0,this.addListeners())}supportsTouch(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}disableScroll(){this.element.style.overflow="hidden"}enableScroll(){this.element.style.overflow=""}addListeners(){this._onResize=this.onResize.bind(this),window.addEventListener("resize",this._onResize),this._onScroll=this.onScroll.bind(this),this.scroller.addEventListener("scroll",this._onScroll),this._onTouchStart=this.onTouchStart.bind(this),this.scroller.addEventListener("touchstart",this._onTouchStart,{passive:!0}),this.on("touchstart",this._onTouchStart),this._onTouchMove=this.onTouchMove.bind(this),this.scroller.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.on("touchmove",this._onTouchMove),this._onTouchEnd=this.onTouchEnd.bind(this),this.scroller.addEventListener("touchend",this._onTouchEnd,{passive:!0}),this.on("touchend",this._onTouchEnd),this._afterDisplayed=this.afterDisplayed.bind(this),this.manager.on(mt.MANAGERS.ADDED,this._afterDisplayed)}removeListeners(){window.removeEventListener("resize",this._onResize),this._onResize=void 0,this.scroller.removeEventListener("scroll",this._onScroll),this._onScroll=void 0,this.scroller.removeEventListener("touchstart",this._onTouchStart,{passive:!0}),this.off("touchstart",this._onTouchStart),this._onTouchStart=void 0,this.scroller.removeEventListener("touchmove",this._onTouchMove,{passive:!0}),this.off("touchmove",this._onTouchMove),this._onTouchMove=void 0,this.scroller.removeEventListener("touchend",this._onTouchEnd,{passive:!0}),this.off("touchend",this._onTouchEnd),this._onTouchEnd=void 0,this.manager.off(mt.MANAGERS.ADDED,this._afterDisplayed),this._afterDisplayed=void 0}afterDisplayed(t){let e=t.contents;["touchstart","touchmove","touchend"].forEach(i=>{e.on(i,s=>this.triggerViewEvent(s,e))})}triggerViewEvent(t,e){this.emit(t.type,t,e)}onScroll(t){this.scrollLeft=this.fullsize?window.scrollX:this.scroller.scrollLeft,this.scrollTop=this.fullsize?window.scrollY:this.scroller.scrollTop}onResize(t){this.resizeCanceler=!0}onTouchStart(t){let{screenX:e,screenY:i}=t.touches[0];this.fullsize&&this.enableScroll(),this.touchCanceler=!0,this.startTouchX||(this.startTouchX=e,this.startTouchY=i,this.startTime=this.now()),this.endTouchX=e,this.endTouchY=i,this.endTime=this.now()}onTouchMove(t){let{screenX:e,screenY:i}=t.touches[0],s=Math.abs(i-this.endTouchY);this.touchCanceler=!0,!this.fullsize&&s<10&&(this.element.scrollLeft-=e-this.endTouchX),this.endTouchX=e,this.endTouchY=i,this.endTime=this.now()}onTouchEnd(t){this.fullsize&&this.disableScroll(),this.touchCanceler=!1;let e=this.wasSwiped();e!==0?this.snap(e):this.snap(),this.startTouchX=void 0,this.startTouchY=void 0,this.startTime=void 0,this.endTouchX=void 0,this.endTouchY=void 0,this.endTime=void 0}wasSwiped(){let t=this.layout.pageWidth*this.layout.divisor,e=this.endTouchX-this.startTouchX,i=Math.abs(e),s=this.endTime-this.startTime,n=e/s,r=this.settings.minVelocity;if(i<=this.settings.minDistance||i>=t)return 0;if(n>r)return-1;if(n<-r)return 1}needsSnap(){let t=this.scrollLeft,e=this.layout.pageWidth*this.layout.divisor;return t%e!==0}snap(t=0){let e=this.scrollLeft,i=this.layout.pageWidth*this.layout.divisor,s=Math.round(e/i)*i;return t&&(s+=t*i),this.smoothScrollTo(s)}smoothScrollTo(t){const e=new te,i=this.scrollLeft,s=this.now(),n=this.settings.duration,r=this.settings.easing;this.snapping=!0;function a(){const o=this.now(),h=Math.min(1,(o-s)/n);if(r(h),this.touchCanceler||this.resizeCanceler){this.resizeCanceler=!1,this.snapping=!1,e.resolve();return}h<1?(window.requestAnimationFrame(a.bind(this)),this.scrollTo(i+(t-i)*h,0)):(this.scrollTo(t,0),this.snapping=!1,e.resolve())}return a.call(this),e.promise}scrollTo(t=0,e=0){this.fullsize?window.scroll(t,e):(this.scroller.scrollLeft=t,this.scroller.scrollTop=e)}now(){return"now"in window.performance?performance.now():new Date().getTime()}destroy(){this.scroller&&(this.fullsize&&this.enableScroll(),this.removeListeners(),this.scroller=void 0)}}mn(Wf.prototype);var bw=Nv();const yw=jl(bw);class ww extends Jc{constructor(t){super(t),this.name="continuous",this.settings=yi(this.settings||{},{infinite:!0,overflow:void 0,axis:void 0,writingMode:void 0,flow:"scrolled",offset:500,offsetDelta:250,width:void 0,height:void 0,snap:!1,afterScrolledTimeout:10,allowScriptedContent:!1,allowPopups:!1}),yi(this.settings,t.settings||{}),t.settings.gap!="undefined"&&t.settings.gap===0&&(this.settings.gap=t.settings.gap),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,width:0,height:0,forceEvenPages:!1,allowScriptedContent:this.settings.allowScriptedContent,allowPopups:this.settings.allowPopups},this.scrollTop=0,this.scrollLeft=0}display(t,e){return Jc.prototype.display.call(this,t,e).then((function(){return this.fill()}).bind(this))}fill(t){var e=t||new te;return this.q.enqueue(()=>this.check()).then(i=>{i?this.fill(e):e.resolve()}),e.promise}moveTo(t){var e=0,i=0;this.isPaginated?(e=Math.floor(t.left/this.layout.delta)*this.layout.delta,e+this.settings.offsetDelta):(i=t.top,t.top+this.settings.offsetDelta),(e>0||i>0)&&this.scrollBy(e,i,!0)}afterResized(t){this.emit(mt.MANAGERS.RESIZE,t.section)}removeShownListeners(t){t.onDisplayed=function(){}}add(t){var e=this.createView(t);return this.views.append(e),e.on(mt.VIEWS.RESIZED,i=>{e.expanded=!0}),e.on(mt.VIEWS.AXIS,i=>{this.updateAxis(i)}),e.on(mt.VIEWS.WRITING_MODE,i=>{this.updateWritingMode(i)}),e.onDisplayed=this.afterDisplayed.bind(this),e.onResize=this.afterResized.bind(this),e.display(this.request)}append(t){var e=this.createView(t);return e.on(mt.VIEWS.RESIZED,i=>{e.expanded=!0}),e.on(mt.VIEWS.AXIS,i=>{this.updateAxis(i)}),e.on(mt.VIEWS.WRITING_MODE,i=>{this.updateWritingMode(i)}),this.views.append(e),e.onDisplayed=this.afterDisplayed.bind(this),e}prepend(t){var e=this.createView(t);return e.on(mt.VIEWS.RESIZED,i=>{this.counter(i),e.expanded=!0}),e.on(mt.VIEWS.AXIS,i=>{this.updateAxis(i)}),e.on(mt.VIEWS.WRITING_MODE,i=>{this.updateWritingMode(i)}),this.views.prepend(e),e.onDisplayed=this.afterDisplayed.bind(this),e}counter(t){this.settings.axis==="vertical"?this.scrollBy(0,t.heightDelta,!0):this.scrollBy(t.widthDelta,0,!0)}update(t){for(var e=this.bounds(),i=this.views.all(),s=i.length,n=typeof t<"u"?t:this.settings.offset||0,r,a,o=new te,h=[],u=0;u<s;u++)if(a=i[u],r=this.isVisible(a,n,n,e),r===!0)if(a.displayed)a.show();else{let c=a.display(this.request).then(function(f){f.show()},f=>{a.hide()});h.push(c)}else this.q.enqueue(a.destroy.bind(a)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout((function(){this.q.enqueue(this.trim.bind(this))}).bind(this),250);return h.length?Promise.all(h).catch(c=>{o.reject(c)}):(o.resolve(),o.promise)}check(t,e){var i=new te,s=[],n=this.settings.axis==="horizontal",r=this.settings.offset||0;t&&n&&(r=t),e&&!n&&(r=e);var a=this._bounds;let o=n?this.scrollLeft:this.scrollTop,h=n?Math.floor(a.width):a.height,u=n?this.container.scrollWidth:this.container.scrollHeight,c=this.writingMode&&this.writingMode.indexOf("vertical")===0?"vertical":"horizontal",f=this.settings.rtlScrollType,p=this.settings.direction==="rtl";this.settings.fullsize?(n&&p&&f==="negative"||!n&&p&&f==="default")&&(o=o*-1):(p&&f==="default"&&c==="horizontal"&&(o=u-h-o),p&&f==="negative"&&c==="horizontal"&&(o=o*-1));let _=()=>{let S=this.views.first(),T=S&&S.section.prev();T&&s.push(this.prepend(T))},v=()=>{let S=this.views.last(),T=S&&S.section.next();T&&s.push(this.append(T))},g=o+h+r,b=o-r;g>=u&&v(),b<0&&_();let w=s.map(S=>S.display(this.request));return s.length?Promise.all(w).then(()=>this.check()).then(()=>this.update(r),S=>S):(this.q.enqueue((function(){this.update()}).bind(this)),i.resolve(!1),i.promise)}trim(){for(var t=new te,e=this.views.displayed(),i=e[0],s=e[e.length-1],n=this.views.indexOf(i),r=this.views.indexOf(s),a=this.views.slice(0,n),o=this.views.slice(r+1),h=0;h<a.length-1;h++)this.erase(a[h],a);for(var u=1;u<o.length;u++)this.erase(o[u]);return t.resolve(),t.promise}erase(t,e){var i,s;this.settings.fullsize?(i=window.scrollY,s=window.scrollX):(i=this.container.scrollTop,s=this.container.scrollLeft);var n=t.bounds();this.views.remove(t),e&&(this.settings.axis==="vertical"?this.scrollTo(0,i-n.height,!0):this.settings.direction==="rtl"?this.settings.fullsize?this.scrollTo(s+Math.floor(n.width),0,!0):this.scrollTo(s,0,!0):this.scrollTo(s-Math.floor(n.width),0,!0))}addEventListeners(t){window.addEventListener("unload",(function(e){this.ignore=!0,this.destroy()}).bind(this)),this.addScrollListeners(),this.isPaginated&&this.settings.snap&&(this.snapper=new Wf(this,this.settings.snap&&typeof this.settings.snap=="object"&&this.settings.snap))}addScrollListeners(){var t;this.tick=ug;let e=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.fullsize?(t=window,this.scrollTop=window.scrollY*e,this.scrollLeft=window.scrollX*e):(t=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft),this._onScroll=this.onScroll.bind(this),t.addEventListener("scroll",this._onScroll),this._scrolled=yw(this.scrolled.bind(this),30),this.didScroll=!1}removeEventListeners(){var t;this.settings.fullsize?t=window:t=this.container,t.removeEventListener("scroll",this._onScroll),this._onScroll=void 0}onScroll(){let t,e,i=this.settings.direction==="rtl"&&this.settings.rtlScrollType==="default"?-1:1;this.settings.fullsize?(t=window.scrollY*i,e=window.scrollX*i):(t=this.container.scrollTop,e=this.container.scrollLeft),this.scrollTop=t,this.scrollLeft=e,this.ignore?this.ignore=!1:this._scrolled(),this.scrollDeltaVert+=Math.abs(t-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(e-this.prevScrollLeft),this.prevScrollTop=t,this.prevScrollLeft=e,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout((function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}).bind(this),150),clearTimeout(this.afterScrolled),this.didScroll=!1}scrolled(){this.q.enqueue((function(){return this.check()}).bind(this)),this.emit(mt.MANAGERS.SCROLL,{top:this.scrollTop,left:this.scrollLeft}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout((function(){this.snapper&&this.snapper.supportsTouch&&this.snapper.needsSnap()||this.emit(mt.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}).bind(this),this.settings.afterScrolledTimeout)}next(){let t=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?this.layout.props.delta*2:this.layout.props.delta;this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(t,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue((function(){return this.check()}).bind(this)))}prev(){let t=this.layout.props.name==="pre-paginated"&&this.layout.props.spread?this.layout.props.delta*2:this.layout.props.delta;this.views.length&&(this.isPaginated&&this.settings.axis==="horizontal"?this.scrollBy(-t,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue((function(){return this.check()}).bind(this)))}updateFlow(t){this.rendered&&this.snapper&&(this.snapper.destroy(),this.snapper=void 0),super.updateFlow(t,"scroll"),this.rendered&&this.isPaginated&&this.settings.snap&&(this.snapper=new Wf(this,this.settings.snap&&typeof this.settings.snap=="object"&&this.settings.snap))}destroy(){super.destroy(),this.snapper&&this.snapper.destroy()}}class mg{constructor(t,e){this.settings=yi(this.settings||{},{width:null,height:null,ignoreClass:"",manager:"default",view:"iframe",flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,resizeOnOrientationChange:!0,script:null,snap:!1,defaultDirection:"ltr",allowScriptedContent:!1,allowPopups:!1}),yi(this.settings,e),typeof this.settings.manager=="object"&&(this.manager=this.settings.manager),this.book=t,this.hooks={},this.hooks.display=new Ws(this),this.hooks.serialize=new Ws(this),this.hooks.content=new Ws(this),this.hooks.unloaded=new Ws(this),this.hooks.layout=new Ws(this),this.hooks.render=new Ws(this),this.hooks.show=new Ws(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new $y(this),this.annotations=new Ky(this),this.epubcfi=new ee,this.q=new fg(this),this.location=void 0,this.q.enqueue(this.book.opened),this.starting=new te,this.started=this.starting.promise,this.q.enqueue(this.start)}setManager(t){this.manager=t}requireManager(t){var e;return typeof t=="string"&&t==="default"?e=Jc:typeof t=="string"&&t==="continuous"?e=ww:e=t,e}requireView(t){var e;return typeof t=="string"&&t==="iframe"?e=kv:e=t,e}start(){switch(!this.settings.layout&&(this.book.package.metadata.layout==="pre-paginated"||this.book.displayOptions.fixedLayout==="true")&&(this.settings.layout="pre-paginated"),this.book.package.metadata.spread){case"none":this.settings.spread="none";break;case"both":this.settings.spread=!0;break}this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.direction(this.book.package.metadata.direction||this.settings.defaultDirection),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on(mt.MANAGERS.ADDED,this.afterDisplayed.bind(this)),this.manager.on(mt.MANAGERS.REMOVED,this.afterRemoved.bind(this)),this.manager.on(mt.MANAGERS.RESIZED,this.onResized.bind(this)),this.manager.on(mt.MANAGERS.ORIENTATION_CHANGE,this.onOrientationChange.bind(this)),this.manager.on(mt.MANAGERS.SCROLLED,this.reportLocation.bind(this)),this.emit(mt.RENDITION.STARTED),this.starting.resolve()}attachTo(t){return this.q.enqueue((function(){this.manager.render(t,{width:this.settings.width,height:this.settings.height}),this.emit(mt.RENDITION.ATTACHED)}).bind(this))}display(t){return this.displaying&&this.displaying.resolve(),this.q.enqueue(this._display,t)}_display(t){if(this.book){this.epubcfi.isCfiString(t);var e=new te,i=e.promise,s;return this.displaying=e,this.book.locations.length()&&gv(t)&&(t=this.book.locations.cfiFromPercentage(parseFloat(t))),s=this.book.spine.get(t),s?(this.manager.display(s,t).then(()=>{e.resolve(s),this.displaying=void 0,this.emit(mt.RENDITION.DISPLAYED,s),this.reportLocation()},n=>{this.emit(mt.RENDITION.DISPLAY_ERROR,n)}),i):(e.reject(new Error("No Section Found")),i)}}afterDisplayed(t){t.on(mt.VIEWS.MARK_CLICKED,(e,i)=>this.triggerMarkEvent(e,i,t.contents)),this.hooks.render.trigger(t,this).then(()=>{t.contents?this.hooks.content.trigger(t.contents,this).then(()=>{this.emit(mt.RENDITION.RENDERED,t.section,t)}):this.emit(mt.RENDITION.RENDERED,t.section,t)})}afterRemoved(t){this.hooks.unloaded.trigger(t,this).then(()=>{this.emit(mt.RENDITION.REMOVED,t.section,t)})}onResized(t,e){this.emit(mt.RENDITION.RESIZED,{width:t.width,height:t.height},e),this.location&&this.location.start&&this.display(e||this.location.start.cfi)}onOrientationChange(t){this.emit(mt.RENDITION.ORIENTATION_CHANGE,t)}moveTo(t){this.manager.moveTo(t)}resize(t,e,i){t&&(this.settings.width=t),e&&(this.settings.height=e),this.manager.resize(t,e,i)}clear(){this.manager.clear()}next(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}prev(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}determineLayoutProperties(t){var e,i=this.settings.layout||t.layout||"reflowable",s=this.settings.spread||t.spread||"auto",n=this.settings.orientation||t.orientation||"auto",r=this.settings.flow||t.flow||"auto",a=t.viewport||"",o=this.settings.minSpreadWidth||t.minSpreadWidth||800,h=this.settings.direction||t.direction||"ltr";return(this.settings.width===0||this.settings.width>0)&&(this.settings.height===0||this.settings.height>0),e={layout:i,spread:s,orientation:n,flow:r,viewport:a,minSpreadWidth:o,direction:h},e}flow(t){var e=t;(t==="scrolled"||t==="scrolled-doc"||t==="scrolled-continuous")&&(e="scrolled"),(t==="auto"||t==="paginated")&&(e="paginated"),this.settings.flow=t,this._layout&&this._layout.flow(e),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this.manager&&this.manager.updateFlow(e),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}layout(t){return t&&(this._layout=new Cv(t),this._layout.spread(t.spread,this.settings.minSpreadWidth),this._layout.on(mt.LAYOUT.UPDATED,(e,i)=>{this.emit(mt.RENDITION.LAYOUT,e,i)})),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}spread(t,e){this.settings.spread=t,e&&(this.settings.minSpreadWidth=e),this._layout&&this._layout.spread(t,e),this.manager&&this.manager.isRendered()&&this.manager.updateLayout()}direction(t){this.settings.direction=t||"ltr",this.manager&&this.manager.direction(this.settings.direction),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}reportLocation(){return this.q.enqueue((function(){requestAnimationFrame((function(){var i=this.manager.currentLocation();if(i&&i.then&&typeof i.then=="function")i.then((function(s){let n=this.located(s);!n||!n.start||!n.end||(this.location=n,this.emit(mt.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(mt.RENDITION.RELOCATED,this.location))}).bind(this));else if(i){let s=this.located(i);if(!s||!s.start||!s.end)return;this.location=s,this.emit(mt.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(mt.RENDITION.RELOCATED,this.location)}}).bind(this))}).bind(this))}currentLocation(){var t=this.manager.currentLocation();if(t&&t.then&&typeof t.then=="function")t.then((function(e){return this.located(e)}).bind(this));else if(t)return this.located(t)}located(t){if(!t.length)return{};let e=t[0],i=t[t.length-1],s={start:{index:e.index,href:e.href,cfi:e.mapping.start,displayed:{page:e.pages[0]||1,total:e.totalPages}},end:{index:i.index,href:i.href,cfi:i.mapping.end,displayed:{page:i.pages[i.pages.length-1]||1,total:i.totalPages}}},n=this.book.locations.locationFromCfi(e.mapping.start),r=this.book.locations.locationFromCfi(i.mapping.end);n!=null&&(s.start.location=n,s.start.percentage=this.book.locations.percentageFromLocation(n)),r!=null&&(s.end.location=r,s.end.percentage=this.book.locations.percentageFromLocation(r));let a=this.book.pageList.pageFromCfi(e.mapping.start),o=this.book.pageList.pageFromCfi(i.mapping.end);return a!=-1&&(s.start.page=a),o!=-1&&(s.end.page=o),i.index===this.book.spine.last().index&&s.end.displayed.page>=s.end.displayed.total&&(s.atEnd=!0),e.index===this.book.spine.first().index&&s.start.displayed.page===1&&(s.atStart=!0),s}destroy(){this.manager&&this.manager.destroy(),this.book=void 0}passEvents(t){fc.forEach(e=>{t.on(e,i=>this.triggerViewEvent(i,t))}),t.on(mt.CONTENTS.SELECTED,e=>this.triggerSelectedEvent(e,t))}triggerViewEvent(t,e){this.emit(t.type,t,e)}triggerSelectedEvent(t,e){this.emit(mt.RENDITION.SELECTED,t,e)}triggerMarkEvent(t,e,i){this.emit(mt.RENDITION.MARK_CLICKED,t,e,i)}getRange(t,e){var i=new ee(t),s=this.manager.visible().filter(function(n){if(i.spinePos===n.index)return!0});if(s.length)return s[0].contents.range(i,e)}adjustImages(t){if(this._layout.name==="pre-paginated")return new Promise(function(n){n()});let e=t.window.getComputedStyle(t.content,null),i=(t.content.offsetHeight-(parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)))*.95,s=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight);return t.addStylesheetRules({img:{"max-width":(this._layout.columnWidth?this._layout.columnWidth-s+"px":"100%")+"!important","max-height":i+"px!important","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"},svg:{"max-width":(this._layout.columnWidth?this._layout.columnWidth-s+"px":"100%")+"!important","max-height":i+"px!important","page-break-inside":"avoid","break-inside":"avoid"}}),new Promise(function(n,r){setTimeout(function(){n()},1)})}getContents(){return this.manager?this.manager.getContents():[]}views(){return(this.manager?this.manager.views:void 0)||[]}handleLinks(t){t&&t.on(mt.CONTENTS.LINK_CLICKED,e=>{let i=this.book.path.relative(e);this.display(i)})}injectStylesheet(t,e){let i=t.createElement("link");i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),i.setAttribute("href",this.settings.stylesheet),t.getElementsByTagName("head")[0].appendChild(i)}injectScript(t,e){let i=t.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",this.settings.script),i.textContent=" ",t.getElementsByTagName("head")[0].appendChild(i)}injectIdentifier(t,e){let i=this.book.packaging.metadata.identifier,s=t.createElement("meta");s.setAttribute("name","dc.relation.ispartof"),i&&s.setAttribute("content",i),t.getElementsByTagName("head")[0].appendChild(s)}}mn(mg.prototype);var Df={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Mm;function _w(){return Mm||(Mm=1,function(d,t){(function(e){d.exports=e()})(function(){return function e(i,s,n){function r(h,u){if(!s[h]){if(!i[h]){var c=typeof jr=="function"&&jr;if(!u&&c)return c(h,!0);if(a)return a(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var p=s[h]={exports:{}};i[h][0].call(p.exports,function(_){var v=i[h][1][_];return r(v||_)},p,p.exports,e,i,s,n)}return s[h].exports}for(var a=typeof jr=="function"&&jr,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,i,s){var n=e("./utils"),r=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(o){for(var h=[],u,c,f,p,_,v,g,b=0,w=o.length,S=w,T=n.getTypeOf(o)!=="string";b<o.length;)S=w-b,T?(u=o[b++],c=b<w?o[b++]:0,f=b<w?o[b++]:0):(u=o.charCodeAt(b++),c=b<w?o.charCodeAt(b++):0,f=b<w?o.charCodeAt(b++):0),p=u>>2,_=(u&3)<<4|c>>4,v=S>1?(c&15)<<2|f>>6:64,g=S>2?f&63:64,h.push(a.charAt(p)+a.charAt(_)+a.charAt(v)+a.charAt(g));return h.join("")},s.decode=function(o){var h,u,c,f,p,_,v,g=0,b=0,w="data:";if(o.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");o=o.replace(/[^A-Za-z0-9+/=]/g,"");var S=o.length*3/4;if(o.charAt(o.length-1)===a.charAt(64)&&S--,o.charAt(o.length-2)===a.charAt(64)&&S--,S%1!==0)throw new Error("Invalid base64 input, bad content length.");var T;for(r.uint8array?T=new Uint8Array(S|0):T=new Array(S|0);g<o.length;)f=a.indexOf(o.charAt(g++)),p=a.indexOf(o.charAt(g++)),_=a.indexOf(o.charAt(g++)),v=a.indexOf(o.charAt(g++)),h=f<<2|p>>4,u=(p&15)<<4|_>>2,c=(_&3)<<6|v,T[b++]=h,_!==64&&(T[b++]=u),v!==64&&(T[b++]=c);return T}},{"./support":30,"./utils":32}],2:[function(e,i,s){var n=e("./external"),r=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),o=e("./stream/DataLengthProbe");function h(u,c,f,p,_){this.compressedSize=u,this.uncompressedSize=c,this.crc32=f,this.compression=p,this.compressedContent=_}h.prototype={getContentWorker:function(){var u=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),c=this;return u.on("end",function(){if(this.streamInfo.data_length!==c.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(u,c,f){return u.pipe(new a).pipe(new o("uncompressedSize")).pipe(c.compressWorker(f)).pipe(new o("compressedSize")).withStreamInfo("compression",c)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,i,s){var n=e("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},s.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,i,s){var n=e("./utils");function r(){for(var u,c=[],f=0;f<256;f++){u=f;for(var p=0;p<8;p++)u=u&1?3988292384^u>>>1:u>>>1;c[f]=u}return c}var a=r();function o(u,c,f,p){var _=a,v=p+f;u=u^-1;for(var g=p;g<v;g++)u=u>>>8^_[(u^c[g])&255];return u^-1}function h(u,c,f,p){var _=a,v=p+f;u=u^-1;for(var g=p;g<v;g++)u=u>>>8^_[(u^c.charCodeAt(g))&255];return u^-1}i.exports=function(c,f){if(typeof c>"u"||!c.length)return 0;var p=n.getTypeOf(c)!=="string";return p?o(f|0,c,c.length,0):h(f|0,c,c.length,0)}},{"./utils":32}],5:[function(e,i,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(e,i,s){var n=null;typeof Promise<"u"?n=Promise:n=e("lie"),i.exports={Promise:n}},{lie:37}],7:[function(e,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=e("pako"),a=e("./utils"),o=e("./stream/GenericWorker"),h=n?"uint8array":"array";s.magic="\b\0";function u(c,f){o.call(this,"FlateWorker/"+c),this._pako=null,this._pakoAction=c,this._pakoOptions=f,this.meta={}}a.inherits(u,o),u.prototype.processChunk=function(c){this.meta=c.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(h,c.data),!1)},u.prototype.flush=function(){o.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var c=this;this._pako.onData=function(f){c.push({data:f,meta:c.meta})}},s.compressWorker=function(c){return new u("Deflate",c)},s.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,i,s){var n=e("../utils"),r=e("../stream/GenericWorker"),a=e("../utf8"),o=e("../crc32"),h=e("../signature"),u=function(b,w){var S="",T;for(T=0;T<w;T++)S+=String.fromCharCode(b&255),b=b>>>8;return S},c=function(b,w){var S=b;return b||(S=w?16893:33204),(S&65535)<<16},f=function(b){return(b||0)&63},p=function(b,w,S,T,A,C){var R=b.file,P=b.compression,N=C!==a.utf8encode,F=n.transformTo("string",C(R.name)),z=n.transformTo("string",a.utf8encode(R.name)),q=R.comment,X=n.transformTo("string",C(q)),tt=n.transformTo("string",a.utf8encode(q)),st=z.length!==R.name.length,Q=tt.length!==q.length,J,et,ut="",Dt="",ot="",ct=R.dir,xt=R.date,Ct={crc32:0,compressedSize:0,uncompressedSize:0};(!w||S)&&(Ct.crc32=b.crc32,Ct.compressedSize=b.compressedSize,Ct.uncompressedSize=b.uncompressedSize);var Mt=0;w&&(Mt|=8),!N&&(st||Q)&&(Mt|=2048);var Yt=0,Rt=0;ct&&(Yt|=16),A==="UNIX"?(Rt=798,Yt|=c(R.unixPermissions,ct)):(Rt=20,Yt|=f(R.dosPermissions)),J=xt.getUTCHours(),J=J<<6,J=J|xt.getUTCMinutes(),J=J<<5,J=J|xt.getUTCSeconds()/2,et=xt.getUTCFullYear()-1980,et=et<<4,et=et|xt.getUTCMonth()+1,et=et<<5,et=et|xt.getUTCDate(),st&&(Dt=u(1,1)+u(o(F),4)+z,ut+="up"+u(Dt.length,2)+Dt),Q&&(ot=u(1,1)+u(o(X),4)+tt,ut+="uc"+u(ot.length,2)+ot);var kt="";kt+=`
\0`,kt+=u(Mt,2),kt+=P.magic,kt+=u(J,2),kt+=u(et,2),kt+=u(Ct.crc32,4),kt+=u(Ct.compressedSize,4),kt+=u(Ct.uncompressedSize,4),kt+=u(F.length,2),kt+=u(ut.length,2);var se=h.LOCAL_FILE_HEADER+kt+F+ut,ie=h.CENTRAL_FILE_HEADER+u(Rt,2)+kt+u(X.length,2)+"\0\0\0\0"+u(Yt,4)+u(T,4)+F+ut+X;return{fileRecord:se,dirRecord:ie}},_=function(b,w,S,T,A){var C="",R=n.transformTo("string",A(T));return C=h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+u(b,2)+u(b,2)+u(w,4)+u(S,4)+u(R.length,2)+R,C},v=function(b){var w="";return w=h.DATA_DESCRIPTOR+u(b.crc32,4)+u(b.compressedSize,4)+u(b.uncompressedSize,4),w};function g(b,w,S,T){r.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=S,this.encodeFileName=T,this.streamFiles=b,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(g,r),g.prototype.push=function(b){var w=b.meta.percent||0,S=this.entriesCount,T=this._sources.length;this.accumulate?this.contentBuffer.push(b):(this.bytesWritten+=b.data.length,r.prototype.push.call(this,{data:b.data,meta:{currentFile:this.currentFile,percent:S?(w+100*(S-T-1))/S:100}}))},g.prototype.openedSource=function(b){this.currentSourceOffset=this.bytesWritten,this.currentFile=b.file.name;var w=this.streamFiles&&!b.file.dir;if(w){var S=p(b,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:S.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(b){this.accumulate=!1;var w=this.streamFiles&&!b.file.dir,S=p(b,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(S.dirRecord),w)this.push({data:v(b),meta:{percent:100}});else for(this.push({data:S.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var b=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var S=this.bytesWritten-b,T=_(this.dirRecords.length,S,b,this.zipComment,this.encodeFileName);this.push({data:T,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(b){this._sources.push(b);var w=this;return b.on("data",function(S){w.processChunk(S)}),b.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),b.on("error",function(S){w.error(S)}),this},g.prototype.resume=function(){if(!r.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&!this._sources.length&&!this.generatedError)return this.end(),!0},g.prototype.error=function(b){var w=this._sources;if(!r.prototype.error.call(this,b))return!1;for(var S=0;S<w.length;S++)try{w[S].error(b)}catch{}return!0},g.prototype.lock=function(){r.prototype.lock.call(this);for(var b=this._sources,w=0;w<b.length;w++)b[w].lock()},i.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,i,s){var n=e("../compressions"),r=e("./ZipFileWorker"),a=function(o,h){var u=o||h,c=n[u];if(!c)throw new Error(u+" is not a valid compression method !");return c};s.generateWorker=function(o,h,u){var c=new r(h.streamFiles,u,h.platform,h.encodeFileName),f=0;try{o.forEach(function(p,_){f++;var v=a(_.options.compression,h.compression),g=_.options.compressionOptions||h.compressionOptions||{},b=_.dir,w=_.date;_._compressWorker(v,g).withStreamInfo("file",{name:p,dir:b,date:w,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(c)}),c.entriesCount=f}catch(p){c.error(p)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,i,s){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var a in this)typeof this[a]!="function"&&(r[a]=this[a]);return r}}n.prototype=e("./object"),n.prototype.loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.10.1",n.loadAsync=function(r,a){return new n().loadAsync(r,a)},n.external=e("./external"),i.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,i,s){var n=e("./utils"),r=e("./external"),a=e("./utf8"),o=e("./zipEntries"),h=e("./stream/Crc32Probe"),u=e("./nodejsUtils");function c(f){return new r.Promise(function(p,_){var v=f.decompressed.getContentWorker().pipe(new h);v.on("error",function(g){_(g)}).on("end",function(){v.streamInfo.crc32!==f.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}i.exports=function(f,p){var _=this;return p=n.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",f,!0,p.optimizedBinaryString,p.base64).then(function(v){var g=new o(p);return g.load(v),g}).then(function(g){var b=[r.Promise.resolve(g)],w=g.files;if(p.checkCRC32)for(var S=0;S<w.length;S++)b.push(c(w[S]));return r.Promise.all(b)}).then(function(g){for(var b=g.shift(),w=b.files,S=0;S<w.length;S++){var T=w[S],A=T.fileNameStr,C=n.resolve(T.fileNameStr);_.file(C,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:p.createFolders}),T.dir||(_.file(C).unsafeOriginalName=A)}return b.zipComment.length&&(_.comment=b.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,i,s){var n=e("../utils"),r=e("../stream/GenericWorker");function a(o,h){r.call(this,"Nodejs stream input adapter for "+o),this._upstreamEnded=!1,this._bindStream(h)}n.inherits(a,r),a.prototype._bindStream=function(o){var h=this;this._stream=o,o.pause(),o.on("data",function(u){h.push({data:u,meta:{percent:0}})}).on("error",function(u){h.isPaused?this.generatedError=u:h.error(u)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},a.prototype.pause=function(){return r.prototype.pause.call(this)?(this._stream.pause(),!0):!1},a.prototype.resume=function(){return r.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1},i.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,i,s){var n=e("readable-stream").Readable,r=e("../utils");r.inherits(a,n);function a(o,h,u){n.call(this,h),this._helper=o;var c=this;o.on("data",function(f,p){c.push(f)||c._helper.pause(),u&&u(p)}).on("error",function(f){c.emit("error",f)}).on("end",function(){c.push(null)})}a.prototype._read=function(){this._helper.resume()},i.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,i,s){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(e,i,s){var n=e("./utf8"),r=e("./utils"),a=e("./stream/GenericWorker"),o=e("./stream/StreamHelper"),h=e("./defaults"),u=e("./compressedObject"),c=e("./zipObject"),f=e("./generate"),p=e("./nodejsUtils"),_=e("./nodejs/NodejsStreamInputAdapter"),v=function(A,C,R){var P=r.getTypeOf(C),N,F=r.extend(R||{},h);F.date=F.date||new Date,F.compression!==null&&(F.compression=F.compression.toUpperCase()),typeof F.unixPermissions=="string"&&(F.unixPermissions=parseInt(F.unixPermissions,8)),F.unixPermissions&&F.unixPermissions&16384&&(F.dir=!0),F.dosPermissions&&F.dosPermissions&16&&(F.dir=!0),F.dir&&(A=b(A)),F.createFolders&&(N=g(A))&&w.call(this,N,!0);var z=P==="string"&&F.binary===!1&&F.base64===!1;(!R||typeof R.binary>"u")&&(F.binary=!z);var q=C instanceof u&&C.uncompressedSize===0;(q||F.dir||!C||C.length===0)&&(F.base64=!1,F.binary=!0,C="",F.compression="STORE",P="string");var X=null;C instanceof u||C instanceof a?X=C:p.isNode&&p.isStream(C)?X=new _(A,C):X=r.prepareContent(A,C,F.binary,F.optimizedBinaryString,F.base64);var tt=new c(A,X,F);this.files[A]=tt},g=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var C=A.lastIndexOf("/");return C>0?A.substring(0,C):""},b=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},w=function(A,C){return C=typeof C<"u"?C:h.createFolders,A=b(A),this.files[A]||v.call(this,A,null,{dir:!0,createFolders:C}),this.files[A]};function S(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var C,R,P;for(C in this.files)P=this.files[C],R=C.slice(this.root.length,C.length),R&&C.slice(0,this.root.length)===this.root&&A(R,P)},filter:function(A){var C=[];return this.forEach(function(R,P){A(R,P)&&C.push(P)}),C},file:function(A,C,R){if(arguments.length===1)if(S(A)){var P=A;return this.filter(function(F,z){return!z.dir&&P.test(F)})}else{var N=this.files[this.root+A];return N&&!N.dir?N:null}else A=this.root+A,v.call(this,A,C,R);return this},folder:function(A){if(!A)return this;if(S(A))return this.filter(function(N,F){return F.dir&&A.test(N)});var C=this.root+A,R=w.call(this,C),P=this.clone();return P.root=R.name,P},remove:function(A){A=this.root+A;var C=this.files[A];if(C||(A.slice(-1)!=="/"&&(A+="/"),C=this.files[A]),C&&!C.dir)delete this.files[A];else for(var R=this.filter(function(N,F){return F.name.slice(0,A.length)===A}),P=0;P<R.length;P++)delete this.files[R[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var C,R={};try{if(R=r.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode}),R.type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");r.checkSupport(R.type),(R.platform==="darwin"||R.platform==="freebsd"||R.platform==="linux"||R.platform==="sunos")&&(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var P=R.comment||this.comment||"";C=f.generateWorker(this,R,P)}catch(N){C=new a("error"),C.error(N)}return new o(C,R.type||"string",R.mimeType)},generateAsync:function(A,C){return this.generateInternalStream(A).accumulate(C)},generateNodeStream:function(A,C){return A=A||{},A.type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(C)}};i.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,i,s){i.exports=e("stream")},{stream:void 0}],17:[function(e,i,s){var n=e("./DataReader"),r=e("../utils");function a(o){n.call(this,o);for(var h=0;h<this.data.length;h++)o[h]=o[h]&255}r.inherits(a,n),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var h=o.charCodeAt(0),u=o.charCodeAt(1),c=o.charCodeAt(2),f=o.charCodeAt(3),p=this.length-4;p>=0;--p)if(this.data[p]===h&&this.data[p+1]===u&&this.data[p+2]===c&&this.data[p+3]===f)return p-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var h=o.charCodeAt(0),u=o.charCodeAt(1),c=o.charCodeAt(2),f=o.charCodeAt(3),p=this.readData(4);return h===p[0]&&u===p[1]&&c===p[2]&&f===p[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,i,s){var n=e("../utils");function r(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var o=0,h;for(this.checkOffset(a),h=this.index+a-1;h>=this.index;h--)o=(o<<8)+this.byteAt(h);return this.index+=a,o},readString:function(a){return n.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(a&31)<<1))}},i.exports=r},{"../utils":32}],19:[function(e,i,s){var n=e("./Uint8ArrayReader"),r=e("../utils");function a(o){n.call(this,o)}r.inherits(a,n),a.prototype.readData=function(o){this.checkOffset(o);var h=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,i,s){var n=e("./DataReader"),r=e("../utils");function a(o){n.call(this,o)}r.inherits(a,n),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){var h=this.readData(4);return o===h},a.prototype.readData=function(o){this.checkOffset(o);var h=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,i,s){var n=e("./ArrayReader"),r=e("../utils");function a(o){n.call(this,o)}r.inherits(a,n),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,i,s){var n=e("../utils"),r=e("../support"),a=e("./ArrayReader"),o=e("./StringReader"),h=e("./NodeBufferReader"),u=e("./Uint8ArrayReader");i.exports=function(c){var f=n.getTypeOf(c);return n.checkSupport(f),f==="string"&&!r.uint8array?new o(c):f==="nodebuffer"?new h(c):r.uint8array?new u(n.transformTo("uint8array",c)):new a(n.transformTo("array",c))}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,i,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,i,s){var n=e("./GenericWorker"),r=e("../utils");function a(o){n.call(this,"ConvertWorker to "+o),this.destType=o}r.inherits(a,n),a.prototype.processChunk=function(o){this.push({data:r.transformTo(this.destType,o.data),meta:o.meta})},i.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,i,s){var n=e("./GenericWorker"),r=e("../crc32"),a=e("../utils");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}a.inherits(o,n),o.prototype.processChunk=function(h){this.streamInfo.crc32=r(h.data,this.streamInfo.crc32||0),this.push(h)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,i,s){var n=e("../utils"),r=e("./GenericWorker");function a(o){r.call(this,"DataLengthProbe for "+o),this.propName=o,this.withStreamInfo(o,0)}n.inherits(a,r),a.prototype.processChunk=function(o){if(o){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+o.data.length}r.prototype.processChunk.call(this,o)},i.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,i,s){var n=e("../utils"),r=e("./GenericWorker"),a=16*1024;function o(h){r.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(c){u.dataIsReady=!0,u.data=c,u.max=c&&c.length||0,u.type=n.getTypeOf(c),u.isPaused||u._tickAndRepeat()},function(c){u.error(c)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return r.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0):!1},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,!(this.isPaused||this.isFinished)&&(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=a,u=null,c=Math.min(this.max,this.index+h);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,c);break;case"uint8array":u=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":u=this.data.slice(this.index,c);break}return this.index=c,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,i,s){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return this.isFinished?!1:(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,a){return this._listeners[r].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,a){if(this._listeners[r])for(var o=0;o<this._listeners[r].length;o++)this._listeners[r][o].call(this,a)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var a=this;return r.on("data",function(o){a.processChunk(o)}),r.on("end",function(){a.end()}),r.on("error",function(o){a.error(o)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var r=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,a){return this.extraStreamInfo[r]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},i.exports=n},{}],29:[function(e,i,s){var n=e("../utils"),r=e("./ConvertWorker"),a=e("./GenericWorker"),o=e("../base64"),h=e("../support"),u=e("../external"),c=null;if(h.nodestream)try{c=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(g,b,w){switch(g){case"blob":return n.newBlob(n.transformTo("arraybuffer",b),w);case"base64":return o.encode(b);default:return n.transformTo(g,b)}}function p(g,b){var w,S=0,T=null,A=0;for(w=0;w<b.length;w++)A+=b[w].length;switch(g){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":for(T=new Uint8Array(A),w=0;w<b.length;w++)T.set(b[w],S),S+=b[w].length;return T;case"nodebuffer":return Buffer.concat(b);default:throw new Error("concat : unsupported type '"+g+"'")}}function _(g,b){return new u.Promise(function(w,S){var T=[],A=g._internalType,C=g._outputType,R=g._mimeType;g.on("data",function(P,N){T.push(P),b&&b(N)}).on("error",function(P){T=[],S(P)}).on("end",function(){try{var P=f(C,p(A,T),R);w(P)}catch(N){S(N)}T=[]}).resume()})}function v(g,b,w){var S=b;switch(b){case"blob":case"arraybuffer":S="uint8array";break;case"base64":S="string";break}try{this._internalType=S,this._outputType=b,this._mimeType=w,n.checkSupport(S),this._worker=g.pipe(new r(S)),g.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}v.prototype={accumulate:function(g){return _(this,g)},on:function(g,b){var w=this;return g==="data"?this._worker.on(g,function(S){b.call(w,S.data,S.meta)}):this._worker.on(g,function(){n.delay(b,arguments,w)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:this._outputType!=="nodebuffer"},g)}},i.exports=v},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,i,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var n=new ArrayBuffer(0);try{s.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,a=new r;a.append(n),s.blob=a.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!e("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(e,i,s){for(var n=e("./utils"),r=e("./support"),a=e("./nodejsUtils"),o=e("./stream/GenericWorker"),h=new Array(256),u=0;u<256;u++)h[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;h[254]=h[254]=1;var c=function(g){var b,w,S,T,A,C=g.length,R=0;for(T=0;T<C;T++)w=g.charCodeAt(T),(w&64512)===55296&&T+1<C&&(S=g.charCodeAt(T+1),(S&64512)===56320&&(w=65536+(w-55296<<10)+(S-56320),T++)),R+=w<128?1:w<2048?2:w<65536?3:4;for(r.uint8array?b=new Uint8Array(R):b=new Array(R),A=0,T=0;A<R;T++)w=g.charCodeAt(T),(w&64512)===55296&&T+1<C&&(S=g.charCodeAt(T+1),(S&64512)===56320&&(w=65536+(w-55296<<10)+(S-56320),T++)),w<128?b[A++]=w:w<2048?(b[A++]=192|w>>>6,b[A++]=128|w&63):w<65536?(b[A++]=224|w>>>12,b[A++]=128|w>>>6&63,b[A++]=128|w&63):(b[A++]=240|w>>>18,b[A++]=128|w>>>12&63,b[A++]=128|w>>>6&63,b[A++]=128|w&63);return b},f=function(g,b){var w;for(b=b||g.length,b>g.length&&(b=g.length),w=b-1;w>=0&&(g[w]&192)===128;)w--;return w<0||w===0?b:w+h[g[w]]>b?w:b},p=function(g){var b,w,S,T,A=g.length,C=new Array(A*2);for(w=0,b=0;b<A;){if(S=g[b++],S<128){C[w++]=S;continue}if(T=h[S],T>4){C[w++]=65533,b+=T-1;continue}for(S&=T===2?31:T===3?15:7;T>1&&b<A;)S=S<<6|g[b++]&63,T--;if(T>1){C[w++]=65533;continue}S<65536?C[w++]=S:(S-=65536,C[w++]=55296|S>>10&1023,C[w++]=56320|S&1023)}return C.length!==w&&(C.subarray?C=C.subarray(0,w):C.length=w),n.applyFromCharCode(C)};s.utf8encode=function(b){return r.nodebuffer?a.newBufferFrom(b,"utf-8"):c(b)},s.utf8decode=function(b){return r.nodebuffer?n.transformTo("nodebuffer",b).toString("utf-8"):(b=n.transformTo(r.uint8array?"uint8array":"array",b),p(b))};function _(){o.call(this,"utf-8 decode"),this.leftOver=null}n.inherits(_,o),_.prototype.processChunk=function(g){var b=n.transformTo(r.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var w=b;b=new Uint8Array(w.length+this.leftOver.length),b.set(this.leftOver,0),b.set(w,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var S=f(b),T=b;S!==b.length&&(r.uint8array?(T=b.subarray(0,S),this.leftOver=b.subarray(S,b.length)):(T=b.slice(0,S),this.leftOver=b.slice(S,b.length))),this.push({data:s.utf8decode(T),meta:g.meta})},_.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=_;function v(){o.call(this,"utf-8 encode")}n.inherits(v,o),v.prototype.processChunk=function(g){this.push({data:s.utf8encode(g.data),meta:g.meta})},s.Utf8EncodeWorker=v},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,i,s){var n=e("./support"),r=e("./base64"),a=e("./nodejsUtils"),o=e("./external");e("setimmediate");function h(g){var b=null;return n.uint8array?b=new Uint8Array(g.length):b=new Array(g.length),c(g,b)}s.newBlob=function(g,b){s.checkSupport("blob");try{return new Blob([g],{type:b})}catch{try{var w=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,S=new w;return S.append(g),S.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};function u(g){return g}function c(g,b){for(var w=0;w<g.length;++w)b[w]=g.charCodeAt(w)&255;return b}var f={stringifyByChunk:function(g,b,w){var S=[],T=0,A=g.length;if(A<=w)return String.fromCharCode.apply(null,g);for(;T<A;)b==="array"||b==="nodebuffer"?S.push(String.fromCharCode.apply(null,g.slice(T,Math.min(T+w,A)))):S.push(String.fromCharCode.apply(null,g.subarray(T,Math.min(T+w,A)))),T+=w;return S.join("")},stringifyByChar:function(g){for(var b="",w=0;w<g.length;w++)b+=String.fromCharCode(g[w]);return b},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function p(g){var b=65536,w=s.getTypeOf(g),S=!0;if(w==="uint8array"?S=f.applyCanBeUsed.uint8array:w==="nodebuffer"&&(S=f.applyCanBeUsed.nodebuffer),S)for(;b>1;)try{return f.stringifyByChunk(g,w,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(g)}s.applyFromCharCode=p;function _(g,b){for(var w=0;w<g.length;w++)b[w]=g[w];return b}var v={};v.string={string:u,array:function(g){return c(g,new Array(g.length))},arraybuffer:function(g){return v.string.uint8array(g).buffer},uint8array:function(g){return c(g,new Uint8Array(g.length))},nodebuffer:function(g){return c(g,a.allocBuffer(g.length))}},v.array={string:p,array:u,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},v.arraybuffer={string:function(g){return p(new Uint8Array(g))},array:function(g){return _(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:u,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},v.uint8array={string:p,array:function(g){return _(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:u,nodebuffer:function(g){return a.newBufferFrom(g)}},v.nodebuffer={string:p,array:function(g){return _(g,new Array(g.length))},arraybuffer:function(g){return v.nodebuffer.uint8array(g).buffer},uint8array:function(g){return _(g,new Uint8Array(g.length))},nodebuffer:u},s.transformTo=function(g,b){if(b||(b=""),!g)return b;s.checkSupport(g);var w=s.getTypeOf(b),S=v[w][g](b);return S},s.resolve=function(g){for(var b=g.split("/"),w=[],S=0;S<b.length;S++){var T=b[S];T==="."||T===""&&S!==0&&S!==b.length-1||(T===".."?w.pop():w.push(T))}return w.join("/")},s.getTypeOf=function(g){if(typeof g=="string")return"string";if(Object.prototype.toString.call(g)==="[object Array]")return"array";if(n.nodebuffer&&a.isBuffer(g))return"nodebuffer";if(n.uint8array&&g instanceof Uint8Array)return"uint8array";if(n.arraybuffer&&g instanceof ArrayBuffer)return"arraybuffer"},s.checkSupport=function(g){var b=n[g.toLowerCase()];if(!b)throw new Error(g+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(g){var b="",w,S;for(S=0;S<(g||"").length;S++)w=g.charCodeAt(S),b+="\\x"+(w<16?"0":"")+w.toString(16).toUpperCase();return b},s.delay=function(g,b,w){setImmediate(function(){g.apply(w||null,b||[])})},s.inherits=function(g,b){var w=function(){};w.prototype=b.prototype,g.prototype=new w},s.extend=function(){var g={},b,w;for(b=0;b<arguments.length;b++)for(w in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],w)&&typeof g[w]>"u"&&(g[w]=arguments[b][w]);return g},s.prepareContent=function(g,b,w,S,T){var A=o.Promise.resolve(b).then(function(C){var R=n.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1);return R&&typeof FileReader<"u"?new o.Promise(function(P,N){var F=new FileReader;F.onload=function(z){P(z.target.result)},F.onerror=function(z){N(z.target.error)},F.readAsArrayBuffer(C)}):C});return A.then(function(C){var R=s.getTypeOf(C);return R?(R==="arraybuffer"?C=s.transformTo("uint8array",C):R==="string"&&(T?C=r.decode(C):w&&S!==!0&&(C=h(C))),C):o.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,i,s){var n=e("./reader/readerFor"),r=e("./utils"),a=e("./signature"),o=e("./zipEntry"),h=e("./support");function u(c){this.files=[],this.loadOptions=c}u.prototype={checkSignature:function(c){if(!this.reader.readAndCheckSignature(c)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(c)+")")}},isSignature:function(c,f){var p=this.reader.index;this.reader.setIndex(c);var _=this.reader.readString(4),v=_===f;return this.reader.setIndex(p),v},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var c=this.reader.readData(this.zipCommentLength),f=h.uint8array?"uint8array":"array",p=r.transformTo(f,c);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var c=this.zip64EndOfCentralSize-44,f=0,p,_,v;f<c;)p=this.reader.readInt(2),_=this.reader.readInt(4),v=this.reader.readData(_),this.zip64ExtensibleData[p]={id:p,length:_,value:v}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var c,f;for(c=0;c<this.files.length;c++)f=this.files[c],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var c;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)c=new o({zip64:this.zip64},this.loadOptions),c.readCentralPart(this.reader),this.files.push(c);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var c=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(c<0){var f=!this.isSignature(0,a.LOCAL_FILE_HEADER);throw f?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(c);var p=c;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,c=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),c<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(c),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var v=p-_;if(v>0)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=v);else if(v<0)throw new Error("Corrupted zip: missing "+Math.abs(v)+" bytes.")},prepareReader:function(c){this.reader=n(c)},load:function(c){this.prepareReader(c),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,i,s){var n=e("./reader/readerFor"),r=e("./utils"),a=e("./compressedObject"),o=e("./crc32"),h=e("./utf8"),u=e("./compressions"),c=e("./support"),f=0,p=3,_=function(g){for(var b in u)if(Object.prototype.hasOwnProperty.call(u,b)&&u[b].magic===g)return u[b];return null};function v(g,b){this.options=g,this.loadOptions=b}v.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(g){var b,w;if(g.skip(22),this.fileNameLength=g.readInt(2),w=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(w),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(b=_(this.compressionMethod),b===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,b,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var b=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(b),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),g===f&&(this.dosPermissions=this.externalFileAttributes&63),g===p&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var b=g.index+this.extraFieldsLength,w,S,T;for(this.extraFields||(this.extraFields={});g.index+4<b;)w=g.readInt(2),S=g.readInt(2),T=g.readData(S),this.extraFields[w]={id:w,length:S,value:T};g.setIndex(b)},handleUTF8:function(){var g=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var w=r.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(w)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var T=r.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(T)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var b=n(g.value);return b.readInt(1)!==1||o(this.fileName)!==b.readInt(4)?null:h.utf8decode(b.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var b=n(g.value);return b.readInt(1)!==1||o(this.fileComment)!==b.readInt(4)?null:h.utf8decode(b.readData(g.length-5))}return null}},i.exports=v},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,i,s){var n=e("./stream/StreamHelper"),r=e("./stream/DataWorker"),a=e("./utf8"),o=e("./compressedObject"),h=e("./stream/GenericWorker"),u=function(_,v,g){this.name=_,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=v,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}};u.prototype={internalStream:function(_){var v=null,g="string";try{if(!_)throw new Error("No output type specified.");g=_.toLowerCase();var b=g==="string"||g==="text";(g==="binarystring"||g==="text")&&(g="string"),v=this._decompressWorker();var w=!this._dataBinary;w&&!b&&(v=v.pipe(new a.Utf8EncodeWorker)),!w&&b&&(v=v.pipe(new a.Utf8DecodeWorker))}catch(S){v=new h("error"),v.error(S)}return new n(v,g,"")},async:function(_,v){return this.internalStream(_).accumulate(v)},nodeStream:function(_,v){return this.internalStream(_||"nodebuffer").toNodejsStream(v)},_compressWorker:function(_,v){if(this._data instanceof o&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(g,_,v)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof h?this._data:new r(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<c.length;p++)u.prototype[c[p]]=f;i.exports=u},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,i,s){(function(n){var r=n.MutationObserver||n.WebKitMutationObserver,a;if(r){var o=0,h=new r(_),u=n.document.createTextNode("");h.observe(u,{characterData:!0}),a=function(){u.data=o=++o%2}}else if(!n.setImmediate&&typeof n.MessageChannel<"u"){var c=new n.MessageChannel;c.port1.onmessage=_,a=function(){c.port2.postMessage(0)}}else"document"in n&&"onreadystatechange"in n.document.createElement("script")?a=function(){var g=n.document.createElement("script");g.onreadystatechange=function(){_(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},n.document.documentElement.appendChild(g)}:a=function(){setTimeout(_,0)};var f,p=[];function _(){f=!0;for(var g,b,w=p.length;w;){for(b=p,p=[],g=-1;++g<w;)b[g]();w=p.length}f=!1}i.exports=v;function v(g){p.push(g)===1&&!f&&a()}}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,i,s){var n=e("immediate");function r(){}var a={},o=["REJECTED"],h=["FULFILLED"],u=["PENDING"];i.exports=c;function c(A){if(typeof A!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,A!==r&&v(this,A)}c.prototype.finally=function(A){if(typeof A!="function")return this;var C=this.constructor;return this.then(R,P);function R(N){function F(){return N}return C.resolve(A()).then(F)}function P(N){function F(){throw N}return C.resolve(A()).then(F)}},c.prototype.catch=function(A){return this.then(null,A)},c.prototype.then=function(A,C){if(typeof A!="function"&&this.state===h||typeof C!="function"&&this.state===o)return this;var R=new this.constructor(r);if(this.state!==u){var P=this.state===h?A:C;p(R,P,this.outcome)}else this.queue.push(new f(R,A,C));return R};function f(A,C,R){this.promise=A,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}f.prototype.callFulfilled=function(A){a.resolve(this.promise,A)},f.prototype.otherCallFulfilled=function(A){p(this.promise,this.onFulfilled,A)},f.prototype.callRejected=function(A){a.reject(this.promise,A)},f.prototype.otherCallRejected=function(A){p(this.promise,this.onRejected,A)};function p(A,C,R){n(function(){var P;try{P=C(R)}catch(N){return a.reject(A,N)}P===A?a.reject(A,new TypeError("Cannot resolve promise with itself")):a.resolve(A,P)})}a.resolve=function(A,C){var R=g(_,C);if(R.status==="error")return a.reject(A,R.value);var P=R.value;if(P)v(A,P);else{A.state=h,A.outcome=C;for(var N=-1,F=A.queue.length;++N<F;)A.queue[N].callFulfilled(C)}return A},a.reject=function(A,C){A.state=o,A.outcome=C;for(var R=-1,P=A.queue.length;++R<P;)A.queue[R].callRejected(C);return A};function _(A){var C=A&&A.then;if(A&&(typeof A=="object"||typeof A=="function")&&typeof C=="function")return function(){C.apply(A,arguments)}}function v(A,C){var R=!1;function P(q){R||(R=!0,a.reject(A,q))}function N(q){R||(R=!0,a.resolve(A,q))}function F(){C(N,P)}var z=g(F);z.status==="error"&&P(z.value)}function g(A,C){var R={};try{R.value=A(C),R.status="success"}catch(P){R.status="error",R.value=P}return R}c.resolve=b;function b(A){return A instanceof this?A:a.resolve(new this(r),A)}c.reject=w;function w(A){var C=new this(r);return a.reject(C,A)}c.all=S;function S(A){var C=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=A.length,P=!1;if(!R)return this.resolve([]);for(var N=new Array(R),F=0,z=-1,q=new this(r);++z<R;)X(A[z],z);return q;function X(tt,st){C.resolve(tt).then(Q,function(J){P||(P=!0,a.reject(q,J))});function Q(J){N[st]=J,++F===R&&!P&&(P=!0,a.resolve(q,N))}}}c.race=T;function T(A){var C=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=A.length,P=!1;if(!R)return this.resolve([]);for(var N=-1,F=new this(r);++N<R;)z(A[N]);return F;function z(q){C.resolve(q).then(function(X){P||(P=!0,a.resolve(F,X))},function(X){P||(P=!0,a.reject(F,X))})}}},{immediate:36}],38:[function(e,i,s){var n=e("./lib/utils/common").assign,r=e("./lib/deflate"),a=e("./lib/inflate"),o=e("./lib/zlib/constants"),h={};n(h,r,a,o),i.exports=h},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,i,s){var n=e("./zlib/deflate"),r=e("./utils/common"),a=e("./utils/strings"),o=e("./zlib/messages"),h=e("./zlib/zstream"),u=Object.prototype.toString,c=0,f=4,p=0,_=1,v=2,g=-1,b=0,w=8;function S(R){if(!(this instanceof S))return new S(R);this.options=r.assign({level:g,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},R||{});var P=this.options;P.raw&&P.windowBits>0?P.windowBits=-P.windowBits:P.gzip&&P.windowBits>0&&P.windowBits<16&&(P.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var N=n.deflateInit2(this.strm,P.level,P.method,P.windowBits,P.memLevel,P.strategy);if(N!==p)throw new Error(o[N]);if(P.header&&n.deflateSetHeader(this.strm,P.header),P.dictionary){var F;if(typeof P.dictionary=="string"?F=a.string2buf(P.dictionary):u.call(P.dictionary)==="[object ArrayBuffer]"?F=new Uint8Array(P.dictionary):F=P.dictionary,N=n.deflateSetDictionary(this.strm,F),N!==p)throw new Error(o[N]);this._dict_set=!0}}S.prototype.push=function(R,P){var N=this.strm,F=this.options.chunkSize,z,q;if(this.ended)return!1;q=P===~~P?P:P===!0?f:c,typeof R=="string"?N.input=a.string2buf(R):u.call(R)==="[object ArrayBuffer]"?N.input=new Uint8Array(R):N.input=R,N.next_in=0,N.avail_in=N.input.length;do{if(N.avail_out===0&&(N.output=new r.Buf8(F),N.next_out=0,N.avail_out=F),z=n.deflate(N,q),z!==_&&z!==p)return this.onEnd(z),this.ended=!0,!1;(N.avail_out===0||N.avail_in===0&&(q===f||q===v))&&(this.options.to==="string"?this.onData(a.buf2binstring(r.shrinkBuf(N.output,N.next_out))):this.onData(r.shrinkBuf(N.output,N.next_out)))}while((N.avail_in>0||N.avail_out===0)&&z!==_);return q===f?(z=n.deflateEnd(this.strm),this.onEnd(z),this.ended=!0,z===p):(q===v&&(this.onEnd(p),N.avail_out=0),!0)},S.prototype.onData=function(R){this.chunks.push(R)},S.prototype.onEnd=function(R){R===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=R,this.msg=this.strm.msg};function T(R,P){var N=new S(P);if(N.push(R,!0),N.err)throw N.msg||o[N.err];return N.result}function A(R,P){return P=P||{},P.raw=!0,T(R,P)}function C(R,P){return P=P||{},P.gzip=!0,T(R,P)}s.Deflate=S,s.deflate=T,s.deflateRaw=A,s.gzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,i,s){var n=e("./zlib/inflate"),r=e("./utils/common"),a=e("./utils/strings"),o=e("./zlib/constants"),h=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),f=Object.prototype.toString;function p(g){if(!(this instanceof p))return new p(g);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},g||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),b.windowBits>=0&&b.windowBits<16&&!(g&&g.windowBits)&&(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&(b.windowBits&15)===0&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var w=n.inflateInit2(this.strm,b.windowBits);if(w!==o.Z_OK)throw new Error(h[w]);this.header=new c,n.inflateGetHeader(this.strm,this.header)}p.prototype.push=function(g,b){var w=this.strm,S=this.options.chunkSize,T=this.options.dictionary,A,C,R,P,N,F,z=!1;if(this.ended)return!1;C=b===~~b?b:b===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof g=="string"?w.input=a.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?w.input=new Uint8Array(g):w.input=g,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new r.Buf8(S),w.next_out=0,w.avail_out=S),A=n.inflate(w,o.Z_NO_FLUSH),A===o.Z_NEED_DICT&&T&&(typeof T=="string"?F=a.string2buf(T):f.call(T)==="[object ArrayBuffer]"?F=new Uint8Array(T):F=T,A=n.inflateSetDictionary(this.strm,F)),A===o.Z_BUF_ERROR&&z===!0&&(A=o.Z_OK,z=!1),A!==o.Z_STREAM_END&&A!==o.Z_OK)return this.onEnd(A),this.ended=!0,!1;w.next_out&&(w.avail_out===0||A===o.Z_STREAM_END||w.avail_in===0&&(C===o.Z_FINISH||C===o.Z_SYNC_FLUSH))&&(this.options.to==="string"?(R=a.utf8border(w.output,w.next_out),P=w.next_out-R,N=a.buf2string(w.output,R),w.next_out=P,w.avail_out=S-P,P&&r.arraySet(w.output,w.output,R,P,0),this.onData(N)):this.onData(r.shrinkBuf(w.output,w.next_out))),w.avail_in===0&&w.avail_out===0&&(z=!0)}while((w.avail_in>0||w.avail_out===0)&&A!==o.Z_STREAM_END);return A===o.Z_STREAM_END&&(C=o.Z_FINISH),C===o.Z_FINISH?(A=n.inflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===o.Z_OK):(C===o.Z_SYNC_FLUSH&&(this.onEnd(o.Z_OK),w.avail_out=0),!0)},p.prototype.onData=function(g){this.chunks.push(g)},p.prototype.onEnd=function(g){g===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg};function _(g,b){var w=new p(b);if(w.push(g,!0),w.err)throw w.msg||h[w.err];return w.result}function v(g,b){return b=b||{},b.raw=!0,_(g,b)}s.Inflate=p,s.inflate=_,s.inflateRaw=v,s.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(o){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var u=h.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var c in u)u.hasOwnProperty(c)&&(o[c]=u[c])}}return o},s.shrinkBuf=function(o,h){return o.length===h?o:o.subarray?o.subarray(0,h):(o.length=h,o)};var r={arraySet:function(o,h,u,c,f){if(h.subarray&&o.subarray){o.set(h.subarray(u,u+c),f);return}for(var p=0;p<c;p++)o[f+p]=h[u+p]},flattenChunks:function(o){var h,u,c,f,p,_;for(c=0,h=0,u=o.length;h<u;h++)c+=o[h].length;for(_=new Uint8Array(c),f=0,h=0,u=o.length;h<u;h++)p=o[h],_.set(p,f),f+=p.length;return _}},a={arraySet:function(o,h,u,c,f){for(var p=0;p<c;p++)o[f+p]=h[u+p]},flattenChunks:function(o){return[].concat.apply([],o)}};s.setTyped=function(o){o?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,r)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,a))},s.setTyped(n)},{}],42:[function(e,i,s){var n=e("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var o=new n.Buf8(256),h=0;h<256;h++)o[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;o[254]=o[254]=1,s.string2buf=function(c){var f,p,_,v,g,b=c.length,w=0;for(v=0;v<b;v++)p=c.charCodeAt(v),(p&64512)===55296&&v+1<b&&(_=c.charCodeAt(v+1),(_&64512)===56320&&(p=65536+(p-55296<<10)+(_-56320),v++)),w+=p<128?1:p<2048?2:p<65536?3:4;for(f=new n.Buf8(w),g=0,v=0;g<w;v++)p=c.charCodeAt(v),(p&64512)===55296&&v+1<b&&(_=c.charCodeAt(v+1),(_&64512)===56320&&(p=65536+(p-55296<<10)+(_-56320),v++)),p<128?f[g++]=p:p<2048?(f[g++]=192|p>>>6,f[g++]=128|p&63):p<65536?(f[g++]=224|p>>>12,f[g++]=128|p>>>6&63,f[g++]=128|p&63):(f[g++]=240|p>>>18,f[g++]=128|p>>>12&63,f[g++]=128|p>>>6&63,f[g++]=128|p&63);return f};function u(c,f){if(f<65537&&(c.subarray&&a||!c.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(c,f));for(var p="",_=0;_<f;_++)p+=String.fromCharCode(c[_]);return p}s.buf2binstring=function(c){return u(c,c.length)},s.binstring2buf=function(c){for(var f=new n.Buf8(c.length),p=0,_=f.length;p<_;p++)f[p]=c.charCodeAt(p);return f},s.buf2string=function(c,f){var p,_,v,g,b=f||c.length,w=new Array(b*2);for(_=0,p=0;p<b;){if(v=c[p++],v<128){w[_++]=v;continue}if(g=o[v],g>4){w[_++]=65533,p+=g-1;continue}for(v&=g===2?31:g===3?15:7;g>1&&p<b;)v=v<<6|c[p++]&63,g--;if(g>1){w[_++]=65533;continue}v<65536?w[_++]=v:(v-=65536,w[_++]=55296|v>>10&1023,w[_++]=56320|v&1023)}return u(w,_)},s.utf8border=function(c,f){var p;for(f=f||c.length,f>c.length&&(f=c.length),p=f-1;p>=0&&(c[p]&192)===128;)p--;return p<0||p===0?f:p+o[c[p]]>f?p:f}},{"./common":41}],43:[function(e,i,s){function n(r,a,o,h){for(var u=r&65535|0,c=r>>>16&65535|0,f=0;o!==0;){f=o>2e3?2e3:o,o-=f;do u=u+a[h++]|0,c=c+u|0;while(--f);u%=65521,c%=65521}return u|c<<16|0}i.exports=n},{}],44:[function(e,i,s){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,i,s){function n(){for(var o,h=[],u=0;u<256;u++){o=u;for(var c=0;c<8;c++)o=o&1?3988292384^o>>>1:o>>>1;h[u]=o}return h}var r=n();function a(o,h,u,c){var f=r,p=c+u;o^=-1;for(var _=c;_<p;_++)o=o>>>8^f[(o^h[_])&255];return o^-1}i.exports=a},{}],46:[function(e,i,s){var n=e("../utils/common"),r=e("./trees"),a=e("./adler32"),o=e("./crc32"),h=e("./messages"),u=0,c=1,f=3,p=4,_=5,v=0,g=1,b=-2,w=-3,S=-5,T=-1,A=1,C=2,R=3,P=4,N=0,F=2,z=8,q=9,X=15,tt=8,st=29,Q=256,J=Q+1+st,et=30,ut=19,Dt=2*J+1,ot=15,ct=3,xt=258,Ct=xt+ct+1,Mt=32,Yt=42,Rt=69,kt=73,se=91,ie=103,Pt=113,zt=666,qt=1,Kt=2,pe=3,ae=4,Jt=3;function _e(y,V){return y.msg=h[V],V}function Ue(y){return(y<<1)-(y>4?9:0)}function Pe(y){for(var V=y.length;--V>=0;)y[V]=0}function Ot(y){var V=y.state,K=V.pending;K>y.avail_out&&(K=y.avail_out),K!==0&&(n.arraySet(y.output,V.pending_buf,V.pending_out,K,y.next_out),y.next_out+=K,V.pending_out+=K,y.total_out+=K,y.avail_out-=K,V.pending-=K,V.pending===0&&(V.pending_out=0))}function Ut(y,V){r._tr_flush_block(y,y.block_start>=0?y.block_start:-1,y.strstart-y.block_start,V),y.block_start=y.strstart,Ot(y.strm)}function Lt(y,V){y.pending_buf[y.pending++]=V}function Xe(y,V){y.pending_buf[y.pending++]=V>>>8&255,y.pending_buf[y.pending++]=V&255}function Gi(y,V,K,I){var U=y.avail_in;return U>I&&(U=I),U===0?0:(y.avail_in-=U,n.arraySet(V,y.input,y.next_in,U,K),y.state.wrap===1?y.adler=a(y.adler,V,U,K):y.state.wrap===2&&(y.adler=o(y.adler,V,U,K)),y.next_in+=U,y.total_in+=U,U)}function Ti(y,V){var K=y.max_chain_length,I=y.strstart,U,Z,bt=y.prev_length,ft=y.nice_match,pt=y.strstart>y.w_size-Ct?y.strstart-(y.w_size-Ct):0,Ft=y.window,Re=y.w_mask,oe=y.prev,Wt=y.strstart+xt,Gt=Ft[I+bt-1],Oe=Ft[I+bt];y.prev_length>=y.good_match&&(K>>=2),ft>y.lookahead&&(ft=y.lookahead);do if(U=V,!(Ft[U+bt]!==Oe||Ft[U+bt-1]!==Gt||Ft[U]!==Ft[I]||Ft[++U]!==Ft[I+1])){I+=2,U++;do;while(Ft[++I]===Ft[++U]&&Ft[++I]===Ft[++U]&&Ft[++I]===Ft[++U]&&Ft[++I]===Ft[++U]&&Ft[++I]===Ft[++U]&&Ft[++I]===Ft[++U]&&Ft[++I]===Ft[++U]&&Ft[++I]===Ft[++U]&&I<Wt);if(Z=xt-(Wt-I),I=Wt-xt,Z>bt){if(y.match_start=V,bt=Z,Z>=ft)break;Gt=Ft[I+bt-1],Oe=Ft[I+bt]}}while((V=oe[V&Re])>pt&&--K!==0);return bt<=y.lookahead?bt:y.lookahead}function He(y){var V=y.w_size,K,I,U,Z,bt;do{if(Z=y.window_size-y.lookahead-y.strstart,y.strstart>=V+(V-Ct)){n.arraySet(y.window,y.window,V,V,0),y.match_start-=V,y.strstart-=V,y.block_start-=V,I=y.hash_size,K=I;do U=y.head[--K],y.head[K]=U>=V?U-V:0;while(--I);I=V,K=I;do U=y.prev[--K],y.prev[K]=U>=V?U-V:0;while(--I);Z+=V}if(y.strm.avail_in===0)break;if(I=Gi(y.strm,y.window,y.strstart+y.lookahead,Z),y.lookahead+=I,y.lookahead+y.insert>=ct)for(bt=y.strstart-y.insert,y.ins_h=y.window[bt],y.ins_h=(y.ins_h<<y.hash_shift^y.window[bt+1])&y.hash_mask;y.insert&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[bt+ct-1])&y.hash_mask,y.prev[bt&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=bt,bt++,y.insert--,!(y.lookahead+y.insert<ct)););}while(y.lookahead<Ct&&y.strm.avail_in!==0)}function us(y,V){var K=65535;for(K>y.pending_buf_size-5&&(K=y.pending_buf_size-5);;){if(y.lookahead<=1){if(He(y),y.lookahead===0&&V===u)return qt;if(y.lookahead===0)break}y.strstart+=y.lookahead,y.lookahead=0;var I=y.block_start+K;if((y.strstart===0||y.strstart>=I)&&(y.lookahead=y.strstart-I,y.strstart=I,Ut(y,!1),y.strm.avail_out===0)||y.strstart-y.block_start>=y.w_size-Ct&&(Ut(y,!1),y.strm.avail_out===0))return qt}return y.insert=0,V===p?(Ut(y,!0),y.strm.avail_out===0?pe:ae):(y.strstart>y.block_start&&(Ut(y,!1),y.strm.avail_out===0),qt)}function Fi(y,V){for(var K,I;;){if(y.lookahead<Ct){if(He(y),y.lookahead<Ct&&V===u)return qt;if(y.lookahead===0)break}if(K=0,y.lookahead>=ct&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+ct-1])&y.hash_mask,K=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),K!==0&&y.strstart-K<=y.w_size-Ct&&(y.match_length=Ti(y,K)),y.match_length>=ct)if(I=r._tr_tally(y,y.strstart-y.match_start,y.match_length-ct),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=ct){y.match_length--;do y.strstart++,y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+ct-1])&y.hash_mask,K=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart;while(--y.match_length!==0);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+1])&y.hash_mask;else I=r._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(I&&(Ut(y,!1),y.strm.avail_out===0))return qt}return y.insert=y.strstart<ct-1?y.strstart:ct-1,V===p?(Ut(y,!0),y.strm.avail_out===0?pe:ae):y.last_lit&&(Ut(y,!1),y.strm.avail_out===0)?qt:Kt}function ei(y,V){for(var K,I,U;;){if(y.lookahead<Ct){if(He(y),y.lookahead<Ct&&V===u)return qt;if(y.lookahead===0)break}if(K=0,y.lookahead>=ct&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+ct-1])&y.hash_mask,K=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=ct-1,K!==0&&y.prev_length<y.max_lazy_match&&y.strstart-K<=y.w_size-Ct&&(y.match_length=Ti(y,K),y.match_length<=5&&(y.strategy===A||y.match_length===ct&&y.strstart-y.match_start>4096)&&(y.match_length=ct-1)),y.prev_length>=ct&&y.match_length<=y.prev_length){U=y.strstart+y.lookahead-ct,I=r._tr_tally(y,y.strstart-1-y.prev_match,y.prev_length-ct),y.lookahead-=y.prev_length-1,y.prev_length-=2;do++y.strstart<=U&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+ct-1])&y.hash_mask,K=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart);while(--y.prev_length!==0);if(y.match_available=0,y.match_length=ct-1,y.strstart++,I&&(Ut(y,!1),y.strm.avail_out===0))return qt}else if(y.match_available){if(I=r._tr_tally(y,0,y.window[y.strstart-1]),I&&Ut(y,!1),y.strstart++,y.lookahead--,y.strm.avail_out===0)return qt}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(I=r._tr_tally(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<ct-1?y.strstart:ct-1,V===p?(Ut(y,!0),y.strm.avail_out===0?pe:ae):y.last_lit&&(Ut(y,!1),y.strm.avail_out===0)?qt:Kt}function Bi(y,V){for(var K,I,U,Z,bt=y.window;;){if(y.lookahead<=xt){if(He(y),y.lookahead<=xt&&V===u)return qt;if(y.lookahead===0)break}if(y.match_length=0,y.lookahead>=ct&&y.strstart>0&&(U=y.strstart-1,I=bt[U],I===bt[++U]&&I===bt[++U]&&I===bt[++U])){Z=y.strstart+xt;do;while(I===bt[++U]&&I===bt[++U]&&I===bt[++U]&&I===bt[++U]&&I===bt[++U]&&I===bt[++U]&&I===bt[++U]&&I===bt[++U]&&U<Z);y.match_length=xt-(Z-U),y.match_length>y.lookahead&&(y.match_length=y.lookahead)}if(y.match_length>=ct?(K=r._tr_tally(y,1,y.match_length-ct),y.lookahead-=y.match_length,y.strstart+=y.match_length,y.match_length=0):(K=r._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++),K&&(Ut(y,!1),y.strm.avail_out===0))return qt}return y.insert=0,V===p?(Ut(y,!0),y.strm.avail_out===0?pe:ae):y.last_lit&&(Ut(y,!1),y.strm.avail_out===0)?qt:Kt}function Di(y,V){for(var K;;){if(y.lookahead===0&&(He(y),y.lookahead===0)){if(V===u)return qt;break}if(y.match_length=0,K=r._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++,K&&(Ut(y,!1),y.strm.avail_out===0))return qt}return y.insert=0,V===p?(Ut(y,!0),y.strm.avail_out===0?pe:ae):y.last_lit&&(Ut(y,!1),y.strm.avail_out===0)?qt:Kt}function ke(y,V,K,I,U){this.good_length=y,this.max_lazy=V,this.nice_length=K,this.max_chain=I,this.func=U}var hi;hi=[new ke(0,0,0,0,us),new ke(4,4,8,4,Fi),new ke(4,5,16,8,Fi),new ke(4,6,32,32,Fi),new ke(4,4,16,16,ei),new ke(8,16,32,32,ei),new ke(8,16,128,128,ei),new ke(8,32,128,256,ei),new ke(32,128,258,1024,ei),new ke(32,258,258,4096,ei)];function Cs(y){y.window_size=2*y.w_size,Pe(y.head),y.max_lazy_match=hi[y.level].max_lazy,y.good_match=hi[y.level].good_length,y.nice_match=hi[y.level].nice_length,y.max_chain_length=hi[y.level].max_chain,y.strstart=0,y.block_start=0,y.lookahead=0,y.insert=0,y.match_length=y.prev_length=ct-1,y.match_available=0,y.ins_h=0}function M(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(Dt*2),this.dyn_dtree=new n.Buf16((2*et+1)*2),this.bl_tree=new n.Buf16((2*ut+1)*2),Pe(this.dyn_ltree),Pe(this.dyn_dtree),Pe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(ot+1),this.heap=new n.Buf16(2*J+1),Pe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*J+1),Pe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function nt(y){var V;return!y||!y.state?_e(y,b):(y.total_in=y.total_out=0,y.data_type=F,V=y.state,V.pending=0,V.pending_out=0,V.wrap<0&&(V.wrap=-V.wrap),V.status=V.wrap?Yt:Pt,y.adler=V.wrap===2?0:1,V.last_flush=u,r._tr_init(V),v)}function at(y){var V=nt(y);return V===v&&Cs(y.state),V}function vt(y,V){return!y||!y.state||y.state.wrap!==2?b:(y.state.gzhead=V,v)}function j(y,V,K,I,U,Z){if(!y)return b;var bt=1;if(V===T&&(V=6),I<0?(bt=0,I=-I):I>15&&(bt=2,I-=16),U<1||U>q||K!==z||I<8||I>15||V<0||V>9||Z<0||Z>P)return _e(y,b);I===8&&(I=9);var ft=new M;return y.state=ft,ft.strm=y,ft.wrap=bt,ft.gzhead=null,ft.w_bits=I,ft.w_size=1<<ft.w_bits,ft.w_mask=ft.w_size-1,ft.hash_bits=U+7,ft.hash_size=1<<ft.hash_bits,ft.hash_mask=ft.hash_size-1,ft.hash_shift=~~((ft.hash_bits+ct-1)/ct),ft.window=new n.Buf8(ft.w_size*2),ft.head=new n.Buf16(ft.hash_size),ft.prev=new n.Buf16(ft.w_size),ft.lit_bufsize=1<<U+6,ft.pending_buf_size=ft.lit_bufsize*4,ft.pending_buf=new n.Buf8(ft.pending_buf_size),ft.d_buf=1*ft.lit_bufsize,ft.l_buf=3*ft.lit_bufsize,ft.level=V,ft.strategy=Z,ft.method=K,at(y)}function E(y,V){return j(y,V,z,X,tt,N)}function m(y,V){var K,I,U,Z;if(!y||!y.state||V>_||V<0)return y?_e(y,b):b;if(I=y.state,!y.output||!y.input&&y.avail_in!==0||I.status===zt&&V!==p)return _e(y,y.avail_out===0?S:b);if(I.strm=y,K=I.last_flush,I.last_flush=V,I.status===Yt)if(I.wrap===2)y.adler=0,Lt(I,31),Lt(I,139),Lt(I,8),I.gzhead?(Lt(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),Lt(I,I.gzhead.time&255),Lt(I,I.gzhead.time>>8&255),Lt(I,I.gzhead.time>>16&255),Lt(I,I.gzhead.time>>24&255),Lt(I,I.level===9?2:I.strategy>=C||I.level<2?4:0),Lt(I,I.gzhead.os&255),I.gzhead.extra&&I.gzhead.extra.length&&(Lt(I,I.gzhead.extra.length&255),Lt(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(y.adler=o(y.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=Rt):(Lt(I,0),Lt(I,0),Lt(I,0),Lt(I,0),Lt(I,0),Lt(I,I.level===9?2:I.strategy>=C||I.level<2?4:0),Lt(I,Jt),I.status=Pt);else{var bt=z+(I.w_bits-8<<4)<<8,ft=-1;I.strategy>=C||I.level<2?ft=0:I.level<6?ft=1:I.level===6?ft=2:ft=3,bt|=ft<<6,I.strstart!==0&&(bt|=Mt),bt+=31-bt%31,I.status=Pt,Xe(I,bt),I.strstart!==0&&(Xe(I,y.adler>>>16),Xe(I,y.adler&65535)),y.adler=1}if(I.status===Rt)if(I.gzhead.extra){for(U=I.pending;I.gzindex<(I.gzhead.extra.length&65535)&&!(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>U&&(y.adler=o(y.adler,I.pending_buf,I.pending-U,U)),Ot(y),U=I.pending,I.pending===I.pending_buf_size));)Lt(I,I.gzhead.extra[I.gzindex]&255),I.gzindex++;I.gzhead.hcrc&&I.pending>U&&(y.adler=o(y.adler,I.pending_buf,I.pending-U,U)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=kt)}else I.status=kt;if(I.status===kt)if(I.gzhead.name){U=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>U&&(y.adler=o(y.adler,I.pending_buf,I.pending-U,U)),Ot(y),U=I.pending,I.pending===I.pending_buf_size)){Z=1;break}I.gzindex<I.gzhead.name.length?Z=I.gzhead.name.charCodeAt(I.gzindex++)&255:Z=0,Lt(I,Z)}while(Z!==0);I.gzhead.hcrc&&I.pending>U&&(y.adler=o(y.adler,I.pending_buf,I.pending-U,U)),Z===0&&(I.gzindex=0,I.status=se)}else I.status=se;if(I.status===se)if(I.gzhead.comment){U=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>U&&(y.adler=o(y.adler,I.pending_buf,I.pending-U,U)),Ot(y),U=I.pending,I.pending===I.pending_buf_size)){Z=1;break}I.gzindex<I.gzhead.comment.length?Z=I.gzhead.comment.charCodeAt(I.gzindex++)&255:Z=0,Lt(I,Z)}while(Z!==0);I.gzhead.hcrc&&I.pending>U&&(y.adler=o(y.adler,I.pending_buf,I.pending-U,U)),Z===0&&(I.status=ie)}else I.status=ie;if(I.status===ie&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&Ot(y),I.pending+2<=I.pending_buf_size&&(Lt(I,y.adler&255),Lt(I,y.adler>>8&255),y.adler=0,I.status=Pt)):I.status=Pt),I.pending!==0){if(Ot(y),y.avail_out===0)return I.last_flush=-1,v}else if(y.avail_in===0&&Ue(V)<=Ue(K)&&V!==p)return _e(y,S);if(I.status===zt&&y.avail_in!==0)return _e(y,S);if(y.avail_in!==0||I.lookahead!==0||V!==u&&I.status!==zt){var pt=I.strategy===C?Di(I,V):I.strategy===R?Bi(I,V):hi[I.level].func(I,V);if((pt===pe||pt===ae)&&(I.status=zt),pt===qt||pt===pe)return y.avail_out===0&&(I.last_flush=-1),v;if(pt===Kt&&(V===c?r._tr_align(I):V!==_&&(r._tr_stored_block(I,0,0,!1),V===f&&(Pe(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),Ot(y),y.avail_out===0))return I.last_flush=-1,v}return V!==p?v:I.wrap<=0?g:(I.wrap===2?(Lt(I,y.adler&255),Lt(I,y.adler>>8&255),Lt(I,y.adler>>16&255),Lt(I,y.adler>>24&255),Lt(I,y.total_in&255),Lt(I,y.total_in>>8&255),Lt(I,y.total_in>>16&255),Lt(I,y.total_in>>24&255)):(Xe(I,y.adler>>>16),Xe(I,y.adler&65535)),Ot(y),I.wrap>0&&(I.wrap=-I.wrap),I.pending!==0?v:g)}function L(y){var V;return!y||!y.state?b:(V=y.state.status,V!==Yt&&V!==Rt&&V!==kt&&V!==se&&V!==ie&&V!==Pt&&V!==zt?_e(y,b):(y.state=null,V===Pt?_e(y,w):v))}function W(y,V){var K=V.length,I,U,Z,bt,ft,pt,Ft,Re;if(!y||!y.state||(I=y.state,bt=I.wrap,bt===2||bt===1&&I.status!==Yt||I.lookahead))return b;for(bt===1&&(y.adler=a(y.adler,V,K,0)),I.wrap=0,K>=I.w_size&&(bt===0&&(Pe(I.head),I.strstart=0,I.block_start=0,I.insert=0),Re=new n.Buf8(I.w_size),n.arraySet(Re,V,K-I.w_size,I.w_size,0),V=Re,K=I.w_size),ft=y.avail_in,pt=y.next_in,Ft=y.input,y.avail_in=K,y.next_in=0,y.input=V,He(I);I.lookahead>=ct;){U=I.strstart,Z=I.lookahead-(ct-1);do I.ins_h=(I.ins_h<<I.hash_shift^I.window[U+ct-1])&I.hash_mask,I.prev[U&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=U,U++;while(--Z);I.strstart=U,I.lookahead=ct-1,He(I)}return I.strstart+=I.lookahead,I.block_start=I.strstart,I.insert=I.lookahead,I.lookahead=0,I.match_length=I.prev_length=ct-1,I.match_available=0,y.next_in=pt,y.input=Ft,y.avail_in=ft,I.wrap=bt,v}s.deflateInit=E,s.deflateInit2=j,s.deflateReset=at,s.deflateResetKeep=nt,s.deflateSetHeader=vt,s.deflate=m,s.deflateEnd=L,s.deflateSetDictionary=W,s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,i,s){function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}i.exports=n},{}],48:[function(e,i,s){var n=30,r=12;i.exports=function(o,h){var u,c,f,p,_,v,g,b,w,S,T,A,C,R,P,N,F,z,q,X,tt,st,Q,J,et;u=o.state,c=o.next_in,J=o.input,f=c+(o.avail_in-5),p=o.next_out,et=o.output,_=p-(h-o.avail_out),v=p+(o.avail_out-257),g=u.dmax,b=u.wsize,w=u.whave,S=u.wnext,T=u.window,A=u.hold,C=u.bits,R=u.lencode,P=u.distcode,N=(1<<u.lenbits)-1,F=(1<<u.distbits)-1;t:do{C<15&&(A+=J[c++]<<C,C+=8,A+=J[c++]<<C,C+=8),z=R[A&N];e:for(;;){if(q=z>>>24,A>>>=q,C-=q,q=z>>>16&255,q===0)et[p++]=z&65535;else if(q&16){X=z&65535,q&=15,q&&(C<q&&(A+=J[c++]<<C,C+=8),X+=A&(1<<q)-1,A>>>=q,C-=q),C<15&&(A+=J[c++]<<C,C+=8,A+=J[c++]<<C,C+=8),z=P[A&F];i:for(;;){if(q=z>>>24,A>>>=q,C-=q,q=z>>>16&255,q&16){if(tt=z&65535,q&=15,C<q&&(A+=J[c++]<<C,C+=8,C<q&&(A+=J[c++]<<C,C+=8)),tt+=A&(1<<q)-1,tt>g){o.msg="invalid distance too far back",u.mode=n;break t}if(A>>>=q,C-=q,q=p-_,tt>q){if(q=tt-q,q>w&&u.sane){o.msg="invalid distance too far back",u.mode=n;break t}if(st=0,Q=T,S===0){if(st+=b-q,q<X){X-=q;do et[p++]=T[st++];while(--q);st=p-tt,Q=et}}else if(S<q){if(st+=b+S-q,q-=S,q<X){X-=q;do et[p++]=T[st++];while(--q);if(st=0,S<X){q=S,X-=q;do et[p++]=T[st++];while(--q);st=p-tt,Q=et}}}else if(st+=S-q,q<X){X-=q;do et[p++]=T[st++];while(--q);st=p-tt,Q=et}for(;X>2;)et[p++]=Q[st++],et[p++]=Q[st++],et[p++]=Q[st++],X-=3;X&&(et[p++]=Q[st++],X>1&&(et[p++]=Q[st++]))}else{st=p-tt;do et[p++]=et[st++],et[p++]=et[st++],et[p++]=et[st++],X-=3;while(X>2);X&&(et[p++]=et[st++],X>1&&(et[p++]=et[st++]))}}else if((q&64)===0){z=P[(z&65535)+(A&(1<<q)-1)];continue i}else{o.msg="invalid distance code",u.mode=n;break t}break}}else if((q&64)===0){z=R[(z&65535)+(A&(1<<q)-1)];continue e}else if(q&32){u.mode=r;break t}else{o.msg="invalid literal/length code",u.mode=n;break t}break}}while(c<f&&p<v);X=C>>3,c-=X,C-=X<<3,A&=(1<<C)-1,o.next_in=c,o.next_out=p,o.avail_in=c<f?5+(f-c):5-(c-f),o.avail_out=p<v?257+(v-p):257-(p-v),u.hold=A,u.bits=C}},{}],49:[function(e,i,s){var n=e("../utils/common"),r=e("./adler32"),a=e("./crc32"),o=e("./inffast"),h=e("./inftrees"),u=0,c=1,f=2,p=4,_=5,v=6,g=0,b=1,w=2,S=-2,T=-3,A=-4,C=-5,R=8,P=1,N=2,F=3,z=4,q=5,X=6,tt=7,st=8,Q=9,J=10,et=11,ut=12,Dt=13,ot=14,ct=15,xt=16,Ct=17,Mt=18,Yt=19,Rt=20,kt=21,se=22,ie=23,Pt=24,zt=25,qt=26,Kt=27,pe=28,ae=29,Jt=30,_e=31,Ue=32,Pe=852,Ot=592,Ut=15,Lt=Ut;function Xe(j){return(j>>>24&255)+(j>>>8&65280)+((j&65280)<<8)+((j&255)<<24)}function Gi(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Ti(j){var E;return!j||!j.state?S:(E=j.state,j.total_in=j.total_out=E.total=0,j.msg="",E.wrap&&(j.adler=E.wrap&1),E.mode=P,E.last=0,E.havedict=0,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new n.Buf32(Pe),E.distcode=E.distdyn=new n.Buf32(Ot),E.sane=1,E.back=-1,g)}function He(j){var E;return!j||!j.state?S:(E=j.state,E.wsize=0,E.whave=0,E.wnext=0,Ti(j))}function us(j,E){var m,L;return!j||!j.state||(L=j.state,E<0?(m=0,E=-E):(m=(E>>4)+1,E<48&&(E&=15)),E&&(E<8||E>15))?S:(L.window!==null&&L.wbits!==E&&(L.window=null),L.wrap=m,L.wbits=E,He(j))}function Fi(j,E){var m,L;return j?(L=new Gi,j.state=L,L.window=null,m=us(j,E),m!==g&&(j.state=null),m):S}function ei(j){return Fi(j,Lt)}var Bi=!0,Di,ke;function hi(j){if(Bi){var E;for(Di=new n.Buf32(512),ke=new n.Buf32(32),E=0;E<144;)j.lens[E++]=8;for(;E<256;)j.lens[E++]=9;for(;E<280;)j.lens[E++]=7;for(;E<288;)j.lens[E++]=8;for(h(c,j.lens,0,288,Di,0,j.work,{bits:9}),E=0;E<32;)j.lens[E++]=5;h(f,j.lens,0,32,ke,0,j.work,{bits:5}),Bi=!1}j.lencode=Di,j.lenbits=9,j.distcode=ke,j.distbits=5}function Cs(j,E,m,L){var W,y=j.state;return y.window===null&&(y.wsize=1<<y.wbits,y.wnext=0,y.whave=0,y.window=new n.Buf8(y.wsize)),L>=y.wsize?(n.arraySet(y.window,E,m-y.wsize,y.wsize,0),y.wnext=0,y.whave=y.wsize):(W=y.wsize-y.wnext,W>L&&(W=L),n.arraySet(y.window,E,m-L,W,y.wnext),L-=W,L?(n.arraySet(y.window,E,m-L,L,0),y.wnext=L,y.whave=y.wsize):(y.wnext+=W,y.wnext===y.wsize&&(y.wnext=0),y.whave<y.wsize&&(y.whave+=W))),0}function M(j,E){var m,L,W,y,V,K,I,U,Z,bt,ft,pt,Ft,Re,oe=0,Wt,Gt,Oe,Te,vn,po,Ie,zi,Ye=new n.Buf8(4),Ts,cs,Qu=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!j||!j.state||!j.output||!j.input&&j.avail_in!==0)return S;m=j.state,m.mode===ut&&(m.mode=Dt),V=j.next_out,W=j.output,I=j.avail_out,y=j.next_in,L=j.input,K=j.avail_in,U=m.hold,Z=m.bits,bt=K,ft=I,zi=g;t:for(;;)switch(m.mode){case P:if(m.wrap===0){m.mode=Dt;break}for(;Z<16;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if(m.wrap&2&&U===35615){m.check=0,Ye[0]=U&255,Ye[1]=U>>>8&255,m.check=a(m.check,Ye,2,0),U=0,Z=0,m.mode=N;break}if(m.flags=0,m.head&&(m.head.done=!1),!(m.wrap&1)||(((U&255)<<8)+(U>>8))%31){j.msg="incorrect header check",m.mode=Jt;break}if((U&15)!==R){j.msg="unknown compression method",m.mode=Jt;break}if(U>>>=4,Z-=4,Ie=(U&15)+8,m.wbits===0)m.wbits=Ie;else if(Ie>m.wbits){j.msg="invalid window size",m.mode=Jt;break}m.dmax=1<<Ie,j.adler=m.check=1,m.mode=U&512?J:ut,U=0,Z=0;break;case N:for(;Z<16;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if(m.flags=U,(m.flags&255)!==R){j.msg="unknown compression method",m.mode=Jt;break}if(m.flags&57344){j.msg="unknown header flags set",m.mode=Jt;break}m.head&&(m.head.text=U>>8&1),m.flags&512&&(Ye[0]=U&255,Ye[1]=U>>>8&255,m.check=a(m.check,Ye,2,0)),U=0,Z=0,m.mode=F;case F:for(;Z<32;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}m.head&&(m.head.time=U),m.flags&512&&(Ye[0]=U&255,Ye[1]=U>>>8&255,Ye[2]=U>>>16&255,Ye[3]=U>>>24&255,m.check=a(m.check,Ye,4,0)),U=0,Z=0,m.mode=z;case z:for(;Z<16;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}m.head&&(m.head.xflags=U&255,m.head.os=U>>8),m.flags&512&&(Ye[0]=U&255,Ye[1]=U>>>8&255,m.check=a(m.check,Ye,2,0)),U=0,Z=0,m.mode=q;case q:if(m.flags&1024){for(;Z<16;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}m.length=U,m.head&&(m.head.extra_len=U),m.flags&512&&(Ye[0]=U&255,Ye[1]=U>>>8&255,m.check=a(m.check,Ye,2,0)),U=0,Z=0}else m.head&&(m.head.extra=null);m.mode=X;case X:if(m.flags&1024&&(pt=m.length,pt>K&&(pt=K),pt&&(m.head&&(Ie=m.head.extra_len-m.length,m.head.extra||(m.head.extra=new Array(m.head.extra_len)),n.arraySet(m.head.extra,L,y,pt,Ie)),m.flags&512&&(m.check=a(m.check,L,pt,y)),K-=pt,y+=pt,m.length-=pt),m.length))break t;m.length=0,m.mode=tt;case tt:if(m.flags&2048){if(K===0)break t;pt=0;do Ie=L[y+pt++],m.head&&Ie&&m.length<65536&&(m.head.name+=String.fromCharCode(Ie));while(Ie&&pt<K);if(m.flags&512&&(m.check=a(m.check,L,pt,y)),K-=pt,y+=pt,Ie)break t}else m.head&&(m.head.name=null);m.length=0,m.mode=st;case st:if(m.flags&4096){if(K===0)break t;pt=0;do Ie=L[y+pt++],m.head&&Ie&&m.length<65536&&(m.head.comment+=String.fromCharCode(Ie));while(Ie&&pt<K);if(m.flags&512&&(m.check=a(m.check,L,pt,y)),K-=pt,y+=pt,Ie)break t}else m.head&&(m.head.comment=null);m.mode=Q;case Q:if(m.flags&512){for(;Z<16;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if(U!==(m.check&65535)){j.msg="header crc mismatch",m.mode=Jt;break}U=0,Z=0}m.head&&(m.head.hcrc=m.flags>>9&1,m.head.done=!0),j.adler=m.check=0,m.mode=ut;break;case J:for(;Z<32;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}j.adler=m.check=Xe(U),U=0,Z=0,m.mode=et;case et:if(m.havedict===0)return j.next_out=V,j.avail_out=I,j.next_in=y,j.avail_in=K,m.hold=U,m.bits=Z,w;j.adler=m.check=1,m.mode=ut;case ut:if(E===_||E===v)break t;case Dt:if(m.last){U>>>=Z&7,Z-=Z&7,m.mode=Kt;break}for(;Z<3;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}switch(m.last=U&1,U>>>=1,Z-=1,U&3){case 0:m.mode=ot;break;case 1:if(hi(m),m.mode=Rt,E===v){U>>>=2,Z-=2;break t}break;case 2:m.mode=Ct;break;case 3:j.msg="invalid block type",m.mode=Jt}U>>>=2,Z-=2;break;case ot:for(U>>>=Z&7,Z-=Z&7;Z<32;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if((U&65535)!==(U>>>16^65535)){j.msg="invalid stored block lengths",m.mode=Jt;break}if(m.length=U&65535,U=0,Z=0,m.mode=ct,E===v)break t;case ct:m.mode=xt;case xt:if(pt=m.length,pt){if(pt>K&&(pt=K),pt>I&&(pt=I),pt===0)break t;n.arraySet(W,L,y,pt,V),K-=pt,y+=pt,I-=pt,V+=pt,m.length-=pt;break}m.mode=ut;break;case Ct:for(;Z<14;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if(m.nlen=(U&31)+257,U>>>=5,Z-=5,m.ndist=(U&31)+1,U>>>=5,Z-=5,m.ncode=(U&15)+4,U>>>=4,Z-=4,m.nlen>286||m.ndist>30){j.msg="too many length or distance symbols",m.mode=Jt;break}m.have=0,m.mode=Mt;case Mt:for(;m.have<m.ncode;){for(;Z<3;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}m.lens[Qu[m.have++]]=U&7,U>>>=3,Z-=3}for(;m.have<19;)m.lens[Qu[m.have++]]=0;if(m.lencode=m.lendyn,m.lenbits=7,Ts={bits:m.lenbits},zi=h(u,m.lens,0,19,m.lencode,0,m.work,Ts),m.lenbits=Ts.bits,zi){j.msg="invalid code lengths set",m.mode=Jt;break}m.have=0,m.mode=Yt;case Yt:for(;m.have<m.nlen+m.ndist;){for(;oe=m.lencode[U&(1<<m.lenbits)-1],Wt=oe>>>24,Gt=oe>>>16&255,Oe=oe&65535,!(Wt<=Z);){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if(Oe<16)U>>>=Wt,Z-=Wt,m.lens[m.have++]=Oe;else{if(Oe===16){for(cs=Wt+2;Z<cs;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if(U>>>=Wt,Z-=Wt,m.have===0){j.msg="invalid bit length repeat",m.mode=Jt;break}Ie=m.lens[m.have-1],pt=3+(U&3),U>>>=2,Z-=2}else if(Oe===17){for(cs=Wt+3;Z<cs;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}U>>>=Wt,Z-=Wt,Ie=0,pt=3+(U&7),U>>>=3,Z-=3}else{for(cs=Wt+7;Z<cs;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}U>>>=Wt,Z-=Wt,Ie=0,pt=11+(U&127),U>>>=7,Z-=7}if(m.have+pt>m.nlen+m.ndist){j.msg="invalid bit length repeat",m.mode=Jt;break}for(;pt--;)m.lens[m.have++]=Ie}}if(m.mode===Jt)break;if(m.lens[256]===0){j.msg="invalid code -- missing end-of-block",m.mode=Jt;break}if(m.lenbits=9,Ts={bits:m.lenbits},zi=h(c,m.lens,0,m.nlen,m.lencode,0,m.work,Ts),m.lenbits=Ts.bits,zi){j.msg="invalid literal/lengths set",m.mode=Jt;break}if(m.distbits=6,m.distcode=m.distdyn,Ts={bits:m.distbits},zi=h(f,m.lens,m.nlen,m.ndist,m.distcode,0,m.work,Ts),m.distbits=Ts.bits,zi){j.msg="invalid distances set",m.mode=Jt;break}if(m.mode=Rt,E===v)break t;case Rt:m.mode=kt;case kt:if(K>=6&&I>=258){j.next_out=V,j.avail_out=I,j.next_in=y,j.avail_in=K,m.hold=U,m.bits=Z,o(j,ft),V=j.next_out,W=j.output,I=j.avail_out,y=j.next_in,L=j.input,K=j.avail_in,U=m.hold,Z=m.bits,m.mode===ut&&(m.back=-1);break}for(m.back=0;oe=m.lencode[U&(1<<m.lenbits)-1],Wt=oe>>>24,Gt=oe>>>16&255,Oe=oe&65535,!(Wt<=Z);){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if(Gt&&(Gt&240)===0){for(Te=Wt,vn=Gt,po=Oe;oe=m.lencode[po+((U&(1<<Te+vn)-1)>>Te)],Wt=oe>>>24,Gt=oe>>>16&255,Oe=oe&65535,!(Te+Wt<=Z);){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}U>>>=Te,Z-=Te,m.back+=Te}if(U>>>=Wt,Z-=Wt,m.back+=Wt,m.length=Oe,Gt===0){m.mode=qt;break}if(Gt&32){m.back=-1,m.mode=ut;break}if(Gt&64){j.msg="invalid literal/length code",m.mode=Jt;break}m.extra=Gt&15,m.mode=se;case se:if(m.extra){for(cs=m.extra;Z<cs;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}m.length+=U&(1<<m.extra)-1,U>>>=m.extra,Z-=m.extra,m.back+=m.extra}m.was=m.length,m.mode=ie;case ie:for(;oe=m.distcode[U&(1<<m.distbits)-1],Wt=oe>>>24,Gt=oe>>>16&255,Oe=oe&65535,!(Wt<=Z);){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if((Gt&240)===0){for(Te=Wt,vn=Gt,po=Oe;oe=m.distcode[po+((U&(1<<Te+vn)-1)>>Te)],Wt=oe>>>24,Gt=oe>>>16&255,Oe=oe&65535,!(Te+Wt<=Z);){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}U>>>=Te,Z-=Te,m.back+=Te}if(U>>>=Wt,Z-=Wt,m.back+=Wt,Gt&64){j.msg="invalid distance code",m.mode=Jt;break}m.offset=Oe,m.extra=Gt&15,m.mode=Pt;case Pt:if(m.extra){for(cs=m.extra;Z<cs;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}m.offset+=U&(1<<m.extra)-1,U>>>=m.extra,Z-=m.extra,m.back+=m.extra}if(m.offset>m.dmax){j.msg="invalid distance too far back",m.mode=Jt;break}m.mode=zt;case zt:if(I===0)break t;if(pt=ft-I,m.offset>pt){if(pt=m.offset-pt,pt>m.whave&&m.sane){j.msg="invalid distance too far back",m.mode=Jt;break}pt>m.wnext?(pt-=m.wnext,Ft=m.wsize-pt):Ft=m.wnext-pt,pt>m.length&&(pt=m.length),Re=m.window}else Re=W,Ft=V-m.offset,pt=m.length;pt>I&&(pt=I),I-=pt,m.length-=pt;do W[V++]=Re[Ft++];while(--pt);m.length===0&&(m.mode=kt);break;case qt:if(I===0)break t;W[V++]=m.length,I--,m.mode=kt;break;case Kt:if(m.wrap){for(;Z<32;){if(K===0)break t;K--,U|=L[y++]<<Z,Z+=8}if(ft-=I,j.total_out+=ft,m.total+=ft,ft&&(j.adler=m.check=m.flags?a(m.check,W,ft,V-ft):r(m.check,W,ft,V-ft)),ft=I,(m.flags?U:Xe(U))!==m.check){j.msg="incorrect data check",m.mode=Jt;break}U=0,Z=0}m.mode=pe;case pe:if(m.wrap&&m.flags){for(;Z<32;){if(K===0)break t;K--,U+=L[y++]<<Z,Z+=8}if(U!==(m.total&4294967295)){j.msg="incorrect length check",m.mode=Jt;break}U=0,Z=0}m.mode=ae;case ae:zi=b;break t;case Jt:zi=T;break t;case _e:return A;case Ue:default:return S}return j.next_out=V,j.avail_out=I,j.next_in=y,j.avail_in=K,m.hold=U,m.bits=Z,(m.wsize||ft!==j.avail_out&&m.mode<Jt&&(m.mode<Kt||E!==p))&&Cs(j,j.output,j.next_out,ft-j.avail_out),bt-=j.avail_in,ft-=j.avail_out,j.total_in+=bt,j.total_out+=ft,m.total+=ft,m.wrap&&ft&&(j.adler=m.check=m.flags?a(m.check,W,ft,j.next_out-ft):r(m.check,W,ft,j.next_out-ft)),j.data_type=m.bits+(m.last?64:0)+(m.mode===ut?128:0)+(m.mode===Rt||m.mode===ct?256:0),(bt===0&&ft===0||E===p)&&zi===g&&(zi=C),zi}function nt(j){if(!j||!j.state)return S;var E=j.state;return E.window&&(E.window=null),j.state=null,g}function at(j,E){var m;return!j||!j.state||(m=j.state,(m.wrap&2)===0)?S:(m.head=E,E.done=!1,g)}function vt(j,E){var m=E.length,L,W,y;return!j||!j.state||(L=j.state,L.wrap!==0&&L.mode!==et)?S:L.mode===et&&(W=1,W=r(W,E,m,0),W!==L.check)?T:(y=Cs(j,E,m,m),y?(L.mode=_e,A):(L.havedict=1,g))}s.inflateReset=He,s.inflateReset2=us,s.inflateResetKeep=Ti,s.inflateInit=ei,s.inflateInit2=Fi,s.inflate=M,s.inflateEnd=nt,s.inflateGetHeader=at,s.inflateSetDictionary=vt,s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,i,s){var n=e("../utils/common"),r=15,a=852,o=592,h=0,u=1,c=2,f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],v=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(b,w,S,T,A,C,R,P){var N=P.bits,F=0,z=0,q=0,X=0,tt=0,st=0,Q=0,J=0,et=0,ut=0,Dt,ot,ct,xt,Ct,Mt=null,Yt=0,Rt,kt=new n.Buf16(r+1),se=new n.Buf16(r+1),ie=null,Pt=0,zt,qt,Kt;for(F=0;F<=r;F++)kt[F]=0;for(z=0;z<T;z++)kt[w[S+z]]++;for(tt=N,X=r;X>=1&&kt[X]===0;X--);if(tt>X&&(tt=X),X===0)return A[C++]=1<<24|64<<16|0,A[C++]=1<<24|64<<16|0,P.bits=1,0;for(q=1;q<X&&kt[q]===0;q++);for(tt<q&&(tt=q),J=1,F=1;F<=r;F++)if(J<<=1,J-=kt[F],J<0)return-1;if(J>0&&(b===h||X!==1))return-1;for(se[1]=0,F=1;F<r;F++)se[F+1]=se[F]+kt[F];for(z=0;z<T;z++)w[S+z]!==0&&(R[se[w[S+z]]++]=z);if(b===h?(Mt=ie=R,Rt=19):b===u?(Mt=f,Yt-=257,ie=p,Pt-=257,Rt=256):(Mt=_,ie=v,Rt=-1),ut=0,z=0,F=q,Ct=C,st=tt,Q=0,ct=-1,et=1<<tt,xt=et-1,b===u&&et>a||b===c&&et>o)return 1;for(;;){zt=F-Q,R[z]<Rt?(qt=0,Kt=R[z]):R[z]>Rt?(qt=ie[Pt+R[z]],Kt=Mt[Yt+R[z]]):(qt=96,Kt=0),Dt=1<<F-Q,ot=1<<st,q=ot;do ot-=Dt,A[Ct+(ut>>Q)+ot]=zt<<24|qt<<16|Kt|0;while(ot!==0);for(Dt=1<<F-1;ut&Dt;)Dt>>=1;if(Dt!==0?(ut&=Dt-1,ut+=Dt):ut=0,z++,--kt[F]===0){if(F===X)break;F=w[S+R[z]]}if(F>tt&&(ut&xt)!==ct){for(Q===0&&(Q=tt),Ct+=q,st=F-Q,J=1<<st;st+Q<X&&(J-=kt[st+Q],!(J<=0));)st++,J<<=1;if(et+=1<<st,b===u&&et>a||b===c&&et>o)return 1;ct=ut&xt,A[ct]=tt<<24|st<<16|Ct-C|0}}return ut!==0&&(A[Ct+ut]=F-Q<<24|64<<16|0),P.bits=tt,0}},{"../utils/common":41}],51:[function(e,i,s){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,i,s){var n=e("../utils/common"),r=4,a=0,o=1,h=2;function u(M){for(var nt=M.length;--nt>=0;)M[nt]=0}var c=0,f=1,p=2,_=3,v=258,g=29,b=256,w=b+1+g,S=30,T=19,A=2*w+1,C=15,R=16,P=7,N=256,F=16,z=17,q=18,X=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],st=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=512,et=new Array((w+2)*2);u(et);var ut=new Array(S*2);u(ut);var Dt=new Array(J);u(Dt);var ot=new Array(v-_+1);u(ot);var ct=new Array(g);u(ct);var xt=new Array(S);u(xt);function Ct(M,nt,at,vt,j){this.static_tree=M,this.extra_bits=nt,this.extra_base=at,this.elems=vt,this.max_length=j,this.has_stree=M&&M.length}var Mt,Yt,Rt;function kt(M,nt){this.dyn_tree=M,this.max_code=0,this.stat_desc=nt}function se(M){return M<256?Dt[M]:Dt[256+(M>>>7)]}function ie(M,nt){M.pending_buf[M.pending++]=nt&255,M.pending_buf[M.pending++]=nt>>>8&255}function Pt(M,nt,at){M.bi_valid>R-at?(M.bi_buf|=nt<<M.bi_valid&65535,ie(M,M.bi_buf),M.bi_buf=nt>>R-M.bi_valid,M.bi_valid+=at-R):(M.bi_buf|=nt<<M.bi_valid&65535,M.bi_valid+=at)}function zt(M,nt,at){Pt(M,at[nt*2],at[nt*2+1])}function qt(M,nt){var at=0;do at|=M&1,M>>>=1,at<<=1;while(--nt>0);return at>>>1}function Kt(M){M.bi_valid===16?(ie(M,M.bi_buf),M.bi_buf=0,M.bi_valid=0):M.bi_valid>=8&&(M.pending_buf[M.pending++]=M.bi_buf&255,M.bi_buf>>=8,M.bi_valid-=8)}function pe(M,nt){var at=nt.dyn_tree,vt=nt.max_code,j=nt.stat_desc.static_tree,E=nt.stat_desc.has_stree,m=nt.stat_desc.extra_bits,L=nt.stat_desc.extra_base,W=nt.stat_desc.max_length,y,V,K,I,U,Z,bt=0;for(I=0;I<=C;I++)M.bl_count[I]=0;for(at[M.heap[M.heap_max]*2+1]=0,y=M.heap_max+1;y<A;y++)V=M.heap[y],I=at[at[V*2+1]*2+1]+1,I>W&&(I=W,bt++),at[V*2+1]=I,!(V>vt)&&(M.bl_count[I]++,U=0,V>=L&&(U=m[V-L]),Z=at[V*2],M.opt_len+=Z*(I+U),E&&(M.static_len+=Z*(j[V*2+1]+U)));if(bt!==0){do{for(I=W-1;M.bl_count[I]===0;)I--;M.bl_count[I]--,M.bl_count[I+1]+=2,M.bl_count[W]--,bt-=2}while(bt>0);for(I=W;I!==0;I--)for(V=M.bl_count[I];V!==0;)K=M.heap[--y],!(K>vt)&&(at[K*2+1]!==I&&(M.opt_len+=(I-at[K*2+1])*at[K*2],at[K*2+1]=I),V--)}}function ae(M,nt,at){var vt=new Array(C+1),j=0,E,m;for(E=1;E<=C;E++)vt[E]=j=j+at[E-1]<<1;for(m=0;m<=nt;m++){var L=M[m*2+1];L!==0&&(M[m*2]=qt(vt[L]++,L))}}function Jt(){var M,nt,at,vt,j,E=new Array(C+1);for(at=0,vt=0;vt<g-1;vt++)for(ct[vt]=at,M=0;M<1<<X[vt];M++)ot[at++]=vt;for(ot[at-1]=vt,j=0,vt=0;vt<16;vt++)for(xt[vt]=j,M=0;M<1<<tt[vt];M++)Dt[j++]=vt;for(j>>=7;vt<S;vt++)for(xt[vt]=j<<7,M=0;M<1<<tt[vt]-7;M++)Dt[256+j++]=vt;for(nt=0;nt<=C;nt++)E[nt]=0;for(M=0;M<=143;)et[M*2+1]=8,M++,E[8]++;for(;M<=255;)et[M*2+1]=9,M++,E[9]++;for(;M<=279;)et[M*2+1]=7,M++,E[7]++;for(;M<=287;)et[M*2+1]=8,M++,E[8]++;for(ae(et,w+1,E),M=0;M<S;M++)ut[M*2+1]=5,ut[M*2]=qt(M,5);Mt=new Ct(et,X,b+1,w,C),Yt=new Ct(ut,tt,0,S,C),Rt=new Ct(new Array(0),st,0,T,P)}function _e(M){var nt;for(nt=0;nt<w;nt++)M.dyn_ltree[nt*2]=0;for(nt=0;nt<S;nt++)M.dyn_dtree[nt*2]=0;for(nt=0;nt<T;nt++)M.bl_tree[nt*2]=0;M.dyn_ltree[N*2]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}function Ue(M){M.bi_valid>8?ie(M,M.bi_buf):M.bi_valid>0&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}function Pe(M,nt,at,vt){Ue(M),ie(M,at),ie(M,~at),n.arraySet(M.pending_buf,M.window,nt,at,M.pending),M.pending+=at}function Ot(M,nt,at,vt){var j=nt*2,E=at*2;return M[j]<M[E]||M[j]===M[E]&&vt[nt]<=vt[at]}function Ut(M,nt,at){for(var vt=M.heap[at],j=at<<1;j<=M.heap_len&&(j<M.heap_len&&Ot(nt,M.heap[j+1],M.heap[j],M.depth)&&j++,!Ot(nt,vt,M.heap[j],M.depth));)M.heap[at]=M.heap[j],at=j,j<<=1;M.heap[at]=vt}function Lt(M,nt,at){var vt,j,E=0,m,L;if(M.last_lit!==0)do vt=M.pending_buf[M.d_buf+E*2]<<8|M.pending_buf[M.d_buf+E*2+1],j=M.pending_buf[M.l_buf+E],E++,vt===0?zt(M,j,nt):(m=ot[j],zt(M,m+b+1,nt),L=X[m],L!==0&&(j-=ct[m],Pt(M,j,L)),vt--,m=se(vt),zt(M,m,at),L=tt[m],L!==0&&(vt-=xt[m],Pt(M,vt,L)));while(E<M.last_lit);zt(M,N,nt)}function Xe(M,nt){var at=nt.dyn_tree,vt=nt.stat_desc.static_tree,j=nt.stat_desc.has_stree,E=nt.stat_desc.elems,m,L,W=-1,y;for(M.heap_len=0,M.heap_max=A,m=0;m<E;m++)at[m*2]!==0?(M.heap[++M.heap_len]=W=m,M.depth[m]=0):at[m*2+1]=0;for(;M.heap_len<2;)y=M.heap[++M.heap_len]=W<2?++W:0,at[y*2]=1,M.depth[y]=0,M.opt_len--,j&&(M.static_len-=vt[y*2+1]);for(nt.max_code=W,m=M.heap_len>>1;m>=1;m--)Ut(M,at,m);y=E;do m=M.heap[1],M.heap[1]=M.heap[M.heap_len--],Ut(M,at,1),L=M.heap[1],M.heap[--M.heap_max]=m,M.heap[--M.heap_max]=L,at[y*2]=at[m*2]+at[L*2],M.depth[y]=(M.depth[m]>=M.depth[L]?M.depth[m]:M.depth[L])+1,at[m*2+1]=at[L*2+1]=y,M.heap[1]=y++,Ut(M,at,1);while(M.heap_len>=2);M.heap[--M.heap_max]=M.heap[1],pe(M,nt),ae(at,W,M.bl_count)}function Gi(M,nt,at){var vt,j=-1,E,m=nt[1],L=0,W=7,y=4;for(m===0&&(W=138,y=3),nt[(at+1)*2+1]=65535,vt=0;vt<=at;vt++)E=m,m=nt[(vt+1)*2+1],!(++L<W&&E===m)&&(L<y?M.bl_tree[E*2]+=L:E!==0?(E!==j&&M.bl_tree[E*2]++,M.bl_tree[F*2]++):L<=10?M.bl_tree[z*2]++:M.bl_tree[q*2]++,L=0,j=E,m===0?(W=138,y=3):E===m?(W=6,y=3):(W=7,y=4))}function Ti(M,nt,at){var vt,j=-1,E,m=nt[1],L=0,W=7,y=4;for(m===0&&(W=138,y=3),vt=0;vt<=at;vt++)if(E=m,m=nt[(vt+1)*2+1],!(++L<W&&E===m)){if(L<y)do zt(M,E,M.bl_tree);while(--L!==0);else E!==0?(E!==j&&(zt(M,E,M.bl_tree),L--),zt(M,F,M.bl_tree),Pt(M,L-3,2)):L<=10?(zt(M,z,M.bl_tree),Pt(M,L-3,3)):(zt(M,q,M.bl_tree),Pt(M,L-11,7));L=0,j=E,m===0?(W=138,y=3):E===m?(W=6,y=3):(W=7,y=4)}}function He(M){var nt;for(Gi(M,M.dyn_ltree,M.l_desc.max_code),Gi(M,M.dyn_dtree,M.d_desc.max_code),Xe(M,M.bl_desc),nt=T-1;nt>=3&&M.bl_tree[Q[nt]*2+1]===0;nt--);return M.opt_len+=3*(nt+1)+5+5+4,nt}function us(M,nt,at,vt){var j;for(Pt(M,nt-257,5),Pt(M,at-1,5),Pt(M,vt-4,4),j=0;j<vt;j++)Pt(M,M.bl_tree[Q[j]*2+1],3);Ti(M,M.dyn_ltree,nt-1),Ti(M,M.dyn_dtree,at-1)}function Fi(M){var nt=4093624447,at;for(at=0;at<=31;at++,nt>>>=1)if(nt&1&&M.dyn_ltree[at*2]!==0)return a;if(M.dyn_ltree[18]!==0||M.dyn_ltree[20]!==0||M.dyn_ltree[26]!==0)return o;for(at=32;at<b;at++)if(M.dyn_ltree[at*2]!==0)return o;return a}var ei=!1;function Bi(M){ei||(Jt(),ei=!0),M.l_desc=new kt(M.dyn_ltree,Mt),M.d_desc=new kt(M.dyn_dtree,Yt),M.bl_desc=new kt(M.bl_tree,Rt),M.bi_buf=0,M.bi_valid=0,_e(M)}function Di(M,nt,at,vt){Pt(M,(c<<1)+(vt?1:0),3),Pe(M,nt,at)}function ke(M){Pt(M,f<<1,3),zt(M,N,et),Kt(M)}function hi(M,nt,at,vt){var j,E,m=0;M.level>0?(M.strm.data_type===h&&(M.strm.data_type=Fi(M)),Xe(M,M.l_desc),Xe(M,M.d_desc),m=He(M),j=M.opt_len+3+7>>>3,E=M.static_len+3+7>>>3,E<=j&&(j=E)):j=E=at+5,at+4<=j&&nt!==-1?Di(M,nt,at,vt):M.strategy===r||E===j?(Pt(M,(f<<1)+(vt?1:0),3),Lt(M,et,ut)):(Pt(M,(p<<1)+(vt?1:0),3),us(M,M.l_desc.max_code+1,M.d_desc.max_code+1,m+1),Lt(M,M.dyn_ltree,M.dyn_dtree)),_e(M),vt&&Ue(M)}function Cs(M,nt,at){return M.pending_buf[M.d_buf+M.last_lit*2]=nt>>>8&255,M.pending_buf[M.d_buf+M.last_lit*2+1]=nt&255,M.pending_buf[M.l_buf+M.last_lit]=at&255,M.last_lit++,nt===0?M.dyn_ltree[at*2]++:(M.matches++,nt--,M.dyn_ltree[(ot[at]+b+1)*2]++,M.dyn_dtree[se(nt)*2]++),M.last_lit===M.lit_bufsize-1}s._tr_init=Bi,s._tr_stored_block=Di,s._tr_flush_block=hi,s._tr_tally=Cs,s._tr_align=ke},{"../utils/common":41}],53:[function(e,i,s){function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}i.exports=n},{}],54:[function(e,i,s){(function(n){(function(r,a){if(r.setImmediate)return;var o=1,h={},u=!1,c=r.document,f;function p(P){typeof P!="function"&&(P=new Function(""+P));for(var N=new Array(arguments.length-1),F=0;F<N.length;F++)N[F]=arguments[F+1];var z={callback:P,args:N};return h[o]=z,f(o),o++}function _(P){delete h[P]}function v(P){var N=P.callback,F=P.args;switch(F.length){case 0:N();break;case 1:N(F[0]);break;case 2:N(F[0],F[1]);break;case 3:N(F[0],F[1],F[2]);break;default:N.apply(a,F);break}}function g(P){if(u)setTimeout(g,0,P);else{var N=h[P];if(N){u=!0;try{v(N)}finally{_(P),u=!1}}}}function b(){f=function(P){process.nextTick(function(){g(P)})}}function w(){if(r.postMessage&&!r.importScripts){var P=!0,N=r.onmessage;return r.onmessage=function(){P=!1},r.postMessage("","*"),r.onmessage=N,P}}function S(){var P="setImmediate$"+Math.random()+"$",N=function(F){F.source===r&&typeof F.data=="string"&&F.data.indexOf(P)===0&&g(+F.data.slice(P.length))};r.addEventListener?r.addEventListener("message",N,!1):r.attachEvent("onmessage",N),f=function(F){r.postMessage(P+F,"*")}}function T(){var P=new MessageChannel;P.port1.onmessage=function(N){var F=N.data;g(F)},f=function(N){P.port2.postMessage(N)}}function A(){var P=c.documentElement;f=function(N){var F=c.createElement("script");F.onreadystatechange=function(){g(N),F.onreadystatechange=null,P.removeChild(F),F=null},P.appendChild(F)}}function C(){f=function(P){setTimeout(g,0,P)}}var R=Object.getPrototypeOf&&Object.getPrototypeOf(r);R=R&&R.setTimeout?R:r,{}.toString.call(r.process)==="[object process]"?b():w()?S():r.MessageChannel?T():c&&"onreadystatechange"in c.createElement("script")?A():C(),R.setImmediate=p,R.clearImmediate=_})(typeof self>"u"?typeof n>"u"?this:n:self)}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(Df)),Df.exports}var Aw=_w();const Ew=jl(Aw);class xw{constructor(){this.zip=void 0,this.urlCache={},this.checkRequirements()}checkRequirements(){try{this.zip=new Ew}catch{throw new Error("JSZip lib not loaded")}}open(t,e){return this.zip.loadAsync(t,{base64:e})}openUrl(t,e){return wh(t,"binary").then((function(i){return this.zip.loadAsync(i,{base64:e})}).bind(this))}request(t,e){var i=new te,s,n=new ir(t);return e||(e=n.extension),e=="blob"?s=this.getBlob(t):s=this.getText(t),s?s.then((function(r){let a=this.handleResponse(r,e);i.resolve(a)}).bind(this)):i.reject({message:"File not found in the epub: "+t,stack:new Error().stack}),i.promise}handleResponse(t,e){var i;return e=="json"?i=JSON.parse(t):yh(e)?i=pn(t,"text/xml"):e=="xhtml"?i=pn(t,"application/xhtml+xml"):e=="html"||e=="htm"?i=pn(t,"text/html"):i=t,i}getBlob(t,e){var i=window.decodeURIComponent(t.substr(1)),s=this.zip.file(i);if(s)return e=e||Lo.lookup(s.name),s.async("uint8array").then(function(n){return new Blob([n],{type:e})})}getText(t,e){var i=window.decodeURIComponent(t.substr(1)),s=this.zip.file(i);if(s)return s.async("string").then(function(n){return n})}getBase64(t,e){var i=window.decodeURIComponent(t.substr(1)),s=this.zip.file(i);if(s)return e=e||Lo.lookup(s.name),s.async("base64").then(function(n){return"data:"+e+";base64,"+n})}createUrl(t,e){var i=new te,s=window.URL||window.webkitURL||window.mozURL,n,r,a=e&&e.base64;return t in this.urlCache?(i.resolve(this.urlCache[t]),i.promise):(a?(r=this.getBase64(t),r&&r.then((function(o){this.urlCache[t]=o,i.resolve(o)}).bind(this))):(r=this.getBlob(t),r&&r.then((function(o){n=s.createObjectURL(o),this.urlCache[t]=n,i.resolve(n)}).bind(this))),r||i.reject({message:"File not found in the epub: "+t,stack:new Error().stack}),i.promise)}revokeUrl(t){var e=window.URL||window.webkitURL||window.mozURL,i=this.urlCache[t];i&&e.revokeObjectURL(i)}destroy(){var t=window.URL||window.webkitURL||window.mozURL;for(let e in this.urlCache)t.revokeObjectURL(e);this.zip=void 0,this.urlCache={}}}var kf={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var Fm;function Sw(){return Fm||(Fm=1,function(d,t){(function(e){d.exports=e()})(function(){return function e(i,s,n){function r(h,u){if(!s[h]){if(!i[h]){var c=typeof jr=="function"&&jr;if(!u&&c)return c(h,!0);if(a)return a(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var p=s[h]={exports:{}};i[h][0].call(p.exports,function(_){var v=i[h][1][_];return r(v||_)},p,p.exports,e,i,s,n)}return s[h].exports}for(var a=typeof jr=="function"&&jr,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,i,s){(function(n){var r=n.MutationObserver||n.WebKitMutationObserver,a;if(r){var o=0,h=new r(_),u=n.document.createTextNode("");h.observe(u,{characterData:!0}),a=function(){u.data=o=++o%2}}else if(!n.setImmediate&&typeof n.MessageChannel<"u"){var c=new n.MessageChannel;c.port1.onmessage=_,a=function(){c.port2.postMessage(0)}}else"document"in n&&"onreadystatechange"in n.document.createElement("script")?a=function(){var g=n.document.createElement("script");g.onreadystatechange=function(){_(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},n.document.documentElement.appendChild(g)}:a=function(){setTimeout(_,0)};var f,p=[];function _(){f=!0;for(var g,b,w=p.length;w;){for(b=p,p=[],g=-1;++g<w;)b[g]();w=p.length}f=!1}i.exports=v;function v(g){p.push(g)===1&&!f&&a()}}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(e,i,s){var n=e(1);function r(){}var a={},o=["REJECTED"],h=["FULFILLED"],u=["PENDING"];i.exports=c;function c(A){if(typeof A!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,A!==r&&v(this,A)}c.prototype.catch=function(A){return this.then(null,A)},c.prototype.then=function(A,C){if(typeof A!="function"&&this.state===h||typeof C!="function"&&this.state===o)return this;var R=new this.constructor(r);if(this.state!==u){var P=this.state===h?A:C;p(R,P,this.outcome)}else this.queue.push(new f(R,A,C));return R};function f(A,C,R){this.promise=A,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}f.prototype.callFulfilled=function(A){a.resolve(this.promise,A)},f.prototype.otherCallFulfilled=function(A){p(this.promise,this.onFulfilled,A)},f.prototype.callRejected=function(A){a.reject(this.promise,A)},f.prototype.otherCallRejected=function(A){p(this.promise,this.onRejected,A)};function p(A,C,R){n(function(){var P;try{P=C(R)}catch(N){return a.reject(A,N)}P===A?a.reject(A,new TypeError("Cannot resolve promise with itself")):a.resolve(A,P)})}a.resolve=function(A,C){var R=g(_,C);if(R.status==="error")return a.reject(A,R.value);var P=R.value;if(P)v(A,P);else{A.state=h,A.outcome=C;for(var N=-1,F=A.queue.length;++N<F;)A.queue[N].callFulfilled(C)}return A},a.reject=function(A,C){A.state=o,A.outcome=C;for(var R=-1,P=A.queue.length;++R<P;)A.queue[R].callRejected(C);return A};function _(A){var C=A&&A.then;if(A&&(typeof A=="object"||typeof A=="function")&&typeof C=="function")return function(){C.apply(A,arguments)}}function v(A,C){var R=!1;function P(q){R||(R=!0,a.reject(A,q))}function N(q){R||(R=!0,a.resolve(A,q))}function F(){C(N,P)}var z=g(F);z.status==="error"&&P(z.value)}function g(A,C){var R={};try{R.value=A(C),R.status="success"}catch(P){R.status="error",R.value=P}return R}c.resolve=b;function b(A){return A instanceof this?A:a.resolve(new this(r),A)}c.reject=w;function w(A){var C=new this(r);return a.reject(C,A)}c.all=S;function S(A){var C=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=A.length,P=!1;if(!R)return this.resolve([]);for(var N=new Array(R),F=0,z=-1,q=new this(r);++z<R;)X(A[z],z);return q;function X(tt,st){C.resolve(tt).then(Q,function(J){P||(P=!0,a.reject(q,J))});function Q(J){N[st]=J,++F===R&&!P&&(P=!0,a.resolve(q,N))}}}c.race=T;function T(A){var C=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=A.length,P=!1;if(!R)return this.resolve([]);for(var N=-1,F=new this(r);++N<R;)z(A[N]);return F;function z(q){C.resolve(q).then(function(X){P||(P=!0,a.resolve(F,X))},function(X){P||(P=!0,a.reject(F,X))})}}},{1:1}],3:[function(e,i,s){(function(n){typeof n.Promise!="function"&&(n.Promise=e(2))}).call(this,typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(e,i,s){var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O};function r(O,H){if(!(O instanceof H))throw new TypeError("Cannot call a class as a function")}function a(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var o=a();function h(){try{if(!o||!o.open)return!1;var O=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),H=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!O||H)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function u(O,H){O=O||[],H=H||{};try{return new Blob(O,H)}catch(G){if(G.name!=="TypeError")throw G;for(var B=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,$=new B,Y=0;Y<O.length;Y+=1)$.append(O[Y]);return $.getBlob(H.type)}}typeof Promise>"u"&&e(3);var c=Promise;function f(O,H){H&&O.then(function(B){H(null,B)},function(B){H(B)})}function p(O,H,B){typeof H=="function"&&O.then(H),typeof B=="function"&&O.catch(B)}function _(O){return typeof O!="string"&&(console.warn(O+" used as a key, but it is not a string."),O=String(O)),O}function v(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var g="local-forage-detect-blob-support",b=void 0,w={},S=Object.prototype.toString,T="readonly",A="readwrite";function C(O){for(var H=O.length,B=new ArrayBuffer(H),$=new Uint8Array(B),Y=0;Y<H;Y++)$[Y]=O.charCodeAt(Y);return B}function R(O){return new c(function(H){var B=O.transaction(g,A),$=u([""]);B.objectStore(g).put($,"key"),B.onabort=function(Y){Y.preventDefault(),Y.stopPropagation(),H(!1)},B.oncomplete=function(){var Y=navigator.userAgent.match(/Chrome\/(\d+)/),G=navigator.userAgent.match(/Edge\//);H(G||!Y||parseInt(Y[1],10)>=43)}}).catch(function(){return!1})}function P(O){return typeof b=="boolean"?c.resolve(b):R(O).then(function(H){return b=H,b})}function N(O){var H=w[O.name],B={};B.promise=new c(function($,Y){B.resolve=$,B.reject=Y}),H.deferredOperations.push(B),H.dbReady?H.dbReady=H.dbReady.then(function(){return B.promise}):H.dbReady=B.promise}function F(O){var H=w[O.name],B=H.deferredOperations.pop();if(B)return B.resolve(),B.promise}function z(O,H){var B=w[O.name],$=B.deferredOperations.pop();if($)return $.reject(H),$.promise}function q(O,H){return new c(function(B,$){if(w[O.name]=w[O.name]||ct(),O.db)if(H)N(O),O.db.close();else return B(O.db);var Y=[O.name];H&&Y.push(O.version);var G=o.open.apply(o,Y);H&&(G.onupgradeneeded=function(it){var rt=G.result;try{rt.createObjectStore(O.storeName),it.oldVersion<=1&&rt.createObjectStore(g)}catch(lt){if(lt.name==="ConstraintError")console.warn('The database "'+O.name+'" has been upgraded from version '+it.oldVersion+" to version "+it.newVersion+', but the storage "'+O.storeName+'" already exists.');else throw lt}}),G.onerror=function(it){it.preventDefault(),$(G.error)},G.onsuccess=function(){var it=G.result;it.onversionchange=function(rt){rt.target.close()},B(it),F(O)}})}function X(O){return q(O,!1)}function tt(O){return q(O,!0)}function st(O,H){if(!O.db)return!0;var B=!O.db.objectStoreNames.contains(O.storeName),$=O.version<O.db.version,Y=O.version>O.db.version;if($&&(O.version!==H&&console.warn('The database "'+O.name+`" can't be downgraded from version `+O.db.version+" to version "+O.version+"."),O.version=O.db.version),Y||B){if(B){var G=O.db.version+1;G>O.version&&(O.version=G)}return!0}return!1}function Q(O){return new c(function(H,B){var $=new FileReader;$.onerror=B,$.onloadend=function(Y){var G=btoa(Y.target.result||"");H({__local_forage_encoded_blob:!0,data:G,type:O.type})},$.readAsBinaryString(O)})}function J(O){var H=C(atob(O.data));return u([H],{type:O.type})}function et(O){return O&&O.__local_forage_encoded_blob}function ut(O){var H=this,B=H._initReady().then(function(){var $=w[H._dbInfo.name];if($&&$.dbReady)return $.dbReady});return p(B,O,O),B}function Dt(O){N(O);for(var H=w[O.name],B=H.forages,$=0;$<B.length;$++){var Y=B[$];Y._dbInfo.db&&(Y._dbInfo.db.close(),Y._dbInfo.db=null)}return O.db=null,X(O).then(function(G){return O.db=G,st(O)?tt(O):G}).then(function(G){O.db=H.db=G;for(var it=0;it<B.length;it++)B[it]._dbInfo.db=G}).catch(function(G){throw z(O,G),G})}function ot(O,H,B,$){$===void 0&&($=1);try{var Y=O.db.transaction(O.storeName,H);B(null,Y)}catch(G){if($>0&&(!O.db||G.name==="InvalidStateError"||G.name==="NotFoundError"))return c.resolve().then(function(){if(!O.db||G.name==="NotFoundError"&&!O.db.objectStoreNames.contains(O.storeName)&&O.version<=O.db.version)return O.db&&(O.version=O.db.version+1),tt(O)}).then(function(){return Dt(O).then(function(){ot(O,H,B,$-1)})}).catch(B);B(G)}}function ct(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function xt(O){var H=this,B={db:null};if(O)for(var $ in O)B[$]=O[$];var Y=w[B.name];Y||(Y=ct(),w[B.name]=Y),Y.forages.push(H),H._initReady||(H._initReady=H.ready,H.ready=ut);var G=[];function it(){return c.resolve()}for(var rt=0;rt<Y.forages.length;rt++){var lt=Y.forages[rt];lt!==H&&G.push(lt._initReady().catch(it))}var ht=Y.forages.slice(0);return c.all(G).then(function(){return B.db=Y.db,X(B)}).then(function(dt){return B.db=dt,st(B,H._defaultConfig.version)?tt(B):dt}).then(function(dt){B.db=Y.db=dt,H._dbInfo=B;for(var St=0;St<ht.length;St++){var $t=ht[St];$t!==H&&($t._dbInfo.db=B.db,$t._dbInfo.version=B.version)}})}function Ct(O,H){var B=this;O=_(O);var $=new c(function(Y,G){B.ready().then(function(){ot(B._dbInfo,T,function(it,rt){if(it)return G(it);try{var lt=rt.objectStore(B._dbInfo.storeName),ht=lt.get(O);ht.onsuccess=function(){var dt=ht.result;dt===void 0&&(dt=null),et(dt)&&(dt=J(dt)),Y(dt)},ht.onerror=function(){G(ht.error)}}catch(dt){G(dt)}})}).catch(G)});return f($,H),$}function Mt(O,H){var B=this,$=new c(function(Y,G){B.ready().then(function(){ot(B._dbInfo,T,function(it,rt){if(it)return G(it);try{var lt=rt.objectStore(B._dbInfo.storeName),ht=lt.openCursor(),dt=1;ht.onsuccess=function(){var St=ht.result;if(St){var $t=St.value;et($t)&&($t=J($t));var he=O($t,St.key,dt++);he!==void 0?Y(he):St.continue()}else Y()},ht.onerror=function(){G(ht.error)}}catch(St){G(St)}})}).catch(G)});return f($,H),$}function Yt(O,H,B){var $=this;O=_(O);var Y=new c(function(G,it){var rt;$.ready().then(function(){return rt=$._dbInfo,S.call(H)==="[object Blob]"?P(rt.db).then(function(lt){return lt?H:Q(H)}):H}).then(function(lt){ot($._dbInfo,A,function(ht,dt){if(ht)return it(ht);try{var St=dt.objectStore($._dbInfo.storeName);lt===null&&(lt=void 0);var $t=St.put(lt,O);dt.oncomplete=function(){lt===void 0&&(lt=null),G(lt)},dt.onabort=dt.onerror=function(){var he=$t.error?$t.error:$t.transaction.error;it(he)}}catch(he){it(he)}})}).catch(it)});return f(Y,B),Y}function Rt(O,H){var B=this;O=_(O);var $=new c(function(Y,G){B.ready().then(function(){ot(B._dbInfo,A,function(it,rt){if(it)return G(it);try{var lt=rt.objectStore(B._dbInfo.storeName),ht=lt.delete(O);rt.oncomplete=function(){Y()},rt.onerror=function(){G(ht.error)},rt.onabort=function(){var dt=ht.error?ht.error:ht.transaction.error;G(dt)}}catch(dt){G(dt)}})}).catch(G)});return f($,H),$}function kt(O){var H=this,B=new c(function($,Y){H.ready().then(function(){ot(H._dbInfo,A,function(G,it){if(G)return Y(G);try{var rt=it.objectStore(H._dbInfo.storeName),lt=rt.clear();it.oncomplete=function(){$()},it.onabort=it.onerror=function(){var ht=lt.error?lt.error:lt.transaction.error;Y(ht)}}catch(ht){Y(ht)}})}).catch(Y)});return f(B,O),B}function se(O){var H=this,B=new c(function($,Y){H.ready().then(function(){ot(H._dbInfo,T,function(G,it){if(G)return Y(G);try{var rt=it.objectStore(H._dbInfo.storeName),lt=rt.count();lt.onsuccess=function(){$(lt.result)},lt.onerror=function(){Y(lt.error)}}catch(ht){Y(ht)}})}).catch(Y)});return f(B,O),B}function ie(O,H){var B=this,$=new c(function(Y,G){if(O<0){Y(null);return}B.ready().then(function(){ot(B._dbInfo,T,function(it,rt){if(it)return G(it);try{var lt=rt.objectStore(B._dbInfo.storeName),ht=!1,dt=lt.openKeyCursor();dt.onsuccess=function(){var St=dt.result;if(!St){Y(null);return}O===0||ht?Y(St.key):(ht=!0,St.advance(O))},dt.onerror=function(){G(dt.error)}}catch(St){G(St)}})}).catch(G)});return f($,H),$}function Pt(O){var H=this,B=new c(function($,Y){H.ready().then(function(){ot(H._dbInfo,T,function(G,it){if(G)return Y(G);try{var rt=it.objectStore(H._dbInfo.storeName),lt=rt.openKeyCursor(),ht=[];lt.onsuccess=function(){var dt=lt.result;if(!dt){$(ht);return}ht.push(dt.key),dt.continue()},lt.onerror=function(){Y(lt.error)}}catch(dt){Y(dt)}})}).catch(Y)});return f(B,O),B}function zt(O,H){H=v.apply(this,arguments);var B=this.config();O=typeof O!="function"&&O||{},O.name||(O.name=O.name||B.name,O.storeName=O.storeName||B.storeName);var $=this,Y;if(!O.name)Y=c.reject("Invalid arguments");else{var G=O.name===B.name&&$._dbInfo.db,it=G?c.resolve($._dbInfo.db):X(O).then(function(rt){var lt=w[O.name],ht=lt.forages;lt.db=rt;for(var dt=0;dt<ht.length;dt++)ht[dt]._dbInfo.db=rt;return rt});O.storeName?Y=it.then(function(rt){if(rt.objectStoreNames.contains(O.storeName)){var lt=rt.version+1;N(O);var ht=w[O.name],dt=ht.forages;rt.close();for(var St=0;St<dt.length;St++){var $t=dt[St];$t._dbInfo.db=null,$t._dbInfo.version=lt}var he=new c(function(ce,qe){var Me=o.open(O.name,lt);Me.onerror=function(ds){var Vl=Me.result;Vl.close(),qe(ds)},Me.onupgradeneeded=function(){var ds=Me.result;ds.deleteObjectStore(O.storeName)},Me.onsuccess=function(){var ds=Me.result;ds.close(),ce(ds)}});return he.then(function(ce){ht.db=ce;for(var qe=0;qe<dt.length;qe++){var Me=dt[qe];Me._dbInfo.db=ce,F(Me._dbInfo)}}).catch(function(ce){throw(z(O,ce)||c.resolve()).catch(function(){}),ce})}}):Y=it.then(function(rt){N(O);var lt=w[O.name],ht=lt.forages;rt.close();for(var dt=0;dt<ht.length;dt++){var St=ht[dt];St._dbInfo.db=null}var $t=new c(function(he,ce){var qe=o.deleteDatabase(O.name);qe.onerror=function(){var Me=qe.result;Me&&Me.close(),ce(qe.error)},qe.onblocked=function(){console.warn('dropInstance blocked for database "'+O.name+'" until all open connections are closed')},qe.onsuccess=function(){var Me=qe.result;Me&&Me.close(),he(Me)}});return $t.then(function(he){lt.db=he;for(var ce=0;ce<ht.length;ce++){var qe=ht[ce];F(qe._dbInfo)}}).catch(function(he){throw(z(O,he)||c.resolve()).catch(function(){}),he})})}return f(Y,H),Y}var qt={_driver:"asyncStorage",_initStorage:xt,_support:h(),iterate:Mt,getItem:Ct,setItem:Yt,removeItem:Rt,clear:kt,length:se,key:ie,keys:Pt,dropInstance:zt};function Kt(){return typeof openDatabase=="function"}var pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ae="~~local_forage_type~",Jt=/^~~local_forage_type~([^~]+)~/,_e="__lfsc__:",Ue=_e.length,Pe="arbf",Ot="blob",Ut="si08",Lt="ui08",Xe="uic8",Gi="si16",Ti="si32",He="ur16",us="ui32",Fi="fl32",ei="fl64",Bi=Ue+Pe.length,Di=Object.prototype.toString;function ke(O){var H=O.length*.75,B=O.length,$,Y=0,G,it,rt,lt;O[O.length-1]==="="&&(H--,O[O.length-2]==="="&&H--);var ht=new ArrayBuffer(H),dt=new Uint8Array(ht);for($=0;$<B;$+=4)G=pe.indexOf(O[$]),it=pe.indexOf(O[$+1]),rt=pe.indexOf(O[$+2]),lt=pe.indexOf(O[$+3]),dt[Y++]=G<<2|it>>4,dt[Y++]=(it&15)<<4|rt>>2,dt[Y++]=(rt&3)<<6|lt&63;return ht}function hi(O){var H=new Uint8Array(O),B="",$;for($=0;$<H.length;$+=3)B+=pe[H[$]>>2],B+=pe[(H[$]&3)<<4|H[$+1]>>4],B+=pe[(H[$+1]&15)<<2|H[$+2]>>6],B+=pe[H[$+2]&63];return H.length%3===2?B=B.substring(0,B.length-1)+"=":H.length%3===1&&(B=B.substring(0,B.length-2)+"=="),B}function Cs(O,H){var B="";if(O&&(B=Di.call(O)),O&&(B==="[object ArrayBuffer]"||O.buffer&&Di.call(O.buffer)==="[object ArrayBuffer]")){var $,Y=_e;O instanceof ArrayBuffer?($=O,Y+=Pe):($=O.buffer,B==="[object Int8Array]"?Y+=Ut:B==="[object Uint8Array]"?Y+=Lt:B==="[object Uint8ClampedArray]"?Y+=Xe:B==="[object Int16Array]"?Y+=Gi:B==="[object Uint16Array]"?Y+=He:B==="[object Int32Array]"?Y+=Ti:B==="[object Uint32Array]"?Y+=us:B==="[object Float32Array]"?Y+=Fi:B==="[object Float64Array]"?Y+=ei:H(new Error("Failed to get type for BinaryArray"))),H(Y+hi($))}else if(B==="[object Blob]"){var G=new FileReader;G.onload=function(){var it=ae+O.type+"~"+hi(this.result);H(_e+Ot+it)},G.readAsArrayBuffer(O)}else try{H(JSON.stringify(O))}catch(it){console.error("Couldn't convert value into a JSON string: ",O),H(null,it)}}function M(O){if(O.substring(0,Ue)!==_e)return JSON.parse(O);var H=O.substring(Bi),B=O.substring(Ue,Bi),$;if(B===Ot&&Jt.test(H)){var Y=H.match(Jt);$=Y[1],H=H.substring(Y[0].length)}var G=ke(H);switch(B){case Pe:return G;case Ot:return u([G],{type:$});case Ut:return new Int8Array(G);case Lt:return new Uint8Array(G);case Xe:return new Uint8ClampedArray(G);case Gi:return new Int16Array(G);case He:return new Uint16Array(G);case Ti:return new Int32Array(G);case us:return new Uint32Array(G);case Fi:return new Float32Array(G);case ei:return new Float64Array(G);default:throw new Error("Unkown type: "+B)}}var nt={serialize:Cs,deserialize:M,stringToBuffer:ke,bufferToString:hi};function at(O,H,B,$){O.executeSql("CREATE TABLE IF NOT EXISTS "+H.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],B,$)}function vt(O){var H=this,B={db:null};if(O)for(var $ in O)B[$]=typeof O[$]!="string"?O[$].toString():O[$];var Y=new c(function(G,it){try{B.db=openDatabase(B.name,String(B.version),B.description,B.size)}catch(rt){return it(rt)}B.db.transaction(function(rt){at(rt,B,function(){H._dbInfo=B,G()},function(lt,ht){it(ht)})},it)});return B.serializer=nt,Y}function j(O,H,B,$,Y,G){O.executeSql(B,$,Y,function(it,rt){rt.code===rt.SYNTAX_ERR?it.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[H.storeName],function(lt,ht){ht.rows.length?G(lt,rt):at(lt,H,function(){lt.executeSql(B,$,Y,G)},G)},G):G(it,rt)},G)}function E(O,H){var B=this;O=_(O);var $=new c(function(Y,G){B.ready().then(function(){var it=B._dbInfo;it.db.transaction(function(rt){j(rt,it,"SELECT * FROM "+it.storeName+" WHERE key = ? LIMIT 1",[O],function(lt,ht){var dt=ht.rows.length?ht.rows.item(0).value:null;dt&&(dt=it.serializer.deserialize(dt)),Y(dt)},function(lt,ht){G(ht)})})}).catch(G)});return f($,H),$}function m(O,H){var B=this,$=new c(function(Y,G){B.ready().then(function(){var it=B._dbInfo;it.db.transaction(function(rt){j(rt,it,"SELECT * FROM "+it.storeName,[],function(lt,ht){for(var dt=ht.rows,St=dt.length,$t=0;$t<St;$t++){var he=dt.item($t),ce=he.value;if(ce&&(ce=it.serializer.deserialize(ce)),ce=O(ce,he.key,$t+1),ce!==void 0){Y(ce);return}}Y()},function(lt,ht){G(ht)})})}).catch(G)});return f($,H),$}function L(O,H,B,$){var Y=this;O=_(O);var G=new c(function(it,rt){Y.ready().then(function(){H===void 0&&(H=null);var lt=H,ht=Y._dbInfo;ht.serializer.serialize(H,function(dt,St){St?rt(St):ht.db.transaction(function($t){j($t,ht,"INSERT OR REPLACE INTO "+ht.storeName+" (key, value) VALUES (?, ?)",[O,dt],function(){it(lt)},function(he,ce){rt(ce)})},function($t){if($t.code===$t.QUOTA_ERR){if($>0){it(L.apply(Y,[O,lt,B,$-1]));return}rt($t)}})})}).catch(rt)});return f(G,B),G}function W(O,H,B){return L.apply(this,[O,H,B,1])}function y(O,H){var B=this;O=_(O);var $=new c(function(Y,G){B.ready().then(function(){var it=B._dbInfo;it.db.transaction(function(rt){j(rt,it,"DELETE FROM "+it.storeName+" WHERE key = ?",[O],function(){Y()},function(lt,ht){G(ht)})})}).catch(G)});return f($,H),$}function V(O){var H=this,B=new c(function($,Y){H.ready().then(function(){var G=H._dbInfo;G.db.transaction(function(it){j(it,G,"DELETE FROM "+G.storeName,[],function(){$()},function(rt,lt){Y(lt)})})}).catch(Y)});return f(B,O),B}function K(O){var H=this,B=new c(function($,Y){H.ready().then(function(){var G=H._dbInfo;G.db.transaction(function(it){j(it,G,"SELECT COUNT(key) as c FROM "+G.storeName,[],function(rt,lt){var ht=lt.rows.item(0).c;$(ht)},function(rt,lt){Y(lt)})})}).catch(Y)});return f(B,O),B}function I(O,H){var B=this,$=new c(function(Y,G){B.ready().then(function(){var it=B._dbInfo;it.db.transaction(function(rt){j(rt,it,"SELECT key FROM "+it.storeName+" WHERE id = ? LIMIT 1",[O+1],function(lt,ht){var dt=ht.rows.length?ht.rows.item(0).key:null;Y(dt)},function(lt,ht){G(ht)})})}).catch(G)});return f($,H),$}function U(O){var H=this,B=new c(function($,Y){H.ready().then(function(){var G=H._dbInfo;G.db.transaction(function(it){j(it,G,"SELECT key FROM "+G.storeName,[],function(rt,lt){for(var ht=[],dt=0;dt<lt.rows.length;dt++)ht.push(lt.rows.item(dt).key);$(ht)},function(rt,lt){Y(lt)})})}).catch(Y)});return f(B,O),B}function Z(O){return new c(function(H,B){O.transaction(function($){$.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(Y,G){for(var it=[],rt=0;rt<G.rows.length;rt++)it.push(G.rows.item(rt).name);H({db:O,storeNames:it})},function(Y,G){B(G)})},function($){B($)})})}function bt(O,H){H=v.apply(this,arguments);var B=this.config();O=typeof O!="function"&&O||{},O.name||(O.name=O.name||B.name,O.storeName=O.storeName||B.storeName);var $=this,Y;return O.name?Y=new c(function(G){var it;O.name===B.name?it=$._dbInfo.db:it=openDatabase(O.name,"","",0),O.storeName?G({db:it,storeNames:[O.storeName]}):G(Z(it))}).then(function(G){return new c(function(it,rt){G.db.transaction(function(lt){function ht(he){return new c(function(ce,qe){lt.executeSql("DROP TABLE IF EXISTS "+he,[],function(){ce()},function(Me,ds){qe(ds)})})}for(var dt=[],St=0,$t=G.storeNames.length;St<$t;St++)dt.push(ht(G.storeNames[St]));c.all(dt).then(function(){it()}).catch(function(he){rt(he)})},function(lt){rt(lt)})})}):Y=c.reject("Invalid arguments"),f(Y,H),Y}var ft={_driver:"webSQLStorage",_initStorage:vt,_support:Kt(),iterate:m,getItem:E,setItem:W,removeItem:y,clear:V,length:K,key:I,keys:U,dropInstance:bt};function pt(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Ft(O,H){var B=O.name+"/";return O.storeName!==H.storeName&&(B+=O.storeName+"/"),B}function Re(){var O="_localforage_support_test";try{return localStorage.setItem(O,!0),localStorage.removeItem(O),!1}catch{return!0}}function oe(){return!Re()||localStorage.length>0}function Wt(O){var H=this,B={};if(O)for(var $ in O)B[$]=O[$];return B.keyPrefix=Ft(O,H._defaultConfig),oe()?(H._dbInfo=B,B.serializer=nt,c.resolve()):c.reject()}function Gt(O){var H=this,B=H.ready().then(function(){for(var $=H._dbInfo.keyPrefix,Y=localStorage.length-1;Y>=0;Y--){var G=localStorage.key(Y);G.indexOf($)===0&&localStorage.removeItem(G)}});return f(B,O),B}function Oe(O,H){var B=this;O=_(O);var $=B.ready().then(function(){var Y=B._dbInfo,G=localStorage.getItem(Y.keyPrefix+O);return G&&(G=Y.serializer.deserialize(G)),G});return f($,H),$}function Te(O,H){var B=this,$=B.ready().then(function(){for(var Y=B._dbInfo,G=Y.keyPrefix,it=G.length,rt=localStorage.length,lt=1,ht=0;ht<rt;ht++){var dt=localStorage.key(ht);if(dt.indexOf(G)===0){var St=localStorage.getItem(dt);if(St&&(St=Y.serializer.deserialize(St)),St=O(St,dt.substring(it),lt++),St!==void 0)return St}}});return f($,H),$}function vn(O,H){var B=this,$=B.ready().then(function(){var Y=B._dbInfo,G;try{G=localStorage.key(O)}catch{G=null}return G&&(G=G.substring(Y.keyPrefix.length)),G});return f($,H),$}function po(O){var H=this,B=H.ready().then(function(){for(var $=H._dbInfo,Y=localStorage.length,G=[],it=0;it<Y;it++){var rt=localStorage.key(it);rt.indexOf($.keyPrefix)===0&&G.push(rt.substring($.keyPrefix.length))}return G});return f(B,O),B}function Ie(O){var H=this,B=H.keys().then(function($){return $.length});return f(B,O),B}function zi(O,H){var B=this;O=_(O);var $=B.ready().then(function(){var Y=B._dbInfo;localStorage.removeItem(Y.keyPrefix+O)});return f($,H),$}function Ye(O,H,B){var $=this;O=_(O);var Y=$.ready().then(function(){H===void 0&&(H=null);var G=H;return new c(function(it,rt){var lt=$._dbInfo;lt.serializer.serialize(H,function(ht,dt){if(dt)rt(dt);else try{localStorage.setItem(lt.keyPrefix+O,ht),it(G)}catch(St){(St.name==="QuotaExceededError"||St.name==="NS_ERROR_DOM_QUOTA_REACHED")&&rt(St),rt(St)}})})});return f(Y,B),Y}function Ts(O,H){if(H=v.apply(this,arguments),O=typeof O!="function"&&O||{},!O.name){var B=this.config();O.name=O.name||B.name,O.storeName=O.storeName||B.storeName}var $=this,Y;return O.name?Y=new c(function(G){O.storeName?G(Ft(O,$._defaultConfig)):G(O.name+"/")}).then(function(G){for(var it=localStorage.length-1;it>=0;it--){var rt=localStorage.key(it);rt.indexOf(G)===0&&localStorage.removeItem(rt)}}):Y=c.reject("Invalid arguments"),f(Y,H),Y}var cs={_driver:"localStorageWrapper",_initStorage:Wt,_support:pt(),iterate:Te,getItem:Oe,setItem:Ye,removeItem:zi,clear:Gt,length:Ie,key:vn,keys:po,dropInstance:Ts},Qu=function(H,B){return H===B||typeof H=="number"&&typeof B=="number"&&isNaN(H)&&isNaN(B)},zb=function(H,B){for(var $=H.length,Y=0;Y<$;){if(Qu(H[Y],B))return!0;Y++}return!1},Mg=Array.isArray||function(O){return Object.prototype.toString.call(O)==="[object Array]"},Wl={},Fg={},go={INDEXEDDB:qt,WEBSQL:ft,LOCALSTORAGE:cs},Ub=[go.INDEXEDDB._driver,go.WEBSQL._driver,go.LOCALSTORAGE._driver],tc=["dropInstance"],Md=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tc),Hb={description:"",driver:Ub.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function qb(O,H){O[H]=function(){var B=arguments;return O.ready().then(function(){return O[H].apply(O,B)})}}function Fd(){for(var O=1;O<arguments.length;O++){var H=arguments[O];if(H)for(var B in H)H.hasOwnProperty(B)&&(Mg(H[B])?arguments[0][B]=H[B].slice():arguments[0][B]=H[B])}return arguments[0]}var jb=function(){function O(H){r(this,O);for(var B in go)if(go.hasOwnProperty(B)){var $=go[B],Y=$._driver;this[B]=Y,Wl[Y]||this.defineDriver($)}this._defaultConfig=Fd({},Hb),this._config=Fd({},this._defaultConfig,H),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return O.prototype.config=function(B){if((typeof B>"u"?"undefined":n(B))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var $ in B){if($==="storeName"&&(B[$]=B[$].replace(/\W/g,"_")),$==="version"&&typeof B[$]!="number")return new Error("Database version must be a number.");this._config[$]=B[$]}return"driver"in B&&B.driver?this.setDriver(this._config.driver):!0}else return typeof B=="string"?this._config[B]:this._config},O.prototype.defineDriver=function(B,$,Y){var G=new c(function(it,rt){try{var lt=B._driver,ht=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!B._driver){rt(ht);return}for(var dt=Md.concat("_initStorage"),St=0,$t=dt.length;St<$t;St++){var he=dt[St],ce=!zb(tc,he);if((ce||B[he])&&typeof B[he]!="function"){rt(ht);return}}var qe=function(){for(var Vl=function(Gb){return function(){var $b=new Error("Method "+Gb+" is not implemented by the current driver"),Bg=c.reject($b);return f(Bg,arguments[arguments.length-1]),Bg}},Bd=0,Vb=tc.length;Bd<Vb;Bd++){var zd=tc[Bd];B[zd]||(B[zd]=Vl(zd))}};qe();var Me=function(Vl){Wl[lt]&&console.info("Redefining LocalForage driver: "+lt),Wl[lt]=B,Fg[lt]=Vl,it()};"_support"in B?B._support&&typeof B._support=="function"?B._support().then(Me,rt):Me(!!B._support):Me(!0)}catch(ds){rt(ds)}});return p(G,$,Y),G},O.prototype.driver=function(){return this._driver||null},O.prototype.getDriver=function(B,$,Y){var G=Wl[B]?c.resolve(Wl[B]):c.reject(new Error("Driver not found."));return p(G,$,Y),G},O.prototype.getSerializer=function(B){var $=c.resolve(nt);return p($,B),$},O.prototype.ready=function(B){var $=this,Y=$._driverSet.then(function(){return $._ready===null&&($._ready=$._initDriver()),$._ready});return p(Y,B,B),Y},O.prototype.setDriver=function(B,$,Y){var G=this;Mg(B)||(B=[B]);var it=this._getSupportedDrivers(B);function rt(){G._config.driver=G.driver()}function lt(St){return G._extend(St),rt(),G._ready=G._initStorage(G._config),G._ready}function ht(St){return function(){var $t=0;function he(){for(;$t<St.length;){var ce=St[$t];return $t++,G._dbInfo=null,G._ready=null,G.getDriver(ce).then(lt).catch(he)}rt();var qe=new Error("No available storage method found.");return G._driverSet=c.reject(qe),G._driverSet}return he()}}var dt=this._driverSet!==null?this._driverSet.catch(function(){return c.resolve()}):c.resolve();return this._driverSet=dt.then(function(){var St=it[0];return G._dbInfo=null,G._ready=null,G.getDriver(St).then(function($t){G._driver=$t._driver,rt(),G._wrapLibraryMethodsWithReady(),G._initDriver=ht(it)})}).catch(function(){rt();var St=new Error("No available storage method found.");return G._driverSet=c.reject(St),G._driverSet}),p(this._driverSet,$,Y),this._driverSet},O.prototype.supports=function(B){return!!Fg[B]},O.prototype._extend=function(B){Fd(this,B)},O.prototype._getSupportedDrivers=function(B){for(var $=[],Y=0,G=B.length;Y<G;Y++){var it=B[Y];this.supports(it)&&$.push(it)}return $},O.prototype._wrapLibraryMethodsWithReady=function(){for(var B=0,$=Md.length;B<$;B++)qb(this,Md[B])},O.prototype.createInstance=function(B){return new O(B)},O}(),Wb=new jb;i.exports=Wb},{3:3}]},{},[4])(4)})}(kf)),kf.exports}var Cw=Sw();const Bm=jl(Cw);class Lv{constructor(t,e,i){this.urlCache={},this.storage=void 0,this.name=t,this.requester=e||wh,this.resolver=i,this.online=!0,this.checkRequirements(),this.addListeners()}checkRequirements(){try{let t;typeof Bm>"u"&&(t=Bm),this.storage=t.createInstance({name:this.name})}catch{throw new Error("localForage lib not loaded")}}addListeners(){this._status=this.status.bind(this),window.addEventListener("online",this._status),window.addEventListener("offline",this._status)}removeListeners(){window.removeEventListener("online",this._status),window.removeEventListener("offline",this._status),this._status=void 0}status(t){let e=navigator.onLine;this.online=e,e?this.emit("online",this):this.emit("offline",this)}add(t,e){let i=t.resources.map(s=>{let{href:n}=s,r=this.resolver(n),a=window.encodeURIComponent(r);return this.storage.getItem(a).then(o=>!o||e?this.requester(r,"binary").then(h=>this.storage.setItem(a,h)):o)});return Promise.all(i)}put(t,e,i){let s=window.encodeURIComponent(t);return this.storage.getItem(s).then(n=>n||this.requester(t,"binary",e,i).then(r=>this.storage.setItem(s,r)))}request(t,e,i,s){return this.online?this.requester(t,e,i,s).then(n=>(this.put(t),n)):this.retrieve(t,e)}retrieve(t,e){new te;var i,s=new ir(t);return e||(e=s.extension),e=="blob"?i=this.getBlob(t):i=this.getText(t),i.then(n=>{var r=new te,a;return n?(a=this.handleResponse(n,e),r.resolve(a)):r.reject({message:"File not found in storage: "+t,stack:new Error().stack}),r.promise})}handleResponse(t,e){var i;return e=="json"?i=JSON.parse(t):yh(e)?i=pn(t,"text/xml"):e=="xhtml"?i=pn(t,"application/xhtml+xml"):e=="html"||e=="htm"?i=pn(t,"text/html"):i=t,i}getBlob(t,e){let i=window.encodeURIComponent(t);return this.storage.getItem(i).then(function(s){if(s)return e=e||Lo.lookup(t),new Blob([s],{type:e})})}getText(t,e){let i=window.encodeURIComponent(t);return e=e||Lo.lookup(t),this.storage.getItem(i).then(function(s){var n=new te,r=new FileReader,a;if(s)return a=new Blob([s],{type:e}),r.addEventListener("loadend",()=>{n.resolve(r.result)}),r.readAsText(a,e),n.promise})}getBase64(t,e){let i=window.encodeURIComponent(t);return e=e||Lo.lookup(t),this.storage.getItem(i).then(s=>{var n=new te,r=new FileReader,a;if(s)return a=new Blob([s],{type:e}),r.addEventListener("loadend",()=>{n.resolve(r.result)}),r.readAsDataURL(a,e),n.promise})}createUrl(t,e){var i=new te,s=window.URL||window.webkitURL||window.mozURL,n,r,a=e&&e.base64;return t in this.urlCache?(i.resolve(this.urlCache[t]),i.promise):(a?(r=this.getBase64(t),r&&r.then((function(o){this.urlCache[t]=o,i.resolve(o)}).bind(this))):(r=this.getBlob(t),r&&r.then((function(o){n=s.createObjectURL(o),this.urlCache[t]=n,i.resolve(n)}).bind(this))),r||i.reject({message:"File not found in storage: "+t,stack:new Error().stack}),i.promise)}revokeUrl(t){var e=window.URL||window.webkitURL||window.mozURL,i=this.urlCache[t];i&&e.revokeObjectURL(i)}destroy(){var t=window.URL||window.webkitURL||window.mozURL;for(let e in this.urlCache)t.revokeObjectURL(e);this.urlCache={},this.removeListeners()}}mn(Lv.prototype);class Rf{constructor(t){this.interactive="",this.fixedLayout="",this.openToSpread="",this.orientationLock="",t&&this.parse(t)}parse(t){if(!t)return this;const e=be(t,"display_options");return e?(er(e,"option").forEach(s=>{let n="";switch(s.childNodes.length&&(n=s.childNodes[0].nodeValue),s.attributes.name.value){case"interactive":this.interactive=n;break;case"fixed-layout":this.fixedLayout=n;break;case"open-to-spread":this.openToSpread=n;break;case"orientation-lock":this.orientationLock=n;break}}),this):this}destroy(){this.interactive=void 0,this.fixedLayout=void 0,this.openToSpread=void 0,this.orientationLock=void 0}}const zm="META-INF/container.xml",Tw="META-INF/com.apple.ibooks.display-options.xml",ks={BINARY:"binary",BASE64:"base64",EPUB:"epub",OPF:"opf",MANIFEST:"json",DIRECTORY:"directory"};class vg{constructor(t,e){typeof e>"u"&&typeof t!="string"&&!(t instanceof Blob)&&!(t instanceof ArrayBuffer)&&(e=t,t=void 0),this.settings=yi(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0,canonical:void 0,openAs:void 0,store:void 0}),yi(this.settings,e),this.opening=new te,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new te,spine:new te,metadata:new te,cover:new te,navigation:new te,pageList:new te,resources:new te,displayOptions:new te},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise,displayOptions:this.loading.displayOptions.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources,this.loaded.displayOptions]),this.isRendered=!1,this.request=this.settings.requestMethod||wh,this.spine=new Hy,this.locations=new Sv(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.storage=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,this.displayOptions=void 0,this.settings.store&&this.store(this.settings.store),t&&this.open(t,this.settings.openAs).catch(i=>{var s=new Error("Cannot load book at "+t);this.emit(mt.BOOK.OPEN_FAILED,s)})}open(t,e){var i,s=e||this.determineType(t);return s===ks.BINARY?(this.archived=!0,this.url=new Is("/",""),i=this.openEpub(t)):s===ks.BASE64?(this.archived=!0,this.url=new Is("/",""),i=this.openEpub(t,s)):s===ks.EPUB?(this.archived=!0,this.url=new Is("/",""),i=this.request(t,"binary",this.settings.requestCredentials,this.settings.requestHeaders).then(this.openEpub.bind(this))):s==ks.OPF?(this.url=new Is(t),i=this.openPackaging(this.url.Path.toString())):s==ks.MANIFEST?(this.url=new Is(t),i=this.openManifest(this.url.Path.toString())):(this.url=new Is(t),i=this.openContainer(zm).then(this.openPackaging.bind(this))),i}openEpub(t,e){return this.unarchive(t,e||this.settings.encoding).then(()=>this.openContainer(zm)).then(i=>this.openPackaging(i))}openContainer(t){return this.load(t).then(e=>(this.container=new qy(e),this.resolve(this.container.packagePath)))}openPackaging(t){return this.path=new ir(t),this.load(t).then(e=>(this.packaging=new mm(e),this.unpack(this.packaging)))}openManifest(t){return this.path=new ir(t),this.load(t).then(e=>(this.packaging=new mm,this.packaging.load(e),this.unpack(this.packaging)))}load(t){var e=this.resolve(t);return this.archived?this.archive.request(e):this.request(e,null,this.settings.requestCredentials,this.settings.requestHeaders)}resolve(t,e){if(t){var i=t,s=t.indexOf("://")>-1;return s?t:(this.path&&(i=this.path.resolve(t)),e!=!1&&this.url&&(i=this.url.resolve(i)),i)}}canonical(t){var e=t;return t?(this.settings.canonical?e=this.settings.canonical(t):e=this.resolve(t,!0),e):""}determineType(t){var e,i,s;if(this.settings.encoding==="base64")return ks.BASE64;if(typeof t!="string")return ks.BINARY;if(e=new Is(t),i=e.path(),s=i.extension,s&&(s=s.replace(/\?.*$/,"")),!s)return ks.DIRECTORY;if(s==="epub")return ks.EPUB;if(s==="opf")return ks.OPF;if(s==="json")return ks.MANIFEST}unpack(t){this.package=t,this.packaging.metadata.layout===""?this.load(this.url.resolve(Tw)).then(e=>{this.displayOptions=new Rf(e),this.loading.displayOptions.resolve(this.displayOptions)}).catch(e=>{this.displayOptions=new Rf,this.loading.displayOptions.resolve(this.displayOptions)}):(this.displayOptions=new Rf,this.loading.displayOptions.resolve(this.displayOptions)),this.spine.unpack(this.packaging,this.resolve.bind(this),this.canonical.bind(this)),this.resources=new Gy(this.packaging.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||(this.archived?"blobUrl":"base64")}),this.loadNavigation(this.packaging).then(()=>{this.loading.navigation.resolve(this.navigation)}),this.packaging.coverPath&&(this.cover=this.resolve(this.packaging.coverPath)),this.loading.manifest.resolve(this.packaging.manifest),this.loading.metadata.resolve(this.packaging.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&this.settings.replacements!="none"?this.replacements().then(()=>{this.loaded.displayOptions.then(()=>{this.opening.resolve(this)})}).catch(e=>{console.error(e)}):this.loaded.displayOptions.then(()=>{this.opening.resolve(this)})}loadNavigation(t){let e=t.navPath||t.ncxPath,i=t.toc;return i?new Promise((s,n)=>{this.navigation=new cf(i),t.pageList&&(this.pageList=new df(t.pageList)),s(this.navigation)}):e?this.load(e,"xml").then(s=>(this.navigation=new cf(s),this.pageList=new df(s),this.navigation)):new Promise((s,n)=>{this.navigation=new cf,this.pageList=new df,s(this.navigation)})}section(t){return this.spine.get(t)}renderTo(t,e){return this.rendition=new mg(this,e),this.rendition.attachTo(t),this.rendition}setRequestCredentials(t){this.settings.requestCredentials=t}setRequestHeaders(t){this.settings.requestHeaders=t}unarchive(t,e){return this.archive=new xw,this.archive.open(t,e)}store(t){let e=this.settings.replacements&&this.settings.replacements!=="none",i=this.url,s=this.settings.requestMethod||wh.bind(this);return this.storage=new Lv(t,s,this.resolve.bind(this)),this.request=this.storage.request.bind(this.storage),this.opened.then(()=>{this.archived&&(this.storage.requester=this.archive.request.bind(this.archive));let n=(r,a)=>{a.output=this.resources.substitute(r,a.url)};this.resources.settings.replacements=e||"blobUrl",this.resources.replacements().then(()=>this.resources.replaceCss()),this.storage.on("offline",()=>{this.url=new Is("/",""),this.spine.hooks.serialize.register(n)}),this.storage.on("online",()=>{this.url=i,this.spine.hooks.serialize.deregister(n)})}),this.storage}coverUrl(){return this.loaded.cover.then(()=>this.cover?this.archived?this.archive.createUrl(this.cover):this.cover:null)}replacements(){return this.spine.hooks.serialize.register((t,e)=>{e.output=this.resources.substitute(t,e.url)}),this.resources.replacements().then(()=>this.resources.replaceCss())}getRange(t){var e=new ee(t),i=this.spine.get(e.spinePos),s=this.load.bind(this);return i?i.load(s).then(function(n){var r=e.toRange(i.document);return r}):new Promise((n,r)=>{r("CFI could not be found")})}key(t){var e=t||this.packaging.metadata.identifier||this.url.filename;return`epubjs:${kd}:${e}`}destroy(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.displayOptions&&this.displayOptions.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1}}mn(vg.prototype);function uo(d,t){return new vg(d,t)}uo.VERSION=kd;typeof global<"u"&&(global.EPUBJS_VERSION=kd);uo.Book=vg;uo.Rendition=mg;uo.Contents=pg;uo.CFI=ee;uo.utils=Ly;var bh={};bh.d=(d,t)=>{for(var e in t)bh.o(t,e)&&!bh.o(d,e)&&Object.defineProperty(d,e,{enumerable:!0,get:t[e]})};bh.o=(d,t)=>Object.prototype.hasOwnProperty.call(d,t);var Nt=globalThis.pdfjsLib={};bh.d(Nt,{AbortException:()=>Vr,AnnotationEditorLayer:()=>sg,AnnotationEditorParamsType:()=>Qt,AnnotationEditorType:()=>Bt,AnnotationEditorUIManager:()=>lo,AnnotationLayer:()=>Np,AnnotationMode:()=>ar,AnnotationType:()=>We,ColorPicker:()=>rd,DOMSVGFactory:()=>sd,DrawLayer:()=>ag,FeatureTest:()=>wi,GlobalWorkerOptions:()=>Zn,ImageKind:()=>pc,InvalidPDFException:()=>Gf,MathClamp:()=>Oi,OPS:()=>Qc,OutputScale:()=>sr,PDFDataRangeTransport:()=>M0,PDFDateString:()=>Ag,PDFWorker:()=>Oo,PasswordResponses:()=>Rw,PermissionFlag:()=>kw,PixelsPerInch:()=>Gr,RenderingCancelledException:()=>wg,ResponseException:()=>td,SignatureExtractor:()=>Jn,SupportedImageMimeTypes:()=>Xf,TextLayer:()=>_h,TouchManager:()=>id,Util:()=>Et,VerbosityLevel:()=>Rd,XfaLayer:()=>B0,build:()=>J2,createValidAbsoluteUrl:()=>Pw,fetchData:()=>$u,getDocument:()=>H2,getFilenameFromUrl:()=>jw,getPdfFilenameFromUrl:()=>Ww,getUuid:()=>Mv,getXfaPageViewport:()=>Vw,isDataScheme:()=>Ld,isPdfFile:()=>_g,isValidExplicitDest:()=>V2,noContextMenu:()=>Gs,normalizeUnicode:()=>Uw,setLayerDimensions:()=>oo,shadow:()=>Zt,stopEvent:()=>Ve,version:()=>Z2});const gi=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Pv=[1,0,0,1,0,0],Vf=[.001,0,0,.001,0,0],If=1.35,os={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},ar={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Dw="pdfjs_internal_editor_",Bt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},Qt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},kw={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},_i={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},pc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},We={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Eo={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Rd={ERRORS:0,WARNINGS:1,INFOS:5},Qc={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},rc={moveTo:0,lineTo:1,curveTo:2,closePath:3},Rw={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Id=Rd.WARNINGS;function Iw(d){Number.isInteger(d)&&(Id=d)}function Nw(){return Id}function Nd(d){Id>=Rd.INFOS&&console.log(`Info: ${d}`)}function Ht(d){Id>=Rd.WARNINGS&&console.log(`Warning: ${d}`)}function me(d){throw new Error(d)}function Ge(d,t){d||me(t)}function Lw(d){switch(d==null?void 0:d.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Pw(d,t=null,e=null){if(!d)return null;if(e&&typeof d=="string"){if(e.addDefaultProtocol&&d.startsWith("www.")){const s=d.match(/\./g);(s==null?void 0:s.length)>=2&&(d=`http://${d}`)}if(e.tryConvertEncoding)try{d=zw(d)}catch{}}const i=t?URL.parse(d,t):URL.parse(d);return Lw(i)?i:null}function Zt(d,t,e,i=!1){return Object.defineProperty(d,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}const co=function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t}();class Um extends co{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Nf extends co{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Gf extends co{constructor(t){super(t,"InvalidPDFException")}}class td extends co{constructor(t,e,i){super(t,"ResponseException"),this.status=e,this.missing=i}}class Ow extends co{constructor(t){super(t,"FormatError")}}class Vr extends co{constructor(t){super(t,"AbortException")}}function Ov(d){(typeof d!="object"||(d==null?void 0:d.length)===void 0)&&me("Invalid argument for bytesToString");const t=d.length,e=8192;if(t<e)return String.fromCharCode.apply(null,d);const i=[];for(let s=0;s<t;s+=e){const n=Math.min(s+e,t),r=d.subarray(s,n);i.push(String.fromCharCode.apply(null,r))}return i.join("")}function Gu(d){typeof d!="string"&&me("Invalid argument for stringToBytes");const t=d.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=d.charCodeAt(i)&255;return e}function Mw(d){return String.fromCharCode(d>>24&255,d>>16&255,d>>8&255,d&255)}function bg(d){const t=Object.create(null);for(const[e,i]of d)t[e]=i;return t}function Fw(){const d=new Uint8Array(4);return d[0]=1,new Uint32Array(d.buffer,0,1)[0]===1}function Bw(){try{return new Function(""),!0}catch{return!1}}class wi{static get isLittleEndian(){return Zt(this,"isLittleEndian",Fw())}static get isEvalSupported(){return Zt(this,"isEvalSupported",Bw())}static get isOffscreenCanvasSupported(){return Zt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Zt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){if(typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"){const{platform:t,userAgent:e}=navigator;return Zt(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}return Zt(this,"platform",{isAndroid:!1,isLinux:!1,isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var t,e;return Zt(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const Lf=Array.from(Array(256).keys(),d=>d.toString(16).padStart(2,"0"));var Qn,gc,$f;class Et{static makeHexColor(t,e,i){return`#${Lf[t]}${Lf[e]}${Lf[i]}`}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){const i=t[0]*e[0]+t[1]*e[2]+e[4],s=t[0]*e[1]+t[1]*e[3]+e[5];return[i,s]}static applyInverseTransform(t,e){const i=e[0]*e[3]-e[1]*e[2],s=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,n=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i;return[s,n]}static getAxialAlignedBoundingBox(t,e){const i=this.applyTransform(t,e),s=this.applyTransform(t.slice(2,4),e),n=this.applyTransform([t[0],t[3]],e),r=this.applyTransform([t[2],t[1]],e);return[Math.min(i[0],s[0],n[0],r[0]),Math.min(i[1],s[1],n[1],r[1]),Math.max(i[0],s[0],n[0],r[0]),Math.max(i[1],s[1],n[1],r[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],s=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],r=t[2]*e[1]+t[3]*e[3],a=(i+r)/2,o=Math.sqrt((i+r)**2-4*(i*r-n*s))/2,h=a+o||1,u=a-o||1;return[Math.sqrt(h),Math.sqrt(u)]}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>s)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>r?null:[i,n,s,r]}static pointBoundingBox(t,e,i){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}static rectBoundingBox(t,e,i,s,n){n[0]=Math.min(n[0],t,i),n[1]=Math.min(n[1],e,s),n[2]=Math.max(n[2],t,i),n[3]=Math.max(n[3],e,s)}static bezierBoundingBox(t,e,i,s,n,r,a,o,h){h[0]=Math.min(h[0],t,a),h[1]=Math.min(h[1],e,o),h[2]=Math.max(h[2],t,a),h[3]=Math.max(h[3],e,o),k(this,Qn,$f).call(this,t,i,n,a,e,s,r,o,3*(-t+3*(i-n)+a),6*(t-2*i+n),3*(i-t),h),k(this,Qn,$f).call(this,t,i,n,a,e,s,r,o,3*(-e+3*(s-r)+o),6*(e-2*s+r),3*(s-e),h)}}Qn=new WeakSet,gc=function(t,e,i,s,n,r,a,o,h,u){if(h<=0||h>=1)return;const c=1-h,f=h*h,p=f*h,_=c*(c*(c*t+3*h*e)+3*f*i)+p*s,v=c*(c*(c*n+3*h*r)+3*f*a)+p*o;u[0]=Math.min(u[0],_),u[1]=Math.min(u[1],v),u[2]=Math.max(u[2],_),u[3]=Math.max(u[3],v)},$f=function(t,e,i,s,n,r,a,o,h,u,c,f){if(Math.abs(h)<1e-12){Math.abs(u)>=1e-12&&k(this,Qn,gc).call(this,t,e,i,s,n,r,a,o,-c/u,f);return}const p=u**2-4*c*h;if(p<0)return;const _=Math.sqrt(p),v=2*h;k(this,Qn,gc).call(this,t,e,i,s,n,r,a,o,(-u+_)/v,f),k(this,Qn,gc).call(this,t,e,i,s,n,r,a,o,(-u-_)/v,f)},D(Et,Qn);function zw(d){return decodeURIComponent(escape(d))}let Pf=null,Hm=null;function Uw(d){return Pf||(Pf=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Hm=new Map([["ﬅ","ſt"]])),d.replaceAll(Pf,(t,e,i)=>e?e.normalize("NFKC"):Hm.get(i))}function Mv(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const d=new Uint8Array(32);return crypto.getRandomValues(d),Ov(d)}const yg="pdfjs_internal_id_";function Hw(d,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[i,s,...n]=e;if(!d(i)&&!Number.isInteger(i)||!t(s))return!1;const r=n.length;let a=!0;switch(s.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;a=!1;break;default:return!1}for(const o of n)if(!(typeof o=="number"||a&&o===null))return!1;return!0}function Oi(d,t,e){return Math.min(Math.max(d,t),e)}function Fv(d){return Uint8Array.prototype.toBase64?d.toBase64():btoa(Ov(d))}function qw(d){return Uint8Array.fromBase64?Uint8Array.fromBase64(d):Gu(atob(d))}typeof Promise.try!="function"&&(Promise.try=function(d,...t){return new Promise(e=>{e(d(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(d){return d.reduce((t,e)=>t+e,0)});const yn="http://www.w3.org/2000/svg",Qr=class Qr{};At(Qr,"CSS",96),At(Qr,"PDF",72),At(Qr,"PDF_TO_CSS_UNITS",Qr.CSS/Qr.PDF);let Gr=Qr;async function $u(d,t="text"){if(xo(d,document.baseURI)){const e=await fetch(d);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{const s=new XMLHttpRequest;s.open("GET",d,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})}class Xu{constructor({viewBox:t,userUnit:e,scale:i,rotation:s,offsetX:n=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=i,this.rotation=s,this.offsetX=n,this.offsetY=r,i*=e;const o=(t[2]+t[0])/2,h=(t[3]+t[1])/2;let u,c,f,p;switch(s%=360,s<0&&(s+=360),s){case 180:u=-1,c=0,f=0,p=1;break;case 90:u=0,c=1,f=1,p=0;break;case 270:u=0,c=-1,f=-1,p=0;break;case 0:u=1,c=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(f=-f,p=-p);let _,v,g,b;u===0?(_=Math.abs(h-t[1])*i+n,v=Math.abs(o-t[0])*i+r,g=(t[3]-t[1])*i,b=(t[2]-t[0])*i):(_=Math.abs(o-t[0])*i+n,v=Math.abs(h-t[1])*i+r,g=(t[2]-t[0])*i,b=(t[3]-t[1])*i),this.transform=[u*i,c*i,f*i,p*i,_-u*i*o-f*i*h,v-c*i*o-p*i*h],this.width=g,this.height=b}get rawDims(){const t=this.viewBox;return Zt(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new Xu({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(t,e){return Et.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=Et.applyTransform([t[0],t[1]],this.transform),i=Et.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){return Et.applyInverseTransform([t,e],this.transform)}}class wg extends co{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Ld(d){const t=d.length;let e=0;for(;e<t&&d[e].trim()==="";)e++;return d.substring(e,e+5).toLowerCase()==="data:"}function _g(d){return typeof d=="string"&&/\.pdf$/i.test(d)}function jw(d){return[d]=d.split(/[#?]/,1),d.substring(d.lastIndexOf("/")+1)}function Ww(d,t="document.pdf"){if(typeof d!="string")return t;if(Ld(d))return Ht('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=e.exec(d);let n=i.exec(s[1])||i.exec(s[2])||i.exec(s[3]);if(n&&(n=n[0],n.includes("%")))try{n=i.exec(decodeURIComponent(n))[0]}catch{}return n||t}class qm{constructor(){At(this,"started",Object.create(null));At(this,"times",[])}time(t){t in this.started&&Ht(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||Ht(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:i}of this.times)e=Math.max(i.length,e);for(const{name:i,start:s,end:n}of this.times)t.push(`${i.padEnd(e)} ${n-s}ms
`);return t.join("")}}function xo(d,t){const e=t?URL.parse(d,t):URL.parse(d);return(e==null?void 0:e.protocol)==="http:"||(e==null?void 0:e.protocol)==="https:"}function Gs(d){d.preventDefault()}function Ve(d){d.preventDefault(),d.stopPropagation()}var Eh;class Ag{static toDateObject(t){if(!t||typeof t!="string")return null;l(this,Eh)||x(this,Eh,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=l(this,Eh).exec(t);if(!e)return null;const i=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let o=parseInt(e[6],10);o=o>=0&&o<=59?o:0;const h=e[7]||"Z";let u=parseInt(e[8],10);u=u>=0&&u<=23?u:0;let c=parseInt(e[9],10)||0;return c=c>=0&&c<=59?c:0,h==="-"?(r+=u,a+=c):h==="+"&&(r-=u,a-=c),new Date(Date.UTC(i,s,n,r,a,o))}}Eh=new WeakMap,D(Ag,Eh);function Vw(d,{scale:t=1,rotation:e=0}){const{width:i,height:s}=d.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new Xu({viewBox:n,userUnit:1,scale:t,rotation:e})}function Eg(d){if(d.startsWith("#")){const t=parseInt(d.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return d.startsWith("rgb(")?d.slice(4,-1).split(",").map(t=>parseInt(t)):d.startsWith("rgba(")?d.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(Ht(`Not a valid color format: "${d}"`),[0,0,0])}function Gw(d){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const e of d.keys()){t.style.color=e;const i=window.getComputedStyle(t).color;d.set(e,Eg(i))}t.remove()}function xe(d){const{a:t,b:e,c:i,d:s,e:n,f:r}=d.getTransform();return[t,e,i,s,n,r]}function Xs(d){const{a:t,b:e,c:i,d:s,e:n,f:r}=d.getTransform().invertSelf();return[t,e,i,s,n,r]}function oo(d,t,e=!1,i=!0){if(t instanceof Xu){const{pageWidth:s,pageHeight:n}=t.rawDims,{style:r}=d,a=wi.isCSSRoundSupported,o=`var(--total-scale-factor) * ${s}px`,h=`var(--total-scale-factor) * ${n}px`,u=a?`round(down, ${o}, var(--scale-round-x))`:`calc(${o})`,c=a?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!e||t.rotation%180===0?(r.width=u,r.height=c):(r.width=c,r.height=u)}i&&d.setAttribute("data-main-rotation",t.rotation)}class sr{constructor(){const{pixelRatio:t}=sr;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,i,s){let n=1/0,r=1/0,a=1/0;i>0&&(n=Math.sqrt(i/(t*e))),s!==-1&&(r=s/t,a=s/e);const o=Math.min(n,r,a);return this.sx>o||this.sy>o?(this.sx=o,this.sy=o,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}}const Xf=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var or,ea,gs,lr,xh,Mo,Sh,ld,Bv,bi,zv,Uv,eh,Hv,mc;const An=class An{constructor(t){D(this,bi);D(this,or,null);D(this,ea,null);D(this,gs);D(this,lr,null);D(this,xh,null);D(this,Mo,null);x(this,gs,t),l(An,Sh)||x(An,Sh,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const t=x(this,or,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=l(this,gs)._uiManager._signal;t.addEventListener("contextmenu",Gs,{signal:e}),t.addEventListener("pointerdown",k(An,ld,Bv),{signal:e});const i=x(this,lr,document.createElement("div"));i.className="buttons",t.append(i);const s=l(this,gs).toolbarPosition;if(s){const{style:n}=t,r=l(this,gs)._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return k(this,bi,Hv).call(this),t}get div(){return l(this,or)}hide(){var t;l(this,or).classList.add("hidden"),(t=l(this,ea))==null||t.hideDropdown()}show(){var t;l(this,or).classList.remove("hidden"),(t=l(this,xh))==null||t.shown()}async addAltText(t){const e=await t.render();k(this,bi,eh).call(this,e),l(this,lr).prepend(e,l(this,bi,mc)),x(this,xh,t)}addColorPicker(t){x(this,ea,t);const e=t.renderButton();k(this,bi,eh).call(this,e),l(this,lr).prepend(e,l(this,bi,mc))}async addEditSignatureButton(t){const e=x(this,Mo,await t.renderEditButton(l(this,gs)));k(this,bi,eh).call(this,e),l(this,lr).prepend(e,l(this,bi,mc))}updateEditSignatureButton(t){l(this,Mo)&&(l(this,Mo).title=t)}remove(){var t;l(this,or).remove(),(t=l(this,ea))==null||t.destroy(),x(this,ea,null)}};or=new WeakMap,ea=new WeakMap,gs=new WeakMap,lr=new WeakMap,xh=new WeakMap,Mo=new WeakMap,Sh=new WeakMap,ld=new WeakSet,Bv=function(t){t.stopPropagation()},bi=new WeakSet,zv=function(t){l(this,gs)._focusEventsAllowed=!1,Ve(t)},Uv=function(t){l(this,gs)._focusEventsAllowed=!0,Ve(t)},eh=function(t){const e=l(this,gs)._uiManager._signal;t.addEventListener("focusin",k(this,bi,zv).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",k(this,bi,Uv).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Gs,{signal:e})},Hv=function(){const{editorType:t,_uiManager:e}=l(this,gs),i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",l(An,Sh)[t]),k(this,bi,eh).call(this,i),i.addEventListener("click",s=>{e.delete()},{signal:e._signal}),l(this,lr).append(i)},mc=function(){const t=document.createElement("div");return t.className="divider",t},D(An,ld),D(An,Sh,null);let Yf=An;var Ch,ia,sa,$r,qv,jv,Wv;class $w{constructor(t){D(this,$r);D(this,Ch,null);D(this,ia,null);D(this,sa);x(this,sa,t)}show(t,e,i){const[s,n]=k(this,$r,jv).call(this,e,i),{style:r}=l(this,ia)||x(this,ia,k(this,$r,qv).call(this));t.append(l(this,ia)),r.insetInlineEnd=`${100*s}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){l(this,ia).remove()}}Ch=new WeakMap,ia=new WeakMap,sa=new WeakMap,$r=new WeakSet,qv=function(){const t=x(this,ia,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",Gs,{signal:l(this,sa)._signal});const e=x(this,Ch,document.createElement("div"));return e.className="buttons",t.append(e),k(this,$r,Wv).call(this),t},jv=function(t,e){let i=0,s=0;for(const n of t){const r=n.y+n.height;if(r<i)continue;const a=n.x+(e?n.width:0);if(r>i){s=a,i=r;continue}e?a>s&&(s=a):a<s&&(s=a)}return[e?1-s:s,i]},Wv=function(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=l(this,sa)._signal;t.addEventListener("contextmenu",Gs,{signal:i}),t.addEventListener("click",()=>{l(this,sa).highlightSelection("floating_button")},{signal:i}),l(this,Ch).append(t)};function xg(d,t,e){for(const i of e)t.addEventListener(i,d[i].bind(d))}var hd;class Xw{constructor(){D(this,hd,0)}get id(){return`${Dw}${ki(this,hd)._++}`}}hd=new WeakMap;var Fo,Th,Ei,Bo,vc;const Ig=class Ig{constructor(){D(this,Bo);D(this,Fo,Mv());D(this,Th,0);D(this,Ei,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return Zt(this,"_isSVGFittingCanvas",n)}async getFromFile(t){const{lastModified:e,name:i,size:s,type:n}=t;return k(this,Bo,vc).call(this,`${e}_${i}_${s}_${n}`,t)}async getFromUrl(t){return k(this,Bo,vc).call(this,t,t)}async getFromBlob(t,e){const i=await e;return k(this,Bo,vc).call(this,t,i)}async getFromId(t){l(this,Ei)||x(this,Ei,new Map);const e=l(this,Ei).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)}getFromCanvas(t,e){l(this,Ei)||x(this,Ei,new Map);let i=l(this,Ei).get(t);if(i!=null&&i.bitmap)return i.refCounter+=1,i;const s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${l(this,Fo)}_${ki(this,Th)._++}`,refCounter:1,isSvg:!1},l(this,Ei).set(t,i),l(this,Ei).set(i.id,i),i}getSvgUrl(t){const e=l(this,Ei).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var s;l(this,Ei)||x(this,Ei,new Map);const e=l(this,Ei).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:i}=e;if(!e.url&&!e.file){const n=new OffscreenCanvas(i.width,i.height);n.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=n.convertToBlob()}(s=i.close)==null||s.call(i),e.bitmap=null}isValidId(t){return t.startsWith(`image_${l(this,Fo)}_`)}};Fo=new WeakMap,Th=new WeakMap,Ei=new WeakMap,Bo=new WeakSet,vc=async function(t,e){l(this,Ei)||x(this,Ei,new Map);let i=l(this,Ei).get(t);if(i===null)return null;if(i!=null&&i.bitmap)return i.refCounter+=1,i;try{i||(i={bitmap:null,id:`image_${l(this,Fo)}_${ki(this,Th)._++}`,refCounter:0,isSvg:!1});let s;if(typeof e=="string"?(i.url=e,s=await $u(e,"blob")):e instanceof File?s=i.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){const n=Ig._isSVGFittingCanvas,r=new FileReader,a=new Image,o=new Promise((h,u)=>{a.onload=()=>{i.bitmap=a,i.isSvg=!0,h()},r.onload=async()=>{const c=i.svgUrl=r.result;a.src=await n?`${c}#svgView(preserveAspectRatio(none))`:c},a.onerror=r.onerror=u});r.readAsDataURL(s),await o}else i.bitmap=await createImageBitmap(s);i.refCounter=1}catch(s){Ht(s),i=null}return l(this,Ei).set(t,i),i&&l(this,Ei).set(i.id,i),i};let Kf=Ig;var Fe,hr,Dh,De;class Yw{constructor(t=128){D(this,Fe,[]);D(this,hr,!1);D(this,Dh);D(this,De,-1);x(this,Dh,t)}add({cmd:t,undo:e,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(s&&t(),l(this,hr))return;const o={cmd:t,undo:e,post:i,type:n};if(l(this,De)===-1){l(this,Fe).length>0&&(l(this,Fe).length=0),x(this,De,0),l(this,Fe).push(o);return}if(r&&l(this,Fe)[l(this,De)].type===n){a&&(o.undo=l(this,Fe)[l(this,De)].undo),l(this,Fe)[l(this,De)]=o;return}const h=l(this,De)+1;h===l(this,Dh)?l(this,Fe).splice(0,1):(x(this,De,h),h<l(this,Fe).length&&l(this,Fe).splice(h)),l(this,Fe).push(o)}undo(){if(l(this,De)===-1)return;x(this,hr,!0);const{undo:t,post:e}=l(this,Fe)[l(this,De)];t(),e==null||e(),x(this,hr,!1),x(this,De,l(this,De)-1)}redo(){if(l(this,De)<l(this,Fe).length-1){x(this,De,l(this,De)+1),x(this,hr,!0);const{cmd:t,post:e}=l(this,Fe)[l(this,De)];t(),e==null||e(),x(this,hr,!1)}}hasSomethingToUndo(){return l(this,De)!==-1}hasSomethingToRedo(){return l(this,De)<l(this,Fe).length-1}cleanType(t){if(l(this,De)!==-1){for(let e=l(this,De);e>=0;e--)if(l(this,Fe)[e].type!==t){l(this,Fe).splice(e+1,l(this,De)-e),x(this,De,e);return}l(this,Fe).length=0,x(this,De,-1)}}destroy(){x(this,Fe,null)}}Fe=new WeakMap,hr=new WeakMap,Dh=new WeakMap,De=new WeakMap;var ud,Vv;class Yu{constructor(t){D(this,ud);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=wi.platform;for(const[i,s,n={}]of t)for(const r of i){const a=r.startsWith("mac+");e&&a?(this.callbacks.set(r.slice(4),{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1))):!e&&!a&&(this.callbacks.set(r,{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const i=this.callbacks.get(k(this,ud,Vv).call(this,e));if(!i)return;const{callback:s,options:{bubbles:n=!1,args:r=[],checker:a=null}}=i;a&&!a(t,e)||(s.bind(t,...r,e)(),n||Ve(e))}}ud=new WeakSet,Vv=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e};const cd=class cd{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return Gw(t),Zt(this,"_colors",t)}convert(t){const e=Eg(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[i,s]of this._colors)if(s.every((n,r)=>n===e[r]))return cd._colorsMapping.get(i);return e}getHexCode(t){const e=this._colors.get(t);return e?Et.makeHexColor(...e):t}};At(cd,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Zf=cd;var zo,Xi,Je,ci,Uo,xn,Ho,ms,ur,na,qo,ra,Zs,Ns,aa,kh,Rh,jo,Ih,Js,cr,Wo,dr,Qs,dd,fr,Nh,pr,oa,la,gr,Lh,ii,de,Sn,mr,ha,Ph,Oh,vr,tn,Cn,Mh,vs,gt,bc,Jf,Gv,$v,yc,Xv,Yv,Kv,Qf,Zv,tp,ep,Jv,Ri,wn,Qv,t0,ip,e0,ih,sp;const Io=class Io{constructor(t,e,i,s,n,r,a,o,h,u,c,f,p,_){D(this,gt);D(this,zo,new AbortController);D(this,Xi,null);D(this,Je,new Map);D(this,ci,new Map);D(this,Uo,null);D(this,xn,null);D(this,Ho,null);D(this,ms,new Yw);D(this,ur,null);D(this,na,null);D(this,qo,0);D(this,ra,new Set);D(this,Zs,null);D(this,Ns,null);D(this,aa,new Set);At(this,"_editorUndoBar",null);D(this,kh,!1);D(this,Rh,!1);D(this,jo,!1);D(this,Ih,null);D(this,Js,null);D(this,cr,null);D(this,Wo,null);D(this,dr,!1);D(this,Qs,null);D(this,dd,new Xw);D(this,fr,!1);D(this,Nh,!1);D(this,pr,null);D(this,oa,null);D(this,la,null);D(this,gr,null);D(this,Lh,null);D(this,ii,Bt.NONE);D(this,de,new Set);D(this,Sn,null);D(this,mr,null);D(this,ha,null);D(this,Ph,null);D(this,Oh,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});D(this,vr,[0,0]);D(this,tn,null);D(this,Cn,null);D(this,Mh,null);D(this,vs,null);const v=this._signal=l(this,zo).signal;x(this,Cn,t),x(this,Mh,e),x(this,Uo,i),x(this,mr,s),this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:v}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:v}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:v}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:v}),n._on("setpreference",this.onSetPreference.bind(this),{signal:v}),n._on("switchannotationeditorparams",g=>this.updateParams(g.type,g.value),{signal:v}),k(this,gt,Xv).call(this),k(this,gt,Jv).call(this),k(this,gt,Qf).call(this),x(this,xn,r.annotationStorage),x(this,Ih,r.filterFactory),x(this,ha,a),x(this,Wo,o||null),x(this,kh,h),x(this,Rh,u),x(this,jo,c),x(this,Lh,f||null),this.viewParameters={realScale:Gr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=_!==!1}static get _keyboardManager(){const t=Io.prototype,e=r=>l(r,Cn).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),i=(r,{target:a})=>{if(a instanceof HTMLInputElement){const{type:o}=a;return o!=="text"&&o!=="number"}return!0},s=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return Zt(this,"_keyboardManager",new Yu([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&l(r,Cn).contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&l(r,Cn).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}destroy(){var t,e,i,s,n,r,a,o;(t=l(this,vs))==null||t.resolve(),x(this,vs,null),(e=l(this,zo))==null||e.abort(),x(this,zo,null),this._signal=null;for(const h of l(this,ci).values())h.destroy();l(this,ci).clear(),l(this,Je).clear(),l(this,aa).clear(),(i=l(this,gr))==null||i.clear(),x(this,Xi,null),l(this,de).clear(),l(this,ms).destroy(),(s=l(this,Uo))==null||s.destroy(),(n=l(this,mr))==null||n.destroy(),(r=l(this,Qs))==null||r.hide(),x(this,Qs,null),(a=l(this,la))==null||a.destroy(),x(this,la,null),l(this,Js)&&(clearTimeout(l(this,Js)),x(this,Js,null)),l(this,tn)&&(clearTimeout(l(this,tn)),x(this,tn,null)),(o=this._editorUndoBar)==null||o.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return l(this,Lh)}get useNewAltTextFlow(){return l(this,Rh)}get useNewAltTextWhenAddingImage(){return l(this,jo)}get hcmFilter(){return Zt(this,"hcmFilter",l(this,ha)?l(this,Ih).addHCMFilter(l(this,ha).foreground,l(this,ha).background):"none")}get direction(){return Zt(this,"direction",getComputedStyle(l(this,Cn)).direction)}get highlightColors(){return Zt(this,"highlightColors",l(this,Wo)?new Map(l(this,Wo).split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return Zt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),x(this,na,t)}setMainHighlightColorPicker(t){x(this,la,t)}editAltText(t,e=!1){var i;(i=l(this,Uo))==null||i.editAltText(this,t,e)}getSignature(t){var e;(e=l(this,mr))==null||e.getSignature({uiManager:this,editor:t})}get signatureManager(){return l(this,mr)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":x(this,jo,e);break}}onPageChanging({pageNumber:t}){x(this,qo,t-1)}focusMainContainer(){l(this,Cn).focus()}findParent(t,e){for(const i of l(this,ci).values()){const{x:s,y:n,width:r,height:a}=i.div.getBoundingClientRect();if(t>=s&&t<=s+r&&e>=n&&e<=n+a)return i}return null}disableUserSelect(t=!1){l(this,Mh).classList.toggle("noUserSelect",t)}addShouldRescale(t){l(this,aa).add(t)}removeShouldRescale(t){l(this,aa).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*Gr.PDF_TO_CSS_UNITS;for(const i of l(this,aa))i.onScaleChanging();(e=l(this,na))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=e,a=e.toString(),h=k(this,gt,bc).call(this,e).closest(".textLayer"),u=this.getSelectionBoxes(h);if(!u)return;e.empty();const c=k(this,gt,Jf).call(this,h),f=l(this,ii)===Bt.NONE,p=()=>{c==null||c.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:u,anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r,text:a}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(Bt.HIGHLIGHT,p);return}p()}addToAnnotationStorage(t){!t.isEmpty()&&l(this,xn)&&!l(this,xn).has(t.id)&&l(this,xn).setValue(t.id,t)}blur(){if(this.isShiftKeyDown=!1,l(this,dr)&&(x(this,dr,!1),k(this,gt,yc).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of l(this,de))if(e.div.contains(t)){x(this,oa,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!l(this,oa))return;const[t,e]=l(this,oa);x(this,oa,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){k(this,gt,Qf).call(this),k(this,gt,tp).call(this)}removeEditListeners(){k(this,gt,Zv).call(this),k(this,gt,ep).call(this)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const i of l(this,Ns))if(i.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const i of l(this,Ns))if(i.isHandlingMimeForPasting(e.type)){i.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var i;if(t.preventDefault(),(i=l(this,Xi))==null||i.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of l(this,de)){const n=s.serialize(!0);n&&e.push(n)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const r of l(this,Ns))if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let i=e.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(n){Ht(`paste: "${n.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const s=this.currentLayer;try{const n=[];for(const o of i){const h=await s.deserialize(o);if(!h)return;n.push(h)}const r=()=>{for(const o of n)k(this,gt,ip).call(this,o);k(this,gt,sp).call(this,n)},a=()=>{for(const o of n)o.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(n){Ht(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),l(this,ii)!==Bt.NONE&&!this.isEditorHandlingKeyboard&&Io._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,l(this,dr)&&(x(this,dr,!1),k(this,gt,yc).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(k(this,gt,Yv).call(this),k(this,gt,tp).call(this),k(this,gt,Ri).call(this,{isEditing:l(this,ii)!==Bt.NONE,isEmpty:k(this,gt,ih).call(this),hasSomethingToUndo:l(this,ms).hasSomethingToUndo(),hasSomethingToRedo:l(this,ms).hasSomethingToRedo(),hasSelectedEditor:!1})):(k(this,gt,Kv).call(this),k(this,gt,ep).call(this),k(this,gt,Ri).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!l(this,Ns)){x(this,Ns,t);for(const e of l(this,Ns))k(this,gt,wn).call(this,e.defaultPropertiesToUpdate)}}getId(){return l(this,dd).id}get currentLayer(){return l(this,ci).get(l(this,qo))}getLayer(t){return l(this,ci).get(t)}get currentPageIndex(){return l(this,qo)}addLayer(t){l(this,ci).set(t.pageIndex,t),l(this,fr)?t.enable():t.disable()}removeLayer(t){l(this,ci).delete(t.pageIndex)}async updateMode(t,e=null,i=!1){var s,n;if(l(this,ii)!==t&&!(l(this,vs)&&(await l(this,vs).promise,!l(this,vs)))){if(x(this,vs,Promise.withResolvers()),x(this,ii,t),t===Bt.NONE){this.setEditingState(!1),k(this,gt,t0).call(this),(s=this._editorUndoBar)==null||s.hide(),l(this,vs).resolve();return}t===Bt.SIGNATURE&&await((n=l(this,mr))==null?void 0:n.loadSignatures()),this.setEditingState(!0),await k(this,gt,Qv).call(this),this.unselectAll();for(const r of l(this,ci).values())r.updateMode(t);if(!e){i&&this.addNewEditorFromKeyboard(),l(this,vs).resolve();return}for(const r of l(this,Je).values())r.annotationElementId===e?(this.setSelected(r),r.enterInEditMode()):r.unselect();l(this,vs).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==l(this,ii)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){var i;if(l(this,Ns)){switch(t){case Qt.CREATE:this.currentLayer.addNewEditor(e);return;case Qt.HIGHLIGHT_DEFAULT_COLOR:(i=l(this,la))==null||i.updateColor(e);break;case Qt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(l(this,Ph)||x(this,Ph,new Map)).set(t,e),this.showAllEditors("highlight",e);break}for(const s of l(this,de))s.updateParams(t,e);for(const s of l(this,Ns))s.updateDefaultParams(t,e)}}showAllEditors(t,e,i=!1){var n;for(const r of l(this,Je).values())r.editorType===t&&r.show(e);(((n=l(this,Ph))==null?void 0:n.get(Qt.HIGHLIGHT_SHOW_ALL))??!0)!==e&&k(this,gt,wn).call(this,[[Qt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(l(this,Nh)!==t){x(this,Nh,t);for(const e of l(this,ci).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){const e=[];for(const i of l(this,Je).values())i.pageIndex===t&&e.push(i);return e}getEditor(t){return l(this,Je).get(t)}addEditor(t){l(this,Je).set(t.id,t)}removeEditor(t){var e,i;t.div.contains(document.activeElement)&&(l(this,Js)&&clearTimeout(l(this,Js)),x(this,Js,setTimeout(()=>{this.focusMainContainer(),x(this,Js,null)},0))),l(this,Je).delete(t.id),t.annotationElementId&&((e=l(this,gr))==null||e.delete(t.annotationElementId)),this.unselect(t),(!t.annotationElementId||!l(this,ra).has(t.annotationElementId))&&((i=l(this,xn))==null||i.remove(t.id))}addDeletedAnnotationElement(t){l(this,ra).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return l(this,ra).has(t)}removeDeletedAnnotationElement(t){l(this,ra).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){l(this,Xi)!==t&&(x(this,Xi,t),t&&k(this,gt,wn).call(this,t.propertiesToUpdate))}updateUI(t){l(this,gt,e0)===t&&k(this,gt,wn).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){k(this,gt,wn).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(l(this,de).has(t)){l(this,de).delete(t),t.unselect(),k(this,gt,Ri).call(this,{hasSelectedEditor:this.hasSelection});return}l(this,de).add(t),t.select(),k(this,gt,wn).call(this,t.propertiesToUpdate),k(this,gt,Ri).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;(e=l(this,na))==null||e.commitOrRemove();for(const i of l(this,de))i!==t&&i.unselect();l(this,de).clear(),l(this,de).add(t),t.select(),k(this,gt,wn).call(this,t.propertiesToUpdate),k(this,gt,Ri).call(this,{hasSelectedEditor:!0})}isSelected(t){return l(this,de).has(t)}get firstSelectedEditor(){return l(this,de).values().next().value}unselect(t){t.unselect(),l(this,de).delete(t),k(this,gt,Ri).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return l(this,de).size!==0}get isEnterHandled(){return l(this,de).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;l(this,ms).undo(),k(this,gt,Ri).call(this,{hasSomethingToUndo:l(this,ms).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:k(this,gt,ih).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){l(this,ms).redo(),k(this,gt,Ri).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:l(this,ms).hasSomethingToRedo(),isEmpty:k(this,gt,ih).call(this)})}addCommands(t){l(this,ms).add(t),k(this,gt,Ri).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:k(this,gt,ih).call(this)})}cleanUndoStack(t){l(this,ms).cleanType(t)}delete(){var n;this.commitOrRemove();const t=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...l(this,de)],i=()=>{var r;(r=this._editorUndoBar)==null||r.show(s,e.length===1?e[0].editorType:e.length);for(const a of e)a.remove()},s=()=>{for(const r of e)k(this,gt,ip).call(this,r)};this.addCommands({cmd:i,undo:s,mustExec:!0})}commitOrRemove(){var t;(t=l(this,Xi))==null||t.commitOrRemove()}hasSomethingToControl(){return l(this,Xi)||this.hasSelection}selectAll(){for(const t of l(this,de))t.commit();k(this,gt,sp).call(this,l(this,Je).values())}unselectAll(){var t;if(!(l(this,Xi)&&(l(this,Xi).commitOrRemove(),l(this,ii)!==Bt.NONE))&&!((t=l(this,na))!=null&&t.commitOrRemove())&&this.hasSelection){for(const e of l(this,de))e.unselect();l(this,de).clear(),k(this,gt,Ri).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;l(this,vr)[0]+=t,l(this,vr)[1]+=e;const[s,n]=l(this,vr),r=[...l(this,de)],a=1e3;l(this,tn)&&clearTimeout(l(this,tn)),x(this,tn,setTimeout(()=>{x(this,tn,null),l(this,vr)[0]=l(this,vr)[1]=0,this.addCommands({cmd:()=>{for(const o of r)l(this,Je).has(o.id)&&(o.translateInPage(s,n),o.translationDone())},undo:()=>{for(const o of r)l(this,Je).has(o.id)&&(o.translateInPage(-s,-n),o.translationDone())},mustExec:!1})},a));for(const o of r)o.translateInPage(t,e),o.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),x(this,Zs,new Map);for(const t of l(this,de))l(this,Zs).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!l(this,Zs))return!1;this.disableUserSelect(!1);const t=l(this,Zs);x(this,Zs,null);let e=!1;for(const[{x:s,y:n,pageIndex:r},a]of t)a.newX=s,a.newY=n,a.newPageIndex=r,e||(e=s!==a.savedX||n!==a.savedY||r!==a.savedPageIndex);if(!e)return!1;const i=(s,n,r,a)=>{if(l(this,Je).has(s.id)){const o=l(this,ci).get(a);o?s._setParentAndPosition(o,n,r):(s.pageIndex=a,s.x=n,s.y=r)}};return this.addCommands({cmd:()=>{for(const[s,{newX:n,newY:r,newPageIndex:a}]of t)i(s,n,r,a)},undo:()=>{for(const[s,{savedX:n,savedY:r,savedPageIndex:a}]of t)i(s,n,r,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(l(this,Zs))for(const i of l(this,Zs).keys())i.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||l(this,de).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return l(this,Xi)===t}getActive(){return l(this,Xi)}getMode(){return l(this,ii)}get imageManager(){return Zt(this,"imageManager",new Kf)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let h=0,u=e.rangeCount;h<u;h++)if(!t.contains(e.getRangeAt(h).commonAncestorContainer))return null;const{x:i,y:s,width:n,height:r}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(h,u,c,f)=>({x:(u-s)/r,y:1-(h+c-i)/n,width:f/r,height:c/n});break;case"180":a=(h,u,c,f)=>({x:1-(h+c-i)/n,y:1-(u+f-s)/r,width:c/n,height:f/r});break;case"270":a=(h,u,c,f)=>({x:1-(u+f-s)/r,y:(h-i)/n,width:f/r,height:c/n});break;default:a=(h,u,c,f)=>({x:(h-i)/n,y:(u-s)/r,width:c/n,height:f/r});break}const o=[];for(let h=0,u=e.rangeCount;h<u;h++){const c=e.getRangeAt(h);if(!c.collapsed)for(const{x:f,y:p,width:_,height:v}of c.getClientRects())_===0||v===0||o.push(a(f,p,_,v))}return o.length===0?null:o}addChangedExistingAnnotation({annotationElementId:t,id:e}){(l(this,Ho)||x(this,Ho,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=l(this,Ho))==null||e.delete(t)}renderAnnotationElement(t){var s;const e=(s=l(this,Ho))==null?void 0:s.get(t.data.id);if(!e)return;const i=l(this,xn).getRawValue(e);i&&(l(this,ii)===Bt.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}setMissingCanvas(t,e,i){var n;const s=(n=l(this,gr))==null?void 0:n.get(t);s&&(s.setCanvas(e,i),l(this,gr).delete(t))}addMissingCanvas(t,e){(l(this,gr)||x(this,gr,new Map)).set(t,e)}};zo=new WeakMap,Xi=new WeakMap,Je=new WeakMap,ci=new WeakMap,Uo=new WeakMap,xn=new WeakMap,Ho=new WeakMap,ms=new WeakMap,ur=new WeakMap,na=new WeakMap,qo=new WeakMap,ra=new WeakMap,Zs=new WeakMap,Ns=new WeakMap,aa=new WeakMap,kh=new WeakMap,Rh=new WeakMap,jo=new WeakMap,Ih=new WeakMap,Js=new WeakMap,cr=new WeakMap,Wo=new WeakMap,dr=new WeakMap,Qs=new WeakMap,dd=new WeakMap,fr=new WeakMap,Nh=new WeakMap,pr=new WeakMap,oa=new WeakMap,la=new WeakMap,gr=new WeakMap,Lh=new WeakMap,ii=new WeakMap,de=new WeakMap,Sn=new WeakMap,mr=new WeakMap,ha=new WeakMap,Ph=new WeakMap,Oh=new WeakMap,vr=new WeakMap,tn=new WeakMap,Cn=new WeakMap,Mh=new WeakMap,vs=new WeakMap,gt=new WeakSet,bc=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},Jf=function(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const i of l(this,ci).values())if(i.hasTextLayer(t))return i;return null},Gv=function(){const t=document.getSelection();if(!t||t.isCollapsed)return;const i=k(this,gt,bc).call(this,t).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(l(this,Qs)||x(this,Qs,new $w(this)),l(this,Qs).show(i,s,this.direction==="ltr"))},$v=function(){var n,r,a;const t=document.getSelection();if(!t||t.isCollapsed){l(this,Sn)&&((n=l(this,Qs))==null||n.hide(),x(this,Sn,null),k(this,gt,Ri).call(this,{hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===l(this,Sn))return;const s=k(this,gt,bc).call(this,t).closest(".textLayer");if(!s){l(this,Sn)&&((r=l(this,Qs))==null||r.hide(),x(this,Sn,null),k(this,gt,Ri).call(this,{hasSelectedText:!1}));return}if((a=l(this,Qs))==null||a.hide(),x(this,Sn,e),k(this,gt,Ri).call(this,{hasSelectedText:!0}),!(l(this,ii)!==Bt.HIGHLIGHT&&l(this,ii)!==Bt.NONE)&&(l(this,ii)===Bt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),x(this,dr,this.isShiftKeyDown),!this.isShiftKeyDown)){const o=l(this,ii)===Bt.HIGHLIGHT?k(this,gt,Jf).call(this,s):null;o==null||o.toggleDrawing();const h=new AbortController,u=this.combinedSignal(h),c=f=>{f.type==="pointerup"&&f.button!==0||(h.abort(),o==null||o.toggleDrawing(!0),f.type==="pointerup"&&k(this,gt,yc).call(this,"main_toolbar"))};window.addEventListener("pointerup",c,{signal:u}),window.addEventListener("blur",c,{signal:u})}},yc=function(t=""){l(this,ii)===Bt.HIGHLIGHT?this.highlightSelection(t):l(this,kh)&&k(this,gt,Gv).call(this)},Xv=function(){document.addEventListener("selectionchange",k(this,gt,$v).bind(this),{signal:this._signal})},Yv=function(){if(l(this,cr))return;x(this,cr,new AbortController);const t=this.combinedSignal(l(this,cr));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},Kv=function(){var t;(t=l(this,cr))==null||t.abort(),x(this,cr,null)},Qf=function(){if(l(this,pr))return;x(this,pr,new AbortController);const t=this.combinedSignal(l(this,pr));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},Zv=function(){var t;(t=l(this,pr))==null||t.abort(),x(this,pr,null)},tp=function(){if(l(this,ur))return;x(this,ur,new AbortController);const t=this.combinedSignal(l(this,ur));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},ep=function(){var t;(t=l(this,ur))==null||t.abort(),x(this,ur,null)},Jv=function(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},Ri=function(t){Object.entries(t).some(([i,s])=>l(this,Oh)[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(l(this,Oh),t)}),l(this,ii)===Bt.HIGHLIGHT&&t.hasSelectedEditor===!1&&k(this,gt,wn).call(this,[[Qt.HIGHLIGHT_FREE,!0]]))},wn=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},Qv=async function(){if(!l(this,fr)){x(this,fr,!0);const t=[];for(const e of l(this,ci).values())t.push(e.enable());await Promise.all(t);for(const e of l(this,Je).values())e.enable()}},t0=function(){if(this.unselectAll(),l(this,fr)){x(this,fr,!1);for(const t of l(this,ci).values())t.disable();for(const t of l(this,Je).values())t.disable()}},ip=function(t){const e=l(this,ci).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},e0=function(){let t=null;for(t of l(this,de));return t},ih=function(){if(l(this,Je).size===0)return!0;if(l(this,Je).size===1)for(const t of l(this,Je).values())return t.isEmpty();return!1},sp=function(t){for(const e of l(this,de))e.unselect();l(this,de).clear();for(const e of t)e.isEmpty()||(l(this,de).add(e),e.select());k(this,gt,Ri).call(this,{hasSelectedEditor:this.hasSelection})},At(Io,"TRANSLATE_SMALL",1),At(Io,"TRANSLATE_BIG",10);let lo=Io;var si,en,Ls,Vo,sn,Yi,Go,nn,qi,Tn,ua,rn,br,Vs,sh,wc;const Ii=class Ii{constructor(t){D(this,Vs);D(this,si,null);D(this,en,!1);D(this,Ls,null);D(this,Vo,null);D(this,sn,null);D(this,Yi,null);D(this,Go,!1);D(this,nn,null);D(this,qi,null);D(this,Tn,null);D(this,ua,null);D(this,rn,!1);x(this,qi,t),x(this,rn,t._uiManager.useNewAltTextFlow),l(Ii,br)||x(Ii,br,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){Ii._l10n??(Ii._l10n=t)}async render(){const t=x(this,Ls,document.createElement("button"));t.className="altText",t.tabIndex="0";const e=x(this,Vo,document.createElement("span"));t.append(e),l(this,rn)?(t.classList.add("new"),t.setAttribute("data-l10n-id",l(Ii,br).missing),e.setAttribute("data-l10n-id",l(Ii,br)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=l(this,qi)._uiManager._signal;t.addEventListener("contextmenu",Gs,{signal:i}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:i});const s=n=>{n.preventDefault(),l(this,qi)._uiManager.editAltText(l(this,qi)),l(this,rn)&&l(this,qi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:l(this,Vs,sh)}})};return t.addEventListener("click",s,{capture:!0,signal:i}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(x(this,Go,!0),s(n))},{signal:i}),await k(this,Vs,wc).call(this),t}finish(){l(this,Ls)&&(l(this,Ls).focus({focusVisible:l(this,Go)}),x(this,Go,!1))}isEmpty(){return l(this,rn)?l(this,si)===null:!l(this,si)&&!l(this,en)}hasData(){return l(this,rn)?l(this,si)!==null||!!l(this,Tn):this.isEmpty()}get guessedText(){return l(this,Tn)}async setGuessedText(t){l(this,si)===null&&(x(this,Tn,t),x(this,ua,await Ii._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),k(this,Vs,wc).call(this))}toggleAltTextBadge(t=!1){var e;if(!l(this,rn)||l(this,si)){(e=l(this,nn))==null||e.remove(),x(this,nn,null);return}if(!l(this,nn)){const i=x(this,nn,document.createElement("div"));i.className="noAltTextBadge",l(this,qi).div.append(i)}l(this,nn).classList.toggle("hidden",!t)}serialize(t){let e=l(this,si);return!t&&l(this,Tn)===e&&(e=l(this,ua)),{altText:e,decorative:l(this,en),guessedText:l(this,Tn),textWithDisclaimer:l(this,ua)}}get data(){return{altText:l(this,si),decorative:l(this,en)}}set data({altText:t,decorative:e,guessedText:i,textWithDisclaimer:s,cancel:n=!1}){i&&(x(this,Tn,i),x(this,ua,s)),!(l(this,si)===t&&l(this,en)===e)&&(n||(x(this,si,t),x(this,en,e)),k(this,Vs,wc).call(this))}toggle(t=!1){l(this,Ls)&&(!t&&l(this,Yi)&&(clearTimeout(l(this,Yi)),x(this,Yi,null)),l(this,Ls).disabled=!t)}shown(){l(this,qi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:l(this,Vs,sh)}})}destroy(){var t,e;(t=l(this,Ls))==null||t.remove(),x(this,Ls,null),x(this,Vo,null),x(this,sn,null),(e=l(this,nn))==null||e.remove(),x(this,nn,null)}};si=new WeakMap,en=new WeakMap,Ls=new WeakMap,Vo=new WeakMap,sn=new WeakMap,Yi=new WeakMap,Go=new WeakMap,nn=new WeakMap,qi=new WeakMap,Tn=new WeakMap,ua=new WeakMap,rn=new WeakMap,br=new WeakMap,Vs=new WeakSet,sh=function(){return l(this,si)&&"added"||l(this,si)===null&&this.guessedText&&"review"||"missing"},wc=async function(){var s,n,r;const t=l(this,Ls);if(!t)return;if(l(this,rn)){if(t.classList.toggle("done",!!l(this,si)),t.setAttribute("data-l10n-id",l(Ii,br)[l(this,Vs,sh)]),(s=l(this,Vo))==null||s.setAttribute("data-l10n-id",l(Ii,br)[`${l(this,Vs,sh)}-label`]),!l(this,si)){(n=l(this,sn))==null||n.remove();return}}else{if(!l(this,si)&&!l(this,en)){t.classList.remove("done"),(r=l(this,sn))==null||r.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=l(this,sn);if(!e){x(this,sn,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${l(this,qi).id}`;const a=100,o=l(this,qi)._uiManager._signal;o.addEventListener("abort",()=>{clearTimeout(l(this,Yi)),x(this,Yi,null)},{once:!0}),t.addEventListener("mouseenter",()=>{x(this,Yi,setTimeout(()=>{x(this,Yi,null),l(this,sn).classList.add("show"),l(this,qi)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:o}),t.addEventListener("mouseleave",()=>{var h;l(this,Yi)&&(clearTimeout(l(this,Yi)),x(this,Yi,null)),(h=l(this,sn))==null||h.classList.remove("show")},{signal:o})}l(this,en)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=l(this,si)),e.parentNode||t.append(e);const i=l(this,qi).getElementForAltText();i==null||i.setAttribute("aria-describedby",e.id)},D(Ii,br,null),At(Ii,"_l10n",null);let ed=Ii;var $o,ca,Fh,Bh,zh,Uh,Hh,Dn,da,kn,fa,yr,Xr,i0,s0,n0;const Ng=class Ng{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:n=null,onPinchEnd:r=null,signal:a}){D(this,Xr);D(this,$o);D(this,ca,!1);D(this,Fh,null);D(this,Bh);D(this,zh);D(this,Uh);D(this,Hh);D(this,Dn,null);D(this,da);D(this,kn,null);D(this,fa);D(this,yr,null);x(this,$o,t),x(this,Fh,i),x(this,Bh,e),x(this,zh,s),x(this,Uh,n),x(this,Hh,r),x(this,fa,new AbortController),x(this,da,AbortSignal.any([a,l(this,fa).signal])),t.addEventListener("touchstart",k(this,Xr,i0).bind(this),{passive:!1,signal:l(this,da)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/sr.pixelRatio}destroy(){var t,e;(t=l(this,fa))==null||t.abort(),x(this,fa,null),(e=l(this,Dn))==null||e.abort(),x(this,Dn,null)}};$o=new WeakMap,ca=new WeakMap,Fh=new WeakMap,Bh=new WeakMap,zh=new WeakMap,Uh=new WeakMap,Hh=new WeakMap,Dn=new WeakMap,da=new WeakMap,kn=new WeakMap,fa=new WeakMap,yr=new WeakMap,Xr=new WeakSet,i0=function(t){var s,n,r;if((s=l(this,Bh))!=null&&s.call(this))return;if(t.touches.length===1){if(l(this,Dn))return;const a=x(this,Dn,new AbortController),o=AbortSignal.any([l(this,da),a.signal]),h=l(this,$o),u={capture:!0,signal:o,passive:!1},c=f=>{var p;f.pointerType==="touch"&&((p=l(this,Dn))==null||p.abort(),x(this,Dn,null))};h.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(Ve(f),c(f))},u),h.addEventListener("pointerup",c,u),h.addEventListener("pointercancel",c,u);return}if(!l(this,yr)){x(this,yr,new AbortController);const a=AbortSignal.any([l(this,da),l(this,yr).signal]),o=l(this,$o),h={signal:a,capture:!1,passive:!1};o.addEventListener("touchmove",k(this,Xr,s0).bind(this),h);const u=k(this,Xr,n0).bind(this);o.addEventListener("touchend",u,h),o.addEventListener("touchcancel",u,h),h.capture=!0,o.addEventListener("pointerdown",Ve,h),o.addEventListener("pointermove",Ve,h),o.addEventListener("pointercancel",Ve,h),o.addEventListener("pointerup",Ve,h),(n=l(this,zh))==null||n.call(this)}if(Ve(t),t.touches.length!==2||(r=l(this,Fh))!=null&&r.call(this)){x(this,kn,null);return}let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]),x(this,kn,{touch0X:e.screenX,touch0Y:e.screenY,touch1X:i.screenX,touch1Y:i.screenY})},s0=function(t){var T;if(!l(this,kn)||t.touches.length!==2)return;Ve(t);let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]);const{screenX:s,screenY:n}=e,{screenX:r,screenY:a}=i,o=l(this,kn),{touch0X:h,touch0Y:u,touch1X:c,touch1Y:f}=o,p=c-h,_=f-u,v=r-s,g=a-n,b=Math.hypot(v,g)||1,w=Math.hypot(p,_)||1;if(!l(this,ca)&&Math.abs(w-b)<=Ng.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(o.touch0X=s,o.touch0Y=n,o.touch1X=r,o.touch1Y=a,!l(this,ca)){x(this,ca,!0);return}const S=[(s+r)/2,(n+a)/2];(T=l(this,Uh))==null||T.call(this,S,w,b)},n0=function(t){var e;t.touches.length>=2||(l(this,yr).abort(),x(this,yr,null),(e=l(this,Hh))==null||e.call(this),l(this,kn)&&(Ve(t),x(this,kn,null),x(this,ca,!1)))};let id=Ng;var pa,Ps,we,Xo,wr,qh,ga,di,ma,Rn,_r,jh,va,Ki,Wh,ba,In,an,Yo,Ko,bs,ya,Vh,fd,It,np,Gh,rp,_c,r0,a0,ap,Ac,op,o0,l0,h0,lp,u0,hp,c0,d0,f0,up,nh;const Vt=class Vt{constructor(t){D(this,It);D(this,pa,null);D(this,Ps,null);D(this,we,null);D(this,Xo,!1);D(this,wr,null);D(this,qh,"");D(this,ga,!1);D(this,di,null);D(this,ma,null);D(this,Rn,null);D(this,_r,null);D(this,jh,"");D(this,va,!1);D(this,Ki,null);D(this,Wh,!1);D(this,ba,!1);D(this,In,!1);D(this,an,null);D(this,Yo,0);D(this,Ko,0);D(this,bs,null);D(this,ya,null);At(this,"_isCopy",!1);At(this,"_editToolbar",null);At(this,"_initialOptions",Object.create(null));At(this,"_initialData",null);At(this,"_isVisible",!0);At(this,"_uiManager",null);At(this,"_focusEventsAllowed",!0);D(this,Vh,!1);D(this,fd,Vt._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,r];const[a,o]=this.parentDimensions;this.x=t.x/a,this.y=t.y/o,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=Vt.prototype._resizeWithKeyboard,e=lo.TRANSLATE_SMALL,i=lo.TRANSLATE_BIG;return Zt(this,"_resizerKeyboardManager",new Yu([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],Vt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Zt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new Kw({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(Vt._l10n??(Vt._l10n=t),Vt._l10nResizer||(Vt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Vt._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);Vt._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){me("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return l(this,Vh)}set _isDraggable(t){var e;x(this,Vh,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=l(this,fd)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):k(this,It,nh).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(l(this,va)?x(this,va,!1):this.parent.setSelected(this))}focusout(t){var i;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(i=this.parent)!=null&&i.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,s){const[n,r]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(t+i)/n,this.y=(e+s)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[i,s]=this.parentDimensions;this.setAt(t*i,e*s,this.width*i,this.height*s),this._onTranslated()}translate(t,e){k(this,It,np).call(this,this.parentDimensions,t,e)}translateInPage(t,e){l(this,Ki)||x(this,Ki,[this.x,this.y,this.width,this.height]),k(this,It,np).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){l(this,Ki)||x(this,Ki,[this.x,this.y,this.width,this.height]);const{div:i,parentDimensions:[s,n]}=this;if(this.x+=t/s,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:c,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,c,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[o,h]=this.getBaseTranslation();r+=o,a+=h;const{style:u}=i;u.left=`${(100*r).toFixed(2)}%`,u.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),i.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!l(this,Ki)&&(l(this,Ki)[0]!==this.x||l(this,Ki)[1]!==this.y)}get _hasBeenResized(){return!!l(this,Ki)&&(l(this,Ki)[2]!==this.width||l(this,Ki)[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:i}=Vt,s=i/t,n=i/e;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[i,s]}=this;let{x:n,y:r,width:a,height:o}=this;if(a*=i,o*=s,n*=i,r*=s,this._mustFixPosition)switch(t){case 0:n=Oi(n,0,i-a),r=Oi(r,0,s-o);break;case 90:n=Oi(n,0,i-o),r=Oi(r,a,s);break;case 180:n=Oi(n,a,i),r=Oi(r,o,s);break;case 270:n=Oi(n,o,i),r=Oi(r,0,s-a);break}this.x=n/=i,this.y=r/=s;const[h,u]=this.getBaseTranslation();n+=h,r+=u,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var i;return k(i=Vt,Gh,rp).call(i,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var i;return k(i=Vt,Gh,rp).call(i,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(t,e){const[i,s]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*t/i).toFixed(2)}%`,l(this,ga)||(n.height=`${(100*e/s).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:i}=t,s=i.endsWith("%"),n=!l(this,ga)&&e.endsWith("%");if(s&&n)return;const[r,a]=this.parentDimensions;s||(t.width=`${(100*parseFloat(i)/r).toFixed(2)}%`),!l(this,ga)&&!n&&(t.height=`${(100*parseFloat(e)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=l(this,we))==null||t.finish()}async addEditToolbar(){return this._editToolbar||l(this,ba)?this._editToolbar:(this._editToolbar=new Yf(this),this.div.append(this._editToolbar.render()),l(this,we)&&await this._editToolbar.addAltText(l(this,we)),this._editToolbar)}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=l(this,we))==null||t.destroy())}addContainer(t){var i;const e=(i=this._editToolbar)==null?void 0:i.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){l(this,we)||(ed.initialize(Vt._l10n),x(this,we,new ed(this)),l(this,pa)&&(l(this,we).data=l(this,pa),x(this,pa,null)),await this.addEditToolbar())}get altTextData(){var t;return(t=l(this,we))==null?void 0:t.data}set altTextData(t){l(this,we)&&(l(this,we).data=t)}get guessedAltText(){var t;return(t=l(this,we))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=l(this,we))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=l(this,we))==null?void 0:e.serialize(t)}hasAltText(){return!!l(this,we)&&!l(this,we).isEmpty()}hasAltTextData(){var t;return((t=l(this,we))==null?void 0:t.hasData())??!1}render(){var r;const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=l(this,Xo)?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),k(this,It,hp).call(this);const[e,i]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*i/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/i).toFixed(2)}%`);const[s,n]=this.getInitialTranslation();return this.translate(s,n),xg(this,t,["keydown","pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(l(this,ya)||x(this,ya,new id({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:k(this,It,o0).bind(this),onPinching:k(this,It,l0).bind(this),onPinchEnd:k(this,It,h0).bind(this),signal:this._uiManager._signal}))),(r=this._uiManager._editorUndoBar)==null||r.hide(),t}pointerdown(t){const{isMac:e}=wi.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(x(this,va,!0),this._isDraggable){k(this,It,u0).call(this,t);return}k(this,It,lp).call(this,t)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){l(this,an)&&clearTimeout(l(this,an)),x(this,an,setTimeout(()=>{var t;x(this,an,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,i=this.rotation){const s=this.parentScale,[n,r]=this.pageDimensions,[a,o]=this.pageTranslation,h=t/s,u=e/s,c=this.x*n,f=this.y*r,p=this.width*n,_=this.height*r;switch(i){case 0:return[c+h+a,r-f-u-_+o,c+h+p+a,r-f-u+o];case 90:return[c+u+a,r-f+h+o,c+u+_+a,r-f+h+p+o];case 180:return[c-h-p+a,r-f+u+o,c-h+a,r-f+u+_+o];case 270:return[c-u-_+a,r-f-h-p+o,c-u+a,r-f-h+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[i,s,n,r]=t,a=n-i,o=r-s;switch(this.rotation){case 0:return[i,e-r,a,o];case 90:return[i,e-s,o,a];case 180:return[n,e-s,a,o];case 270:return[n,e-r,o,a];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){x(this,ba,!0)}disableEditMode(){x(this,ba,!1)}isInEditMode(){return l(this,ba)}shouldGetKeyboardEvents(){return l(this,In)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return e<r&&s>0&&t<n&&i>0}rebuild(){k(this,It,hp).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){me("An editor must be serializable")}static async deserialize(t,e,i){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i});s.rotation=t.rotation,x(s,pa,t.accessibilityData),s._isCopy=t.isCopy||!1;const[n,r]=s.pageDimensions,[a,o,h,u]=s.getRectInCurrentCoords(t.rect,r);return s.x=a/n,s.y=o/r,s.width=h/n,s.height=u/r,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e;if((t=l(this,_r))==null||t.abort(),x(this,_r,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),l(this,an)&&(clearTimeout(l(this,an)),x(this,an,null)),k(this,It,nh).call(this),this.removeEditToolbar(),l(this,bs)){for(const i of l(this,bs).values())clearTimeout(i);x(this,bs,null)}this.parent=null,(e=l(this,ya))==null||e.destroy(),x(this,ya,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(k(this,It,r0).call(this),l(this,di).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),x(this,Rn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=l(this,di).children;if(!l(this,Ps)){x(this,Ps,Array.from(e));const r=k(this,It,c0).bind(this),a=k(this,It,d0).bind(this),o=this._uiManager._signal;for(const h of l(this,Ps)){const u=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",r,{signal:o}),h.addEventListener("blur",a,{signal:o}),h.addEventListener("focus",k(this,It,f0).bind(this,u),{signal:o}),h.setAttribute("data-l10n-id",Vt._l10nResizer[u])}}const i=l(this,Ps)[0];let s=0;for(const r of e){if(r===i)break;s++}const n=(360-this.rotation+this.parentRotation)%360/90*(l(this,Ps).length/4);if(n!==s){if(n<s)for(let a=0;a<s-n;a++)l(this,di).append(l(this,di).firstChild);else if(n>s)for(let a=0;a<n-s;a++)l(this,di).firstChild.before(l(this,di).lastChild);let r=0;for(const a of e){const h=l(this,Ps)[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",Vt._l10nResizer[h])}}k(this,It,up).call(this,0),x(this,In,!0),l(this,di).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){l(this,In)&&k(this,It,op).call(this,l(this,jh),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){k(this,It,nh).call(this),this.div.focus()}select(){var t,e,i;if(this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,n;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(e=this._editToolbar)==null||e.show(),(i=l(this,we))==null||i.toggleAltTextBadge(!1)}unselect(){var t,e,i,s,n;(t=l(this,di))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(i=this.div)!=null&&i.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(n=l(this,we))==null||n.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return l(this,Wh)}set isEditing(t){x(this,Wh,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){x(this,ga,!0);const i=t/e,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){l(this,bs)||x(this,bs,new Map);const{action:i}=t;let s=l(this,bs).get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),l(this,bs).delete(i),l(this,bs).size===0&&x(this,bs,null)},Vt._telemetryTimeout),l(this,bs).set(i,s);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),x(this,Xo,!1)}disable(){this.div&&(this.div.tabIndex=-1),x(this,Xo,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};pa=new WeakMap,Ps=new WeakMap,we=new WeakMap,Xo=new WeakMap,wr=new WeakMap,qh=new WeakMap,ga=new WeakMap,di=new WeakMap,ma=new WeakMap,Rn=new WeakMap,_r=new WeakMap,jh=new WeakMap,va=new WeakMap,Ki=new WeakMap,Wh=new WeakMap,ba=new WeakMap,In=new WeakMap,an=new WeakMap,Yo=new WeakMap,Ko=new WeakMap,bs=new WeakMap,ya=new WeakMap,Vh=new WeakMap,fd=new WeakMap,It=new WeakSet,np=function([t,e],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Gh=new WeakSet,rp=function(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},_c=function(t){switch(t){case 90:{const[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}},r0=function(){if(l(this,di))return;x(this,di,document.createElement("div")),l(this,di).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const i of t){const s=document.createElement("div");l(this,di).append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",k(this,It,a0).bind(this,i),{signal:e}),s.addEventListener("contextmenu",Gs,{signal:e}),s.tabIndex=-1}this.div.prepend(l(this,di))},a0=function(t,e){var u;e.preventDefault();const{isMac:i}=wi.platform;if(e.button!==0||e.ctrlKey&&i)return;(u=l(this,we))==null||u.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,x(this,ma,[e.screenX,e.screenY]);const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",k(this,It,op).bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Ve,{passive:!1,signal:r}),window.addEventListener("contextmenu",Gs,{signal:r}),x(this,Rn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const a=this.parent.div.style.cursor,o=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const h=()=>{var c;n.abort(),this.parent.togglePointerEvents(!0),(c=l(this,we))==null||c.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=a,this.div.style.cursor=o,k(this,It,Ac).call(this)};window.addEventListener("pointerup",h,{signal:r}),window.addEventListener("blur",h,{signal:r})},ap=function(t,e,i,s){this.width=i,this.height=s,this.x=t,this.y=e;const[n,r]=this.parentDimensions;this.setDims(n*i,r*s),this.fixAndSetPosition(),this._onResized()},Ac=function(){if(!l(this,Rn))return;const{savedX:t,savedY:e,savedWidth:i,savedHeight:s}=l(this,Rn);x(this,Rn,null);const n=this.x,r=this.y,a=this.width,o=this.height;n===t&&r===e&&a===i&&o===s||this.addCommands({cmd:k(this,It,ap).bind(this,n,r,a,o),undo:k(this,It,ap).bind(this,t,e,i,s),mustExec:!0})},op=function(t,e){const[i,s]=this.parentDimensions,n=this.x,r=this.y,a=this.width,o=this.height,h=Vt.MIN_SIZE/i,u=Vt.MIN_SIZE/s,c=k(this,It,_c).call(this,this.rotation),f=(Q,J)=>[c[0]*Q+c[2]*J,c[1]*Q+c[3]*J],p=k(this,It,_c).call(this,360-this.rotation),_=(Q,J)=>[p[0]*Q+p[2]*J,p[1]*Q+p[3]*J];let v,g,b=!1,w=!1;switch(t){case"topLeft":b=!0,v=(Q,J)=>[0,0],g=(Q,J)=>[Q,J];break;case"topMiddle":v=(Q,J)=>[Q/2,0],g=(Q,J)=>[Q/2,J];break;case"topRight":b=!0,v=(Q,J)=>[Q,0],g=(Q,J)=>[0,J];break;case"middleRight":w=!0,v=(Q,J)=>[Q,J/2],g=(Q,J)=>[0,J/2];break;case"bottomRight":b=!0,v=(Q,J)=>[Q,J],g=(Q,J)=>[0,0];break;case"bottomMiddle":v=(Q,J)=>[Q/2,J],g=(Q,J)=>[Q/2,0];break;case"bottomLeft":b=!0,v=(Q,J)=>[0,J],g=(Q,J)=>[Q,0];break;case"middleLeft":w=!0,v=(Q,J)=>[0,J/2],g=(Q,J)=>[Q,J/2];break}const S=v(a,o),T=g(a,o);let A=f(...T);const C=Vt._round(n+A[0]),R=Vt._round(r+A[1]);let P=1,N=1,F,z;if(e.fromKeyboard)({deltaX:F,deltaY:z}=e);else{const{screenX:Q,screenY:J}=e,[et,ut]=l(this,ma);[F,z]=this.screenToPageTranslation(Q-et,J-ut),l(this,ma)[0]=Q,l(this,ma)[1]=J}if([F,z]=_(F/i,z/s),b){const Q=Math.hypot(a,o);P=N=Math.max(Math.min(Math.hypot(T[0]-S[0]-F,T[1]-S[1]-z)/Q,1/a,1/o),h/a,u/o)}else w?P=Oi(Math.abs(T[0]-S[0]-F),h,1)/a:N=Oi(Math.abs(T[1]-S[1]-z),u,1)/o;const q=Vt._round(a*P),X=Vt._round(o*N);A=f(...g(q,X));const tt=C-A[0],st=R-A[1];l(this,Ki)||x(this,Ki,[this.x,this.y,this.width,this.height]),this.width=q,this.height=X,this.x=tt,this.y=st,this.setDims(i*q,s*X),this.fixAndSetPosition(),this._onResizing()},o0=function(){var t;x(this,Rn,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(t=l(this,we))==null||t.toggle(!1),this.parent.togglePointerEvents(!1)},l0=function(t,e,i){let n=.7*(i/e)+1-.7;if(n===1)return;const r=k(this,It,_c).call(this,this.rotation),a=(C,R)=>[r[0]*C+r[2]*R,r[1]*C+r[3]*R],[o,h]=this.parentDimensions,u=this.x,c=this.y,f=this.width,p=this.height,_=Vt.MIN_SIZE/o,v=Vt.MIN_SIZE/h;n=Math.max(Math.min(n,1/f,1/p),_/f,v/p);const g=Vt._round(f*n),b=Vt._round(p*n);if(g===f&&b===p)return;l(this,Ki)||x(this,Ki,[u,c,f,p]);const w=a(f/2,p/2),S=Vt._round(u+w[0]),T=Vt._round(c+w[1]),A=a(g/2,b/2);this.x=S-A[0],this.y=T-A[1],this.width=g,this.height=b,this.setDims(o*g,h*b),this.fixAndSetPosition(),this._onResizing()},h0=function(){var t;(t=l(this,we))==null||t.toggle(!0),this.parent.togglePointerEvents(!0),k(this,It,Ac).call(this)},lp=function(t){const{isMac:e}=wi.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},u0=function(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let i=!1;const s=new AbortController,n=this._uiManager.combinedSignal(s),r={capture:!0,passive:!1,signal:n},a=h=>{s.abort(),x(this,wr,null),x(this,va,!1),this._uiManager.endDragSession()||k(this,It,lp).call(this,h),i&&this._onStopDragging()};e&&(x(this,Yo,t.clientX),x(this,Ko,t.clientY),x(this,wr,t.pointerId),x(this,qh,t.pointerType),window.addEventListener("pointermove",h=>{i||(i=!0,this._onStartDragging());const{clientX:u,clientY:c,pointerId:f}=h;if(f!==l(this,wr)){Ve(h);return}const[p,_]=this.screenToPageTranslation(u-l(this,Yo),c-l(this,Ko));x(this,Yo,u),x(this,Ko,c),this._uiManager.dragSelectedEditors(p,_)},r),window.addEventListener("touchmove",Ve,r),window.addEventListener("pointerdown",h=>{h.pointerType===l(this,qh)&&(l(this,ya)||h.isPrimary)&&a(h),Ve(h)},r));const o=h=>{if(!l(this,wr)||l(this,wr)===h.pointerId){a(h);return}Ve(h)};window.addEventListener("pointerup",o,{signal:n}),window.addEventListener("blur",o,{signal:n})},hp=function(){if(l(this,_r)||!this.div)return;x(this,_r,new AbortController);const t=this._uiManager.combinedSignal(l(this,_r));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},c0=function(t){Vt._resizerKeyboardManager.exec(this,t)},d0=function(t){var e;l(this,In)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==l(this,di)&&k(this,It,nh).call(this)},f0=function(t){x(this,jh,l(this,In)?t:"")},up=function(t){if(l(this,Ps))for(const e of l(this,Ps))e.tabIndex=t},nh=function(){x(this,In,!1),k(this,It,up).call(this,-1),k(this,It,Ac).call(this)},D(Vt,Gh),At(Vt,"_l10n",null),At(Vt,"_l10nResizer",null),At(Vt,"_borderLineWidth",-1),At(Vt,"_colorManager",new Zf),At(Vt,"_zIndex",1),At(Vt,"_telemetryTimeout",1e3);let Ce=Vt;class Kw extends Ce{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const jm=3285377520,ps=4294901760,Ys=65535;class p0{constructor(t){this.h1=t?t&4294967295:jm,this.h2=t?t&4294967295:jm}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let v=0,g=t.length;v<g;v++){const b=t.charCodeAt(v);b<=255?e[i++]=b:(e[i++]=b>>>8,e[i++]=b&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=i>>2,n=i-s*4,r=new Uint32Array(e.buffer,0,s);let a=0,o=0,h=this.h1,u=this.h2;const c=3432918353,f=461845907,p=c&Ys,_=f&Ys;for(let v=0;v<s;v++)v&1?(a=r[v],a=a*c&ps|a*p&Ys,a=a<<15|a>>>17,a=a*f&ps|a*_&Ys,h^=a,h=h<<13|h>>>19,h=h*5+3864292196):(o=r[v],o=o*c&ps|o*p&Ys,o=o<<15|o>>>17,o=o*f&ps|o*_&Ys,u^=o,u=u<<13|u>>>19,u=u*5+3864292196);switch(a=0,n){case 3:a^=e[s*4+2]<<16;case 2:a^=e[s*4+1]<<8;case 1:a^=e[s*4],a=a*c&ps|a*p&Ys,a=a<<15|a>>>17,a=a*f&ps|a*_&Ys,s&1?h^=a:u^=a}this.h1=h,this.h2=u}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&ps|t*36045&Ys,e=e*4283543511&ps|((e<<16|t>>>16)*2950163797&ps)>>>16,t^=e>>>1,t=t*444984403&ps|t*60499&Ys,e=e*3301882366&ps|((e<<16|t>>>16)*3120437893&ps)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const cp=Object.freeze({map:null,hash:"",transfer:void 0});var wa,_a,ni,pd,g0;class Sg{constructor(){D(this,pd);D(this,wa,!1);D(this,_a,null);D(this,ni,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const i=l(this,ni).get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return l(this,ni).get(t)}remove(t){if(l(this,ni).delete(t),l(this,ni).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of l(this,ni).values())if(e instanceof Ce)return;this.onAnnotationEditor(null)}}setValue(t,e){const i=l(this,ni).get(t);let s=!1;if(i!==void 0)for(const[n,r]of Object.entries(e))i[n]!==r&&(s=!0,i[n]=r);else s=!0,l(this,ni).set(t,e);s&&k(this,pd,g0).call(this),e instanceof Ce&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return l(this,ni).has(t)}getAll(){return l(this,ni).size>0?bg(l(this,ni)):null}setAll(t){for(const[e,i]of Object.entries(t))this.setValue(e,i)}get size(){return l(this,ni).size}resetModified(){l(this,wa)&&(x(this,wa,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new m0(this)}get serializable(){if(l(this,ni).size===0)return cp;const t=new Map,e=new p0,i=[],s=Object.create(null);let n=!1;for(const[r,a]of l(this,ni)){const o=a instanceof Ce?a.serialize(!1,s):a;o&&(t.set(r,o),e.update(`${r}:${JSON.stringify(o)}`),n||(n=!!o.bitmap))}if(n)for(const r of t.values())r.bitmap&&i.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:cp}get editorStats(){let t=null;const e=new Map;for(const i of l(this,ni).values()){if(!(i instanceof Ce))continue;const s=i.telemetryFinalData;if(!s)continue;const{type:n}=s;e.has(n)||e.set(n,Object.getPrototypeOf(i).constructor),t||(t=Object.create(null));const r=t[n]||(t[n]=new Map);for(const[a,o]of Object.entries(s)){if(a==="type")continue;let h=r.get(a);h||(h=new Map,r.set(a,h));const u=h.get(o)??0;h.set(o,u+1)}}for(const[i,s]of e)t[i]=s.computeTelemetryFinalData(t[i]);return t}resetModifiedIds(){x(this,_a,null)}get modifiedIds(){if(l(this,_a))return l(this,_a);const t=[];for(const e of l(this,ni).values())!(e instanceof Ce)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return x(this,_a,{ids:new Set(t),hash:t.join(",")})}}wa=new WeakMap,_a=new WeakMap,ni=new WeakMap,pd=new WeakSet,g0=function(){l(this,wa)||(x(this,wa,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var $h;class m0 extends Sg{constructor(e){super();D(this,$h);const{map:i,hash:s,transfer:n}=e.serializable,r=structuredClone(i,n?{transfer:n}:null);x(this,$h,{map:r,hash:s,transfer:n})}get print(){me("Should not call PrintAnnotationStorage.print")}get serializable(){return l(this,$h)}get modifiedIds(){return Zt(this,"modifiedIds",{ids:new Set,hash:""})}}$h=new WeakMap;var Zo;class Zw{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){D(this,Zo,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),l(this,Zo).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:i}){if(!(!t||l(this,Zo).has(t.loadedName))){if(Ge(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:n,style:r}=t,a=new FontFace(s,n,r);this.addNativeFontFace(a);try{await a.load(),l(this,Zo).add(s),i==null||i(t)}catch{Ht(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}me("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(s){throw Ht(`Failed to load font '${i.family}': '${s}'.`),t.disableFontFace=!0,s}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){var e;const t=!!((e=this._document)!=null&&e.fonts);return Zt(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return Zt(this,"isSyncFontLoadingSupported",gi||wi.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(Ge(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){const n=i.shift();setTimeout(n.callback,0)}}const{loadingRequests:i}=this,s={done:!1,complete:e,callback:t};return i.push(s),s}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Zt(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(T,A){return T.charCodeAt(A)<<24|T.charCodeAt(A+1)<<16|T.charCodeAt(A+2)<<8|T.charCodeAt(A+3)&255}function s(T,A,C,R){const P=T.substring(0,A),N=T.substring(A+C);return P+R+N}let n,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const o=a.getContext("2d");let h=0;function u(T,A){if(++h>30){Ht("Load test font never loaded."),A();return}if(o.font="30px "+T,o.fillText(".",0,20),o.getImageData(0,0,1,1).data[3]>0){A();return}setTimeout(u.bind(null,T,A))}const c=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=s(f,976,c.length,c);const _=16,v=1482184792;let g=i(f,_);for(n=0,r=c.length-3;n<r;n+=4)g=g-v+i(c,n)|0;n<c.length&&(g=g-v+i(c+"XXX",n)|0),f=s(f,_,4,Mw(g));const b=`url(data:font/opentype;base64,${btoa(f)});`,w=`@font-face {font-family:"${c}";src:${b}}`;this.insertRule(w);const S=this._document.createElement("div");S.style.visibility="hidden",S.style.width=S.style.height="10px",S.style.position="absolute",S.style.top=S.style.left="0px";for(const T of[t.loadedName,c]){const A=this._document.createElement("span");A.textContent="Hi",A.style.fontFamily=T,S.append(A)}this._document.body.append(S),u(c,()=>{S.remove(),e.complete()})}}Zo=new WeakMap;class Jw{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const i in t)this[i]=t[i];this._inspectFont=e}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var i;if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Fv(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return(i=this._inspectFont)==null||i.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const i=this.loadedName+"_path_"+e;let s;try{s=t.get(i)}catch(r){Ht(`getPathGenerator - ignoring character: "${r}".`)}const n=new Path2D(s||"");return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=n}}const ac={DATA:1,ERROR:2},je={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Wm(){}function Ui(d){if(d instanceof Vr||d instanceof Gf||d instanceof Um||d instanceof td||d instanceof Nf)return d;switch(d instanceof Error||typeof d=="object"&&d!==null||me('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),d.name){case"AbortException":return new Vr(d.message);case"InvalidPDFException":return new Gf(d.message);case"PasswordException":return new Um(d.message,d.code);case"ResponseException":return new td(d.message,d.status,d.missing);case"UnknownErrorException":return new Nf(d.message,d.details)}return new Nf(d.message,d.toString())}var Jo,Ss,v0,b0,y0,Ec;class rh{constructor(t,e,i){D(this,Ss);D(this,Jo,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",k(this,Ss,v0).bind(this),{signal:l(this,Jo).signal})}on(t,e){const i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){const s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},i)}catch(r){n.reject(r)}return n.promise}sendWithStream(t,e,i,s){const n=this.streamId++,r=this.sourceName,a=this.targetName,o=this.comObj;return new ReadableStream({start:h=>{const u=Promise.withResolvers();return this.streamControllers[n]={controller:h,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},o.postMessage({sourceName:r,targetName:a,action:t,streamId:n,data:e,desiredSize:h.desiredSize},s),u.promise},pull:h=>{const u=Promise.withResolvers();return this.streamControllers[n].pullCall=u,o.postMessage({sourceName:r,targetName:a,stream:je.PULL,streamId:n,desiredSize:h.desiredSize}),u.promise},cancel:h=>{Ge(h instanceof Error,"cancel must have a valid reason");const u=Promise.withResolvers();return this.streamControllers[n].cancelCall=u,this.streamControllers[n].isClosed=!0,o.postMessage({sourceName:r,targetName:a,stream:je.CANCEL,streamId:n,reason:Ui(h)}),u.promise}},i)}destroy(){var t;(t=l(this,Jo))==null||t.abort(),x(this,Jo,null)}}Jo=new WeakMap,Ss=new WeakSet,v0=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){k(this,Ss,y0).call(this,t);return}if(t.callback){const i=t.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===ac.DATA)s.resolve(t.data);else if(t.callback===ac.ERROR)s.reject(Ui(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const i=this.sourceName,s=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(r){n.postMessage({sourceName:i,targetName:s,callback:ac.DATA,callbackId:t.callbackId,data:r})},function(r){n.postMessage({sourceName:i,targetName:s,callback:ac.ERROR,callbackId:t.callbackId,reason:Ui(r)})});return}if(t.streamId){k(this,Ss,b0).call(this,t);return}e(t.data)},b0=function(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,r=this,a=this.actionHandler[t.action],o={enqueue(h,u=1,c){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=u,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:je.ENQUEUE,streamId:e,chunk:h},c)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:je.CLOSE,streamId:e}),delete r.streamSinks[e])},error(h){Ge(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:je.ERROR,streamId:e,reason:Ui(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[e]=o,Promise.try(a,t.data,o).then(function(){n.postMessage({sourceName:i,targetName:s,stream:je.START_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:i,targetName:s,stream:je.START_COMPLETE,streamId:e,reason:Ui(h)})})},y0=function(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case je.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(Ui(t.reason));break;case je.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(Ui(t.reason));break;case je.PULL:if(!a){n.postMessage({sourceName:i,targetName:s,stream:je.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||Wm).then(function(){n.postMessage({sourceName:i,targetName:s,stream:je.PULL_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:i,targetName:s,stream:je.PULL_COMPLETE,streamId:e,reason:Ui(h)})});break;case je.ENQUEUE:if(Ge(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case je.CLOSE:if(Ge(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),k(this,Ss,Ec).call(this,r,e);break;case je.ERROR:Ge(r,"error should have stream controller"),r.controller.error(Ui(t.reason)),k(this,Ss,Ec).call(this,r,e);break;case je.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(Ui(t.reason)),k(this,Ss,Ec).call(this,r,e);break;case je.CANCEL:if(!a)break;const o=Ui(t.reason);Promise.try(a.onCancel||Wm,o).then(function(){n.postMessage({sourceName:i,targetName:s,stream:je.CANCEL_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:i,targetName:s,stream:je.CANCEL_COMPLETE,streamId:e,reason:Ui(h)})}),a.sinkCapability.reject(o),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},Ec=async function(t,e){var i,s,n;await Promise.allSettled([(i=t.startCall)==null?void 0:i.promise,(s=t.pullCall)==null?void 0:s.promise,(n=t.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[e]};var Xh;class w0{constructor({enableHWA:t=!1}){D(this,Xh,!1);x(this,Xh,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!l(this,Xh)})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){me("Abstract method `_createCanvas` called.")}}Xh=new WeakMap;class Qw extends w0{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}class _0{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){me("Abstract method `_fetch` called.")}}class Vm extends _0{async _fetch(t){const e=await $u(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Gu(e)}}class A0{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,s,n){return"none"}destroy(t=!1){}}var Aa,Qo,Nn,Ln,xi,Ea,xa,yt,Ai,ah,So,xc,Co,E0,dp,To,oh,lh,fp,hh;class t2 extends A0{constructor({docId:e,ownerDocument:i=globalThis.document}){super();D(this,yt);D(this,Aa);D(this,Qo);D(this,Nn);D(this,Ln);D(this,xi);D(this,Ea);D(this,xa,0);x(this,Ln,e),x(this,xi,i)}addFilter(e){if(!e)return"none";let i=l(this,yt,Ai).get(e);if(i)return i;const[s,n,r]=k(this,yt,xc).call(this,e),a=e.length===1?s:`${s}${n}${r}`;if(i=l(this,yt,Ai).get(a),i)return l(this,yt,Ai).set(e,i),i;const o=`g_${l(this,Ln)}_transfer_map_${ki(this,xa)._++}`,h=k(this,yt,Co).call(this,o);l(this,yt,Ai).set(e,h),l(this,yt,Ai).set(a,h);const u=k(this,yt,To).call(this,o);return k(this,yt,lh).call(this,s,n,r,u),h}addHCMFilter(e,i){var _;const s=`${e}-${i}`,n="base";let r=l(this,yt,ah).get(n);if((r==null?void 0:r.key)===s||(r?((_=r.filter)==null||_.remove(),r.key=s,r.url="none",r.filter=null):(r={key:s,url:"none",filter:null},l(this,yt,ah).set(n,r)),!e||!i))return r.url;const a=k(this,yt,hh).call(this,e);e=Et.makeHexColor(...a);const o=k(this,yt,hh).call(this,i);if(i=Et.makeHexColor(...o),l(this,yt,So).style.color="",e==="#000000"&&i==="#ffffff"||e===i)return r.url;const h=new Array(256);for(let v=0;v<=255;v++){const g=v/255;h[v]=g<=.03928?g/12.92:((g+.055)/1.055)**2.4}const u=h.join(","),c=`g_${l(this,Ln)}_hcm_filter`,f=r.filter=k(this,yt,To).call(this,c);k(this,yt,lh).call(this,u,u,u,f),k(this,yt,dp).call(this,f);const p=(v,g)=>{const b=a[v]/255,w=o[v]/255,S=new Array(g+1);for(let T=0;T<=g;T++)S[T]=b+T/g*(w-b);return S.join(",")};return k(this,yt,lh).call(this,p(0,5),p(1,5),p(2,5),f),r.url=k(this,yt,Co).call(this,c),r.url}addAlphaFilter(e){let i=l(this,yt,Ai).get(e);if(i)return i;const[s]=k(this,yt,xc).call(this,[e]),n=`alpha_${s}`;if(i=l(this,yt,Ai).get(n),i)return l(this,yt,Ai).set(e,i),i;const r=`g_${l(this,Ln)}_alpha_map_${ki(this,xa)._++}`,a=k(this,yt,Co).call(this,r);l(this,yt,Ai).set(e,a),l(this,yt,Ai).set(n,a);const o=k(this,yt,To).call(this,r);return k(this,yt,fp).call(this,s,o),a}addLuminosityFilter(e){let i=l(this,yt,Ai).get(e||"luminosity");if(i)return i;let s,n;if(e?([s]=k(this,yt,xc).call(this,[e]),n=`luminosity_${s}`):n="luminosity",i=l(this,yt,Ai).get(n),i)return l(this,yt,Ai).set(e,i),i;const r=`g_${l(this,Ln)}_luminosity_map_${ki(this,xa)._++}`,a=k(this,yt,Co).call(this,r);l(this,yt,Ai).set(e,a),l(this,yt,Ai).set(n,a);const o=k(this,yt,To).call(this,r);return k(this,yt,E0).call(this,o),e&&k(this,yt,fp).call(this,s,o),a}addHighlightHCMFilter(e,i,s,n,r){var w;const a=`${i}-${s}-${n}-${r}`;let o=l(this,yt,ah).get(e);if((o==null?void 0:o.key)===a||(o?((w=o.filter)==null||w.remove(),o.key=a,o.url="none",o.filter=null):(o={key:a,url:"none",filter:null},l(this,yt,ah).set(e,o)),!i||!s))return o.url;const[h,u]=[i,s].map(k(this,yt,hh).bind(this));let c=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[p,_]=[n,r].map(k(this,yt,hh).bind(this));f<c&&([c,f,p,_]=[f,c,_,p]),l(this,yt,So).style.color="";const v=(S,T,A)=>{const C=new Array(256),R=(f-c)/A,P=S/255,N=(T-S)/(255*A);let F=0;for(let z=0;z<=A;z++){const q=Math.round(c+z*R),X=P+z*N;for(let tt=F;tt<=q;tt++)C[tt]=X;F=q+1}for(let z=F;z<256;z++)C[z]=C[F-1];return C.join(",")},g=`g_${l(this,Ln)}_hcm_${e}_filter`,b=o.filter=k(this,yt,To).call(this,g);return k(this,yt,dp).call(this,b),k(this,yt,lh).call(this,v(p[0],_[0],5),v(p[1],_[1],5),v(p[2],_[2],5),b),o.url=k(this,yt,Co).call(this,g),o.url}destroy(e=!1){var i,s,n,r;e&&((i=l(this,Ea))!=null&&i.size)||((s=l(this,Nn))==null||s.parentNode.parentNode.remove(),x(this,Nn,null),(n=l(this,Qo))==null||n.clear(),x(this,Qo,null),(r=l(this,Ea))==null||r.clear(),x(this,Ea,null),x(this,xa,0))}}Aa=new WeakMap,Qo=new WeakMap,Nn=new WeakMap,Ln=new WeakMap,xi=new WeakMap,Ea=new WeakMap,xa=new WeakMap,yt=new WeakSet,Ai=function(){return l(this,Qo)||x(this,Qo,new Map)},ah=function(){return l(this,Ea)||x(this,Ea,new Map)},So=function(){if(!l(this,Nn)){const e=l(this,xi).createElement("div"),{style:i}=e;i.visibility="hidden",i.contain="strict",i.width=i.height=0,i.position="absolute",i.top=i.left=0,i.zIndex=-1;const s=l(this,xi).createElementNS(yn,"svg");s.setAttribute("width",0),s.setAttribute("height",0),x(this,Nn,l(this,xi).createElementNS(yn,"defs")),e.append(s),s.append(l(this,Nn)),l(this,xi).body.append(e)}return l(this,Nn)},xc=function(e){if(e.length===1){const h=e[0],u=new Array(256);for(let f=0;f<256;f++)u[f]=h[f]/255;const c=u.join(",");return[c,c,c]}const[i,s,n]=e,r=new Array(256),a=new Array(256),o=new Array(256);for(let h=0;h<256;h++)r[h]=i[h]/255,a[h]=s[h]/255,o[h]=n[h]/255;return[r.join(","),a.join(","),o.join(",")]},Co=function(e){if(l(this,Aa)===void 0){x(this,Aa,"");const i=l(this,xi).URL;i!==l(this,xi).baseURI&&(Ld(i)?Ht('#createUrl: ignore "data:"-URL for performance reasons.'):x(this,Aa,i.split("#",1)[0]))}return`url(${l(this,Aa)}#${e})`},E0=function(e){const i=l(this,xi).createElementNS(yn,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(i)},dp=function(e){const i=l(this,xi).createElementNS(yn,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(i)},To=function(e){const i=l(this,xi).createElementNS(yn,"filter");return i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("id",e),l(this,yt,So).append(i),i},oh=function(e,i,s){const n=l(this,xi).createElementNS(yn,i);n.setAttribute("type","discrete"),n.setAttribute("tableValues",s),e.append(n)},lh=function(e,i,s,n){const r=l(this,xi).createElementNS(yn,"feComponentTransfer");n.append(r),k(this,yt,oh).call(this,r,"feFuncR",e),k(this,yt,oh).call(this,r,"feFuncG",i),k(this,yt,oh).call(this,r,"feFuncB",s)},fp=function(e,i){const s=l(this,xi).createElementNS(yn,"feComponentTransfer");i.append(s),k(this,yt,oh).call(this,s,"feFuncA",e)},hh=function(e){return l(this,yt,So).style.color=e,Eg(getComputedStyle(l(this,yt,So)).getPropertyValue("color"))};class x0{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){me("Abstract method `_fetch` called.")}}class Gm extends x0{async _fetch(t){const e=await $u(t,"arraybuffer");return new Uint8Array(e)}}class S0{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){me("Abstract method `_fetch` called.")}}class $m extends S0{async _fetch(t){const e=await $u(t,"arraybuffer");return new Uint8Array(e)}}gi&&Ht("Please use the `legacy` build in Node.js environments.");async function Cg(d){const e=await process.getBuiltinModule("fs").promises.readFile(d);return new Uint8Array(e)}class e2 extends A0{}class i2 extends w0{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class s2 extends _0{async _fetch(t){return Cg(t)}}class n2 extends x0{async _fetch(t){return Cg(t)}}class r2 extends S0{async _fetch(t){return Cg(t)}}const mi={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function pp(d,t){if(!t)return;const e=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,i),d.clip(s)}class Tg{isModifyingCurrentTransform(){return!1}getPattern(){me("Abstract method `getPattern` called.")}}class a2 extends Tg{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,s){let n;if(s===mi.STROKE||s===mi.FILL){const r=e.current.getClippedPathBoundingBox(s,xe(t))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,o=Math.ceil(r[3]-r[1])||1,h=e.cachedCanvases.getCanvas("pattern",a,o),u=h.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-r[0],-r[1]),i=Et.transform(i,[1,0,0,1,r[0],r[1]]),u.transform(...e.baseTransform),this.matrix&&u.transform(...this.matrix),pp(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),n=t.createPattern(h.canvas,"no-repeat");const c=new DOMMatrix(i);n.setTransform(c)}else pp(t,this._bbox),n=this._createGradient(t);return n}}function Of(d,t,e,i,s,n,r,a){const o=t.coords,h=t.colors,u=d.data,c=d.width*4;let f;o[e+1]>o[i+1]&&(f=e,e=i,i=f,f=n,n=r,r=f),o[i+1]>o[s+1]&&(f=i,i=s,s=f,f=r,r=a,a=f),o[e+1]>o[i+1]&&(f=e,e=i,i=f,f=n,n=r,r=f);const p=(o[e]+t.offsetX)*t.scaleX,_=(o[e+1]+t.offsetY)*t.scaleY,v=(o[i]+t.offsetX)*t.scaleX,g=(o[i+1]+t.offsetY)*t.scaleY,b=(o[s]+t.offsetX)*t.scaleX,w=(o[s+1]+t.offsetY)*t.scaleY;if(_>=w)return;const S=h[n],T=h[n+1],A=h[n+2],C=h[r],R=h[r+1],P=h[r+2],N=h[a],F=h[a+1],z=h[a+2],q=Math.round(_),X=Math.round(w);let tt,st,Q,J,et,ut,Dt,ot;for(let ct=q;ct<=X;ct++){if(ct<g){const Rt=ct<_?0:(_-ct)/(_-g);tt=p-(p-v)*Rt,st=S-(S-C)*Rt,Q=T-(T-R)*Rt,J=A-(A-P)*Rt}else{let Rt;ct>w?Rt=1:g===w?Rt=0:Rt=(g-ct)/(g-w),tt=v-(v-b)*Rt,st=C-(C-N)*Rt,Q=R-(R-F)*Rt,J=P-(P-z)*Rt}let xt;ct<_?xt=0:ct>w?xt=1:xt=(_-ct)/(_-w),et=p-(p-b)*xt,ut=S-(S-N)*xt,Dt=T-(T-F)*xt,ot=A-(A-z)*xt;const Ct=Math.round(Math.min(tt,et)),Mt=Math.round(Math.max(tt,et));let Yt=c*ct+Ct*4;for(let Rt=Ct;Rt<=Mt;Rt++)xt=(tt-Rt)/(tt-et),xt<0?xt=0:xt>1&&(xt=1),u[Yt++]=st-(st-ut)*xt|0,u[Yt++]=Q-(Q-Dt)*xt|0,u[Yt++]=J-(J-ot)*xt|0,u[Yt++]=255}}function o2(d,t,e){const i=t.coords,s=t.colors;let n,r;switch(t.type){case"lattice":const a=t.verticesPerRow,o=Math.floor(i.length/a)-1,h=a-1;for(n=0;n<o;n++){let u=n*a;for(let c=0;c<h;c++,u++)Of(d,e,i[u],i[u+1],i[u+a],s[u],s[u+1],s[u+a]),Of(d,e,i[u+a+1],i[u+1],i[u+a],s[u+a+1],s[u+1],s[u+a])}break;case"triangles":for(n=0,r=i.length;n<r;n+=3)Of(d,e,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}class l2 extends Tg{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,i){const a=Math.floor(this._bounds[0]),o=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-a,u=Math.ceil(this._bounds[3])-o,c=Math.min(Math.ceil(Math.abs(h*t[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(u*t[1]*1.1)),3e3),p=h/c,_=u/f,v={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-o,scaleX:1/p,scaleY:1/_},g=c+4,b=f+4,w=i.getCanvas("mesh",g,b),S=w.context,T=S.createImageData(c,f);if(e){const C=T.data;for(let R=0,P=C.length;R<P;R+=4)C[R]=e[0],C[R+1]=e[1],C[R+2]=e[2],C[R+3]=255}for(const C of this._figures)o2(T,C,v);return S.putImageData(T,2,2),{canvas:w.canvas,offsetX:a-2*p,offsetY:o-2*_,scaleX:p,scaleY:_}}isModifyingCurrentTransform(){return!0}getPattern(t,e,i,s){pp(t,this._bbox);let n;if(s===mi.SHADING)n=Et.singularValueDecompose2dScale(xe(t));else if(n=Et.singularValueDecompose2dScale(e.baseTransform),this.matrix){const a=Et.singularValueDecompose2dScale(this.matrix);n=[n[0]*a[0],n[1]*a[1]]}const r=this._createMeshCanvas(n,s===mi.SHADING?null:this._background,e.cachedCanvases);return s!==mi.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class h2 extends Tg{getPattern(){return"hotpink"}}function u2(d){switch(d[0]){case"RadialAxial":return new a2(d);case"Mesh":return new l2(d);case"Dummy":return new h2}throw new Error(`Unknown IR type: ${d[0]}`)}const Xm={COLORED:1,UNCOLORED:2},gd=class gd{constructor(t,e,i,s){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=i,this.baseTransform=s}createPatternCanvas(t){const{bbox:e,operatorList:i,paintType:s,tilingType:n,color:r,canvasGraphicsFactory:a}=this;let{xstep:o,ystep:h}=this;o=Math.abs(o),h=Math.abs(h),Nd("TilingType: "+n);const u=e[0],c=e[1],f=e[2],p=e[3],_=f-u,v=p-c,g=Et.singularValueDecompose2dScale(this.matrix),b=Et.singularValueDecompose2dScale(this.baseTransform),w=g[0]*b[0],S=g[1]*b[1];let T=_,A=v,C=!1,R=!1;const P=Math.ceil(o*w),N=Math.ceil(h*S),F=Math.ceil(_*w),z=Math.ceil(v*S);P>=F?T=o:C=!0,N>=z?A=h:R=!0;const q=this.getSizeAndScale(T,this.ctx.canvas.width,w),X=this.getSizeAndScale(A,this.ctx.canvas.height,S),tt=t.cachedCanvases.getCanvas("pattern",q.size,X.size),st=tt.context,Q=a.createCanvasGraphics(st);if(Q.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(Q,s,r),st.translate(-q.scale*u,-X.scale*c),Q.transform(q.scale,0,0,X.scale,0,0),st.save(),this.clipBbox(Q,u,c,f,p),Q.baseTransform=xe(Q.ctx),Q.executeOperatorList(i),Q.endDrawing(),st.restore(),C||R){const J=tt.canvas;C&&(T=o),R&&(A=h);const et=this.getSizeAndScale(T,this.ctx.canvas.width,w),ut=this.getSizeAndScale(A,this.ctx.canvas.height,S),Dt=et.size,ot=ut.size,ct=t.cachedCanvases.getCanvas("pattern-workaround",Dt,ot),xt=ct.context,Ct=C?Math.floor(_/o):0,Mt=R?Math.floor(v/h):0;for(let Yt=0;Yt<=Ct;Yt++)for(let Rt=0;Rt<=Mt;Rt++)xt.drawImage(J,Dt*Yt,ot*Rt,Dt,ot,0,0,Dt,ot);return{canvas:ct.canvas,scaleX:et.scale,scaleY:ut.scale,offsetX:u,offsetY:c}}return{canvas:tt.canvas,scaleX:q.scale,scaleY:X.scale,offsetX:u,offsetY:c}}getSizeAndScale(t,e,i){const s=Math.max(gd.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*i);return n>=s?n=s:i=n/t,{scale:i,size:n}}clipBbox(t,e,i,s,n){const r=s-e,a=n-i;t.ctx.rect(e,i,r,a),t.current.updateRectMinMax(xe(t.ctx),[e,i,s,n]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,i){const s=t.ctx,n=t.current;switch(e){case Xm.COLORED:const r=this.ctx;s.fillStyle=r.fillStyle,s.strokeStyle=r.strokeStyle,n.fillColor=r.fillStyle,n.strokeColor=r.strokeStyle;break;case Xm.UNCOLORED:const a=Et.makeHexColor(i[0],i[1],i[2]);s.fillStyle=a,s.strokeStyle=a,n.fillColor=a,n.strokeColor=a;break;default:throw new Ow(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,i,s){let n=i;s!==mi.SHADING&&(n=Et.transform(n,e.baseTransform),this.matrix&&(n=Et.transform(n,this.matrix)));const r=this.createPatternCanvas(e);let a=new DOMMatrix(n);a=a.translate(r.offsetX,r.offsetY),a=a.scale(1/r.scaleX,1/r.scaleY);const o=t.createPattern(r.canvas,"repeat");return o.setTransform(a),o}};At(gd,"MAX_PATTERN_SIZE",3e3);let gp=gd;function c2({src:d,srcPos:t=0,dest:e,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const a=wi.isLittleEndian?4278190080:255,[o,h]=r?[n,a]:[a,n],u=i>>3,c=i&7,f=d.length;e=new Uint32Array(e.buffer);let p=0;for(let _=0;_<s;_++){for(const g=t+u;t<g;t++){const b=t<f?d[t]:255;e[p++]=b&128?h:o,e[p++]=b&64?h:o,e[p++]=b&32?h:o,e[p++]=b&16?h:o,e[p++]=b&8?h:o,e[p++]=b&4?h:o,e[p++]=b&2?h:o,e[p++]=b&1?h:o}if(c===0)continue;const v=t<f?d[t++]:255;for(let g=0;g<c;g++)e[p++]=v&1<<7-g?h:o}return{srcPos:t,destPos:p}}const Ym=16,Km=100,d2=15,Zm=10,Jm=1e3,Vi=16,Mf=new DOMMatrix;function f2(d,t){if(d._removeMirroring)throw new Error("Context is already forwarding operations.");d.__originalSave=d.save,d.__originalRestore=d.restore,d.__originalRotate=d.rotate,d.__originalScale=d.scale,d.__originalTranslate=d.translate,d.__originalTransform=d.transform,d.__originalSetTransform=d.setTransform,d.__originalResetTransform=d.resetTransform,d.__originalClip=d.clip,d.__originalMoveTo=d.moveTo,d.__originalLineTo=d.lineTo,d.__originalBezierCurveTo=d.bezierCurveTo,d.__originalRect=d.rect,d.__originalClosePath=d.closePath,d.__originalBeginPath=d.beginPath,d._removeMirroring=()=>{d.save=d.__originalSave,d.restore=d.__originalRestore,d.rotate=d.__originalRotate,d.scale=d.__originalScale,d.translate=d.__originalTranslate,d.transform=d.__originalTransform,d.setTransform=d.__originalSetTransform,d.resetTransform=d.__originalResetTransform,d.clip=d.__originalClip,d.moveTo=d.__originalMoveTo,d.lineTo=d.__originalLineTo,d.bezierCurveTo=d.__originalBezierCurveTo,d.rect=d.__originalRect,d.closePath=d.__originalClosePath,d.beginPath=d.__originalBeginPath,delete d._removeMirroring},d.save=function(){t.save(),this.__originalSave()},d.restore=function(){t.restore(),this.__originalRestore()},d.translate=function(i,s){t.translate(i,s),this.__originalTranslate(i,s)},d.scale=function(i,s){t.scale(i,s),this.__originalScale(i,s)},d.transform=function(i,s,n,r,a,o){t.transform(i,s,n,r,a,o),this.__originalTransform(i,s,n,r,a,o)},d.setTransform=function(i,s,n,r,a,o){t.setTransform(i,s,n,r,a,o),this.__originalSetTransform(i,s,n,r,a,o)},d.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},d.rotate=function(i){t.rotate(i),this.__originalRotate(i)},d.clip=function(i){t.clip(i),this.__originalClip(i)},d.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},d.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},d.bezierCurveTo=function(e,i,s,n,r,a){t.bezierCurveTo(e,i,s,n,r,a),this.__originalBezierCurveTo(e,i,s,n,r,a)},d.rect=function(e,i,s,n){t.rect(e,i,s,n),this.__originalRect(e,i,s,n)},d.closePath=function(){t.closePath(),this.__originalClosePath()},d.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class p2{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,i)):(s=this.canvasFactory.create(e,i),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function oc(d,t,e,i,s,n,r,a,o,h){const[u,c,f,p,_,v]=xe(d);if(c===0&&f===0){const w=r*u+_,S=Math.round(w),T=a*p+v,A=Math.round(T),C=(r+o)*u+_,R=Math.abs(Math.round(C)-S)||1,P=(a+h)*p+v,N=Math.abs(Math.round(P)-A)||1;return d.setTransform(Math.sign(u),0,0,Math.sign(p),S,A),d.drawImage(t,e,i,s,n,0,0,R,N),d.setTransform(u,c,f,p,_,v),[R,N]}if(u===0&&p===0){const w=a*f+_,S=Math.round(w),T=r*c+v,A=Math.round(T),C=(a+h)*f+_,R=Math.abs(Math.round(C)-S)||1,P=(r+o)*c+v,N=Math.abs(Math.round(P)-A)||1;return d.setTransform(0,Math.sign(c),Math.sign(f),0,S,A),d.drawImage(t,e,i,s,n,0,0,N,R),d.setTransform(u,c,f,p,_,v),[N,R]}d.drawImage(t,e,i,s,n,r,a,o,h);const g=Math.hypot(u,c),b=Math.hypot(f,p);return[g*o,b*h]}function g2(d){const{width:t,height:e}=d;if(t>Jm||e>Jm)return null;const i=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=t+1,r=new Uint8Array(n*(e+1));let a,o,h;const u=t+7&-8,c=new Uint8Array(u*e);let f=0;for(const C of d.data){let R=128;for(;R>0;)c[f++]=C&R?0:255,R>>=1}let p=0;for(f=0,c[f]!==0&&(r[0]=1,++p),o=1;o<t;o++)c[f]!==c[f+1]&&(r[o]=c[f]?2:1,++p),f++;for(c[f]!==0&&(r[o]=2,++p),a=1;a<e;a++){f=a*u,h=a*n,c[f-u]!==c[f]&&(r[h]=c[f]?1:8,++p);let C=(c[f]?4:0)+(c[f-u]?8:0);for(o=1;o<t;o++)C=(C>>2)+(c[f+1]?4:0)+(c[f-u+1]?8:0),s[C]&&(r[h+o]=s[C],++p),f++;if(c[f-u]!==c[f]&&(r[h+o]=c[f]?2:4,++p),p>i)return null}for(f=u*(e-1),h=a*n,c[f]!==0&&(r[h]=8,++p),o=1;o<t;o++)c[f]!==c[f+1]&&(r[h+o]=c[f]?4:8,++p),f++;if(c[f]!==0&&(r[h+o]=4,++p),p>i)return null;const _=new Int32Array([0,n,-1,0,-n,0,0,0,1]),v=new Path2D,{a:g,b,c:w,d:S,e:T,f:A}=new DOMMatrix().scaleSelf(1/t,-1/e).translateSelf(0,-e);for(a=0;p&&a<=e;a++){let C=a*n;const R=C+t;for(;C<R&&!r[C];)C++;if(C===R)continue;let P=C%n,N=a;v.moveTo(g*P+w*N+T,b*P+S*N+A);const F=C;let z=r[C];do{const q=_[z];do C+=q;while(!r[C]);const X=r[C];X!==5&&X!==10?(z=X,r[C]=0):(z=X&51*z>>4,r[C]&=z>>2|z<<2),P=C%n,N=C/n|0,v.lineTo(g*P+w*N+T,b*P+S*N+A),r[C]||--p}while(F!==C);--a}return v}class Qm{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Pv,this.textMatrixScale=1,this.fontMatrix=Vf,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=_i.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}updateRectMinMax(t,e){const i=Et.applyTransform(e,t),s=Et.applyTransform(e.slice(2),t),n=Et.applyTransform([e[0],e[3]],t),r=Et.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,i[0],s[0],n[0],r[0]),this.minY=Math.min(this.minY,i[1],s[1],n[1],r[1]),this.maxX=Math.max(this.maxX,i[0],s[0],n[0],r[0]),this.maxY=Math.max(this.maxY,i[1],s[1],n[1],r[1])}getPathBoundingBox(t=mi.FILL,e=null){const i=[this.minX,this.minY,this.maxX,this.maxY];if(t===mi.STROKE){e||me("Stroke bounding box must include transform.");const s=Et.singularValueDecompose2dScale(e),n=s[0]*this.lineWidth/2,r=s[1]*this.lineWidth/2;i[0]-=n,i[1]-=r,i[2]+=n,i[3]+=r}return i}updateClipFromPath(){const t=Et.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=mi.FILL,e=null){return Et.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function tv(d,t){if(t instanceof ImageData){d.putImageData(t,0,0);return}const e=t.height,i=t.width,s=e%Vi,n=(e-s)/Vi,r=s===0?n:n+1,a=d.createImageData(i,Vi);let o=0,h;const u=t.data,c=a.data;let f,p,_,v;if(t.kind===pc.GRAYSCALE_1BPP){const g=u.byteLength,b=new Uint32Array(c.buffer,0,c.byteLength>>2),w=b.length,S=i+7>>3,T=4294967295,A=wi.isLittleEndian?4278190080:255;for(f=0;f<r;f++){for(_=f<n?Vi:s,h=0,p=0;p<_;p++){const C=g-o;let R=0;const P=C>S?i:C*8-7,N=P&-8;let F=0,z=0;for(;R<N;R+=8)z=u[o++],b[h++]=z&128?T:A,b[h++]=z&64?T:A,b[h++]=z&32?T:A,b[h++]=z&16?T:A,b[h++]=z&8?T:A,b[h++]=z&4?T:A,b[h++]=z&2?T:A,b[h++]=z&1?T:A;for(;R<P;R++)F===0&&(z=u[o++],F=128),b[h++]=z&F?T:A,F>>=1}for(;h<w;)b[h++]=0;d.putImageData(a,0,f*Vi)}}else if(t.kind===pc.RGBA_32BPP){for(p=0,v=i*Vi*4,f=0;f<n;f++)c.set(u.subarray(o,o+v)),o+=v,d.putImageData(a,0,p),p+=Vi;f<r&&(v=i*s*4,c.set(u.subarray(o,o+v)),d.putImageData(a,0,p))}else if(t.kind===pc.RGB_24BPP)for(_=Vi,v=i*_,f=0;f<r;f++){for(f>=n&&(_=s,v=i*_),h=0,p=v;p--;)c[h++]=u[o++],c[h++]=u[o++],c[h++]=u[o++],c[h++]=255;d.putImageData(a,0,f*Vi)}else throw new Error(`bad image kind: ${t.kind}`)}function ev(d,t){if(t.bitmap){d.drawImage(t.bitmap,0,0);return}const e=t.height,i=t.width,s=e%Vi,n=(e-s)/Vi,r=s===0?n:n+1,a=d.createImageData(i,Vi);let o=0;const h=t.data,u=a.data;for(let c=0;c<r;c++){const f=c<n?Vi:s;({srcPos:o}=c2({src:h,srcPos:o,dest:u,width:i,height:f,nonBlackColor:0})),d.putImageData(a,0,c*Vi)}}function Zl(d,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of e)d[i]!==void 0&&(t[i]=d[i]);d.setLineDash!==void 0&&(t.setLineDash(d.getLineDash()),t.lineDashOffset=d.lineDashOffset)}function lc(d){if(d.strokeStyle=d.fillStyle="#000000",d.fillRule="nonzero",d.globalAlpha=1,d.lineWidth=1,d.lineCap="butt",d.lineJoin="miter",d.miterLimit=10,d.globalCompositeOperation="source-over",d.font="10px sans-serif",d.setLineDash!==void 0&&(d.setLineDash([]),d.lineDashOffset=0),!gi){const{filter:t}=d;t!=="none"&&t!==""&&(d.filter="none")}}function iv(d,t){if(t)return!0;const e=Et.singularValueDecompose2dScale(d);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);const i=Math.fround(sr.pixelRatio*Gr.PDF_TO_CSS_UNITS);return e[0]<=i&&e[1]<=i}const m2=["butt","round","square"],v2=["miter","round","bevel"],b2={},sv={};var $s,mp,vp,bp;const Lg=class Lg{constructor(t,e,i,s,n,{optionalContentConfig:r,markedContentStack:a=null},o,h){D(this,$s);this.ctx=t,this.current=new Qm(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new p2(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:s=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=a,i){const o=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=o.canvas,this.ctx=o.context,this.ctx.save(),this.ctx.transform(...xe(this.compositeCtx))}this.ctx.save(),lc(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=xe(this.ctx)}executeOperatorList(t,e,i,s){const n=t.argsArray,r=t.fnArray;let a=e||0;const o=n.length;if(o===a)return a;const h=o-a>Zm&&typeof i=="function",u=h?Date.now()+d2:0;let c=0;const f=this.commonObjs,p=this.objs;let _;for(;;){if(s!==void 0&&a===s.nextBreakPoint)return s.breakIt(a,i),a;if(_=r[a],_!==Qc.dependency)this[_].apply(this,n[a]);else for(const v of n[a]){const g=v.startsWith("g_")?f:p;if(!g.has(v))return g.get(v,i),a}if(a++,a===o)return a;if(h&&++c>Zm){if(Date.now()>u)return i(),a;c=0}}}endDrawing(){k(this,$s,mp).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),k(this,$s,vp).call(this)}_scaleImage(t,e){const i=t.width??t.displayWidth,s=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),a=i,o=s,h="prescale1",u,c;for(;n>2&&a>1||r>2&&o>1;){let f=a,p=o;n>2&&a>1&&(f=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),n/=a/f),r>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o)/2,r/=o/p),u=this.cachedCanvases.getCanvas(h,f,p),c=u.context,c.clearRect(0,0,f,p),c.drawImage(t,0,0,a,o,0,0,f,p),t=u.canvas,a=f,o=p,h=h==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:o}}_createMaskCanvas(t){const e=this.ctx,{width:i,height:s}=t,n=this.current.fillColor,r=this.current.patternFill,a=xe(e);let o,h,u,c;if((t.bitmap||t.data)&&t.count>1){const P=t.bitmap||t.data.buffer;h=JSON.stringify(r?a:[a.slice(0,4),n]),o=this._cachedBitmapsMap.get(P),o||(o=new Map,this._cachedBitmapsMap.set(P,o));const N=o.get(h);if(N&&!r){const F=Math.round(Math.min(a[0],a[2])+a[4]),z=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:N,offsetX:F,offsetY:z}}u=N}u||(c=this.cachedCanvases.getCanvas("maskCanvas",i,s),ev(c.context,t));let f=Et.transform(a,[1/i,0,0,-1/s,0,0]);f=Et.transform(f,[1,0,0,1,0,-s]);const[p,_,v,g]=Et.getAxialAlignedBoundingBox([0,0,i,s],f),b=Math.round(v-p)||1,w=Math.round(g-_)||1,S=this.cachedCanvases.getCanvas("fillCanvas",b,w),T=S.context,A=p,C=_;T.translate(-A,-C),T.transform(...f),u||(u=this._scaleImage(c.canvas,Xs(T)),u=u.img,o&&r&&o.set(h,u)),T.imageSmoothingEnabled=iv(xe(T),t.interpolate),oc(T,u,0,0,u.width,u.height,0,0,i,s),T.globalCompositeOperation="source-in";const R=Et.transform(Xs(T),[1,0,0,1,-A,-C]);return T.fillStyle=r?n.getPattern(e,this,R,mi.FILL):n,T.fillRect(0,0,i,s),o&&!r&&(this.cachedCanvases.delete("fillCanvas"),o.set(h,S.canvas)),{canvas:S.canvas,offsetX:Math.round(A),offsetY:Math.round(C)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=m2[t]}setLineJoin(t){this.ctx.lineJoin=v2[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,i]of t)switch(e){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,t,e);this.suspendedCtx=this.ctx;const n=this.ctx=s.context;n.setTransform(this.suspendedCtx.getTransform()),Zl(this.suspendedCtx,n),f2(n,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Zl(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,s){const n=s[0],r=s[1],a=s[2]-n,o=s[3]-r;a===0||o===0||(this.genericComposeSMask(e.context,i,a,o,e.subtype,e.backdrop,e.transferMap,n,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,s,n,r,a,o,h,u,c){let f=t.canvas,p=o-u,_=h-c;if(r){const g=Et.makeHexColor(...r);if(p<0||_<0||p+i>f.width||_+s>f.height){const b=this.cachedCanvases.getCanvas("maskExtension",i,s),w=b.context;w.drawImage(f,-p,-_),w.globalCompositeOperation="destination-atop",w.fillStyle=g,w.fillRect(0,0,i,s),w.globalCompositeOperation="source-over",f=b.canvas,p=_=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(p,_,i,s),t.clip(b),t.globalCompositeOperation="destination-atop",t.fillStyle=g,t.fillRect(p,_,i,s),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const v=new Path2D;v.rect(o,h,i,s),e.clip(v),e.globalCompositeOperation="destination-in",e.drawImage(f,p,_,i,s,o,h,i,s),e.restore()}save(){this.inSMaskMode&&Zl(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Zl(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,i,s,n,r){this.ctx.transform(t,e,i,s,n,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i){let[s]=e;if(!i){s||(s=e[0]=new Path2D),this[t](s);return}if(!(s instanceof Path2D)){const n=e[0]=new Path2D;for(let r=0,a=s.length;r<a;)switch(s[r++]){case rc.moveTo:n.moveTo(s[r++],s[r++]);break;case rc.lineTo:n.lineTo(s[r++],s[r++]);break;case rc.curveTo:n.bezierCurveTo(s[r++],s[r++],s[r++],s[r++],s[r++],s[r++]);break;case rc.closePath:n.closePath();break;default:Ht(`Unrecognized drawing path operator: ${s[r-1]}`);break}s=n}this.current.updateRectMinMax(xe(this.ctx),i),this[t](s)}closePath(){this.ctx.closePath()}stroke(t,e=!0){const i=this.ctx,s=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&(s!=null&&s.getPattern)){const n=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=s.getPattern(i,this,Xs(i),mi.STROKE),n){const r=new Path2D;r.addPath(t,i.getTransform().invertSelf().multiplySelf(n)),t=r}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);e&&this.consumePath(t,this.current.getClippedPathBoundingBox(mi.STROKE,xe(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(t){this.stroke(t)}fill(t,e=!0){const i=this.ctx,s=this.current.fillColor,n=this.current.patternFill;let r=!1;if(n){const o=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.fillStyle=s.getPattern(i,this,Xs(i),mi.FILL),o){const h=new Path2D;h.addPath(t,i.getTransform().invertSelf().multiplySelf(o)),t=h}r=!0}const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),r&&i.restore(),e&&this.consumePath(t,a)}eoFill(t){this.pendingEOFill=!0,this.fill(t)}fillStroke(t){this.fill(t,!1),this.stroke(t,!1),this.consumePath(t)}eoFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}closeFillStroke(t){this.fillStroke(t)}closeEOFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}endPath(t){this.consumePath(t)}clip(){this.pendingClip=b2}eoClip(){this.pendingClip=sv}beginText(){this.current.textMatrix=Pv,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}const i=new Path2D,s=e.getTransform().invertSelf();for(const{transform:n,x:r,y:a,fontSize:o,path:h}of t)i.addPath(h,new DOMMatrix(n).preMultiplySelf(s).translate(r,a).scale(o,-o));e.clip(i),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var u;const i=this.commonObjs.get(t),s=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=i.fontMatrix||Vf,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&Ht("Invalid font matrix for font "+t),e<0?(e=-e,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=e,i.isType3Font)return;const n=i.loadedName||"sans-serif",r=((u=i.systemFontInfo)==null?void 0:u.css)||`"${n}", ${i.fallbackName}`;let a="normal";i.black?a="900":i.bold&&(a="bold");const o=i.italic?"italic":"normal";let h=e;e<Ym?h=Ym:e>Km&&(h=Km),this.current.fontSizeScale=e/h,this.ctx.font=`${o} ${a} ${h}px ${r}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,i,s,n,r){this.current.textMatrix=[t,e,i,s,n,r],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,i,s,n){const r=this.ctx,a=this.current,o=a.font,h=a.textRenderingMode,u=a.fontSize/a.fontSizeScale,c=h&_i.FILL_STROKE_MASK,f=!!(h&_i.ADD_TO_PATH_FLAG),p=a.patternFill&&!o.missingFile,_=a.patternStroke&&!o.missingFile;let v;if((o.disableFontFace||f||p||_)&&(v=o.getPathGenerator(this.commonObjs,t)),o.disableFontFace||p||_){r.save(),r.translate(e,i),r.scale(u,-u);let g;if((c===_i.FILL||c===_i.FILL_STROKE)&&(s?(g=r.getTransform(),r.setTransform(...s),r.fill(k(this,$s,bp).call(this,v,g,s))):r.fill(v)),c===_i.STROKE||c===_i.FILL_STROKE)if(n){g||(g=r.getTransform()),r.setTransform(...n);const{a:b,b:w,c:S,d:T}=g,A=Et.inverseTransform(n),C=Et.transform([b,w,S,T,0,0],A),[R,P]=Et.singularValueDecompose2dScale(C);r.lineWidth*=Math.max(R,P)/u,r.stroke(k(this,$s,bp).call(this,v,g,n))}else r.lineWidth/=u,r.stroke(v);r.restore()}else(c===_i.FILL||c===_i.FILL_STROKE)&&r.fillText(t,e,i),(c===_i.STROKE||c===_i.FILL_STROKE)&&r.strokeText(t,e,i);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:xe(r),x:e,y:i,fontSize:u,path:v})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let i=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){i=!0;break}return Zt(this,"isFontSubpixelAAEnabled",i)}showText(t){const e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);const s=e.fontSize;if(s===0)return;const n=this.ctx,r=e.fontSizeScale,a=e.charSpacing,o=e.wordSpacing,h=e.fontDirection,u=e.textHScale*h,c=t.length,f=i.vertical,p=f?1:-1,_=i.defaultVMetrics,v=s*e.fontMatrix[0],g=e.textRenderingMode===_i.FILL&&!i.disableFontFace&&!e.patternFill;n.save(),n.transform(...e.textMatrix),n.translate(e.x,e.y+e.textRise),h>0?n.scale(u,-1):n.scale(u,1);let b,w;if(e.patternFill){n.save();const R=e.fillColor.getPattern(n,this,Xs(n),mi.FILL);b=xe(n),n.restore(),n.fillStyle=R}if(e.patternStroke){n.save();const R=e.strokeColor.getPattern(n,this,Xs(n),mi.STROKE);w=xe(n),n.restore(),n.strokeStyle=R}let S=e.lineWidth;const T=e.textMatrixScale;if(T===0||S===0){const R=e.textRenderingMode&_i.FILL_STROKE_MASK;(R===_i.STROKE||R===_i.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=T;if(r!==1&&(n.scale(r,r),S/=r),n.lineWidth=S,i.isInvalidPDFjsFont){const R=[];let P=0;for(const N of t)R.push(N.unicode),P+=N.width;n.fillText(R.join(""),0,0),e.x+=P*v*u,n.restore(),this.compose();return}let A=0,C;for(C=0;C<c;++C){const R=t[C];if(typeof R=="number"){A+=p*R*s/1e3;continue}let P=!1;const N=(R.isSpace?o:0)+a,F=R.fontChar,z=R.accent;let q,X,tt=R.width;if(f){const Q=R.vmetric||_,J=-(R.vmetric?Q[1]:tt*.5)*v,et=Q[2]*v;tt=Q?-Q[0]:tt,q=J/r,X=(A+et)/r}else q=A/r,X=0;if(i.remeasure&&tt>0){const Q=n.measureText(F).width*1e3/s*r;if(tt<Q&&this.isFontSubpixelAAEnabled){const J=tt/Q;P=!0,n.save(),n.scale(J,1),q/=J}else tt!==Q&&(q+=(tt-Q)/2e3*s/r)}if(this.contentVisible&&(R.isInFont||i.missingFile)){if(g&&!z)n.fillText(F,q,X);else if(this.paintChar(F,q,X,b,w),z){const Q=q+s*z.offset.x/r,J=X-s*z.offset.y/r;this.paintChar(z.fontChar,Q,J,b,w)}}const st=f?tt*v-N*h:tt*v+N*h;A+=st,P&&n.restore()}f?e.y-=A:e.x+=A*u,n.restore(),this.compose()}showType3Text(t){const e=this.ctx,i=this.current,s=i.font,n=i.fontSize,r=i.fontDirection,a=s.vertical?1:-1,o=i.charSpacing,h=i.wordSpacing,u=i.textHScale*r,c=i.fontMatrix||Vf,f=t.length,p=i.textRenderingMode===_i.INVISIBLE;let _,v,g,b;if(!(p||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...i.textMatrix),e.translate(i.x,i.y+i.textRise),e.scale(u,r),_=0;_<f;++_){if(v=t[_],typeof v=="number"){b=a*v*n/1e3,this.ctx.translate(b,0),i.x+=b*u;continue}const w=(v.isSpace?h:0)+o,S=s.charProcOperatorList[v.operatorListId];S?this.contentVisible&&(this.processingType3=v,this.save(),e.scale(n,n),e.transform(...c),this.executeOperatorList(S),this.restore()):Ht(`Type3 character "${v.operatorListId}" is not available.`),g=Et.applyTransform([v.width,0],c)[0]*n+w,e.translate(g,0),i.x+=g*u}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,i,s,n,r){this.ctx.rect(i,s,n-i,r-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const i=this.baseTransform||xe(this.ctx),s={createCanvasGraphics:n=>new Lg(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new gp(t,this.ctx,s,i)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,i){this.ctx.strokeStyle=this.current.strokeColor=Et.makeHexColor(t,e,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,i){this.ctx.fillStyle=this.current.fillColor=Et.makeHexColor(t,e,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=u2(this.getObject(t)),this.cachedPatterns.set(t,i)),e&&(i.matrix=e),i}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const i=this._getPattern(t);e.fillStyle=i.getPattern(e,this,Xs(e),mi.SHADING);const s=Xs(e);if(s){const{width:n,height:r}=e.canvas,[a,o,h,u]=Et.getAxialAlignedBoundingBox([0,0,n,r],s);this.ctx.fillRect(a,o,h-a,u-o)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){me("Should not call beginInlineImage")}beginImageData(){me("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=xe(this.ctx),e)){const i=e[2]-e[0],s=e[3]-e[1];this.ctx.rect(e[0],e[1],i,s),this.current.updateRectMinMax(xe(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||Nd("TODO: Support non-isolated groups."),t.knockout&&Ht("Knockout groups not supported.");const i=xe(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=Et.getAxialAlignedBoundingBox(t.bbox,xe(e));const n=[0,0,e.canvas.width,e.canvas.height];s=Et.intersect(s,n)||[0,0,0,0];const r=Math.floor(s[0]),a=Math.floor(s[1]),o=Math.max(Math.ceil(s[2])-r,1),h=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,o,h]);let u="groupAt"+this.groupLevel;t.smask&&(u+="_smask_"+this.smaskCounter++%2);const c=this.cachedCanvases.getCanvas(u,o,h),f=c.context;f.translate(-r,-a),f.transform(...i);let p=new Path2D;const[_,v,g,b]=t.bbox;if(p.rect(_,v,g-_,b-v),t.matrix){const w=new Path2D;w.addPath(p,new DOMMatrix(t.matrix)),p=w}f.clip(p),t.smask?this.smaskStack.push({canvas:c.canvas,context:f,offsetX:r,offsetY:a,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,a),e.save()),Zl(e,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=xe(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const n=Et.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],s);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(t,e,i,s,n){if(k(this,$s,mp).call(this),lc(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const r=e[2]-e[0],a=e[3]-e[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=e[0],i[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=r,e[3]=a;const[o,h]=Et.singularValueDecompose2dScale(xe(this.ctx)),{viewportScale:u}=this,c=Math.ceil(r*this.outputScaleX*u),f=Math.ceil(a*this.outputScaleY*u);this.annotationCanvas=this.canvasFactory.create(c,f);const{canvas:p,context:_}=this.annotationCanvas;this.annotationCanvasMap.set(t,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=_,this.ctx.save(),this.ctx.setTransform(o,0,0,-h,0,a*h),lc(this.ctx)}else lc(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],r,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Qm(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),k(this,$s,vp).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const i=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=g2(t)),s.compiled)){i.fill(s.compiled);return}const n=this._createMaskCanvas(t),r=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,n.offsetX,n.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i=0,s=0,n,r){if(!this.contentVisible)return;t=this.getObject(t.data,t);const a=this.ctx;a.save();const o=xe(a);a.transform(e,i,s,n,0,0);const h=this._createMaskCanvas(t);a.setTransform(1,0,0,1,h.offsetX-o[4],h.offsetY-o[5]);for(let u=0,c=r.length;u<c;u+=2){const f=Et.transform(o,[e,i,s,n,r[u],r[u+1]]),[p,_]=Et.applyTransform([0,0],f);a.drawImage(h.canvas,p,_)}a.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(const n of t){const{data:r,width:a,height:o,transform:h}=n,u=this.cachedCanvases.getCanvas("maskCanvas",a,o),c=u.context;c.save();const f=this.getObject(r,n);ev(c,f),c.globalCompositeOperation="source-in",c.fillStyle=s?i.getPattern(c,this,Xs(e),mi.FILL):i,c.fillRect(0,0,a,o),c.restore(),e.save(),e.transform(...h),e.scale(1,-1),oc(e,u.canvas,0,0,a,o,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){Ht("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,i,s){if(!this.contentVisible)return;const n=this.getObject(t);if(!n){Ht("Dependent image isn't ready yet");return}const r=n.width,a=n.height,o=[];for(let h=0,u=s.length;h<u;h+=2)o.push({transform:[e,0,0,i,s[h],s[h+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(n,o)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:i,height:s}=t,n=this.cachedCanvases.getCanvas("inlineImage",i,s),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",n.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,i=t.height,s=this.ctx;if(this.save(),!gi){const{filter:a}=s;a!=="none"&&a!==""&&(s.filter="none")}s.scale(1/e,-1/i);let n;if(t.bitmap)n=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)n=t;else{const o=this.cachedCanvases.getCanvas("inlineImage",e,i).context;tv(o,t),n=this.applyTransferMapsToCanvas(o)}const r=this._scaleImage(n,Xs(s));s.imageSmoothingEnabled=iv(xe(s),t.interpolate),oc(s,r.img,0,0,r.paintWidth,r.paintHeight,0,-i,e,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const i=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const n=t.width,r=t.height,o=this.cachedCanvases.getCanvas("inlineImage",n,r).context;tv(o,t),s=this.applyTransferMapsToCanvas(o)}for(const n of e)i.save(),i.transform(...n.transform),i.scale(1,-1),oc(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t,e){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(i||(this.pendingClip===sv?s.clip(t,"evenodd"):s.clip(t)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=xe(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:i,c:s,d:n}=this.ctx.getTransform();let r,a;if(i===0&&s===0){const o=Math.abs(e),h=Math.abs(n);if(o===h)if(t===0)r=a=1/o;else{const u=o*t;r=a=u<1?1/u:1}else if(t===0)r=1/o,a=1/h;else{const u=o*t,c=h*t;r=u<1?1/u:1,a=c<1?1/c:1}}else{const o=Math.abs(e*n-i*s),h=Math.hypot(e,i),u=Math.hypot(s,n);if(t===0)r=u/o,a=h/o;else{const c=t*o;r=u>c?u/c:1,a=h>c?h/c:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:i,current:{lineWidth:s}}=this,[n,r]=this.getScaleForStroking();if(n===r){i.lineWidth=(s||1)*n,i.stroke(t);return}const a=i.getLineDash();e&&i.save(),i.scale(n,r),Mf.a=1/n,Mf.d=1/r;const o=new Path2D;if(o.addPath(t,Mf),a.length>0){const h=Math.max(n,r);i.setLineDash(a.map(u=>u/h)),i.lineDashOffset/=h}i.lineWidth=s||1,i.stroke(o),e&&i.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};$s=new WeakSet,mp=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},vp=function(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}},bp=function(t,e,i){const s=new Path2D;return s.addPath(t,new DOMMatrix(i).invertSelf().multiplySelf(e)),s};let Po=Lg;for(const d in Qc)Po.prototype[d]!==void 0&&(Po.prototype[Qc[d]]=Po.prototype[d]);var Yh,Kh;class Zn{static get workerPort(){return l(this,Yh)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");x(this,Yh,t)}static get workerSrc(){return l(this,Kh)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");x(this,Kh,t)}}Yh=new WeakMap,Kh=new WeakMap,D(Zn,Yh,null),D(Zn,Kh,"");var Sa,Zh;class y2{constructor({parsedData:t,rawData:e}){D(this,Sa);D(this,Zh);x(this,Sa,t),x(this,Zh,e)}getRaw(){return l(this,Zh)}get(t){return l(this,Sa).get(t)??null}getAll(){return bg(l(this,Sa))}has(t){return l(this,Sa).has(t)}}Sa=new WeakMap,Zh=new WeakMap;const Do=Symbol("INTERNAL");var Jh,Qh,tu,tl;class w2{constructor(t,{name:e,intent:i,usage:s,rbGroups:n}){D(this,Jh,!1);D(this,Qh,!1);D(this,tu,!1);D(this,tl,!0);x(this,Jh,!!(t&os.DISPLAY)),x(this,Qh,!!(t&os.PRINT)),this.name=e,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(l(this,tu))return l(this,tl);if(!l(this,tl))return!1;const{print:t,view:e}=this.usage;return l(this,Jh)?(e==null?void 0:e.viewState)!=="OFF":l(this,Qh)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,i=!1){t!==Do&&me("Internal method `_setVisible` called."),x(this,tu,i),x(this,tl,e)}}Jh=new WeakMap,Qh=new WeakMap,tu=new WeakMap,tl=new WeakMap;var Ar,fe,el,il,eu,yp;class _2{constructor(t,e=os.DISPLAY){D(this,eu);D(this,Ar,null);D(this,fe,new Map);D(this,el,null);D(this,il,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,x(this,il,t.order);for(const i of t.groups)l(this,fe).set(i.id,new w2(e,i));if(t.baseState==="OFF")for(const i of l(this,fe).values())i._setVisible(Do,!1);for(const i of t.on)l(this,fe).get(i)._setVisible(Do,!0);for(const i of t.off)l(this,fe).get(i)._setVisible(Do,!1);x(this,el,this.getHash())}}isVisible(t){if(l(this,fe).size===0)return!0;if(!t)return Nd("Optional content group not defined."),!0;if(t.type==="OCG")return l(this,fe).has(t.id)?l(this,fe).get(t.id).visible:(Ht(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return k(this,eu,yp).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!l(this,fe).has(e))return Ht(`Optional content group not found: ${e}`),!0;if(l(this,fe).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!l(this,fe).has(e))return Ht(`Optional content group not found: ${e}`),!0;if(!l(this,fe).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!l(this,fe).has(e))return Ht(`Optional content group not found: ${e}`),!0;if(!l(this,fe).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!l(this,fe).has(e))return Ht(`Optional content group not found: ${e}`),!0;if(l(this,fe).get(e).visible)return!1}return!0}return Ht(`Unknown optional content policy ${t.policy}.`),!0}return Ht(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){var n;const s=l(this,fe).get(t);if(!s){Ht(`Optional content group not found: ${t}`);return}if(i&&e&&s.rbGroups.length)for(const r of s.rbGroups)for(const a of r)a!==t&&((n=l(this,fe).get(a))==null||n._setVisible(Do,!1,!0));s._setVisible(Do,!!e,!0),x(this,Ar,null)}setOCGState({state:t,preserveRB:e}){let i;for(const s of t){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}const n=l(this,fe).get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!n.visible,e);break}}x(this,Ar,null)}get hasInitialVisibility(){return l(this,el)===null||this.getHash()===l(this,el)}getOrder(){return l(this,fe).size?l(this,il)?l(this,il).slice():[...l(this,fe).keys()]:null}getGroups(){return l(this,fe).size>0?bg(l(this,fe)):null}getGroup(t){return l(this,fe).get(t)||null}getHash(){if(l(this,Ar)!==null)return l(this,Ar);const t=new p0;for(const[e,i]of l(this,fe))t.update(`${e}:${i.visible}`);return x(this,Ar,t.hexdigest())}}Ar=new WeakMap,fe=new WeakMap,el=new WeakMap,il=new WeakMap,eu=new WeakSet,yp=function(t){const e=t.length;if(e<2)return!0;const i=t[0];for(let s=1;s<e;s++){const n=t[s];let r;if(Array.isArray(n))r=k(this,eu,yp).call(this,n);else if(l(this,fe).has(n))r=l(this,fe).get(n).visible;else return Ht(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return i==="And"};class A2{constructor(t,{disableRange:e=!1,disableStream:i=!1}){Ge(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:n,progressiveDone:r,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,(n==null?void 0:n.length)>0){const o=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(o)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((o,h)=>{this._onReceiveData({begin:o,chunk:h})}),t.addProgressListener((o,h)=>{this._onProgress({loaded:o,total:h})}),t.addProgressiveReadListener(o=>{this._onReceiveData({chunk:o})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const s=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(i),!0)});Ge(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,i,s,n;t.total===void 0?(i=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||i.call(e,{loaded:t.loaded}):(n=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||n.call(s,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Ge(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new E2(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new x2(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeReaders.slice(0))i.cancel(t);this._pdfDataRangeTransport.abort()}}class E2{constructor(t,e,i=!1,s=null){this._stream=t,this._done=i||!1,this._filename=_g(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class x2{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function S2(d){let t=!0,e=i("filename\\*","i").exec(d);if(e){e=e[1];let u=a(e);return u=unescape(u),u=o(u),u=h(u),n(u)}if(e=r(d),e){const u=h(e);return n(u)}if(e=i("filename","i").exec(d),e){e=e[1];let u=a(e);return u=h(u),n(u)}function i(u,c){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',c)}function s(u,c){if(u){if(!/^[\x00-\xFF]+$/.test(c))return c;try{const f=new TextDecoder(u,{fatal:!0}),p=Gu(c);c=f.decode(p),t=!1}catch{}}return c}function n(u){return t&&/[\x80-\xff]/.test(u)&&(u=s("utf-8",u),t&&(u=s("iso-8859-1",u))),u}function r(u){const c=[];let f;const p=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(u))!==null;){let[,v,g,b]=f;if(v=parseInt(v,10),v in c){if(v===0)break;continue}c[v]=[g,b]}const _=[];for(let v=0;v<c.length&&v in c;++v){let[g,b]=c[v];b=a(b),g&&(b=unescape(b),v===0&&(b=o(b))),_.push(b)}return _.join("")}function a(u){if(u.startsWith('"')){const c=u.slice(1).split('\\"');for(let f=0;f<c.length;++f){const p=c[f].indexOf('"');p!==-1&&(c[f]=c[f].slice(0,p),c.length=f+1),c[f]=c[f].replaceAll(/\\(.)/g,"$1")}u=c.join('"')}return u}function o(u){const c=u.indexOf("'");if(c===-1)return u;const f=u.slice(0,c),_=u.slice(c+1).replace(/^[^']*'/,"");return s(f,_)}function h(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(c,f,p,_){if(p==="q"||p==="Q")return _=_.replaceAll("_"," "),_=_.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,g){return String.fromCharCode(parseInt(g,16))}),s(f,_);try{_=atob(_)}catch{}return s(f,_)})}return""}function C0(d,t){const e=new Headers;if(!d||!t||typeof t!="object")return e;for(const i in t){const s=t[i];s!==void 0&&e.append(i,s)}return e}function Pd(d){var t;return((t=URL.parse(d))==null?void 0:t.origin)??null}function T0({responseHeaders:d,isHttp:t,rangeChunkSize:e,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(d.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*e)||i||!t||d.get("Accept-Ranges")!=="bytes"||(d.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function D0(d){const t=d.get("Content-Disposition");if(t){let e=S2(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(_g(e))return e}return null}function Ku(d,t){return new td(`Unexpected server response (${d}) while retrieving PDF "${t}".`,d,d===404||d===0&&t.startsWith("file:"))}function k0(d){return d===200||d===206}function R0(d,t,e){return{method:"GET",headers:d,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function I0(d){return d instanceof Uint8Array?d.buffer:d instanceof ArrayBuffer?d:(Ht(`getArrayBuffer - unexpected data format: ${d}`),new Uint8Array(d).buffer)}class nv{constructor(t){At(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=C0(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ge(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new C2(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new T2(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class C2{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const i=new Headers(t.headers),s=e.url;fetch(s,R0(i,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=Pd(n.url),!k0(n.status))throw Ku(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();const r=n.headers,{allowRangeRequests:a,suggestedLength:o}=T0({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=o||this._contentLength,this._filename=D0(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Vr("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:I0(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class T2{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${i-1}`);const r=s.url;fetch(r,R0(n,this._withCredentials,this._abortController)).then(a=>{const o=Pd(a.url);if(o!==t._responseOrigin)throw new Error(`Expected range response-origin "${o}" to match "${t._responseOrigin}".`);if(!k0(a.status))throw Ku(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:I0(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const Ff=200,Bf=206;function D2(d){const t=d.response;return typeof t!="string"?t:Gu(t).buffer}class k2{constructor({url:t,httpHeaders:e,withCredentials:i}){At(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=C0(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,r]of this.headers)e.setRequestHeader(n,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=Bf):s.expectedStatus=Ff,e.responseType="arraybuffer",Ge(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){var s;const i=this.pendingRequests[t];i&&((s=i.onProgress)==null||s.call(i,e))}onStateChange(t,e){const i=this.pendingRequests[t];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){i.onError(s.status);return}const n=s.status||Ff;if(!(n===Ff&&i.expectedStatus===Bf)&&n!==i.expectedStatus){i.onError(s.status);return}const a=D2(s);if(n===Bf){const o=s.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(o);h?i.onDone({begin:parseInt(h[1],10),chunk:a}):(Ht('Missing or invalid "Content-Range" header.'),i.onError(0))}else a?i.onDone({begin:0,chunk:a}):i.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class R2{constructor(t){this._source=t,this._manager=new k2(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Ge(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new I2(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const i=new N2(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class I2{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Pd(e.responseURL);const i=e.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[o,...h]=a.split(": ");return[o,h.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=T0({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=D0(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Ku(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class N2{constructor(t,e,i){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;const t=Pd((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??(this._storedError=Ku(t,this._url));for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const L2=/^[a-z][a-z0-9\-+.]+:/i;function P2(d){if(L2.test(d))return new URL(d);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(d))}class O2{constructor(t){this.source=t,this.url=P2(t.url),Ge(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ge(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new M2(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new F2(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class M2{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=Ku(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Vr("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class F2{constructor(t,e,i){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=t.source;this._isStreamingSupported=!s.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const B2=1e5,rv=30;var hv,Er,ji,iu,su,Ca,Pn,nu,ru,Ta,sl,nl,xr,rl,au,al,Da,ou,lu,ol,ka,hu,Sr,ll,nr,N0,L0,wp,hs,Sc,_p,P0,O0;const Ke=class Ke{constructor({textContentSource:t,container:e,viewport:i}){D(this,nr);D(this,Er,Promise.withResolvers());D(this,ji,null);D(this,iu,!1);D(this,su,!!((hv=globalThis.FontInspector)!=null&&hv.enabled));D(this,Ca,null);D(this,Pn,null);D(this,nu,0);D(this,ru,0);D(this,Ta,null);D(this,sl,null);D(this,nl,0);D(this,xr,0);D(this,rl,Object.create(null));D(this,au,[]);D(this,al,null);D(this,Da,[]);D(this,ou,new WeakMap);D(this,lu,null);var o;if(t instanceof ReadableStream)x(this,al,t);else if(typeof t=="object")x(this,al,new ReadableStream({start(h){h.enqueue(t),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');x(this,ji,x(this,sl,e)),x(this,xr,i.scale*sr.pixelRatio),x(this,nl,i.rotation),x(this,Pn,{div:null,properties:null,ctx:null});const{pageWidth:s,pageHeight:n,pageX:r,pageY:a}=i.rawDims;x(this,lu,[1,0,0,-1,-r,a+n]),x(this,ru,s),x(this,nu,n),k(o=Ke,hs,P0).call(o),oo(e,i),l(this,Er).promise.finally(()=>{l(Ke,ll).delete(this),x(this,Pn,null),x(this,rl,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=wi.platform;return Zt(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{l(this,Ta).read().then(({value:e,done:i})=>{if(i){l(this,Er).resolve();return}l(this,Ca)??x(this,Ca,e.lang),Object.assign(l(this,rl),e.styles),k(this,nr,N0).call(this,e.items),t()},l(this,Er).reject)};return x(this,Ta,l(this,al).getReader()),l(Ke,ll).add(this),t(),l(this,Er).promise}update({viewport:t,onBefore:e=null}){var n;const i=t.scale*sr.pixelRatio,s=t.rotation;if(s!==l(this,nl)&&(e==null||e(),x(this,nl,s),oo(l(this,sl),{rotation:s})),i!==l(this,xr)){e==null||e(),x(this,xr,i);const r={div:null,properties:null,ctx:k(n=Ke,hs,Sc).call(n,l(this,Ca))};for(const a of l(this,Da))r.properties=l(this,ou).get(a),r.div=a,k(this,nr,wp).call(this,r)}}cancel(){var e;const t=new Vr("TextLayer task cancelled.");(e=l(this,Ta))==null||e.cancel(t).catch(()=>{}),x(this,Ta,null),l(this,Er).reject(t)}get textDivs(){return l(this,Da)}get textContentItemsStr(){return l(this,au)}static cleanup(){if(!(l(this,ll).size>0)){l(this,ol).clear();for(const{canvas:t}of l(this,ka).values())t.remove();l(this,ka).clear()}}};Er=new WeakMap,ji=new WeakMap,iu=new WeakMap,su=new WeakMap,Ca=new WeakMap,Pn=new WeakMap,nu=new WeakMap,ru=new WeakMap,Ta=new WeakMap,sl=new WeakMap,nl=new WeakMap,xr=new WeakMap,rl=new WeakMap,au=new WeakMap,al=new WeakMap,Da=new WeakMap,ou=new WeakMap,lu=new WeakMap,ol=new WeakMap,ka=new WeakMap,hu=new WeakMap,Sr=new WeakMap,ll=new WeakMap,nr=new WeakSet,N0=function(t){var s,n;if(l(this,iu))return;(n=l(this,Pn)).ctx??(n.ctx=k(s=Ke,hs,Sc).call(s,l(this,Ca)));const e=l(this,Da),i=l(this,au);for(const r of t){if(e.length>B2){Ht("Ignoring additional textDivs for performance reasons."),x(this,iu,!0);return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const a=l(this,ji);x(this,ji,document.createElement("span")),l(this,ji).classList.add("markedContent"),r.id!==null&&l(this,ji).setAttribute("id",`${r.id}`),a.append(l(this,ji))}else r.type==="endMarkedContent"&&x(this,ji,l(this,ji).parentNode);continue}i.push(r.str),k(this,nr,L0).call(this,r)}},L0=function(t){var v;const e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};l(this,Da).push(e);const s=Et.transform(l(this,lu),t.transform);let n=Math.atan2(s[1],s[0]);const r=l(this,rl)[t.fontName];r.vertical&&(n+=Math.PI/2);let a=l(this,su)&&r.fontSubstitution||r.fontFamily;a=Ke.fontFamilyMap.get(a)||a;const o=Math.hypot(s[2],s[3]),h=o*k(v=Ke,hs,O0).call(v,a,r,l(this,Ca));let u,c;n===0?(u=s[4],c=s[5]-h):(u=s[4]+h*Math.sin(n),c=s[5]-h*Math.cos(n));const f="calc(var(--total-scale-factor) *",p=e.style;l(this,ji)===l(this,sl)?(p.left=`${(100*u/l(this,ru)).toFixed(2)}%`,p.top=`${(100*c/l(this,nu)).toFixed(2)}%`):(p.left=`${f}${u.toFixed(2)}px)`,p.top=`${f}${c.toFixed(2)}px)`),p.fontSize=`${f}${(l(Ke,Sr)*o).toFixed(2)}px)`,p.fontFamily=a,i.fontSize=o,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,l(this,su)&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),n!==0&&(i.angle=n*(180/Math.PI));let _=!1;if(t.str.length>1)_=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const g=Math.abs(t.transform[0]),b=Math.abs(t.transform[3]);g!==b&&Math.max(g,b)/Math.min(g,b)>1.5&&(_=!0)}if(_&&(i.canvasWidth=r.vertical?t.height:t.width),l(this,ou).set(e,i),l(this,Pn).div=e,l(this,Pn).properties=i,k(this,nr,wp).call(this,l(this,Pn)),i.hasText&&l(this,ji).append(e),i.hasEOL){const g=document.createElement("br");g.setAttribute("role","presentation"),l(this,ji).append(g)}},wp=function(t){var a;const{div:e,properties:i,ctx:s}=t,{style:n}=e;let r="";if(l(Ke,Sr)>1&&(r=`scale(${1/l(Ke,Sr)})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:o}=n,{canvasWidth:h,fontSize:u}=i;k(a=Ke,hs,_p).call(a,s,u*l(this,xr),o);const{width:c}=s.measureText(e.textContent);c>0&&(r=`scaleX(${h*l(this,xr)/c}) ${r}`)}i.angle!==0&&(r=`rotate(${i.angle}deg) ${r}`),r.length>0&&(n.transform=r)},hs=new WeakSet,Sc=function(t=null){let e=l(this,ka).get(t||(t=""));if(!e){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),l(this,ka).set(t,e),l(this,hu).set(e,{size:0,family:""})}return e},_p=function(t,e,i){const s=l(this,hu).get(t);e===s.size&&i===s.family||(t.font=`${e}px ${i}`,s.size=e,s.family=i)},P0=function(){if(l(this,Sr)!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),x(this,Sr,t.getBoundingClientRect().height),t.remove()},O0=function(t,e,i){const s=l(this,ol).get(t);if(s)return s;const n=k(this,hs,Sc).call(this,i);n.canvas.width=n.canvas.height=rv,k(this,hs,_p).call(this,n,rv,t);const r=n.measureText(""),a=r.fontBoundingBoxAscent,o=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let h=.8;return a?h=a/(a+o):(wi.platform.isFirefox&&Ht("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?h=e.ascent:e.descent&&(h=1+e.descent)),l(this,ol).set(t,h),h},D(Ke,hs),D(Ke,ol,new Map),D(Ke,ka,new Map),D(Ke,hu,new WeakMap),D(Ke,Sr,null),D(Ke,ll,new Set);let _h=Ke;class Ah{static textContent(t){const e=[],i={items:e,styles:Object.create(null)};function s(n){var o;if(!n)return;let r=null;const a=n.name;if(a==="#text")r=n.value;else if(Ah.shouldBuildText(a))(o=n==null?void 0:n.attributes)!=null&&o.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&e.push({str:r}),!!n.children)for(const h of n.children)s(h)}return s(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const z2=65536,U2=100;function H2(d={}){typeof d=="string"||d instanceof URL?d={url:d}:(d instanceof ArrayBuffer||ArrayBuffer.isView(d))&&(d={data:d});const t=new Ep,{docId:e}=t,i=d.url?q2(d.url):null,s=d.data?j2(d.data):null,n=d.httpHeaders||null,r=d.withCredentials===!0,a=d.password??null,o=d.range instanceof M0?d.range:null,h=Number.isInteger(d.rangeChunkSize)&&d.rangeChunkSize>0?d.rangeChunkSize:z2;let u=d.worker instanceof Oo?d.worker:null;const c=d.verbosity,f=typeof d.docBaseUrl=="string"&&!Ld(d.docBaseUrl)?d.docBaseUrl:null,p=hc(d.cMapUrl),_=d.cMapPacked!==!1,v=d.CMapReaderFactory||(gi?s2:Vm),g=hc(d.iccUrl),b=hc(d.standardFontDataUrl),w=d.StandardFontDataFactory||(gi?n2:Gm),S=hc(d.wasmUrl),T=d.WasmFactory||(gi?r2:$m),A=d.stopAtErrors!==!0,C=Number.isInteger(d.maxImageSize)&&d.maxImageSize>-1?d.maxImageSize:-1,R=d.isEvalSupported!==!1,P=typeof d.isOffscreenCanvasSupported=="boolean"?d.isOffscreenCanvasSupported:!gi,N=typeof d.isImageDecoderSupported=="boolean"?d.isImageDecoderSupported:!gi&&(wi.platform.isFirefox||!globalThis.chrome),F=Number.isInteger(d.canvasMaxAreaInBytes)?d.canvasMaxAreaInBytes:-1,z=typeof d.disableFontFace=="boolean"?d.disableFontFace:gi,q=d.fontExtraProperties===!0,X=d.enableXfa===!0,tt=d.ownerDocument||globalThis.document,st=d.disableRange===!0,Q=d.disableStream===!0,J=d.disableAutoFetch===!0,et=d.pdfBug===!0,ut=d.CanvasFactory||(gi?i2:Qw),Dt=d.FilterFactory||(gi?e2:t2),ot=d.enableHWA===!0,ct=d.useWasm!==!1,xt=o?o.length:d.length??NaN,Ct=typeof d.useSystemFonts=="boolean"?d.useSystemFonts:!gi&&!z,Mt=typeof d.useWorkerFetch=="boolean"?d.useWorkerFetch:!!(v===Vm&&w===Gm&&T===$m&&p&&b&&S&&xo(p,document.baseURI)&&xo(b,document.baseURI)&&xo(S,document.baseURI)),Yt=null;Iw(c);const Rt={canvasFactory:new ut({ownerDocument:tt,enableHWA:ot}),filterFactory:new Dt({docId:e,ownerDocument:tt}),cMapReaderFactory:Mt?null:new v({baseUrl:p,isCompressed:_}),standardFontDataFactory:Mt?null:new w({baseUrl:b}),wasmFactory:Mt?null:new T({baseUrl:S})};if(!u){const ie={verbosity:c,port:Zn.workerPort};u=ie.port?Oo.fromPort(ie):new Oo(ie),t._worker=u}const kt={docId:e,apiVersion:"5.1.91",data:s,password:a,disableAutoFetch:J,rangeChunkSize:h,length:xt,docBaseUrl:f,enableXfa:X,evaluatorOptions:{maxImageSize:C,disableFontFace:z,ignoreErrors:A,isEvalSupported:R,isOffscreenCanvasSupported:P,isImageDecoderSupported:N,canvasMaxAreaInBytes:F,fontExtraProperties:q,useSystemFonts:Ct,useWasm:ct,useWorkerFetch:Mt,cMapUrl:p,iccUrl:g,standardFontDataUrl:b,wasmUrl:S}},se={ownerDocument:tt,pdfBug:et,styleElement:Yt,loadingParams:{disableAutoFetch:J,enableXfa:X}};return u.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const ie=u.messageHandler.sendWithPromise("GetDocRequest",kt,s?[s.buffer]:null);let Pt;if(o)Pt=new A2(o,{disableRange:st,disableStream:Q});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");let zt;if(gi)if(xo(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");zt=nv}else zt=O2;else zt=xo(i)?nv:R2;Pt=new zt({url:i,length:xt,httpHeaders:n,withCredentials:r,rangeChunkSize:h,disableRange:st,disableStream:Q})}return ie.then(zt=>{if(t.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const qt=new rh(e,zt,u.port),Kt=new Y2(qt,t,Pt,se,Rt);t._transport=Kt,qt.send("Ready",null)})}).catch(t._capability.reject),t}function q2(d){if(d instanceof URL)return d.href;if(typeof d=="string"){if(gi)return d;const t=URL.parse(d,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function j2(d){if(gi&&typeof Buffer<"u"&&d instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(d instanceof Uint8Array&&d.byteLength===d.buffer.byteLength)return d;if(typeof d=="string")return Gu(d);if(d instanceof ArrayBuffer||ArrayBuffer.isView(d)||typeof d=="object"&&!isNaN(d==null?void 0:d.length))return new Uint8Array(d);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function hc(d){if(typeof d!="string")return null;if(d.endsWith("/"))return d;throw new Error(`Invalid factory url: "${d}" must include trailing slash.`)}const Ap=d=>typeof d=="object"&&Number.isInteger(d==null?void 0:d.num)&&d.num>=0&&Number.isInteger(d==null?void 0:d.gen)&&d.gen>=0,W2=d=>typeof d=="object"&&typeof(d==null?void 0:d.name)=="string",V2=Hw.bind(null,Ap,W2);var md;const vd=class vd{constructor(){At(this,"_capability",Promise.withResolvers());At(this,"_transport",null);At(this,"_worker",null);At(this,"docId",`d${ki(vd,md)._++}`);At(this,"destroyed",!1);At(this,"onPassword",null);At(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var t,e,i,s;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(n){throw(i=this._worker)!=null&&i.port&&delete this._worker._pendingDestroy,n}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}async getData(){return this._transport.getData()}};md=new WeakMap,D(vd,md,0);let Ep=vd;class M0{constructor(t,e,i=!1,s=null){this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const i of this._rangeListeners)i(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(const i of this._progressListeners)i(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){me("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class G2{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Zt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var On,Ra,uh;class $2{constructor(t,e,i,s=!1){D(this,Ra);D(this,On,!1);this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=s?new qm:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new F0,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new Xu({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Zt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:e,intent:i="display",annotationMode:s=ar.ENABLE,transform:n=null,background:r=null,optionalContentConfigPromise:a=null,annotationCanvasMap:o=null,pageColors:h=null,printAnnotationStorage:u=null,isEditing:c=!1}){var T,A;(T=this._stats)==null||T.time("Overall");const f=this._transport.getRenderingIntent(i,s,u,c),{renderingIntent:p,cacheKey:_}=f;x(this,On,!1),a||(a=this._transport.getOptionalContentConfig(p));let v=this._intentStates.get(_);v||(v=Object.create(null),this._intentStates.set(_,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);const g=!!(p&os.PRINT);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(A=this._stats)==null||A.time("Page Request"),this._pumpOperatorList(f));const b=C=>{var R;v.renderTasks.delete(w),g&&x(this,On,!0),k(this,Ra,uh).call(this),C?(w.capability.reject(C),this._abortOperatorList({intentState:v,reason:C instanceof Error?C:new Error(C)})):w.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(R=globalThis.Stats)!=null&&R.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},w=new Sp({callback:b,params:{canvasContext:t,viewport:e,transform:n,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:o,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!g,pdfBug:this._pdfBug,pageColors:h});(v.renderTasks||(v.renderTasks=new Set)).add(w);const S=w.task;return Promise.all([v.displayReadyCapability.promise,a]).then(([C,R])=>{var P;if(this.destroyed){b();return}if((P=this._stats)==null||P.time("Rendering"),!(R.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");w.initializeGraphics({transparency:C,optionalContentConfig:R}),w.operatorListChanged()}).catch(b),S}getOperatorList({intent:t="display",annotationMode:e=ar.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){var h;function n(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(o))}const r=this._transport.getRenderingIntent(t,e,i,s,!0);let a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let o;return a.opListReadCapability||(o=Object.create(null),o.operatorListChanged=n,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(o),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>Ah.textContent(i));const e=this.streamTextContent(t);return new Promise(function(i,s){function n(){r.read().then(function({value:o,done:h}){if(h){i(a);return}a.lang??(a.lang=o.lang),Object.assign(a.styles,o.styles),a.items.push(...o.items),n()},s)}const r=e.getReader(),a={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),x(this,On,!1),Promise.all(t)}cleanup(t=!1){x(this,On,!0);const e=k(this,Ra,uh).call(this);return t&&e&&this._stats&&(this._stats=new qm),e}_startRenderPage(t,e){var s,n;const i=this._intentStates.get(e);i&&((s=this._stats)==null||s.timeEnd("Page Request"),(n=i.displayReadyCapability)==null||n.resolve(t))}_renderPageChunk(t,e){for(let i=0,s=t.length;i<s;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const i of e.renderTasks)i.operatorListChanged();t.lastChunk&&k(this,Ra,uh).call(this)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:s}){const{map:n,transfer:r}=i,o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:s},r).getReader(),h=this._intentStates.get(e);h.streamReader=o;const u=()=>{o.read().then(({value:c,done:f})=>{if(f){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(c,h),u())},c=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const f of h.renderTasks)f.operatorListChanged();k(this,Ra,uh).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(c);else if(h.opListReadCapability)h.opListReadCapability.reject(c);else throw c}})};u()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof wg){let s=U2;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new Vr(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[s,n]of this._intentStates)if(n===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}On=new WeakMap,Ra=new WeakSet,uh=function(){if(!l(this,On)||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),x(this,On,!1),!0};var Mn,bd;class X2{constructor(){D(this,Mn,new Map);D(this,bd,Promise.resolve())}postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};l(this,bd).then(()=>{for(const[s]of l(this,Mn))s.call(this,i)})}addEventListener(t,e,i=null){let s=null;if((i==null?void 0:i.signal)instanceof AbortSignal){const{signal:n}=i;if(n.aborted){Ht("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);s=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}l(this,Mn).set(e,s)}removeEventListener(t,e){const i=l(this,Mn).get(e);i==null||i(),l(this,Mn).delete(e)}terminate(){for(const[,t]of l(this,Mn))t==null||t();l(this,Mn).clear()}}Mn=new WeakMap,bd=new WeakMap;var yd,Ia,Na,hl,Cc,ul,Tc;const Ae=class Ae{constructor({name:t=null,port:e=null,verbosity:i=Nw()}={}){D(this,hl);var s;if(this.name=t,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if((s=l(Ae,Na))!=null&&s.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(l(Ae,Na)||x(Ae,Na,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new rh("main","worker",t),this._messageHandler.on("ready",function(){}),k(this,hl,Cc).call(this)}_initialize(){if(l(Ae,Ia)||l(Ae,ul,Tc)){this._setupFakeWorker();return}let{workerSrc:t}=Ae;try{Ae._isSameOrigin(window.location,t)||(t=Ae._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),i=new rh("main","worker",e),s=()=>{n.abort(),i.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;e.addEventListener("error",()=>{this._webWorker||s()},{signal:n.signal}),i.on("test",a=>{if(n.abort(),this.destroyed||!a){s();return}this._messageHandler=i,this._port=e,this._webWorker=e,k(this,hl,Cc).call(this)}),i.on("ready",a=>{if(n.abort(),this.destroyed){s();return}try{r()}catch{this._setupFakeWorker()}});const r=()=>{const a=new Uint8Array;i.send("test",a,[a.buffer])};r();return}catch{Nd("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){l(Ae,Ia)||(Ht("Setting up fake worker."),x(Ae,Ia,!0)),Ae._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new X2;this._port=e;const i=`fake${ki(Ae,yd)._++}`,s=new rh(i+"_worker",i,e);t.setup(s,e),this._messageHandler=new rh(i,i+"_worker",e),k(this,hl,Cc).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){var t,e,i;this.destroyed=!0,(t=this._webWorker)==null||t.terminate(),this._webWorker=null,(e=l(Ae,Na))==null||e.delete(this._port),this._port=null,(i=this._messageHandler)==null||i.destroy(),this._messageHandler=null}static fromPort(t){var i;if(!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const e=(i=l(this,Na))==null?void 0:i.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Ae(t)}static get workerSrc(){if(Zn.workerSrc)return Zn.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Zt(this,"_setupFakeWorkerGlobal",(async()=>l(this,ul,Tc)?l(this,ul,Tc):(await import(this.workerSrc)).WorkerMessageHandler)())}};yd=new WeakMap,Ia=new WeakMap,Na=new WeakMap,hl=new WeakSet,Cc=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},ul=new WeakSet,Tc=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}},D(Ae,ul),D(Ae,yd,0),D(Ae,Ia,!1),D(Ae,Na),gi&&(x(Ae,Ia,!0),Zn.workerSrc||(Zn.workerSrc="./pdf.worker.mjs")),Ae._isSameOrigin=(t,e)=>{const i=URL.parse(t);if(!(i!=null&&i.origin)||i.origin==="null")return!1;const s=new URL(e,i);return i.origin===s.origin},Ae._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};let Oo=Ae;var Fn,on,cl,dl,Bn,La,ch;class Y2{constructor(t,e,i,s,n){D(this,La);D(this,Fn,new Map);D(this,on,new Map);D(this,cl,new Map);D(this,dl,new Map);D(this,Bn,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new F0,this.fontLoader=new Zw({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Zt(this,"annotationStorage",new Sg)}getRenderingIntent(t,e=ar.ENABLE,i=null,s=!1,n=!1){let r=os.DISPLAY,a=cp;switch(t){case"any":r=os.ANY;break;case"display":break;case"print":r=os.PRINT;break;default:Ht(`getRenderingIntent - invalid intent: ${t}`)}const o=r&os.PRINT&&i instanceof m0?i:this.annotationStorage;switch(e){case ar.DISABLE:r+=os.ANNOTATIONS_DISABLE;break;case ar.ENABLE:break;case ar.ENABLE_FORMS:r+=os.ANNOTATIONS_FORMS;break;case ar.ENABLE_STORAGE:r+=os.ANNOTATIONS_STORAGE,a=o.serializable;break;default:Ht(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(r+=os.IS_EDITING),n&&(r+=os.OPLIST);const{ids:h,hash:u}=o.modifiedIds,c=[r,a.hash,u];return{renderingIntent:r,cacheKey:c.join("_"),annotationStorageSerializable:a,modifiedIds:h}}destroy(){var i;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(i=l(this,Bn))==null||i.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of l(this,on).values())t.push(s._destroy());l(this,on).clear(),l(this,cl).clear(),l(this,dl).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var s,n;this.commonObjs.clear(),this.fontLoader.clear(),l(this,Fn).clear(),this.filterFactory.destroy(),_h.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new Vr("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,s)=>{Ge(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){s.close();return}Ge(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async i=>{var a;await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:n,contentLength:r}=this._fullReader;return(!s||!n)&&(this._lastProgress&&((a=e.onProgress)==null||a.call(e,this._lastProgress)),this._fullReader.onProgress=o=>{var h;(h=e.onProgress)==null||h.call(e,{loaded:o.loaded,total:o.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:r}}),t.on("GetRangeReader",(i,s)=>{Ge(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:r,done:a}){if(a){s.close();return}Ge(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{n.cancel(r),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new G2(i,this))}),t.on("DocException",i=>{e._capability.reject(Ui(i))}),t.on("PasswordRequest",i=>{x(this,Bn,Promise.withResolvers());try{if(!e.onPassword)throw Ui(i);const s=n=>{n instanceof Error?l(this,Bn).reject(n):l(this,Bn).resolve({password:n})};e.onPassword(s,i.code)}catch(s){l(this,Bn).reject(s)}return l(this,Bn).promise}),t.on("DataLoaded",i=>{var s;(s=e.onProgress)==null||s.call(e,{loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;l(this,on).get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,s,n])=>{var r;if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":if("error"in n){const u=n.error;Ht(`Error during font loading: ${u}`),this.commonObjs.resolve(i,u);break}const a=this._params.pdfBug&&((r=globalThis.FontInspector)!=null&&r.enabled)?(u,c)=>globalThis.FontInspector.fontAdded(u,c):null,o=new Jw(n,a);this.fontLoader.bind(o).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!o.fontExtraProperties&&o.data&&(o.data=null),this.commonObjs.resolve(i,o)});break;case"CopyLocalImage":const{imageRef:h}=n;Ge(h,"The imageRef must be defined.");for(const u of l(this,on).values())for(const[,c]of u.objs)if((c==null?void 0:c.ref)===h)return c.dataLen?(this.commonObjs.resolve(i,structuredClone(c)),c.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([i,s,n,r])=>{var o;if(this.destroyed)return;const a=l(this,on).get(s);if(!a.objs.has(i)){if(a._intentStates.size===0){(o=r==null?void 0:r.bitmap)==null||o.close();return}switch(n){case"Image":case"Pattern":a.objs.resolve(i,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",i=>{var s;this.destroyed||(s=e.onProgress)==null||s.call(e,{loaded:i.loaded,total:i.total})}),t.on("FetchBinaryData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[i.type];if(!s)throw new Error(`${i.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var i;this.annotationStorage.size<=0&&Ht("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:((i=this._fullReader)==null?void 0:i.filename)??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=l(this,cl).get(e);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&l(this,dl).set(n.refStr,t);const r=new $2(e,n,this,this._params.pdfBug);return l(this,on).set(e,r),r});return l(this,cl).set(e,s),s}getPageIndex(t){return Ap(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return k(this,La,ch).call(this,"GetFieldObjects")}hasJSActions(){return k(this,La,ch).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return k(this,La,ch).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return k(this,La,ch).call(this,"GetOptionalContentConfig").then(e=>new _2(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=l(this,Fn).get(t);if(e)return e;const i=this.messageHandler.sendWithPromise(t,null).then(s=>{var n,r;return{info:s[0],metadata:s[1]?new y2(s[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((r=this._fullReader)==null?void 0:r.contentLength)??null}});return l(this,Fn).set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of l(this,on).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),l(this,Fn).clear(),this.filterFactory.destroy(!0),_h.cleanup()}}cachedPageNumber(t){if(!Ap(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return l(this,dl).get(e)??null}}Fn=new WeakMap,on=new WeakMap,cl=new WeakMap,dl=new WeakMap,Bn=new WeakMap,La=new WeakSet,ch=function(t,e=null){const i=l(this,Fn).get(t);if(i)return i;const s=this.messageHandler.sendWithPromise(t,e);return l(this,Fn).set(t,s),s};const Jl=Symbol("INITIAL_DATA");var Zi,uu,xp;class F0{constructor(){D(this,uu);D(this,Zi,Object.create(null))}get(t,e=null){if(e){const s=k(this,uu,xp).call(this,t);return s.promise.then(()=>e(s.data)),null}const i=l(this,Zi)[t];if(!i||i.data===Jl)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){const e=l(this,Zi)[t];return!!e&&e.data!==Jl}delete(t){const e=l(this,Zi)[t];return!e||e.data===Jl?!1:(delete l(this,Zi)[t],!0)}resolve(t,e=null){const i=k(this,uu,xp).call(this,t);i.data=e,i.resolve()}clear(){var t;for(const e in l(this,Zi)){const{data:i}=l(this,Zi)[e];(t=i==null?void 0:i.bitmap)==null||t.close()}x(this,Zi,Object.create(null))}*[Symbol.iterator](){for(const t in l(this,Zi)){const{data:e}=l(this,Zi)[t];e!==Jl&&(yield[t,e])}}}Zi=new WeakMap,uu=new WeakSet,xp=function(t){var e;return(e=l(this,Zi))[t]||(e[t]={...Promise.withResolvers(),data:Jl})};var Cr;class K2{constructor(t){D(this,Cr,null);At(this,"onContinue",null);At(this,"onError",null);x(this,Cr,t)}get promise(){return l(this,Cr).capability.promise}cancel(t=0){l(this,Cr).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=l(this,Cr).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=l(this,Cr);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}Cr=new WeakMap;var Tr,Pa;const ta=class ta{constructor({callback:t,params:e,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:r,pageIndex:a,canvasFactory:o,filterFactory:h,useRequestAnimationFrame:u=!1,pdfBug:c=!1,pageColors:f=null}){D(this,Tr,null);this.callback=t,this.params=e,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=o,this.filterFactory=h,this._pdfBug=c,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new K2(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var a,o;if(this.cancelled)return;if(this._canvas){if(l(ta,Pa).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");l(ta,Pa).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:s,transform:n,background:r}=this.params;this.gfx=new Po(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:s,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(o=this.graphicsReadyCallback)==null||o.call(this)}cancel(t=null,e=0){var i,s,n;this.running=!1,this.cancelled=!0,(i=this.gfx)==null||i.endDrawing(),l(this,Tr)&&(window.cancelAnimationFrame(l(this,Tr)),x(this,Tr,null)),l(ta,Pa).delete(this._canvas),t||(t=new wg(`Rendering cancelled, page ${this._pageIndex+1}`,e)),this.callback(t),(n=(s=this.task).onError)==null||n.call(s,t)}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?x(this,Tr,window.requestAnimationFrame(()=>{x(this,Tr,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),l(ta,Pa).delete(this._canvas),this.callback())))}};Tr=new WeakMap,Pa=new WeakMap,D(ta,Pa,new WeakSet);let Sp=ta;const Z2="5.1.91",J2="45cbe8bb0";function av(d){return Math.floor(Math.max(0,Math.min(1,d))*255).toString(16).padStart(2,"0")}function Ql(d){return Math.max(0,Math.min(255,255*d))}class ov{static CMYK_G([t,e,i,s]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Ql(t),[t,t,t]}static G_HTML([t]){const e=av(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(Ql)}static RGB_HTML(t){return`#${t.map(av).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,i,s]){return[Ql(1-Math.min(1,t+s)),Ql(1-Math.min(1,i+s)),Ql(1-Math.min(1,e+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){const s=1-t,n=1-e,r=1-i,a=Math.min(s,n,r);return["CMYK",s,n,r,a]}}class Q2{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){me("Abstract method `_createSVG` called.")}}class sd extends Q2{_createSVG(t){return document.createElementNS(yn,t)}}class B0{static setupStorage(t,e,i,s,n){const r=s.getValue(e,{value:null});switch(i.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),n==="print")break;t.addEventListener("input",a=>{s.setValue(e,{value:a.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(r.value===i.attributes.xfaOn?t.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",a=>{s.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),n==="print")break;t.addEventListener("input",a=>{s.setValue(e,{value:a.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const a of i.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const o=a.target.options,h=o.selectedIndex===-1?"":o[o.selectedIndex].value;s.setValue(e,{value:h})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:s,linkService:n}){const{attributes:r}=e,a=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${s}`);for(const[o,h]of Object.entries(r))if(h!=null)switch(o){case"class":h.length&&t.setAttribute(o,h.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",h);break;case"style":Object.assign(t.style,h);break;case"textContent":t.textContent=h;break;default:(!a||o!=="href"&&o!=="newWindow")&&t.setAttribute(o,h)}a&&n.addLinkAttributes(t,r.href,r.newWindow),i&&r.dataId&&this.setupStorage(t,r.dataId,e,i)}static render(t){var c,f;const e=t.annotationStorage,i=t.linkService,s=t.xfaHtml,n=t.intent||"display",r=document.createElement(s.name);s.attributes&&this.setAttributes({html:r,element:s,intent:n,linkService:i});const a=n!=="richText",o=t.div;if(o.append(r),t.viewport){const p=`matrix(${t.viewport.transform.join(",")})`;o.style.transform=p}a&&o.setAttribute("class","xfaLayer xfaFont");const h=[];if(s.children.length===0){if(s.value){const p=document.createTextNode(s.value);r.append(p),a&&Ah.shouldBuildText(s.name)&&h.push(p)}return{textDivs:h}}const u=[[s,-1,r]];for(;u.length>0;){const[p,_,v]=u.at(-1);if(_+1===p.children.length){u.pop();continue}const g=p.children[++u.at(-1)[1]];if(g===null)continue;const{name:b}=g;if(b==="#text"){const S=document.createTextNode(g.value);h.push(S),v.append(S);continue}const w=(c=g==null?void 0:g.attributes)!=null&&c.xmlns?document.createElementNS(g.attributes.xmlns,b):document.createElement(b);if(v.append(w),g.attributes&&this.setAttributes({html:w,element:g,storage:e,intent:n,linkService:i}),((f=g.children)==null?void 0:f.length)>0)u.push([g,-1,w]);else if(g.value){const S=document.createTextNode(g.value);a&&Ah.shouldBuildText(b)&&h.push(S),w.append(S)}}for(const p of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:h}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Zu=1e3,t_=9,ho=new WeakSet;class lv{static create(t){switch(t.data.annotationType){case We.LINK:return new z0(t);case We.TEXT:return new e_(t);case We.WIDGET:switch(t.data.fieldType){case"Tx":return new i_(t);case"Btn":return t.data.radioButton?new q0(t):t.data.checkBox?new n_(t):new r_(t);case"Ch":return new a_(t);case"Sig":return new s_(t)}return new fo(t);case We.POPUP:return new Tp(t);case We.FREETEXT:return new $0(t);case We.LINE:return new l_(t);case We.SQUARE:return new h_(t);case We.CIRCLE:return new u_(t);case We.POLYLINE:return new X0(t);case We.CARET:return new d_(t);case We.INK:return new Dg(t);case We.POLYGON:return new c_(t);case We.HIGHLIGHT:return new Y0(t);case We.UNDERLINE:return new f_(t);case We.SQUIGGLY:return new p_(t);case We.STRIKEOUT:return new g_(t);case We.STAMP:return new K0(t);case We.FILEATTACHMENT:return new m_(t);default:return new ze(t)}}}var Oa,fl,pl,cu,Cp;const Pg=class Pg{constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){D(this,cu);D(this,Oa,null);D(this,fl,!1);D(this,pl,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:i}){return!!(t!=null&&t.str||e!=null&&e.str||i!=null&&i.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Pg._hasPopupData(this.data)}updateEdited(t){var i;if(!this.container)return;l(this,Oa)||x(this,Oa,{rect:this.data.rect.slice(0)});const{rect:e}=t;e&&k(this,cu,Cp).call(this,e),(i=l(this,pl))==null||i.popup.updateEdited(t)}resetEdited(){var t;l(this,Oa)&&(k(this,cu,Cp).call(this,l(this,Oa).rect),(t=l(this,pl))==null||t.popup.resetEdited(),x(this,Oa,null))}_createContainer(t){const{data:e,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),this instanceof fo||(n.tabIndex=Zu);const{style:r}=n;if(r.zIndex=this.parent.zIndex++,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof Tp){const{rotation:v}=e;return!e.hasOwnCanvas&&v!==0&&this.setRotation(v,n),n}const{width:a,height:o}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const v=e.borderStyle.horizontalCornerRadius,g=e.borderStyle.verticalCornerRadius;if(v>0||g>0){const w=`calc(${v}px * var(--total-scale-factor)) / calc(${g}px * var(--total-scale-factor))`;r.borderRadius=w}else if(this instanceof q0){const w=`calc(${a}px * var(--total-scale-factor)) / calc(${o}px * var(--total-scale-factor))`;r.borderRadius=w}switch(e.borderStyle.style){case Eo.SOLID:r.borderStyle="solid";break;case Eo.DASHED:r.borderStyle="dashed";break;case Eo.BEVELED:Ht("Unimplemented border style: beveled");break;case Eo.INSET:Ht("Unimplemented border style: inset");break;case Eo.UNDERLINE:r.borderBottomStyle="solid";break}const b=e.borderColor||null;b?(x(this,fl,!0),r.borderColor=Et.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):r.borderWidth=0}const h=Et.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:u,pageHeight:c,pageX:f,pageY:p}=s.rawDims;r.left=`${100*(h[0]-f)/u}%`,r.top=`${100*(h[1]-p)/c}%`;const{rotation:_}=e;return e.hasOwnCanvas||_===0?(r.width=`${100*a/u}%`,r.height=`${100*o/c}%`):this.setRotation(_,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims;let{width:n,height:r}=this;t%180!==0&&([n,r]=[r,n]),e.style.width=`${100*n/i}%`,e.style.height=`${100*r/s}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,i,s)=>{const n=s.detail[e],r=n[0],a=n.slice(1);s.target.style[i]=ov[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[i]:ov[`${r}_rgb`](a)})};return Zt(this,"_commonActions",{display:e=>{const{display:i}=e.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){const i=this._commonActions;for(const s of Object.keys(e.detail)){const n=t[s]||i[s];n==null||n(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const i=this._commonActions;for(const[s,n]of Object.entries(e)){const r=i[s];if(r){const a={detail:{[s]:n},target:t};r(a),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,i,s,n]=this.data.rect.map(v=>Math.fround(v));if(t.length===8){const[v,g,b,w]=t.subarray(2,6);if(s===v&&n===g&&e===b&&i===w)return}const{style:r}=this.container;let a;if(l(this,fl)){const{borderColor:v,borderWidth:g}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${g}">`],this.container.classList.add("hasBorder")}const o=s-e,h=n-i,{svgFactory:u}=this,c=u.createElement("svg");c.classList.add("quadrilateralsContainer"),c.setAttribute("width",0),c.setAttribute("height",0);const f=u.createElement("defs");c.append(f);const p=u.createElement("clipPath"),_=`clippath_${this.data.id}`;p.setAttribute("id",_),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let v=2,g=t.length;v<g;v+=8){const b=t[v],w=t[v+1],S=t[v+2],T=t[v+3],A=u.createElement("rect"),C=(S-e)/o,R=(n-w)/h,P=(b-S)/o,N=(w-T)/h;A.setAttribute("x",C),A.setAttribute("y",R),A.setAttribute("width",P),A.setAttribute("height",N),p.append(A),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${R}" width="${P}" height="${N}"/>`)}l(this,fl)&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(c),this.container.style.clipPath=`url(#${_})`}_createPopup(){const{data:t}=this,e=x(this,pl,new Tp({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(e.render())}render(){me("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const i=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:n,id:r,exportValues:a}of s){if(n===-1||r===e)continue;const o=typeof a=="string"?a:null,h=document.querySelector(`[data-element-id="${r}"]`);if(h&&!ho.has(h)){Ht(`_getElementsByName - element not allowed: ${r}`);continue}i.push({id:r,exportValue:o,domElement:h})}return i}for(const s of document.getElementsByName(t)){const{exportValue:n}=s,r=s.getAttribute("data-element-id");r!==e&&ho.has(s)&&i.push({id:r,exportValue:n,domElement:s})}return i}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var i;(i=this.linkService.eventBus)==null||i.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};Oa=new WeakMap,fl=new WeakMap,pl=new WeakMap,cu=new WeakSet,Cp=function(t){const{container:{style:e},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:o}}}}=this;i==null||i.splice(0,4,...t),e.left=`${100*(t[0]-a)/n}%`,e.top=`${100*(r-t[3]+o)/r}%`,s===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/r}%`):this.setRotation(s)};let ze=Pg;var ls,Kr,U0,H0;class z0 extends ze{constructor(e,i=null){super(e,{isRenderable:!0,ignoreBorder:!!(i!=null&&i.ignoreBorder),createQuadrilaterals:!0});D(this,ls);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:i}=this,s=document.createElement("a");s.setAttribute("data-element-id",e.id);let n=!1;return e.url?(i.addLinkAttributes(s,e.url,e.newWindow),n=!0):e.action?(this._bindNamedAction(s,e.action),n=!0):e.attachment?(k(this,ls,U0).call(this,s,e.attachment,e.attachmentDest),n=!0):e.setOCGState?(k(this,ls,H0).call(this,s,e.setOCGState),n=!0):e.dest?(this._bindLink(s,e.dest),n=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,e),n=!0),e.resetForm?(this._bindResetFormAction(s,e.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(s,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(s),this.container}_bindLink(e,i){e.href=this.linkService.getDestinationHash(i),e.onclick=()=>(i&&this.linkService.goToDestination(i),!1),(i||i==="")&&k(this,ls,Kr).call(this)}_bindNamedAction(e,i){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(i),!1),k(this,ls,Kr).call(this)}_bindJSAction(e,i){e.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(i.actions)){const r=s.get(n);r&&(e[r]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i.id,name:n}}),!1})}e.onclick||(e.onclick=()=>!1),k(this,ls,Kr).call(this)}_bindResetFormAction(e,i){const s=e.onclick;if(s||(e.href=this.linkService.getAnchorUrl("")),k(this,ls,Kr).call(this),!this._fieldObjects){Ht('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(e.onclick=()=>!1);return}e.onclick=()=>{var c;s==null||s();const{fields:n,refs:r,include:a}=i,o=[];if(n.length!==0||r.length!==0){const f=new Set(r);for(const p of n){const _=this._fieldObjects[p]||[];for(const{id:v}of _)f.add(v)}for(const p of Object.values(this._fieldObjects))for(const _ of p)f.has(_.id)===a&&o.push(_)}else for(const f of Object.values(this._fieldObjects))o.push(...f);const h=this.annotationStorage,u=[];for(const f of o){const{id:p}=f;switch(u.push(p),f.type){case"text":{const v=f.defaultValue||"";h.setValue(p,{value:v});break}case"checkbox":case"radiobutton":{const v=f.defaultValue===f.exportValues;h.setValue(p,{value:v});break}case"combobox":case"listbox":{const v=f.defaultValue||"";h.setValue(p,{value:v});break}default:continue}const _=document.querySelector(`[data-element-id="${p}"]`);if(_){if(!ho.has(_)){Ht(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;_.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}})),!1}}}ls=new WeakSet,Kr=function(){this.container.setAttribute("data-internal-link","")},U0=function(e,i,s=null){e.href=this.linkService.getAnchorUrl(""),i.description&&(e.title=i.description),e.onclick=()=>{var n;return(n=this.downloadManager)==null||n.openOrDownloadData(i.content,i.filename,s),!1},k(this,ls,Kr).call(this)},H0=function(e,i){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(i),!1),k(this,ls,Kr).call(this)};class e_ extends ze{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class fo extends ze{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return wi.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,s,n){i.includes("mouse")?t.addEventListener(i,r=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(i,r=>{var a;if(i==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}n&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r)}}))})}_setEventListeners(t,e,i,s){var n,r,a;for(const[o,h]of i)(h==="Action"||(n=this.data.actions)!=null&&n[h])&&((h==="Focus"||h==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,o,h,s),h==="Focus"&&!((r=this.data.actions)!=null&&r.Blur)?this._setEventListener(t,e,"blur","Blur",null):h==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":Et.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||t_,n=t.style;let r;const a=2,o=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-a),u=Math.round(h/(If*s))||1,c=h/u;r=Math.min(s,o(c/If))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(s,o(h/If))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`,n.color=Et.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class i_ extends fo{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,s){const n=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=i),n.setValue(r.id,{[s]:i})}render(){var s,n;const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const r=t.getValue(e,{value:this.data.fieldValue});let a=r.value||"";const o=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;o&&a.length>o&&(a=a.slice(0,o));let h=r.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const u={userValue:a,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=h??a,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",h??a),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),ho.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=Zu,this._setRequired(i,this.data.required),o&&(i.maxLength=o),i.addEventListener("input",f=>{t.setValue(e,{value:f.target.value}),this.setPropertyOnSiblings(i,"value",f.target.value,"value"),u.formattedValue=null}),i.addEventListener("resetform",f=>{const p=this.data.defaultFieldValue??"";i.value=u.userValue=p,u.formattedValue=null});let c=f=>{const{formattedValue:p}=u;p!=null&&(f.target.value=p),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",p=>{var v;if(u.focused)return;const{target:_}=p;u.userValue&&(_.value=u.userValue),u.lastCommittedValue=_.value,u.commitKey=1,(v=this.data.actions)!=null&&v.Focus||(u.focused=!0)}),i.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const _={value(v){u.userValue=v.detail.value??"",t.setValue(e,{value:u.userValue.toString()}),v.target.value=u.userValue},formattedValue(v){const{formattedValue:g}=v.detail;u.formattedValue=g,g!=null&&v.target!==document.activeElement&&(v.target.value=g),t.setValue(e,{formattedValue:g})},selRange(v){v.target.setSelectionRange(...v.detail.selRange)},charLimit:v=>{var S;const{charLimit:g}=v.detail,{target:b}=v;if(g===0){b.removeAttribute("maxLength");return}b.setAttribute("maxLength",g);let w=u.userValue;!w||w.length<=g||(w=w.slice(0,g),b.value=u.userValue=w,t.setValue(e,{value:w}),(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,willCommit:!0,commitKey:1,selStart:b.selectionStart,selEnd:b.selectionEnd}}))}};this._dispatchEventFromSandbox(_,p)}),i.addEventListener("keydown",p=>{var g;u.commitKey=1;let _=-1;if(p.key==="Escape"?_=0:p.key==="Enter"&&!this.data.multiLine?_=2:p.key==="Tab"&&(u.commitKey=3),_===-1)return;const{value:v}=p.target;u.lastCommittedValue!==v&&(u.lastCommittedValue=v,u.userValue=v,(g=this.linkService.eventBus)==null||g.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:v,willCommit:!0,commitKey:_,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const f=c;c=null,i.addEventListener("blur",p=>{var v,g;if(!u.focused||!p.relatedTarget)return;(v=this.data.actions)!=null&&v.Blur||(u.focused=!1);const{value:_}=p.target;u.userValue=_,u.lastCommittedValue!==_&&((g=this.linkService.eventBus)==null||g.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:_,willCommit:!0,commitKey:u.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}})),f(p)}),(n=this.data.actions)!=null&&n.Keystroke&&i.addEventListener("beforeinput",p=>{var A;u.lastCommittedValue=null;const{data:_,target:v}=p,{value:g,selectionStart:b,selectionEnd:w}=v;let S=b,T=w;switch(p.inputType){case"deleteWordBackward":{const C=g.substring(0,b).match(/\w*[^\w]*$/);C&&(S-=C[0].length);break}case"deleteWordForward":{const C=g.substring(b).match(/^[^\w]*\w*/);C&&(T+=C[0].length);break}case"deleteContentBackward":b===w&&(S-=1);break;case"deleteContentForward":b===w&&(T+=1);break}p.preventDefault(),(A=this.linkService.eventBus)==null||A.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:g,change:_||"",willCommit:!1,selStart:S,selEnd:T}})}),this._setEventListeners(i,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(c&&i.addEventListener("blur",c),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/o;i.classList.add("comb"),i.style.letterSpacing=`calc(${p}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class s_ extends fo{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class n_ extends fo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return ho.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=Zu,n.addEventListener("change",r=>{const{name:a,checked:o}=r.target;for(const h of this._getElementsByName(a,i)){const u=o&&h.exportValue===e.exportValue;h.domElement&&(h.domElement.checked=u),t.setValue(h.id,{value:u})}t.setValue(i,{value:o})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue||"Off";r.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const a={value(o){o.target.checked=o.detail.value!=="Off",t.setValue(i,{value:o.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class q0 extends fo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(i,{value:s})),s)for(const r of this._getElementsByName(e.fieldName,i))t.setValue(r.id,{value:!1});const n=document.createElement("input");if(ho.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=Zu,n.addEventListener("change",r=>{const{name:a,checked:o}=r.target;for(const h of this._getElementsByName(a,i))t.setValue(h.id,{value:!1});t.setValue(i,{value:o})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue;r.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;n.addEventListener("updatefromsandbox",a=>{const o={value:h=>{const u=r===h.detail.value;for(const c of this._getElementsByName(h.target.name)){const f=u&&c.id===i;c.domElement&&(c.domElement.checked=f),t.setValue(c.id,{value:f})}}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class r_ extends z0{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}}class a_ extends fo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");ho.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=Zu;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",u=>{const c=this.data.defaultFieldValue;for(const f of s.options)f.selected=f.value===c});for(const u of this.data.options){const c=document.createElement("option");c.textContent=u.displayValue,c.value=u.exportValue,i.value.includes(u.exportValue)&&(c.setAttribute("selected",!0),n=!1),s.append(c)}let r=null;if(n){const u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),s.prepend(u),r=()=>{u.remove(),s.removeEventListener("input",r),r=null},s.addEventListener("input",r)}const a=u=>{const c=u?"value":"textContent",{options:f,multiple:p}=s;return p?Array.prototype.filter.call(f,_=>_.selected).map(_=>_[c]):f.selectedIndex===-1?null:f[f.selectedIndex][c]};let o=a(!1);const h=u=>{const c=u.target.options;return Array.prototype.map.call(c,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",u=>{const c={value(f){r==null||r();const p=f.detail.value,_=new Set(Array.isArray(p)?p:[p]);for(const v of s.options)v.selected=_.has(v.value);t.setValue(e,{value:a(!0)}),o=a(!1)},multipleSelection(f){s.multiple=!0},remove(f){const p=s.options,_=f.detail.remove;p[_].selected=!1,s.remove(_),p.length>0&&Array.prototype.findIndex.call(p,g=>g.selected)===-1&&(p[0].selected=!0),t.setValue(e,{value:a(!0),items:h(f)}),o=a(!1)},clear(f){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),o=a(!1)},insert(f){const{index:p,displayValue:_,exportValue:v}=f.detail.insert,g=s.children[p],b=document.createElement("option");b.textContent=_,b.value=v,g?g.before(b):s.append(b),t.setValue(e,{value:a(!0),items:h(f)}),o=a(!1)},items(f){const{items:p}=f.detail;for(;s.length!==0;)s.remove(0);for(const _ of p){const{displayValue:v,exportValue:g}=_,b=document.createElement("option");b.textContent=v,b.value=g,s.append(b)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:a(!0),items:h(f)}),o=a(!1)},indices(f){const p=new Set(f.detail.indices);for(const _ of f.target.options)_.selected=p.has(_.index);t.setValue(e,{value:a(!0)}),o=a(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(c,u)}),s.addEventListener("input",u=>{var p;const c=a(!0),f=a(!1);t.setValue(e,{value:c}),u.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:o,change:f,changeEx:c,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):s.addEventListener("input",function(u){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Tp extends ze{constructor(t){const{data:e,elements:i}=t;super(t,{isRenderable:ze._hasPopupData(e)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new o_({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const i of this.elements)i.popup=t,i.container.ariaHasPopup="dialog",e.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(i=>`${yg}${i}`).join(",")),this.container}}var gl,wd,_d,ml,vl,Ne,zn,bl,du,fu,yl,Un,Os,Hn,pu,qn,gu,Ma,Fa,ve,Dc,Dp,j0,W0,V0,G0,kc,Rc,kp;class o_{constructor({container:t,color:e,elements:i,titleObj:s,modificationDate:n,contentsObj:r,richText:a,parent:o,rect:h,parentRect:u,open:c}){D(this,ve);D(this,gl,k(this,ve,V0).bind(this));D(this,wd,k(this,ve,kp).bind(this));D(this,_d,k(this,ve,Rc).bind(this));D(this,ml,k(this,ve,kc).bind(this));D(this,vl,null);D(this,Ne,null);D(this,zn,null);D(this,bl,null);D(this,du,null);D(this,fu,null);D(this,yl,null);D(this,Un,!1);D(this,Os,null);D(this,Hn,null);D(this,pu,null);D(this,qn,null);D(this,gu,null);D(this,Ma,null);D(this,Fa,!1);var f;x(this,Ne,t),x(this,gu,s),x(this,zn,r),x(this,qn,a),x(this,fu,o),x(this,vl,e),x(this,pu,h),x(this,yl,u),x(this,du,i),x(this,bl,Ag.toDateObject(n)),this.trigger=i.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",l(this,ml)),p.addEventListener("mouseenter",l(this,_d)),p.addEventListener("mouseleave",l(this,wd)),p.classList.add("popupTriggerArea");for(const p of i)(f=p.container)==null||f.addEventListener("keydown",l(this,gl));l(this,Ne).hidden=!0,c&&k(this,ve,kc).call(this)}render(){if(l(this,Os))return;const t=x(this,Os,document.createElement("div"));if(t.className="popup",l(this,vl)){const n=t.style.outlineColor=Et.makeHexColor(...l(this,vl));t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const e=document.createElement("span");e.className="header";const i=document.createElement("h1");if(e.append(i),{dir:i.dir,str:i.textContent}=l(this,gu),t.append(e),l(this,bl)){const n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:l(this,bl).valueOf()})),e.append(n)}const s=l(this,ve,Dc);if(s)B0.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(l(this,zn));t.append(n)}l(this,Ne).append(t)}_formatContents({str:t,dir:e}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=e;const s=t.split(/(?:\r\n?|\n)/);for(let n=0,r=s.length;n<r;++n){const a=s[n];i.append(document.createTextNode(a)),n<r-1&&i.append(document.createElement("br"))}return i}updateEdited({rect:t,popupContent:e}){var i;l(this,Ma)||x(this,Ma,{contentsObj:l(this,zn),richText:l(this,qn)}),t&&x(this,Hn,null),e&&(x(this,qn,k(this,ve,W0).call(this,e)),x(this,zn,null)),(i=l(this,Os))==null||i.remove(),x(this,Os,null)}resetEdited(){var t;l(this,Ma)&&({contentsObj:ki(this,zn)._,richText:ki(this,qn)._}=l(this,Ma),x(this,Ma,null),(t=l(this,Os))==null||t.remove(),x(this,Os,null),x(this,Hn,null))}forceHide(){x(this,Fa,this.isVisible),l(this,Fa)&&(l(this,Ne).hidden=!0)}maybeShow(){l(this,Fa)&&(l(this,Os)||k(this,ve,Rc).call(this),x(this,Fa,!1),l(this,Ne).hidden=!1)}get isVisible(){return l(this,Ne).hidden===!1}}gl=new WeakMap,wd=new WeakMap,_d=new WeakMap,ml=new WeakMap,vl=new WeakMap,Ne=new WeakMap,zn=new WeakMap,bl=new WeakMap,du=new WeakMap,fu=new WeakMap,yl=new WeakMap,Un=new WeakMap,Os=new WeakMap,Hn=new WeakMap,pu=new WeakMap,qn=new WeakMap,gu=new WeakMap,Ma=new WeakMap,Fa=new WeakMap,ve=new WeakSet,Dc=function(){const t=l(this,qn),e=l(this,zn);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&l(this,qn).html||null},Dp=function(){var t,e,i;return((i=(e=(t=l(this,ve,Dc))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:i.fontSize)||0},j0=function(){var t,e,i;return((i=(e=(t=l(this,ve,Dc))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:i.color)||null},W0=function(t){const e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:l(this,ve,j0),fontSize:l(this,ve,Dp)?`calc(${l(this,ve,Dp)}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:s});return i},V0=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&l(this,Un))&&k(this,ve,kc).call(this)},G0=function(){if(l(this,Hn)!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:s,pageY:n}}}=l(this,fu);let r=!!l(this,yl),a=r?l(this,yl):l(this,pu);for(const _ of l(this,du))if(!a||Et.intersect(_.data.rect,a)!==null){a=_.data.rect,r=!0;break}const o=Et.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),u=r?a[2]-a[0]+5:0,c=o[0]+u,f=o[1];x(this,Hn,[100*(c-s)/e,100*(f-n)/i]);const{style:p}=l(this,Ne);p.left=`${l(this,Hn)[0]}%`,p.top=`${l(this,Hn)[1]}%`},kc=function(){x(this,Un,!l(this,Un)),l(this,Un)?(k(this,ve,Rc).call(this),l(this,Ne).addEventListener("click",l(this,ml)),l(this,Ne).addEventListener("keydown",l(this,gl))):(k(this,ve,kp).call(this),l(this,Ne).removeEventListener("click",l(this,ml)),l(this,Ne).removeEventListener("keydown",l(this,gl)))},Rc=function(){l(this,Os)||this.render(),this.isVisible?l(this,Un)&&l(this,Ne).classList.add("focused"):(k(this,ve,G0).call(this),l(this,Ne).hidden=!1,l(this,Ne).style.zIndex=parseInt(l(this,Ne).style.zIndex)+1e3)},kp=function(){l(this,Ne).classList.remove("focused"),!(l(this,Un)||!this.isVisible)&&(l(this,Ne).hidden=!0,l(this,Ne).style.zIndex=parseInt(l(this,Ne).style.zIndex)-1e3)};class $0 extends ze{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=Bt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var mu;class l_ extends ze{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,mu,null)}render(){this.container.classList.add("lineAnnotation");const{data:e,width:i,height:s}=this,n=this.svgFactory.create(i,s,!0),r=x(this,mu,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,mu)}addHighlightArea(){this.container.classList.add("highlightArea")}}mu=new WeakMap;var vu;class h_ extends ze{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,vu,null)}render(){this.container.classList.add("squareAnnotation");const{data:e,width:i,height:s}=this,n=this.svgFactory.create(i,s,!0),r=e.borderStyle.width,a=x(this,vu,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",i-r),a.setAttribute("height",s-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,vu)}addHighlightArea(){this.container.classList.add("highlightArea")}}vu=new WeakMap;var bu;class u_ extends ze{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,bu,null)}render(){this.container.classList.add("circleAnnotation");const{data:e,width:i,height:s}=this,n=this.svgFactory.create(i,s,!0),r=e.borderStyle.width,a=x(this,bu,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",i/2),a.setAttribute("cy",s/2),a.setAttribute("rx",i/2-r/2),a.setAttribute("ry",s/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,bu)}addHighlightArea(){this.container.classList.add("highlightArea")}}bu=new WeakMap;var yu;class X0 extends ze{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,yu,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:i,borderStyle:s,popupRef:n},width:r,height:a}=this;if(!i)return this.container;const o=this.svgFactory.create(r,a,!0);let h=[];for(let c=0,f=i.length;c<f;c+=2){const p=i[c]-e[0],_=e[3]-i[c+1];h.push(`${p},${_}`)}h=h.join(" ");const u=x(this,yu,this.svgFactory.createElement(this.svgElementName));return u.setAttribute("points",h),u.setAttribute("stroke-width",s.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),o.append(u),this.container.append(o),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,yu)}addHighlightArea(){this.container.classList.add("highlightArea")}}yu=new WeakMap;class c_ extends X0{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class d_ extends ze{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var wu,Ba,_u,Rp;class Dg extends ze{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,_u);D(this,wu,null);D(this,Ba,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Bt.HIGHLIGHT:Bt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:i,inkLists:s,borderStyle:n,popupRef:r}}=this,{transform:a,width:o,height:h}=k(this,_u,Rp).call(this,i,e),u=this.svgFactory.create(o,h,!0),c=x(this,wu,this.svgFactory.createElement("svg:g"));u.append(c),c.setAttribute("stroke-width",n.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",a);for(let f=0,p=s.length;f<p;f++){const _=this.svgFactory.createElement(this.svgElementName);l(this,Ba).push(_),_.setAttribute("points",s[f].join(",")),c.append(_)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:i,points:s,rect:n}=e,r=l(this,wu);if(i>=0&&r.setAttribute("stroke-width",i||1),s)for(let a=0,o=l(this,Ba).length;a<o;a++)l(this,Ba)[a].setAttribute("points",s[a].join(","));if(n){const{transform:a,width:o,height:h}=k(this,_u,Rp).call(this,this.data.rotation,n);r.parentElement.setAttribute("viewBox",`0 0 ${o} ${h}`),r.setAttribute("transform",a)}}getElementsToTriggerPopup(){return l(this,Ba)}addHighlightArea(){this.container.classList.add("highlightArea")}}wu=new WeakMap,Ba=new WeakMap,_u=new WeakSet,Rp=function(e,i){switch(e){case 90:return{transform:`rotate(90) translate(${-i[0]},${i[1]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};case 180:return{transform:`rotate(180) translate(${-i[2]},${i[1]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]};case 270:return{transform:`rotate(270) translate(${-i[2]},${i[3]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};default:return{transform:`translate(${-i[0]},${i[3]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]}}};class Y0 extends ze{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Bt.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class f_ extends ze{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class p_ extends ze{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class g_ extends ze{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class K0 extends ze{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Bt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Au,Eu,Ip;class m_ extends ze{constructor(e){var s;super(e,{isRenderable:!0});D(this,Eu);D(this,Au,null);const{file:i}=this.data;this.filename=i.filename,this.content=i.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...i})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:i}=this;let s;i.hasAppearance||i.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(i.name)?"paperclip":"pushpin"}.svg`,i.fillAlpha&&i.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(i.fillAlpha*100)}%);`)),s.addEventListener("dblclick",k(this,Eu,Ip).bind(this)),x(this,Au,s);const{isMac:n}=wi.platform;return e.addEventListener("keydown",r=>{r.key==="Enter"&&(n?r.metaKey:r.ctrlKey)&&k(this,Eu,Ip).call(this)}),!i.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),e.append(s),e}getElementsToTriggerPopup(){return l(this,Au)}addHighlightArea(){this.container.classList.add("highlightArea")}}Au=new WeakMap,Eu=new WeakSet,Ip=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var xu,za,Dr,Su,Yr,Lp,Pp;const Og=class Og{constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:r,structTreeLayer:a}){D(this,Yr);D(this,xu,null);D(this,za,null);D(this,Dr,new Map);D(this,Su,null);this.div=t,x(this,xu,e),x(this,za,i),x(this,Su,a||null),this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return l(this,Dr).size>0}async render(t){var r;const{annotations:e}=t,i=this.div;oo(i,this.viewport);const s=new Map,n={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new sd,annotationStorage:t.annotationStorage||new Sg,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const a of e){if(a.noHTML)continue;const o=a.annotationType===We.POPUP;if(o){const c=s.get(a.id);if(!c)continue;n.elements=c}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;n.data=a;const h=lv.create(n);if(!h.isRenderable)continue;if(!o&&a.popupRef){const c=s.get(a.popupRef);c?c.push(h):s.set(a.popupRef,[h])}const u=h.render();a.hidden&&(u.style.visibility="hidden"),await k(this,Yr,Lp).call(this,u,a.id),h._isEditable&&(l(this,Dr).set(h.data.id,h),(r=this._annotationEditorUIManager)==null||r.renderAnnotationElement(h))}k(this,Yr,Pp).call(this)}async addLinkAnnotations(t,e){const i={data:null,layer:this.div,linkService:e,svgFactory:new sd,parent:this};for(const s of t){s.borderStyle||(s.borderStyle=Og._defaultBorderStyle),i.data=s;const n=lv.create(i);if(!n.isRenderable)continue;const r=n.render();await k(this,Yr,Lp).call(this,r,s.id)}}update({viewport:t}){const e=this.div;this.viewport=t,oo(e,{rotation:t.rotation}),k(this,Yr,Pp).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(l(this,Dr).values())}getEditableAnnotation(t){return l(this,Dr).get(t)}static get _defaultBorderStyle(){return Zt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Eo.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};xu=new WeakMap,za=new WeakMap,Dr=new WeakMap,Su=new WeakMap,Yr=new WeakSet,Lp=async function(t,e){var r,a;const i=t.firstChild||t,s=i.id=`${yg}${e}`,n=await((r=l(this,Su))==null?void 0:r.getAriaAttributes(s));if(n)for(const[o,h]of n)i.setAttribute(o,h);this.div.append(t),(a=l(this,xu))==null||a.moveElementInDOM(this.div,t,i,!1)},Pp=function(){var e;if(!l(this,za))return;const t=this.div;for(const[i,s]of l(this,za)){const n=t.querySelector(`[data-annotation-id="${i}"]`);if(!n)continue;s.className="annotationContent";const{firstChild:r}=n;r?r.nodeName==="CANVAS"?r.replaceWith(s):r.classList.contains("annotationContent")?r.after(s):r.before(s):n.append(s);const a=l(this,Dr).get(i);a&&(a._hasNoCanvas?((e=this._annotationEditorUIManager)==null||e.setMissingCanvas(i,n.id,s),a._hasNoCanvas=!1):a.canvas=s)}l(this,za).clear()};let Np=Og;const uc=/\r\n?|\n/g;var Ms,Ji,Cu,Ua,Qi,$e,Z0,J0,Q0,Ic,tr,Nc,Lc,tb,Mp,eb;const ye=class ye extends Ce{constructor(e){super({...e,name:"freeTextEditor"});D(this,$e);D(this,Ms);D(this,Ji,"");D(this,Cu,`${this.id}-editor`);D(this,Ua,null);D(this,Qi);x(this,Ms,e.color||ye._defaultColor||Ce._defaultLineColor),x(this,Qi,e.fontSize||ye._defaultFontSize)}static get _keyboardManager(){const e=ye.prototype,i=r=>r.isEmpty(),s=lo.TRANSLATE_SMALL,n=lo.TRANSLATE_BIG;return Zt(this,"_keyboardManager",new Yu([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:i}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[s,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[n,0],checker:i}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:i}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,s],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,n],checker:i}]]))}static initialize(e,i){Ce.initialize(e,i);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,i){switch(e){case Qt.FREETEXT_SIZE:ye._defaultFontSize=i;break;case Qt.FREETEXT_COLOR:ye._defaultColor=i;break}}updateParams(e,i){switch(e){case Qt.FREETEXT_SIZE:k(this,$e,Z0).call(this,i);break;case Qt.FREETEXT_COLOR:k(this,$e,J0).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[Qt.FREETEXT_SIZE,ye._defaultFontSize],[Qt.FREETEXT_COLOR,ye._defaultColor||Ce._defaultLineColor]]}get propertiesToUpdate(){return[[Qt.FREETEXT_SIZE,l(this,Qi)],[Qt.FREETEXT_COLOR,l(this,Ms)]]}_translateEmpty(e,i){this._uiManager.translateSelectedEditors(e,i,!0)}getInitialTranslation(){const e=this.parentScale;return[-ye._internalPadding*e,-(ye._internalPadding+l(this,Qi))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Bt.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),x(this,Ua,new AbortController);const e=this._uiManager.combinedSignal(l(this,Ua));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){var e;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",l(this,Cu)),this._isDraggable=!0,(e=l(this,Ua))==null||e.abort(),x(this,Ua,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){var i;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),(i=this._initialOptions)!=null&&i.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=l(this,Ji),i=x(this,Ji,k(this,$e,Q0).call(this).trimEnd());if(e===i)return;const s=n=>{if(x(this,Ji,n),!n){this.remove();return}k(this,$e,Lc).call(this),this._uiManager.rebuild(this),k(this,$e,Ic).call(this)};this.addCommands({cmd:()=>{s(i)},undo:()=>{s(e)},mustExec:!1}),k(this,$e,Ic).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){ye._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,i;(this._isCopy||this.annotationElementId)&&(e=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",l(this,Cu)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${l(this,Qi)}px * var(--total-scale-factor))`,s.color=l(this,Ms),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),xg(this,this.div,["dblclick","keydown"]),this._isCopy||this.annotationElementId){const[n,r]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[o,h]=this.getInitialTranslation();[o,h]=this.pageTranslationToScreen(o,h);const[u,c]=this.pageDimensions,[f,p]=this.pageTranslation;let _,v;switch(this.rotation){case 0:_=e+(a[0]-f)/u,v=i+this.height-(a[1]-p)/c;break;case 90:_=e+(a[0]-f)/u,v=i-(a[1]-p)/c,[o,h]=[h,-o];break;case 180:_=e-this.width+(a[0]-f)/u,v=i-(a[1]-p)/c,[o,h]=[-o,-h];break;case 270:_=e+(a[0]-f-this.height*c)/u,v=i+(a[1]-p-this.width*u)/c,[o,h]=[-h,o];break}this.setAt(_*n,v*r,o,h)}else this._moveAfterPaste(e,i);k(this,$e,Lc).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var _,v,g;const i=e.clipboardData||window.clipboardData,{types:s}=i;if(s.length===1&&s[0]==="text/plain")return;e.preventDefault();const n=k(_=ye,tr,Mp).call(_,i.getData("text")||"").replaceAll(uc,`
`);if(!n)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const a=r.getRangeAt(0);if(!n.includes(`
`)){a.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:o,startOffset:h}=a,u=[],c=[];if(o.nodeType===Node.TEXT_NODE){const b=o.parentElement;if(c.push(o.nodeValue.slice(h).replaceAll(uc,"")),b!==this.editorDiv){let w=u;for(const S of this.editorDiv.childNodes){if(S===b){w=c;continue}w.push(k(v=ye,tr,Nc).call(v,S))}}u.push(o.nodeValue.slice(0,h).replaceAll(uc,""))}else if(o===this.editorDiv){let b=u,w=0;for(const S of this.editorDiv.childNodes)w++===h&&(b=c),b.push(k(g=ye,tr,Nc).call(g,S))}x(this,Ji,`${u.join(`
`)}${n}${c.join(`
`)}`),k(this,$e,Lc).call(this);const f=new Range;let p=Math.sumPrecise(u.map(b=>b.length));for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const w=b.nodeValue.length;if(p<=w){f.setStart(b,p),f.setEnd(b,p);break}p-=w}r.removeAllRanges(),r.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(e,i,s){var a;let n=null;if(e instanceof $0){const{data:{defaultAppearanceData:{fontSize:o,fontColor:h},rect:u,rotation:c,id:f,popupRef:p},textContent:_,textPosition:v,parent:{page:{pageNumber:g}}}=e;if(!_||_.length===0)return null;n=e={annotationType:Bt.FREETEXT,color:Array.from(h),fontSize:o,value:_.join(`
`),position:v,pageIndex:g-1,rect:u.slice(0),rotation:c,id:f,deleted:!1,popupRef:p}}const r=await super.deserialize(e,i,s);return x(r,Qi,e.fontSize),x(r,Ms,Et.makeHexColor(...e.color)),x(r,Ji,k(a=ye,tr,Mp).call(a,e.value)),r.annotationElementId=e.id||null,r._initialData=n,r}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=ye._internalPadding*this.parentScale,s=this.getRect(i,i),n=Ce._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:l(this,Ms)),r={annotationType:Bt.FREETEXT,color:n,fontSize:l(this,Qi),value:k(this,$e,tb).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(r.isCopy=!0,r):this.annotationElementId&&!k(this,$e,eb).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(e){const i=super.renderAnnotationElement(e);if(this.deleted)return i;const{style:s}=i;s.fontSize=`calc(${l(this,Qi)}px * var(--total-scale-factor))`,s.color=l(this,Ms),i.replaceChildren();for(const r of l(this,Ji).split(`
`)){const a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),i.append(a)}const n=ye._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(n,n),popupContent:l(this,Ji)}),i}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};Ms=new WeakMap,Ji=new WeakMap,Cu=new WeakMap,Ua=new WeakMap,Qi=new WeakMap,$e=new WeakSet,Z0=function(e){const i=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-l(this,Qi))*this.parentScale),x(this,Qi,n),k(this,$e,Ic).call(this)},s=l(this,Qi);this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Qt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},J0=function(e){const i=n=>{x(this,Ms,this.editorDiv.style.color=n)},s=l(this,Ms);this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Qt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Q0=function(){var s;const e=[];this.editorDiv.normalize();let i=null;for(const n of this.editorDiv.childNodes)(i==null?void 0:i.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(e.push(k(s=ye,tr,Nc).call(s,n)),i=n);return e.join(`
`)},Ic=function(){const[e,i]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:n,div:r}=this,a=r.style.display,o=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",n.div.append(this.div),s=r.getBoundingClientRect(),r.remove(),r.style.display=a,r.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=s.width/e,this.height=s.height/i):(this.width=s.height/e,this.height=s.width/i),this.fixAndSetPosition()},tr=new WeakSet,Nc=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(uc,"")},Lc=function(){if(this.editorDiv.replaceChildren(),!!l(this,Ji))for(const e of l(this,Ji).split(`
`)){const i=document.createElement("div");i.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(i)}},tb=function(){return l(this,Ji).replaceAll(" "," ")},Mp=function(e){return e.replaceAll(" "," ")},eb=function(e){const{value:i,fontSize:s,color:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||e.value!==i||e.fontSize!==s||e.color.some((a,o)=>a!==n[o])||e.pageIndex!==r},D(ye,tr),At(ye,"_freeTextDefaultContent",""),At(ye,"_internalPadding",0),At(ye,"_defaultColor",null),At(ye,"_defaultFontSize",10),At(ye,"_type","freetext"),At(ye,"_editorType",Bt.FREETEXT);let Op=ye;class wt{toSVGPath(){me("Abstract method `toSVGPath` must be implemented.")}get box(){me("Abstract getter `box` must be implemented.")}serialize(t,e){me("Abstract method `serialize` must be implemented.")}static _rescale(t,e,i,s,n,r){r||(r=new Float32Array(t.length));for(let a=0,o=t.length;a<o;a+=2)r[a]=e+t[a]*s,r[a+1]=i+t[a+1]*n;return r}static _rescaleAndSwap(t,e,i,s,n,r){r||(r=new Float32Array(t.length));for(let a=0,o=t.length;a<o;a+=2)r[a]=e+t[a+1]*s,r[a+1]=i+t[a]*n;return r}static _translate(t,e,i,s){s||(s=new Float32Array(t.length));for(let n=0,r=t.length;n<r;n+=2)s[n]=e+t[n],s[n+1]=i+t[n+1];return s}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,i,s,n){switch(n){case 90:return[1-e/i,t/s];case 180:return[1-t/i,1-e/s];case 270:return[e/i,1-t/s];default:return[t/i,e/s]}}static _normalizePagePoint(t,e,i){switch(i){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,i,s,n,r){return[(t+5*i)/6,(e+5*s)/6,(5*i+n)/6,(5*s+r)/6,(i+n)/2,(s+r)/2]}}At(wt,"PRECISION",1e-4);var ts,Fs,wl,_l,ln,Xt,Ha,qa,Tu,Du,Al,El,kr,ku,Ad,Ed,ti,dh,ib,sb,nb,rb,ab,ob;const En=class En{constructor({x:t,y:e},i,s,n,r,a=0){D(this,ti);D(this,ts);D(this,Fs,[]);D(this,wl);D(this,_l);D(this,ln,[]);D(this,Xt,new Float32Array(18));D(this,Ha);D(this,qa);D(this,Tu);D(this,Du);D(this,Al);D(this,El);D(this,kr,[]);x(this,ts,i),x(this,El,n*s),x(this,_l,r),l(this,Xt).set([NaN,NaN,NaN,NaN,t,e],6),x(this,wl,a),x(this,Du,l(En,ku)*s),x(this,Tu,l(En,Ed)*s),x(this,Al,s),l(this,kr).push(t,e)}isEmpty(){return isNaN(l(this,Xt)[8])}add({x:t,y:e}){var N;x(this,Ha,t),x(this,qa,e);const[i,s,n,r]=l(this,ts);let[a,o,h,u]=l(this,Xt).subarray(8,12);const c=t-h,f=e-u,p=Math.hypot(c,f);if(p<l(this,Tu))return!1;const _=p-l(this,Du),v=_/p,g=v*c,b=v*f;let w=a,S=o;a=h,o=u,h+=g,u+=b,(N=l(this,kr))==null||N.push(t,e);const T=-b/_,A=g/_,C=T*l(this,El),R=A*l(this,El);return l(this,Xt).set(l(this,Xt).subarray(2,8),0),l(this,Xt).set([h+C,u+R],4),l(this,Xt).set(l(this,Xt).subarray(14,18),12),l(this,Xt).set([h-C,u-R],16),isNaN(l(this,Xt)[6])?(l(this,ln).length===0&&(l(this,Xt).set([a+C,o+R],2),l(this,ln).push(NaN,NaN,NaN,NaN,(a+C-i)/n,(o+R-s)/r),l(this,Xt).set([a-C,o-R],14),l(this,Fs).push(NaN,NaN,NaN,NaN,(a-C-i)/n,(o-R-s)/r)),l(this,Xt).set([w,S,a,o,h,u],6),!this.isEmpty()):(l(this,Xt).set([w,S,a,o,h,u],6),Math.abs(Math.atan2(S-o,w-a)-Math.atan2(b,g))<Math.PI/2?([a,o,h,u]=l(this,Xt).subarray(2,6),l(this,ln).push(NaN,NaN,NaN,NaN,((a+h)/2-i)/n,((o+u)/2-s)/r),[a,o,w,S]=l(this,Xt).subarray(14,18),l(this,Fs).push(NaN,NaN,NaN,NaN,((w+a)/2-i)/n,((S+o)/2-s)/r),!0):([w,S,a,o,h,u]=l(this,Xt).subarray(0,6),l(this,ln).push(((w+5*a)/6-i)/n,((S+5*o)/6-s)/r,((5*a+h)/6-i)/n,((5*o+u)/6-s)/r,((a+h)/2-i)/n,((o+u)/2-s)/r),[h,u,a,o,w,S]=l(this,Xt).subarray(12,18),l(this,Fs).push(((w+5*a)/6-i)/n,((S+5*o)/6-s)/r,((5*a+h)/6-i)/n,((5*o+u)/6-s)/r,((a+h)/2-i)/n,((o+u)/2-s)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=l(this,ln),e=l(this,Fs);if(isNaN(l(this,Xt)[6])&&!this.isEmpty())return k(this,ti,ib).call(this);const i=[];i.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);k(this,ti,nb).call(this,i);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return k(this,ti,sb).call(this,i),i.join(" ")}newFreeDrawOutline(t,e,i,s,n,r){return new lb(t,e,i,s,n,r)}getOutlines(){var c;const t=l(this,ln),e=l(this,Fs),i=l(this,Xt),[s,n,r,a]=l(this,ts),o=new Float32Array((((c=l(this,kr))==null?void 0:c.length)??0)+2);for(let f=0,p=o.length-2;f<p;f+=2)o[f]=(l(this,kr)[f]-s)/r,o[f+1]=(l(this,kr)[f+1]-n)/a;if(o[o.length-2]=(l(this,Ha)-s)/r,o[o.length-1]=(l(this,qa)-n)/a,isNaN(i[6])&&!this.isEmpty())return k(this,ti,rb).call(this,o);const h=new Float32Array(l(this,ln).length+24+l(this,Fs).length);let u=t.length;for(let f=0;f<u;f+=2){if(isNaN(t[f])){h[f]=h[f+1]=NaN;continue}h[f]=t[f],h[f+1]=t[f+1]}u=k(this,ti,ob).call(this,h,u);for(let f=e.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(e[f+p])){h[u]=h[u+1]=NaN,u+=2;continue}h[u]=e[f+p],h[u+1]=e[f+p+1],u+=2}return k(this,ti,ab).call(this,h,u),this.newFreeDrawOutline(h,o,l(this,ts),l(this,Al),l(this,wl),l(this,_l))}};ts=new WeakMap,Fs=new WeakMap,wl=new WeakMap,_l=new WeakMap,ln=new WeakMap,Xt=new WeakMap,Ha=new WeakMap,qa=new WeakMap,Tu=new WeakMap,Du=new WeakMap,Al=new WeakMap,El=new WeakMap,kr=new WeakMap,ku=new WeakMap,Ad=new WeakMap,Ed=new WeakMap,ti=new WeakSet,dh=function(){const t=l(this,Xt).subarray(4,6),e=l(this,Xt).subarray(16,18),[i,s,n,r]=l(this,ts);return[(l(this,Ha)+(t[0]-e[0])/2-i)/n,(l(this,qa)+(t[1]-e[1])/2-s)/r,(l(this,Ha)+(e[0]-t[0])/2-i)/n,(l(this,qa)+(e[1]-t[1])/2-s)/r]},ib=function(){const[t,e,i,s]=l(this,ts),[n,r,a,o]=k(this,ti,dh).call(this);return`M${(l(this,Xt)[2]-t)/i} ${(l(this,Xt)[3]-e)/s} L${(l(this,Xt)[4]-t)/i} ${(l(this,Xt)[5]-e)/s} L${n} ${r} L${a} ${o} L${(l(this,Xt)[16]-t)/i} ${(l(this,Xt)[17]-e)/s} L${(l(this,Xt)[14]-t)/i} ${(l(this,Xt)[15]-e)/s} Z`},sb=function(t){const e=l(this,Fs);t.push(`L${e[4]} ${e[5]} Z`)},nb=function(t){const[e,i,s,n]=l(this,ts),r=l(this,Xt).subarray(4,6),a=l(this,Xt).subarray(16,18),[o,h,u,c]=k(this,ti,dh).call(this);t.push(`L${(r[0]-e)/s} ${(r[1]-i)/n} L${o} ${h} L${u} ${c} L${(a[0]-e)/s} ${(a[1]-i)/n}`)},rb=function(t){const e=l(this,Xt),[i,s,n,r]=l(this,ts),[a,o,h,u]=k(this,ti,dh).call(this),c=new Float32Array(36);return c.set([NaN,NaN,NaN,NaN,(e[2]-i)/n,(e[3]-s)/r,NaN,NaN,NaN,NaN,(e[4]-i)/n,(e[5]-s)/r,NaN,NaN,NaN,NaN,a,o,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,(e[16]-i)/n,(e[17]-s)/r,NaN,NaN,NaN,NaN,(e[14]-i)/n,(e[15]-s)/r],0),this.newFreeDrawOutline(c,t,l(this,ts),l(this,Al),l(this,wl),l(this,_l))},ab=function(t,e){const i=l(this,Fs);return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6},ob=function(t,e){const i=l(this,Xt).subarray(4,6),s=l(this,Xt).subarray(16,18),[n,r,a,o]=l(this,ts),[h,u,c,f]=k(this,ti,dh).call(this);return t.set([NaN,NaN,NaN,NaN,(i[0]-n)/a,(i[1]-r)/o,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,c,f,NaN,NaN,NaN,NaN,(s[0]-n)/a,(s[1]-r)/o],e),e+=24},D(En,ku,8),D(En,Ad,2),D(En,Ed,l(En,ku)+l(En,Ad));let nd=En;var xl,ja,jn,Ru,es,Iu,Be,xd,hb;class lb extends wt{constructor(e,i,s,n,r,a){super();D(this,xd);D(this,xl);D(this,ja,new Float32Array(4));D(this,jn);D(this,Ru);D(this,es);D(this,Iu);D(this,Be);x(this,Be,e),x(this,es,i),x(this,xl,s),x(this,Iu,n),x(this,jn,r),x(this,Ru,a),this.lastPoint=[NaN,NaN],k(this,xd,hb).call(this,a);const[o,h,u,c]=l(this,ja);for(let f=0,p=e.length;f<p;f+=2)e[f]=(e[f]-o)/u,e[f+1]=(e[f+1]-h)/c;for(let f=0,p=i.length;f<p;f+=2)i[f]=(i[f]-o)/u,i[f+1]=(i[f+1]-h)/c}toSVGPath(){const e=[`M${l(this,Be)[4]} ${l(this,Be)[5]}`];for(let i=6,s=l(this,Be).length;i<s;i+=6){if(isNaN(l(this,Be)[i])){e.push(`L${l(this,Be)[i+4]} ${l(this,Be)[i+5]}`);continue}e.push(`C${l(this,Be)[i]} ${l(this,Be)[i+1]} ${l(this,Be)[i+2]} ${l(this,Be)[i+3]} ${l(this,Be)[i+4]} ${l(this,Be)[i+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,i,s,n],r){const a=s-e,o=n-i;let h,u;switch(r){case 0:h=wt._rescale(l(this,Be),e,n,a,-o),u=wt._rescale(l(this,es),e,n,a,-o);break;case 90:h=wt._rescaleAndSwap(l(this,Be),e,i,a,o),u=wt._rescaleAndSwap(l(this,es),e,i,a,o);break;case 180:h=wt._rescale(l(this,Be),s,i,-a,o),u=wt._rescale(l(this,es),s,i,-a,o);break;case 270:h=wt._rescaleAndSwap(l(this,Be),s,n,-a,-o),u=wt._rescaleAndSwap(l(this,es),s,n,-a,-o);break}return{outline:Array.from(h),points:[Array.from(u)]}}get box(){return l(this,ja)}newOutliner(e,i,s,n,r,a=0){return new nd(e,i,s,n,r,a)}getNewOutline(e,i){const[s,n,r,a]=l(this,ja),[o,h,u,c]=l(this,xl),f=r*u,p=a*c,_=s*u+o,v=n*c+h,g=this.newOutliner({x:l(this,es)[0]*f+_,y:l(this,es)[1]*p+v},l(this,xl),l(this,Iu),e,l(this,Ru),i??l(this,jn));for(let b=2;b<l(this,es).length;b+=2)g.add({x:l(this,es)[b]*f+_,y:l(this,es)[b+1]*p+v});return g.getOutlines()}}xl=new WeakMap,ja=new WeakMap,jn=new WeakMap,Ru=new WeakMap,es=new WeakMap,Iu=new WeakMap,Be=new WeakMap,xd=new WeakSet,hb=function(e){const i=l(this,Be);let s=i[4],n=i[5];const r=[s,n,s,n];let a=s,o=n;const h=e?Math.max:Math.min;for(let c=6,f=i.length;c<f;c+=6){const p=i[c+4],_=i[c+5];if(isNaN(i[c]))Et.pointBoundingBox(p,_,r),o<_?(a=p,o=_):o===_&&(a=h(a,p));else{const v=[1/0,1/0,-1/0,-1/0];Et.bezierBoundingBox(s,n,...i.slice(c,c+6),v),Et.rectBoundingBox(...v,r),o<v[3]?(a=v[2],o=v[3]):o===v[3]&&(a=h(a,v[2]))}s=p,n=_}const u=l(this,ja);u[0]=r[0]-l(this,jn),u[1]=r[1]-l(this,jn),u[2]=r[2]-r[0]+2*l(this,jn),u[3]=r[3]-r[1]+2*l(this,jn),this.lastPoint=[a,o]};var Nu,Lu,Rr,Bs,Mi,ub,Pc,cb,db,Bp;class Fp{constructor(t,e=0,i=0,s=!0){D(this,Mi);D(this,Nu);D(this,Lu);D(this,Rr,[]);D(this,Bs,[]);const n=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:p,y:_,width:v,height:g}of t){const b=Math.floor((p-e)/r)*r,w=Math.ceil((p+v+e)/r)*r,S=Math.floor((_-e)/r)*r,T=Math.ceil((_+g+e)/r)*r,A=[b,S,T,!0],C=[w,S,T,!1];l(this,Rr).push(A,C),Et.rectBoundingBox(b,S,w,T,n)}const a=n[2]-n[0]+2*i,o=n[3]-n[1]+2*i,h=n[0]-i,u=n[1]-i,c=l(this,Rr).at(s?-1:-2),f=[c[0],c[2]];for(const p of l(this,Rr)){const[_,v,g]=p;p[0]=(_-h)/a,p[1]=(v-u)/o,p[2]=(g-u)/o}x(this,Nu,new Float32Array([h,u,a,o])),x(this,Lu,f)}getOutlines(){l(this,Rr).sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);const t=[];for(const e of l(this,Rr))e[3]?(t.push(...k(this,Mi,Bp).call(this,e)),k(this,Mi,cb).call(this,e)):(k(this,Mi,db).call(this,e),t.push(...k(this,Mi,Bp).call(this,e)));return k(this,Mi,ub).call(this,t)}}Nu=new WeakMap,Lu=new WeakMap,Rr=new WeakMap,Bs=new WeakMap,Mi=new WeakSet,ub=function(t){const e=[],i=new Set;for(const r of t){const[a,o,h]=r;e.push([a,o,r],[a,h,r])}e.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=e.length;r<a;r+=2){const o=e[r][2],h=e[r+1][2];o.push(h),h.push(o),i.add(o),i.add(h)}const s=[];let n;for(;i.size>0;){const r=i.values().next().value;let[a,o,h,u,c]=r;i.delete(r);let f=a,p=o;for(n=[a,h],s.push(n);;){let _;if(i.has(u))_=u;else if(i.has(c))_=c;else break;i.delete(_),[a,o,h,u,c]=_,f!==a&&(n.push(f,p,a,p===o?o:h),f=a),p=p===o?h:o}n.push(f,p)}return new v_(s,l(this,Nu),l(this,Lu))},Pc=function(t){const e=l(this,Bs);let i=0,s=e.length-1;for(;i<=s;){const n=i+s>>1,r=e[n][0];if(r===t)return n;r<t?i=n+1:s=n-1}return s+1},cb=function([,t,e]){const i=k(this,Mi,Pc).call(this,t);l(this,Bs).splice(i,0,[t,e])},db=function([,t,e]){const i=k(this,Mi,Pc).call(this,t);for(let s=i;s<l(this,Bs).length;s++){const[n,r]=l(this,Bs)[s];if(n!==t)break;if(n===t&&r===e){l(this,Bs).splice(s,1);return}}for(let s=i-1;s>=0;s--){const[n,r]=l(this,Bs)[s];if(n!==t)break;if(n===t&&r===e){l(this,Bs).splice(s,1);return}}},Bp=function(t){const[e,i,s]=t,n=[[e,i,s]],r=k(this,Mi,Pc).call(this,s);for(let a=0;a<r;a++){const[o,h]=l(this,Bs)[a];for(let u=0,c=n.length;u<c;u++){const[,f,p]=n[u];if(!(h<=f||p<=o)){if(f>=o){if(p>h)n[u][1]=h;else{if(c===1)return[];n.splice(u,1),u--,c--}continue}n[u][2]=o,p>h&&n.push([e,h,p])}}}return n};var Pu,Sl;class v_ extends wt{constructor(e,i,s){super();D(this,Pu);D(this,Sl);x(this,Sl,e),x(this,Pu,i),this.lastPoint=s}toSVGPath(){const e=[];for(const i of l(this,Sl)){let[s,n]=i;e.push(`M${s} ${n}`);for(let r=2;r<i.length;r+=2){const a=i[r],o=i[r+1];a===s?(e.push(`V${o}`),n=o):o===n&&(e.push(`H${a}`),s=a)}e.push("Z")}return e.join(" ")}serialize([e,i,s,n],r){const a=[],o=s-e,h=n-i;for(const u of l(this,Sl)){const c=new Array(u.length);for(let f=0;f<u.length;f+=2)c[f]=e+u[f]*o,c[f+1]=n-u[f+1]*h;a.push(c)}return a}get box(){return l(this,Pu)}get classNamesForOutlining(){return["highlightOutline"]}}Pu=new WeakMap,Sl=new WeakMap;class zp extends nd{newFreeDrawOutline(t,e,i,s,n,r){return new b_(t,e,i,s,n,r)}}class b_ extends lb{newOutliner(t,e,i,s,n,r=0){return new zp(t,e,i,s,n,r)}}var zs,Wa,Cl,Qe,Ou,Tl,Mu,Fu,Ir,Us,Dl,Bu,ge,Up,Hp,qp,Zr,fb,rr;const Hi=class Hi{constructor({editor:t=null,uiManager:e=null}){D(this,ge);D(this,zs,null);D(this,Wa,null);D(this,Cl);D(this,Qe,null);D(this,Ou,!1);D(this,Tl,!1);D(this,Mu,null);D(this,Fu);D(this,Ir,null);D(this,Us,null);D(this,Dl);var i;t?(x(this,Tl,!1),x(this,Dl,Qt.HIGHLIGHT_COLOR),x(this,Mu,t)):(x(this,Tl,!0),x(this,Dl,Qt.HIGHLIGHT_DEFAULT_COLOR)),x(this,Us,(t==null?void 0:t._uiManager)||e),x(this,Fu,l(this,Us)._eventBus),x(this,Cl,(t==null?void 0:t.color)||((i=l(this,Us))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),l(Hi,Bu)||x(Hi,Bu,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Zt(this,"_keyboardManager",new Yu([[["Escape","mac+Escape"],Hi.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Hi.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Hi.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Hi.prototype._moveToPrevious],[["Home","mac+Home"],Hi.prototype._moveToBeginning],[["End","mac+End"],Hi.prototype._moveToEnd]]))}renderButton(){const t=x(this,zs,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);const e=l(this,Us)._signal;t.addEventListener("click",k(this,ge,Zr).bind(this),{signal:e}),t.addEventListener("keydown",k(this,ge,qp).bind(this),{signal:e});const i=x(this,Wa,document.createElement("span"));return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=l(this,Cl),t.append(i),t}renderMainDropdown(){const t=x(this,Qe,k(this,ge,Up).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}_colorSelectFromKeyboard(t){if(t.target===l(this,zs)){k(this,ge,Zr).call(this,t);return}const e=t.target.getAttribute("data-color");e&&k(this,ge,Hp).call(this,e,t)}_moveToNext(t){var e,i;if(!l(this,ge,rr)){k(this,ge,Zr).call(this,t);return}if(t.target===l(this,zs)){(e=l(this,Qe).firstChild)==null||e.focus();return}(i=t.target.nextSibling)==null||i.focus()}_moveToPrevious(t){var e,i;if(t.target===((e=l(this,Qe))==null?void 0:e.firstChild)||t.target===l(this,zs)){l(this,ge,rr)&&this._hideDropdownFromKeyboard();return}l(this,ge,rr)||k(this,ge,Zr).call(this,t),(i=t.target.previousSibling)==null||i.focus()}_moveToBeginning(t){var e;if(!l(this,ge,rr)){k(this,ge,Zr).call(this,t);return}(e=l(this,Qe).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!l(this,ge,rr)){k(this,ge,Zr).call(this,t);return}(e=l(this,Qe).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=l(this,Qe))==null||t.classList.add("hidden"),(e=l(this,Ir))==null||e.abort(),x(this,Ir,null)}_hideDropdownFromKeyboard(){var t;if(!l(this,Tl)){if(!l(this,ge,rr)){(t=l(this,Mu))==null||t.unselect();return}this.hideDropdown(),l(this,zs).focus({preventScroll:!0,focusVisible:l(this,Ou)})}}updateColor(t){if(l(this,Wa)&&(l(this,Wa).style.backgroundColor=t),!l(this,Qe))return;const e=l(this,Us).highlightColors.values();for(const i of l(this,Qe).children)i.setAttribute("aria-selected",e.next().value===t)}destroy(){var t,e;(t=l(this,zs))==null||t.remove(),x(this,zs,null),x(this,Wa,null),(e=l(this,Qe))==null||e.remove(),x(this,Qe,null)}};zs=new WeakMap,Wa=new WeakMap,Cl=new WeakMap,Qe=new WeakMap,Ou=new WeakMap,Tl=new WeakMap,Mu=new WeakMap,Fu=new WeakMap,Ir=new WeakMap,Us=new WeakMap,Dl=new WeakMap,Bu=new WeakMap,ge=new WeakSet,Up=function(){const t=document.createElement("div"),e=l(this,Us)._signal;t.addEventListener("contextmenu",Gs,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[i,s]of l(this,Us).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",l(Hi,Bu)[i]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=s,n.setAttribute("aria-selected",s===l(this,Cl)),n.addEventListener("click",k(this,ge,Hp).bind(this,s),{signal:e}),t.append(n)}return t.addEventListener("keydown",k(this,ge,qp).bind(this),{signal:e}),t},Hp=function(t,e){e.stopPropagation(),l(this,Fu).dispatch("switchannotationeditorparams",{source:this,type:l(this,Dl),value:t})},qp=function(t){Hi._keyboardManager.exec(this,t)},Zr=function(t){if(l(this,ge,rr)){this.hideDropdown();return}if(x(this,Ou,t.detail===0),l(this,Ir)||(x(this,Ir,new AbortController),window.addEventListener("pointerdown",k(this,ge,fb).bind(this),{signal:l(this,Us).combinedSignal(l(this,Ir))})),l(this,Qe)){l(this,Qe).classList.remove("hidden");return}const e=x(this,Qe,k(this,ge,Up).call(this));l(this,zs).append(e)},fb=function(t){var e;(e=l(this,Qe))!=null&&e.contains(t.target)||this.hideDropdown()},rr=function(){return l(this,Qe)&&!l(this,Qe).classList.contains("hidden")},D(Hi,Bu,null);let rd=Hi;var kl,zu,Wn,Va,Rl,Wi,Uu,Hu,Ga,ys,is,fi,Il,Vn,Si,Nl,ws,qu,jt,jp,Oc,pb,gb,mb,Wp,Jr,Es,ko,vb,Mc,fh,bb,yb,wb,_b,Ab;const le=class le extends Ce{constructor(e){super({...e,name:"highlightEditor"});D(this,jt);D(this,kl,null);D(this,zu,0);D(this,Wn);D(this,Va,null);D(this,Rl,null);D(this,Wi,null);D(this,Uu,null);D(this,Hu,0);D(this,Ga,null);D(this,ys,null);D(this,is,null);D(this,fi,!1);D(this,Il,null);D(this,Vn);D(this,Si,null);D(this,Nl,"");D(this,ws);D(this,qu,"");this.color=e.color||le._defaultColor,x(this,ws,e.thickness||le._defaultThickness),x(this,Vn,e.opacity||le._defaultOpacity),x(this,Wn,e.boxes||null),x(this,qu,e.methodOfCreation||""),x(this,Nl,e.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(x(this,fi,!0),k(this,jt,Oc).call(this,e),k(this,jt,Jr).call(this)):l(this,Wn)&&(x(this,kl,e.anchorNode),x(this,zu,e.anchorOffset),x(this,Uu,e.focusNode),x(this,Hu,e.focusOffset),k(this,jt,jp).call(this),k(this,jt,Jr).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const e=le.prototype;return Zt(this,"_keyboardManager",new Yu([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:l(this,fi)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:l(this,ws),methodOfCreation:l(this,qu)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,i){var s;Ce.initialize(e,i),le._defaultColor||(le._defaultColor=((s=i.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(e,i){switch(e){case Qt.HIGHLIGHT_DEFAULT_COLOR:le._defaultColor=i;break;case Qt.HIGHLIGHT_THICKNESS:le._defaultThickness=i;break}}translateInPage(e,i){}get toolbarPosition(){return l(this,Il)}updateParams(e,i){switch(e){case Qt.HIGHLIGHT_COLOR:k(this,jt,pb).call(this,i);break;case Qt.HIGHLIGHT_THICKNESS:k(this,jt,gb).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[Qt.HIGHLIGHT_DEFAULT_COLOR,le._defaultColor],[Qt.HIGHLIGHT_THICKNESS,le._defaultThickness]]}get propertiesToUpdate(){return[[Qt.HIGHLIGHT_COLOR,this.color||le._defaultColor],[Qt.HIGHLIGHT_THICKNESS,l(this,ws)||le._defaultThickness],[Qt.HIGHLIGHT_FREE,l(this,fi)]]}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(x(this,Rl,new rd({editor:this})),e.addColorPicker(l(this,Rl))),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(k(this,jt,fh).call(this))}getBaseTranslation(){return[0,0]}getRect(e,i){return super.getRect(e,i,k(this,jt,fh).call(this))}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){k(this,jt,Wp).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(k(this,jt,Jr).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var s;let i=!1;this.parent&&!e?k(this,jt,Wp).call(this):e&&(k(this,jt,Jr).call(this,e),i=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),i&&this.select()}rotate(e){var n,r,a;const{drawLayer:i}=this.parent;let s;l(this,fi)?(e=(e-this.rotation+360)%360,s=k(n=le,Es,ko).call(n,l(this,ys).box,e)):s=k(r=le,Es,ko).call(r,[this.x,this.y,this.width,this.height],e),i.updateProperties(l(this,is),{bbox:s,root:{"data-main-rotation":e}}),i.updateProperties(l(this,Si),{bbox:k(a=le,Es,ko).call(a,l(this,Wi).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();l(this,Nl)&&(e.setAttribute("aria-label",l(this,Nl)),e.setAttribute("role","mark")),l(this,fi)?e.classList.add("free"):this.div.addEventListener("keydown",k(this,jt,vb).bind(this),{signal:this._uiManager._signal});const i=x(this,Ga,document.createElement("div"));e.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=l(this,Va);const[s,n]=this.parentDimensions;return this.setDims(this.width*s,this.height*n),xg(this,l(this,Ga),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(l(this,Si),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(l(this,Si),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:k(this,jt,Mc).call(this,!0);break;case 1:case 3:k(this,jt,Mc).call(this,!1);break}}select(){var e;super.select(),l(this,Si)&&((e=this.parent)==null||e.drawLayer.updateProperties(l(this,Si),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),l(this,Si)&&((e=this.parent)==null||e.drawLayer.updateProperties(l(this,Si),{rootClass:{selected:!1}}),l(this,fi)||k(this,jt,Mc).call(this,!1))}get _mustFixPosition(){return!l(this,fi)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(l(this,is),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(l(this,Si),{rootClass:{hidden:!e}}))}static startHighlighting(e,i,{target:s,x:n,y:r}){const{x:a,y:o,width:h,height:u}=s.getBoundingClientRect(),c=new AbortController,f=e.combinedSignal(c),p=_=>{c.abort(),k(this,Es,_b).call(this,e,_)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",Ve,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",Gs,{signal:f}),s.addEventListener("pointermove",k(this,Es,wb).bind(this,e),{signal:f}),this._freeHighlight=new zp({x:n,y:r},[a,o,h,u],e.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,i,s){var v,g,b,w;let n=null;if(e instanceof Y0){const{data:{quadPoints:S,rect:T,rotation:A,id:C,color:R,opacity:P,popupRef:N},parent:{page:{pageNumber:F}}}=e;n=e={annotationType:Bt.HIGHLIGHT,color:Array.from(R),opacity:P,quadPoints:S,boxes:null,pageIndex:F-1,rect:T.slice(0),rotation:A,id:C,deleted:!1,popupRef:N}}else if(e instanceof Dg){const{data:{inkLists:S,rect:T,rotation:A,id:C,color:R,borderStyle:{rawWidth:P},popupRef:N},parent:{page:{pageNumber:F}}}=e;n=e={annotationType:Bt.HIGHLIGHT,color:Array.from(R),thickness:P,inkLists:S,boxes:null,pageIndex:F-1,rect:T.slice(0),rotation:A,id:C,deleted:!1,popupRef:N}}const{color:r,quadPoints:a,inkLists:o,opacity:h}=e,u=await super.deserialize(e,i,s);u.color=Et.makeHexColor(...r),x(u,Vn,h||1),o&&x(u,ws,e.thickness),u.annotationElementId=e.id||null,u._initialData=n;const[c,f]=u.pageDimensions,[p,_]=u.pageTranslation;if(a){const S=x(u,Wn,[]);for(let T=0;T<a.length;T+=8)S.push({x:(a[T]-p)/c,y:1-(a[T+1]-_)/f,width:(a[T+2]-a[T])/c,height:(a[T+1]-a[T+5])/f});k(v=u,jt,jp).call(v),k(g=u,jt,Jr).call(g),u.rotate(u.rotation)}else if(o){x(u,fi,!0);const S=o[0],T={x:S[0]-p,y:f-(S[1]-_)},A=new zp(T,[0,0,c,f],1,l(u,ws)/2,!0,.001);for(let P=0,N=S.length;P<N;P+=2)T.x=S[P]-p,T.y=f-(S[P+1]-_),A.add(T);const{id:C,clipPathId:R}=i.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:A.toSVGPath()}},!0,!0);k(b=u,jt,Oc).call(b,{highlightOutlines:A.getOutlines(),highlightId:C,clipPathId:R}),k(w=u,jt,Jr).call(w),u.rotate(u.parentRotation)}return u}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const i=this.getRect(0,0),s=Ce._colorManager.convert(this.color),n={annotationType:Bt.HIGHLIGHT,color:s,opacity:l(this,Vn),thickness:l(this,ws),quadPoints:k(this,jt,bb).call(this),outlines:k(this,jt,yb).call(this,i),pageIndex:this.pageIndex,rect:i,rotation:k(this,jt,fh).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!k(this,jt,Ab).call(this,n)?null:(n.id=this.annotationElementId,n)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};kl=new WeakMap,zu=new WeakMap,Wn=new WeakMap,Va=new WeakMap,Rl=new WeakMap,Wi=new WeakMap,Uu=new WeakMap,Hu=new WeakMap,Ga=new WeakMap,ys=new WeakMap,is=new WeakMap,fi=new WeakMap,Il=new WeakMap,Vn=new WeakMap,Si=new WeakMap,Nl=new WeakMap,ws=new WeakMap,qu=new WeakMap,jt=new WeakSet,jp=function(){const e=new Fp(l(this,Wn),.001);x(this,ys,e.getOutlines()),[this.x,this.y,this.width,this.height]=l(this,ys).box;const i=new Fp(l(this,Wn),.0025,.001,this._uiManager.direction==="ltr");x(this,Wi,i.getOutlines());const{lastPoint:s}=l(this,Wi);x(this,Il,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},Oc=function({highlightOutlines:e,highlightId:i,clipPathId:s}){var c,f;if(x(this,ys,e),x(this,Wi,e.getNewOutline(l(this,ws)/2+1.5,.0025)),i>=0)x(this,is,i),x(this,Va,s),this.parent.drawLayer.finalizeDraw(i,{bbox:e.box,path:{d:e.toSVGPath()}}),x(this,Si,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:l(this,Wi).box,path:{d:l(this,Wi).toSVGPath()}},!0));else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(l(this,is),{bbox:k(c=le,Es,ko).call(c,l(this,ys).box,(p-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(l(this,Si),{bbox:k(f=le,Es,ko).call(f,l(this,Wi).box,p),path:{d:l(this,Wi).toSVGPath()}})}const[r,a,o,h]=e.box;switch(this.rotation){case 0:this.x=r,this.y=a,this.width=o,this.height=h;break;case 90:{const[p,_]=this.parentDimensions;this.x=a,this.y=1-r,this.width=o*_/p,this.height=h*p/_;break}case 180:this.x=1-r,this.y=1-a,this.width=o,this.height=h;break;case 270:{const[p,_]=this.parentDimensions;this.x=1-a,this.y=r,this.width=o*_/p,this.height=h*p/_;break}}const{lastPoint:u}=l(this,Wi);x(this,Il,[(u[0]-r)/o,(u[1]-a)/h])},pb=function(e){const i=(r,a)=>{var o,h;this.color=r,x(this,Vn,a),(o=this.parent)==null||o.drawLayer.updateProperties(l(this,is),{root:{fill:r,"fill-opacity":a}}),(h=l(this,Rl))==null||h.updateColor(r)},s=this.color,n=l(this,Vn);this.addCommands({cmd:i.bind(this,e,le._defaultOpacity),undo:i.bind(this,s,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Qt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)},gb=function(e){const i=l(this,ws),s=n=>{x(this,ws,n),k(this,jt,mb).call(this,n)};this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Qt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},mb=function(e){if(!l(this,fi))return;k(this,jt,Oc).call(this,{highlightOutlines:l(this,ys).getNewOutline(e/2)}),this.fixAndSetPosition();const[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)},Wp=function(){l(this,is)===null||!this.parent||(this.parent.drawLayer.remove(l(this,is)),x(this,is,null),this.parent.drawLayer.remove(l(this,Si)),x(this,Si,null))},Jr=function(e=this.parent){l(this,is)===null&&({id:ki(this,is)._,clipPathId:ki(this,Va)._}=e.drawLayer.draw({bbox:l(this,ys).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":l(this,Vn)},rootClass:{highlight:!0,free:l(this,fi)},path:{d:l(this,ys).toSVGPath()}},!1,!0),x(this,Si,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:l(this,fi)},bbox:l(this,Wi).box,path:{d:l(this,Wi).toSVGPath()}},l(this,fi))),l(this,Ga)&&(l(this,Ga).style.clipPath=l(this,Va)))},Es=new WeakSet,ko=function([e,i,s,n],r){switch(r){case 90:return[1-i-n,e,n,s];case 180:return[1-e-s,1-i-n,s,n];case 270:return[i,1-e-s,n,s]}return[e,i,s,n]},vb=function(e){le._keyboardManager.exec(this,e)},Mc=function(e){if(!l(this,kl))return;const i=window.getSelection();e?i.setPosition(l(this,kl),l(this,zu)):i.setPosition(l(this,Uu),l(this,Hu))},fh=function(){return l(this,fi)?this.rotation:0},bb=function(){if(l(this,fi))return null;const[e,i]=this.pageDimensions,[s,n]=this.pageTranslation,r=l(this,Wn),a=new Float32Array(r.length*8);let o=0;for(const{x:h,y:u,width:c,height:f}of r){const p=h*e+s,_=(1-u)*i+n;a[o]=a[o+4]=p,a[o+1]=a[o+3]=_,a[o+2]=a[o+6]=p+c*e,a[o+5]=a[o+7]=_-f*i,o+=8}return a},yb=function(e){return l(this,ys).serialize(e,k(this,jt,fh).call(this))},wb=function(e,i){this._freeHighlight.add(i)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},_b=function(e,i){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Ab=function(e){const{color:i}=this._initialData;return e.color.some((s,n)=>s!==i[n])},D(le,Es),At(le,"_defaultColor",null),At(le,"_defaultOpacity",1),At(le,"_defaultThickness",12),At(le,"_type","highlight"),At(le,"_editorType",Bt.HIGHLIGHT),At(le,"_freeHighlightId",-1),At(le,"_freeHighlight",null),At(le,"_freeHighlightClipId","");let ad=le;var $a;class Eb{constructor(){D(this,$a,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,i]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,i)}updateSVGProperty(t,e){l(this,$a)[t]=e}toSVGProperties(){const t=l(this,$a);return x(this,$a,Object.create(null)),{root:t}}reset(){x(this,$a,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){me("Not implemented")}}$a=new WeakMap;var ss,Ll,ri,Xa,Ya,Nr,Lr,Pr,Ka,ne,Vp,Gp,$p,ph,xb,Fc,gh,Ro;const _t=class _t extends Ce{constructor(e){super(e);D(this,ne);D(this,ss,null);D(this,Ll);At(this,"_drawId",null);x(this,Ll,e.mustBeCommitted||!1),this._addOutlines(e)}_addOutlines(e){e.drawOutlines&&(k(this,ne,Vp).call(this,e),k(this,ne,ph).call(this))}static _mergeSVGProperties(e,i){const s=new Set(Object.keys(e));for(const[n,r]of Object.entries(i))s.has(n)?Object.assign(e[n],r):e[n]=r;return e}static getDefaultDrawingOptions(e){me("Not implemented")}static get typesMap(){me("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,i){const s=this.typesMap.get(e);s&&this._defaultDrawingOptions.updateProperty(s,i),this._currentParent&&(l(_t,ri).updateProperty(s,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,i){const s=this.constructor.typesMap.get(e);s&&this._updateProperty(e,s,i)}static get defaultPropertiesToUpdate(){const e=[],i=this._defaultDrawingOptions;for(const[s,n]of this.typesMap)e.push([s,i[n]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:i}=this;for(const[s,n]of this.constructor.typesMap)e.push([s,i[n]]);return e}_updateProperty(e,i,s){const n=this._drawingOptions,r=n[i],a=o=>{var u;n.updateProperty(i,o);const h=l(this,ss).updateProperty(i,o);h&&k(this,ne,gh).call(this,h),(u=this.parent)==null||u.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:a.bind(this,s),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,_t._mergeSVGProperties(l(this,ss).getPathResizingSVGProperties(k(this,ne,Fc).call(this)),{bbox:k(this,ne,Ro).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,_t._mergeSVGProperties(l(this,ss).getPathResizedSVGProperties(k(this,ne,Fc).call(this)),{bbox:k(this,ne,Ro).call(this)}))}_onTranslating(e,i){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:k(this,ne,Ro).call(this)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,_t._mergeSVGProperties(l(this,ss).getPathTranslatedSVGProperties(k(this,ne,Fc).call(this),this.parentDimensions),{bbox:k(this,ne,Ro).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,l(this,Ll)&&(x(this,Ll,!1),this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){k(this,ne,$p).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(k(this,ne,ph).call(this),k(this,ne,gh).call(this,l(this,ss).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var s;let i=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),k(this,ne,$p).call(this)):e&&(this._uiManager.addShouldRescale(this),k(this,ne,ph).call(this,e),i=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(e),i&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,_t._mergeSVGProperties({bbox:k(this,ne,Ro).call(this)},l(this,ss).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&k(this,ne,gh).call(this,l(this,ss).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,i;this._isCopy&&(e=this.x,i=this.y);const s=super.render();s.classList.add("draw");const n=document.createElement("div");s.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";const[r,a]=this.parentDimensions;return this.setDims(this.width*r,this.height*a),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,i),s}static createDrawerInstance(e,i,s,n,r){me("Not implemented")}static startDrawing(e,i,s,n){var g;const{target:r,offsetX:a,offsetY:o,pointerId:h,pointerType:u}=n;if(l(_t,Lr)&&l(_t,Lr)!==u)return;const{viewport:{rotation:c}}=e,{width:f,height:p}=r.getBoundingClientRect(),_=x(_t,Xa,new AbortController),v=e.combinedSignal(_);if(l(_t,Nr)||x(_t,Nr,h),l(_t,Lr)??x(_t,Lr,u),window.addEventListener("pointerup",b=>{var w;l(_t,Nr)===b.pointerId?this._endDraw(b):(w=l(_t,Pr))==null||w.delete(b.pointerId)},{signal:v}),window.addEventListener("pointercancel",b=>{var w;l(_t,Nr)===b.pointerId?this._currentParent.endDrawingSession():(w=l(_t,Pr))==null||w.delete(b.pointerId)},{signal:v}),window.addEventListener("pointerdown",b=>{l(_t,Lr)===b.pointerType&&((l(_t,Pr)||x(_t,Pr,new Set)).add(b.pointerId),l(_t,ri).isCancellable()&&(l(_t,ri).removeLastElement(),l(_t,ri).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",Gs,{signal:v}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:v}),r.addEventListener("touchmove",b=>{b.timeStamp===l(_t,Ka)&&Ve(b)},{signal:v}),e.toggleDrawing(),(g=i._editorUndoBar)==null||g.hide(),l(_t,ri)){e.drawLayer.updateProperties(this._currentDrawId,l(_t,ri).startNew(a,o,f,p,c));return}i.updateUIForDefaultProperties(this),x(_t,ri,this.createDrawerInstance(a,o,f,p,c)),x(_t,Ya,this.getDefaultDrawingOptions()),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(l(_t,Ya).toSVGProperties(),l(_t,ri).defaultSVGProperties),!0,!1)}static _drawMove(e){var r;if(x(_t,Ka,-1),!l(_t,ri))return;const{offsetX:i,offsetY:s,pointerId:n}=e;if(l(_t,Nr)===n){if(((r=l(_t,Pr))==null?void 0:r.size)>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,l(_t,ri).add(i,s)),x(_t,Ka,e.timeStamp),Ve(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,x(_t,ri,null),x(_t,Ya,null),x(_t,Lr,null),x(_t,Ka,NaN)),l(_t,Xa)&&(l(_t,Xa).abort(),x(_t,Xa,null),x(_t,Nr,NaN),x(_t,Pr,null))}static _endDraw(e){const i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),(e==null?void 0:e.target)===i.div&&i.drawLayer.updateProperties(this._currentDrawId,l(_t,ri).end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const s=l(_t,ri),n=this._currentDrawId,r=s.getLastElement();i.addCommands({cmd:()=>{i.drawLayer.updateProperties(n,s.setLastElement(r))},undo:()=>{i.drawLayer.updateProperties(n,s.removeLastElement())},mustExec:!1,type:Qt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(Qt.DRAW_STEP),!l(_t,ri).isEmpty()){const{pageDimensions:[s,n],scale:r}=i,a=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:l(_t,ri).getOutlines(s*r,n*r,r,this._INNER_MARGIN),drawingOptions:l(_t,Ya),mustBeCommitted:!e});return this._cleanup(!0),a}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,i,s,n,r,a){me("Not implemented")}static async deserialize(e,i,s){var c,f;const{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:o}}=i.viewport,h=this.deserializeDraw(a,o,n,r,this._INNER_MARGIN,e),u=await super.deserialize(e,i,s);return u.createDrawingOptions(e),k(c=u,ne,Vp).call(c,{drawOutlines:h}),k(f=u,ne,ph).call(f),u.onScaleChanging(),u.rotate(),u}serializeDraw(e){const[i,s]=this.pageTranslation,[n,r]=this.pageDimensions;return l(this,ss).serialize([i,s,n,r],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};ss=new WeakMap,Ll=new WeakMap,ri=new WeakMap,Xa=new WeakMap,Ya=new WeakMap,Nr=new WeakMap,Lr=new WeakMap,Pr=new WeakMap,Ka=new WeakMap,ne=new WeakSet,Vp=function({drawOutlines:e,drawId:i,drawingOptions:s}){x(this,ss,e),this._drawingOptions||(this._drawingOptions=s),i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,e.defaultProperties)):this._drawId=k(this,ne,Gp).call(this,e,this.parent),k(this,ne,gh).call(this,e.box)},Gp=function(e,i){const{id:s}=i.drawLayer.draw(_t._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return s},$p=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},ph=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=k(this,ne,Gp).call(this,l(this,ss),e)}},xb=function([e,i,s,n]){const{parentDimensions:[r,a],rotation:o}=this;switch(o){case 90:return[i,1-e,s*(a/r),n*(r/a)];case 180:return[1-e,1-i,s,n];case 270:return[1-i,e,s*(a/r),n*(r/a)];default:return[e,i,s,n]}},Fc=function(){const{x:e,y:i,width:s,height:n,parentDimensions:[r,a],rotation:o}=this;switch(o){case 90:return[1-i,e,s*(r/a),n*(a/r)];case 180:return[1-e,1-i,s,n];case 270:return[i,1-e,s*(r/a),n*(a/r)];default:return[e,i,s,n]}},gh=function(e){if([this.x,this.y,this.width,this.height]=k(this,ne,xb).call(this,e),this.div){this.fixAndSetPosition();const[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)}this._onResized()},Ro=function(){const{x:e,y:i,width:s,height:n,rotation:r,parentRotation:a,parentDimensions:[o,h]}=this;switch((r*4+a)/90){case 1:return[1-i-n,e,n,s];case 2:return[1-e-s,1-i-n,s,n];case 3:return[i,1-e-s,n,s];case 4:return[e,i-s*(o/h),n*(h/o),s*(o/h)];case 5:return[1-i,e,s*(o/h),n*(h/o)];case 6:return[1-e-n*(h/o),1-i,n*(h/o),s*(o/h)];case 7:return[i-s*(o/h),1-e-n*(h/o),s*(o/h),n*(h/o)];case 8:return[e-s,i-n,s,n];case 9:return[1-i,e-s,n,s];case 10:return[1-e,1-i,s,n];case 11:return[i-n,1-e,n,s];case 12:return[e-n*(h/o),i,n*(h/o),s*(o/h)];case 13:return[1-i-s*(o/h),e-n*(h/o),s*(o/h),n*(h/o)];case 14:return[1-e,1-i-s*(o/h),n*(h/o),s*(o/h)];case 15:return[i,1-e,s*(o/h),n*(h/o)];default:return[e,i,s,n]}},At(_t,"_currentDrawId",-1),At(_t,"_currentParent",null),D(_t,ri,null),D(_t,Xa,null),D(_t,Ya,null),D(_t,Nr,NaN),D(_t,Lr,null),D(_t,Pr,null),D(_t,Ka,NaN),At(_t,"_INNER_MARGIN",3);let od=_t;var hn,ai,oi,Za,Pl,Ni,pi,_s,Ja,Qa,to,Ol,Bc;class y_{constructor(t,e,i,s,n,r){D(this,Ol);D(this,hn,new Float64Array(6));D(this,ai);D(this,oi);D(this,Za);D(this,Pl);D(this,Ni);D(this,pi,"");D(this,_s,0);D(this,Ja,new Ju);D(this,Qa);D(this,to);x(this,Qa,i),x(this,to,s),x(this,Za,n),x(this,Pl,r),[t,e]=k(this,Ol,Bc).call(this,t,e);const a=x(this,ai,[NaN,NaN,NaN,NaN,t,e]);x(this,Ni,[t,e]),x(this,oi,[{line:a,points:l(this,Ni)}]),l(this,hn).set(a,0)}updateProperty(t,e){t==="stroke-width"&&x(this,Pl,e)}isEmpty(){return!l(this,oi)||l(this,oi).length===0}isCancellable(){return l(this,Ni).length<=10}add(t,e){[t,e]=k(this,Ol,Bc).call(this,t,e);const[i,s,n,r]=l(this,hn).subarray(2,6),a=t-n,o=e-r;return Math.hypot(l(this,Qa)*a,l(this,to)*o)<=2?null:(l(this,Ni).push(t,e),isNaN(i)?(l(this,hn).set([n,r,t,e],2),l(this,ai).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(l(this,hn)[0])&&l(this,ai).splice(6,6),l(this,hn).set([i,s,n,r,t,e],0),l(this,ai).push(...wt.createBezierPoints(i,s,n,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const i=this.add(t,e);return i||(l(this,Ni).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,i,s,n){x(this,Qa,i),x(this,to,s),x(this,Za,n),[t,e]=k(this,Ol,Bc).call(this,t,e);const r=x(this,ai,[NaN,NaN,NaN,NaN,t,e]);x(this,Ni,[t,e]);const a=l(this,oi).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),l(this,oi).push({line:r,points:l(this,Ni)}),l(this,hn).set(r,0),x(this,_s,0),this.toSVGPath(),null}getLastElement(){return l(this,oi).at(-1)}setLastElement(t){return l(this,oi)?(l(this,oi).push(t),x(this,ai,t.line),x(this,Ni,t.points),x(this,_s,0),{path:{d:this.toSVGPath()}}):l(this,Ja).setLastElement(t)}removeLastElement(){if(!l(this,oi))return l(this,Ja).removeLastElement();l(this,oi).pop(),x(this,pi,"");for(let t=0,e=l(this,oi).length;t<e;t++){const{line:i,points:s}=l(this,oi)[t];x(this,ai,i),x(this,Ni,s),x(this,_s,0),this.toSVGPath()}return{path:{d:l(this,pi)}}}toSVGPath(){const t=wt.svgRound(l(this,ai)[4]),e=wt.svgRound(l(this,ai)[5]);if(l(this,Ni).length===2)return x(this,pi,`${l(this,pi)} M ${t} ${e} Z`),l(this,pi);if(l(this,Ni).length<=6){const s=l(this,pi).lastIndexOf("M");x(this,pi,`${l(this,pi).slice(0,s)} M ${t} ${e}`),x(this,_s,6)}if(l(this,Ni).length===4){const s=wt.svgRound(l(this,ai)[10]),n=wt.svgRound(l(this,ai)[11]);return x(this,pi,`${l(this,pi)} L ${s} ${n}`),x(this,_s,12),l(this,pi)}const i=[];l(this,_s)===0&&(i.push(`M ${t} ${e}`),x(this,_s,6));for(let s=l(this,_s),n=l(this,ai).length;s<n;s+=6){const[r,a,o,h,u,c]=l(this,ai).slice(s,s+6).map(wt.svgRound);i.push(`C${r} ${a} ${o} ${h} ${u} ${c}`)}return x(this,pi,l(this,pi)+i.join(" ")),x(this,_s,l(this,ai).length),l(this,pi)}getOutlines(t,e,i,s){const n=l(this,oi).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),l(this,Ja).build(l(this,oi),t,e,i,l(this,Za),l(this,Pl),s),x(this,hn,null),x(this,ai,null),x(this,oi,null),x(this,pi,null),l(this,Ja)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}hn=new WeakMap,ai=new WeakMap,oi=new WeakMap,Za=new WeakMap,Pl=new WeakMap,Ni=new WeakMap,pi=new WeakMap,_s=new WeakMap,Ja=new WeakMap,Qa=new WeakMap,to=new WeakMap,Ol=new WeakSet,Bc=function(t,e){return wt._normalizePoint(t,e,l(this,Qa),l(this,to),l(this,Za))};var Li,ju,Wu,ns,un,cn,Ml,Fl,eo,vi,_n,Sb,Cb,Tb;class Ju extends wt{constructor(){super(...arguments);D(this,vi);D(this,Li);D(this,ju,0);D(this,Wu);D(this,ns);D(this,un);D(this,cn);D(this,Ml);D(this,Fl);D(this,eo)}build(e,i,s,n,r,a,o){x(this,un,i),x(this,cn,s),x(this,Ml,n),x(this,Fl,r),x(this,eo,a),x(this,Wu,o??0),x(this,ns,e),k(this,vi,Cb).call(this)}get thickness(){return l(this,eo)}setLastElement(e){return l(this,ns).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return l(this,ns).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:i}of l(this,ns)){if(e.push(`M${wt.svgRound(i[4])} ${wt.svgRound(i[5])}`),i.length===6){e.push("Z");continue}if(i.length===12&&isNaN(i[6])){e.push(`L${wt.svgRound(i[10])} ${wt.svgRound(i[11])}`);continue}for(let s=6,n=i.length;s<n;s+=6){const[r,a,o,h,u,c]=i.subarray(s,s+6).map(wt.svgRound);e.push(`C${r} ${a} ${o} ${h} ${u} ${c}`)}}return e.join("")}serialize([e,i,s,n],r){const a=[],o=[],[h,u,c,f]=k(this,vi,Sb).call(this);let p,_,v,g,b,w,S,T,A;switch(l(this,Fl)){case 0:A=wt._rescale,p=e,_=i+n,v=s,g=-n,b=e+h*s,w=i+(1-u-f)*n,S=e+(h+c)*s,T=i+(1-u)*n;break;case 90:A=wt._rescaleAndSwap,p=e,_=i,v=s,g=n,b=e+u*s,w=i+h*n,S=e+(u+f)*s,T=i+(h+c)*n;break;case 180:A=wt._rescale,p=e+s,_=i,v=-s,g=n,b=e+(1-h-c)*s,w=i+u*n,S=e+(1-h)*s,T=i+(u+f)*n;break;case 270:A=wt._rescaleAndSwap,p=e+s,_=i+n,v=-s,g=-n,b=e+(1-u-f)*s,w=i+(1-h-c)*n,S=e+(1-u)*s,T=i+(1-h)*n;break}for(const{line:C,points:R}of l(this,ns))a.push(A(C,p,_,v,g,r?new Array(C.length):null)),o.push(A(R,p,_,v,g,r?new Array(R.length):null));return{lines:a,points:o,rect:[b,w,S,T]}}static deserialize(e,i,s,n,r,{paths:{lines:a,points:o},rotation:h,thickness:u}){const c=[];let f,p,_,v,g;switch(h){case 0:g=wt._rescale,f=-e/s,p=i/n+1,_=1/s,v=-1/n;break;case 90:g=wt._rescaleAndSwap,f=-i/n,p=-e/s,_=1/n,v=1/s;break;case 180:g=wt._rescale,f=e/s+1,p=-i/n,_=-1/s,v=1/n;break;case 270:g=wt._rescaleAndSwap,f=i/n+1,p=e/s+1,_=-1/n,v=-1/s;break}if(!a){a=[];for(const w of o){const S=w.length;if(S===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(S===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const T=new Float32Array(3*(S-2));a.push(T);let[A,C,R,P]=w.subarray(0,4);T.set([NaN,NaN,NaN,NaN,A,C],0);for(let N=4;N<S;N+=2){const F=w[N],z=w[N+1];T.set(wt.createBezierPoints(A,C,R,P,F,z),(N-2)*3),[A,C,R,P]=[R,P,F,z]}}}for(let w=0,S=a.length;w<S;w++)c.push({line:g(a[w].map(T=>T??NaN),f,p,_,v),points:g(o[w].map(T=>T??NaN),f,p,_,v)});const b=new this.prototype.constructor;return b.build(c,s,n,1,h,u,r),b}get box(){return l(this,Li)}updateProperty(e,i){return e==="stroke-width"?k(this,vi,Tb).call(this,i):null}updateParentDimensions([e,i],s){const[n,r]=k(this,vi,_n).call(this);x(this,un,e),x(this,cn,i),x(this,Ml,s);const[a,o]=k(this,vi,_n).call(this),h=a-n,u=o-r,c=l(this,Li);return c[0]-=h,c[1]-=u,c[2]+=2*h,c[3]+=2*u,c}updateRotation(e){return x(this,ju,e),{path:{transform:this.rotationTransform}}}get viewBox(){return l(this,Li).map(wt.svgRound).join(" ")}get defaultProperties(){const[e,i]=l(this,Li);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${wt.svgRound(e)} ${wt.svgRound(i)}`}}}get rotationTransform(){const[,,e,i]=l(this,Li);let s=0,n=0,r=0,a=0,o=0,h=0;switch(l(this,ju)){case 90:n=i/e,r=-e/i,o=e;break;case 180:s=-1,a=-1,o=e,h=i;break;case 270:n=-i/e,r=e/i,h=i;break;default:return""}return`matrix(${s} ${n} ${r} ${a} ${wt.svgRound(o)} ${wt.svgRound(h)})`}getPathResizingSVGProperties([e,i,s,n]){const[r,a]=k(this,vi,_n).call(this),[o,h,u,c]=l(this,Li);if(Math.abs(u-r)<=wt.PRECISION||Math.abs(c-a)<=wt.PRECISION){const g=e+s/2-(o+u/2),b=i+n/2-(h+c/2);return{path:{"transform-origin":`${wt.svgRound(e)} ${wt.svgRound(i)}`,transform:`${this.rotationTransform} translate(${g} ${b})`}}}const f=(s-2*r)/(u-2*r),p=(n-2*a)/(c-2*a),_=u/s,v=c/n;return{path:{"transform-origin":`${wt.svgRound(o)} ${wt.svgRound(h)}`,transform:`${this.rotationTransform} scale(${_} ${v}) translate(${wt.svgRound(r)} ${wt.svgRound(a)}) scale(${f} ${p}) translate(${wt.svgRound(-r)} ${wt.svgRound(-a)})`}}}getPathResizedSVGProperties([e,i,s,n]){const[r,a]=k(this,vi,_n).call(this),o=l(this,Li),[h,u,c,f]=o;if(o[0]=e,o[1]=i,o[2]=s,o[3]=n,Math.abs(c-r)<=wt.PRECISION||Math.abs(f-a)<=wt.PRECISION){const b=e+s/2-(h+c/2),w=i+n/2-(u+f/2);for(const{line:S,points:T}of l(this,ns))wt._translate(S,b,w,S),wt._translate(T,b,w,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${wt.svgRound(e)} ${wt.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(s-2*r)/(c-2*r),_=(n-2*a)/(f-2*a),v=-p*(h+r)+e+r,g=-_*(u+a)+i+a;if(p!==1||_!==1||v!==0||g!==0)for(const{line:b,points:w}of l(this,ns))wt._rescale(b,v,g,p,_,b),wt._rescale(w,v,g,p,_,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${wt.svgRound(e)} ${wt.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,i],s){const[n,r]=s,a=l(this,Li),o=e-a[0],h=i-a[1];if(l(this,un)===n&&l(this,cn)===r)for(const{line:u,points:c}of l(this,ns))wt._translate(u,o,h,u),wt._translate(c,o,h,c);else{const u=l(this,un)/n,c=l(this,cn)/r;x(this,un,n),x(this,cn,r);for(const{line:f,points:p}of l(this,ns))wt._rescale(f,o,h,u,c,f),wt._rescale(p,o,h,u,c,p);a[2]*=u,a[3]*=c}return a[0]=e,a[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${wt.svgRound(e)} ${wt.svgRound(i)}`}}}get defaultSVGProperties(){const e=l(this,Li);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${wt.svgRound(e[0])} ${wt.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}Li=new WeakMap,ju=new WeakMap,Wu=new WeakMap,ns=new WeakMap,un=new WeakMap,cn=new WeakMap,Ml=new WeakMap,Fl=new WeakMap,eo=new WeakMap,vi=new WeakSet,_n=function(e=l(this,eo)){const i=l(this,Wu)+e/2*l(this,Ml);return l(this,Fl)%180===0?[i/l(this,un),i/l(this,cn)]:[i/l(this,cn),i/l(this,un)]},Sb=function(){const[e,i,s,n]=l(this,Li),[r,a]=k(this,vi,_n).call(this,0);return[e+r,i+a,s-2*r,n-2*a]},Cb=function(){const e=x(this,Li,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of l(this,ns)){if(n.length<=12){for(let o=4,h=n.length;o<h;o+=6)Et.pointBoundingBox(n[o],n[o+1],e);continue}let r=n[4],a=n[5];for(let o=6,h=n.length;o<h;o+=6){const[u,c,f,p,_,v]=n.subarray(o,o+6);Et.bezierBoundingBox(r,a,u,c,f,p,_,v,e),r=_,a=v}}const[i,s]=k(this,vi,_n).call(this);e[0]=Oi(e[0]-i,0,1),e[1]=Oi(e[1]-s,0,1),e[2]=Oi(e[2]+i,0,1),e[3]=Oi(e[3]+s,0,1),e[2]-=e[0],e[3]-=e[1]},Tb=function(e){const[i,s]=k(this,vi,_n).call(this);x(this,eo,e);const[n,r]=k(this,vi,_n).call(this),[a,o]=[n-i,r-s],h=l(this,Li);return h[0]-=a,h[1]-=o,h[2]+=2*a,h[3]+=2*o,h};class Od extends Eb{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:Ce._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??(e=this["stroke-width"]),e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Od(this._viewParameters);return t.updateAll(this),t}}var Sd,Db;const No=class No extends od{constructor(e){super({...e,name:"inkEditor"});D(this,Sd);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,i){Ce.initialize(e,i),this._defaultDrawingOptions=new Od(i.viewParameters)}static getDefaultDrawingOptions(e){const i=this._defaultDrawingOptions.clone();return i.updateProperties(e),i}static get supportMultipleDrawings(){return!0}static get typesMap(){return Zt(this,"typesMap",new Map([[Qt.INK_THICKNESS,"stroke-width"],[Qt.INK_COLOR,"stroke"],[Qt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,i,s,n,r){return new y_(e,i,s,n,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,i,s,n,r,a){return Ju.deserialize(e,i,s,n,r,a)}static async deserialize(e,i,s){let n=null;if(e instanceof Dg){const{data:{inkLists:a,rect:o,rotation:h,id:u,color:c,opacity:f,borderStyle:{rawWidth:p},popupRef:_},parent:{page:{pageNumber:v}}}=e;n=e={annotationType:Bt.INK,color:Array.from(c),thickness:p,opacity:f,paths:{points:a},boxes:null,pageIndex:v-1,rect:o.slice(0),rotation:h,id:u,deleted:!1,popupRef:_}}const r=await super.deserialize(e,i,s);return r.annotationElementId=e.id||null,r._initialData=n,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:i,parent:s}=this;i.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(e,i.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:i,opacity:s}){this._drawingOptions=No.getDefaultDrawingOptions({stroke:Et.makeHexColor(...e),"stroke-width":i,"stroke-opacity":s})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:i,points:s,rect:n}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":o}}=this,h={annotationType:Bt.INK,color:Ce._colorManager.convert(r),opacity:a,thickness:o,paths:{lines:i,points:s},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(h.isCopy=!0,h):this.annotationElementId&&!k(this,Sd,Db).call(this,h)?null:(h.id=this.annotationElementId,h)}renderAnnotationElement(e){const{points:i,rect:s}=this.serializeDraw(!1);return e.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:i}),null}};Sd=new WeakSet,Db=function(e){const{color:i,thickness:s,opacity:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((a,o)=>a!==i[o])||e.thickness!==s||e.opacity!==n||e.pageIndex!==r},At(No,"_type","ink"),At(No,"_editorType",Bt.INK),At(No,"_defaultDrawingOptions",null);let Xp=No;class Yp extends Ju{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const cc=8,th=3;var io,ue,Kp,Hs,kb,Rb,Zp,zc,Ib,Nb,Lb,Jp,Qp,Pb;class Jn{static extractContoursFromText(t,{fontFamily:e,fontStyle:i,fontWeight:s},n,r,a,o){let h=new OffscreenCanvas(1,1),u=h.getContext("2d",{alpha:!1});const c=200,f=u.font=`${i} ${s} ${c}px ${e}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:_,actualBoundingBoxAscent:v,actualBoundingBoxDescent:g,fontBoundingBoxAscent:b,fontBoundingBoxDescent:w,width:S}=u.measureText(t),T=1.5,A=Math.ceil(Math.max(Math.abs(p)+Math.abs(_)||0,S)*T),C=Math.ceil(Math.max(Math.abs(v)+Math.abs(g)||c,Math.abs(b)+Math.abs(w)||c)*T);h=new OffscreenCanvas(A,C),u=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),u.font=f,u.filter="grayscale(1)",u.fillStyle="white",u.fillRect(0,0,A,C),u.fillStyle="black",u.fillText(t,A*(T-1)/2,C*(3-T)/2);const R=k(this,ue,Jp).call(this,u.getImageData(0,0,A,C).data),P=k(this,ue,Lb).call(this,R),N=k(this,ue,Qp).call(this,P),F=k(this,ue,Zp).call(this,R,A,C,N);return this.processDrawnLines({lines:{curves:F,width:A,height:C},pageWidth:n,pageHeight:r,rotation:a,innerMargin:o,mustSmooth:!0,areContours:!0})}static process(t,e,i,s,n){const[r,a,o]=k(this,ue,Pb).call(this,t),[h,u]=k(this,ue,Nb).call(this,r,a,o,Math.hypot(a,o)*l(this,io).sigmaSFactor,l(this,io).sigmaR,l(this,io).kernelSize),c=k(this,ue,Qp).call(this,u),f=k(this,ue,Zp).call(this,h,a,o,c);return this.processDrawnLines({lines:{curves:f,width:a,height:o},pageWidth:e,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:r,areContours:a}){s%180!==0&&([e,i]=[i,e]);const{curves:o,width:h,height:u}=t,c=t.thickness??0,f=[],p=Math.min(e/h,i/u),_=p/e,v=p/i,g=[];for(const{points:w}of o){const S=r?k(this,ue,Ib).call(this,w):w;if(!S)continue;g.push(S);const T=S.length,A=new Float32Array(T),C=new Float32Array(3*(T===2?2:T-2));if(f.push({line:C,points:A}),T===2){A[0]=S[0]*_,A[1]=S[1]*v,C.set([NaN,NaN,NaN,NaN,A[0],A[1]],0);continue}let[R,P,N,F]=S;R*=_,P*=v,N*=_,F*=v,A.set([R,P,N,F],0),C.set([NaN,NaN,NaN,NaN,R,P],0);for(let z=4;z<T;z+=2){const q=A[z]=S[z]*_,X=A[z+1]=S[z+1]*v;C.set(wt.createBezierPoints(R,P,N,F,q,X),(z-2)*3),[R,P,N,F]=[N,F,q,X]}}if(f.length===0)return null;const b=a?new Yp:new Ju;return b.build(f,e,i,1,s,a?0:c,n),{outline:b,newCurves:g,areContours:a,thickness:c,width:h,height:u}}static async compressSignature({outlines:t,areContours:e,thickness:i,width:s,height:n}){let r=1/0,a=-1/0,o=0;for(const S of t){o+=S.length;for(let T=2,A=S.length;T<A;T++){const C=S[T]-S[T-2];r=Math.min(r,C),a=Math.max(a,C)}}let h;r>=-128&&a<=127?h=Int8Array:r>=-32768&&a<=32767?h=Int16Array:h=Int32Array;const u=t.length,c=cc+th*u,f=new Uint32Array(c);let p=0;f[p++]=c*Uint32Array.BYTES_PER_ELEMENT+(o-2*u)*h.BYTES_PER_ELEMENT,f[p++]=0,f[p++]=s,f[p++]=n,f[p++]=e?0:1,f[p++]=Math.max(0,Math.floor(i??0)),f[p++]=u,f[p++]=h.BYTES_PER_ELEMENT;for(const S of t)f[p++]=S.length-2,f[p++]=S[0],f[p++]=S[1];const _=new CompressionStream("deflate-raw"),v=_.writable.getWriter();await v.ready,v.write(f);const g=h.prototype.constructor;for(const S of t){const T=new g(S.length-2);for(let A=2,C=S.length;A<C;A++)T[A-2]=S[A]-S[A-2];v.write(T)}v.close();const b=await new Response(_.readable).arrayBuffer(),w=new Uint8Array(b);return Fv(w)}static async decompressSignature(t){try{const e=qw(t),{readable:i,writable:s}=new DecompressionStream("deflate-raw"),n=s.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let r=null,a=0;for await(const S of i)r||(r=new Uint8Array(new Uint32Array(S.buffer,0,4)[0])),r.set(S,a),a+=S.length;const o=new Uint32Array(r.buffer,0,r.length>>2),h=o[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const u=o[2],c=o[3],f=o[4]===0,p=o[5],_=o[6],v=o[7],g=[],b=(cc+th*_)*Uint32Array.BYTES_PER_ELEMENT;let w;switch(v){case Int8Array.BYTES_PER_ELEMENT:w=new Int8Array(r.buffer,b);break;case Int16Array.BYTES_PER_ELEMENT:w=new Int16Array(r.buffer,b);break;case Int32Array.BYTES_PER_ELEMENT:w=new Int32Array(r.buffer,b);break}a=0;for(let S=0;S<_;S++){const T=o[th*S+cc],A=new Float32Array(T+2);g.push(A);for(let C=0;C<th-1;C++)A[C]=o[th*S+cc+C+1];for(let C=0;C<T;C++)A[C+2]=A[C]+w[a++]}return{areContours:f,thickness:p,outlines:g,width:u,height:c}}catch(e){return Ht(`decompressSignature: ${e}`),null}}}io=new WeakMap,ue=new WeakSet,Kp=function(t,e,i,s){return i-=t,s-=e,i===0?s>0?0:4:i===1?s+6:2-s},Hs=new WeakMap,kb=function(t,e,i,s,n,r,a){const o=k(this,ue,Kp).call(this,i,s,n,r);for(let h=0;h<8;h++){const u=(-h+o-a+16)%8,c=l(this,Hs)[2*u],f=l(this,Hs)[2*u+1];if(t[(i+c)*e+(s+f)]!==0)return u}return-1},Rb=function(t,e,i,s,n,r,a){const o=k(this,ue,Kp).call(this,i,s,n,r);for(let h=0;h<8;h++){const u=(h+o+a+16)%8,c=l(this,Hs)[2*u],f=l(this,Hs)[2*u+1];if(t[(i+c)*e+(s+f)]!==0)return u}return-1},Zp=function(t,e,i,s){const n=t.length,r=new Int32Array(n);for(let u=0;u<n;u++)r[u]=t[u]<=s?1:0;for(let u=1;u<i-1;u++)r[u*e]=r[u*e+e-1]=0;for(let u=0;u<e;u++)r[u]=r[e*i-1-u]=0;let a=1,o;const h=[];for(let u=1;u<i-1;u++){o=1;for(let c=1;c<e-1;c++){const f=u*e+c,p=r[f];if(p===0)continue;let _=u,v=c;if(p===1&&r[f-1]===0)a+=1,v-=1;else if(p>=1&&r[f+1]===0)a+=1,v+=1,p>1&&(o=p);else{p!==1&&(o=Math.abs(p));continue}const g=[c,u],b=v===c+1,w={isHole:b,points:g,id:a,parent:0};h.push(w);let S;for(const z of h)if(z.id===o){S=z;break}S?S.isHole?w.parent=b?S.parent:o:w.parent=b?o:S.parent:w.parent=b?o:0;const T=k(this,ue,kb).call(this,r,e,u,c,_,v,0);if(T===-1){r[f]=-a,r[f]!==1&&(o=Math.abs(r[f]));continue}let A=l(this,Hs)[2*T],C=l(this,Hs)[2*T+1];const R=u+A,P=c+C;_=R,v=P;let N=u,F=c;for(;;){const z=k(this,ue,Rb).call(this,r,e,N,F,_,v,1);A=l(this,Hs)[2*z],C=l(this,Hs)[2*z+1];const q=N+A,X=F+C;g.push(X,q);const tt=N*e+F;if(r[tt+1]===0?r[tt]=-a:r[tt]===1&&(r[tt]=a),q===u&&X===c&&N===R&&F===P){r[f]!==1&&(o=Math.abs(r[f]));break}else _=N,v=F,N=q,F=X}}}return h},zc=function(t,e,i,s){if(i-e<=4){for(let R=e;R<i-2;R+=2)s.push(t[R],t[R+1]);return}const n=t[e],r=t[e+1],a=t[i-4]-n,o=t[i-3]-r,h=Math.hypot(a,o),u=a/h,c=o/h,f=u*r-c*n,p=o/a,_=1/h,v=Math.atan(p),g=Math.cos(v),b=Math.sin(v),w=_*(Math.abs(g)+Math.abs(b)),S=_*(1-w+w**2),T=Math.max(Math.atan(Math.abs(b+g)*S),Math.atan(Math.abs(b-g)*S));let A=0,C=e;for(let R=e+2;R<i-2;R+=2){const P=Math.abs(f-u*t[R+1]+c*t[R]);P>A&&(C=R,A=P)}A>(h*T)**2?(k(this,ue,zc).call(this,t,e,C+2,s),k(this,ue,zc).call(this,t,C,i,s)):s.push(n,r)},Ib=function(t){const e=[],i=t.length;return k(this,ue,zc).call(this,t,0,i,e),e.push(t[i-2],t[i-1]),e.length<=4?null:e},Nb=function(t,e,i,s,n,r){const a=new Float32Array(r**2),o=-2*s**2,h=r>>1;for(let v=0;v<r;v++){const g=(v-h)**2;for(let b=0;b<r;b++)a[v*r+b]=Math.exp((g+(b-h)**2)/o)}const u=new Float32Array(256),c=-2*n**2;for(let v=0;v<256;v++)u[v]=Math.exp(v**2/c);const f=t.length,p=new Uint8Array(f),_=new Uint32Array(256);for(let v=0;v<i;v++)for(let g=0;g<e;g++){const b=v*e+g,w=t[b];let S=0,T=0;for(let C=0;C<r;C++){const R=v+C-h;if(!(R<0||R>=i))for(let P=0;P<r;P++){const N=g+P-h;if(N<0||N>=e)continue;const F=t[R*e+N],z=a[C*r+P]*u[Math.abs(F-w)];S+=F*z,T+=z}}const A=p[b]=Math.round(S/T);_[A]++}return[p,_]},Lb=function(t){const e=new Uint32Array(256);for(const i of t)e[i]++;return e},Jp=function(t){const e=t.length,i=new Uint8ClampedArray(e>>2);let s=-1/0,n=1/0;for(let a=0,o=i.length;a<o;a++){if(t[(a<<2)+3]===0){s=i[a]=255;continue}const u=i[a]=t[a<<2];u>s&&(s=u),u<n&&(n=u)}const r=255/(s-n);for(let a=0;a<e;a++)i[a]=(i[a]-n)*r;return i},Qp=function(t){let e,i=-1/0,s=-1/0;const n=t.findIndex(o=>o!==0);let r=n,a=n;for(e=n;e<256;e++){const o=t[e];o>i&&(e-r>s&&(s=e-r,a=e-1),i=o,r=e)}for(e=a-1;e>=0&&!(t[e]>t[e+1]);e--);return e},Pb=function(t){const e=t,{width:i,height:s}=t,{maxDim:n}=l(this,io);let r=i,a=s;if(i>n||s>n){let f=i,p=s,_=Math.log2(Math.max(i,s)/n);const v=Math.floor(_);_=_===v?v-1:v;for(let b=0;b<_;b++){r=f,a=p,r>n&&(r=Math.ceil(r/2)),a>n&&(a=Math.ceil(a/2));const w=new OffscreenCanvas(r,a);w.getContext("2d").drawImage(t,0,0,f,p,0,0,r,a),f=r,p=a,t!==e&&t.close(),t=w.transferToImageBitmap()}const g=Math.min(n/r,n/a);r=Math.round(r*g),a=Math.round(a*g)}const h=new OffscreenCanvas(r,a).getContext("2d",{willReadFrequently:!0});h.filter="grayscale(1)",h.drawImage(t,0,0,t.width,t.height,0,0,r,a);const u=h.getImageData(0,0,r,a).data;return[k(this,ue,Jp).call(this,u),r,a]},D(Jn,ue),D(Jn,io,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),D(Jn,Hs,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class kg extends Eb{constructor(){super(),super.updateProperties({fill:"CanvasText","stroke-width":0})}clone(){const t=new kg;return t.updateAll(this),t}}class Rg extends Od{constructor(t){super(t),super.updateProperties({stroke:"CanvasText","stroke-width":1})}clone(){const t=new Rg(this._viewParameters);return t.updateAll(this),t}}var Or,rs,Mr,Fr;const $i=class $i extends od{constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"});D(this,Or,!1);D(this,rs,null);D(this,Mr,null);D(this,Fr,null);this._willKeepAspectRatio=!0,x(this,Mr,e.signatureData||null),x(this,rs,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,i){Ce.initialize(e,i),this._defaultDrawingOptions=new kg,this._defaultDrawnSignatureOptions=new Rg(i.viewParameters)}static getDefaultDrawingOptions(e){const i=this._defaultDrawingOptions.clone();return i.updateProperties(e),i}static get supportMultipleDrawings(){return!1}static get typesMap(){return Zt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!l(this,rs)}}static computeTelemetryFinalData(e){const i=e.get("hasDescription");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,i;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,e=this.x,i=this.y),super.render(),this._drawId===null)if(l(this,Mr)){const{lines:n,mustSmooth:r,areContours:a,description:o,uuid:h,heightInPage:u}=l(this,Mr),{rawDims:{pageWidth:c,pageHeight:f},rotation:p}=this.parent.viewport,_=Jn.processDrawnLines({lines:n,pageWidth:c,pageHeight:f,rotation:p,innerMargin:$i._INNER_MARGIN,mustSmooth:r,areContours:a});this.addSignature(_,u,o,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return s&&(this._isCopy=!0,this._moveAfterPaste(e,i)),this.div}setUuid(e){x(this,Fr,e),this.addEditToolbar()}getUuid(){return l(this,Fr)}get description(){return l(this,rs)}set description(e){x(this,rs,e),super.addEditToolbar().then(i=>{i==null||i.updateEditSignatureButton(e)})}getSignaturePreview(){const{newCurves:e,areContours:i,thickness:s,width:n,height:r}=l(this,Mr),a=Math.max(n,r),o=Jn.processDrawnLines({lines:{curves:e.map(h=>({points:h})),thickness:s,width:n,height:r},pageWidth:a,pageHeight:a,rotation:0,innerMargin:0,mustSmooth:!1,areContours:i});return{areContours:i,outline:o.outline}}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.signatureManager&&l(this,rs)!==null&&(await e.addEditSignatureButton(this._uiManager.signatureManager,l(this,Fr),l(this,rs)),e.show()),e):null}addSignature(e,i,s,n){const{x:r,y:a}=this,{outline:o}=x(this,Mr,e);x(this,Or,o instanceof Yp),x(this,rs,s),this.div.setAttribute("data-l10n-args",JSON.stringify({description:s}));let h;l(this,Or)?h=$i.getDefaultDrawingOptions():(h=$i._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":o.thickness})),this._addOutlines({drawOutlines:o,drawingOptions:h});const[u,c]=this.parentDimensions,[,f]=this.pageDimensions;let p=i/f;p=p>=1?.5:p,this.width*=p/this.height,this.width>=1&&(p*=.9/this.width,this.width=.9),this.height=p,this.setDims(u*this.width,c*this.height),this.x=r,this.y=a,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:i,pageHeight:s},rotation:n}=this.parent.viewport;return Jn.process(e,i,s,n,$i._INNER_MARGIN)}getFromText(e,i){const{rawDims:{pageWidth:s,pageHeight:n},rotation:r}=this.parent.viewport;return Jn.extractContoursFromText(e,i,s,n,r,$i._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:i,pageHeight:s},rotation:n}=this.parent.viewport;return Jn.processDrawnLines({lines:e,pageWidth:i,pageHeight:s,rotation:n,innerMargin:$i._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:i}){e?this._drawingOptions=$i.getDefaultDrawingOptions():(this._drawingOptions=$i._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":i}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:i,points:s,rect:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":r}}=this,a={annotationType:Bt.SIGNATURE,isSignature:!0,areContours:l(this,Or),color:[0,0,0],thickness:l(this,Or)?0:r,pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(a.paths={lines:i,points:s},a.uuid=l(this,Fr),a.isCopy=!0):a.lines=i,l(this,rs)&&(a.accessibilityData={type:"Figure",alt:l(this,rs)}),a}static deserializeDraw(e,i,s,n,r,a){return a.areContours?Yp.deserialize(e,i,s,n,r,a):Ju.deserialize(e,i,s,n,r,a)}static async deserialize(e,i,s){var r;const n=await super.deserialize(e,i,s);return x(n,Or,e.areContours),x(n,rs,((r=e.accessibilityData)==null?void 0:r.alt)||""),x(n,Fr,e.uuid),n}};Or=new WeakMap,rs=new WeakMap,Mr=new WeakMap,Fr=new WeakMap,At($i,"_type","signature"),At($i,"_editorType",Bt.SIGNATURE),At($i,"_defaultDrawingOptions",null);let tg=$i;var Ee,li,Br,Gn,zr,Bl,$n,so,dn,as,zl,re,mh,vh,Uc,Hc,qc,ig,jc,Ob;class eg extends Ce{constructor(e){super({...e,name:"stampEditor"});D(this,re);D(this,Ee,null);D(this,li,null);D(this,Br,null);D(this,Gn,null);D(this,zr,null);D(this,Bl,"");D(this,$n,null);D(this,so,!1);D(this,dn,null);D(this,as,!1);D(this,zl,!1);x(this,Gn,e.bitmapUrl),x(this,zr,e.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,i){Ce.initialize(e,i)}static isHandlingMimeForPasting(e){return Xf.includes(e)}static paste(e,i){i.pasteEditor(Bt.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){const i=e.get("hasAltText");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}async mlGuessAltText(e=null,i=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:r,height:a}=e||this.copyCanvas(null,null,!0).imageData,o=await s.guess({name:"altText",request:{data:n,width:r,height:a,channels:n.length/(r*a)}});if(!o)throw new Error("No response from the AI service.");if(o.error)throw new Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw new Error("No valid response from the AI service.");const h=o.output;return await this.setGuessedAltText(h),i&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var e;l(this,li)&&(x(this,Ee,null),this._uiManager.imageManager.deleteId(l(this,li)),(e=l(this,$n))==null||e.remove(),x(this,$n,null),l(this,dn)&&(clearTimeout(l(this,dn)),x(this,dn,null))),super.remove()}rebuild(){if(!this.parent){l(this,li)&&k(this,re,Uc).call(this);return}super.rebuild(),this.div!==null&&(l(this,li)&&l(this,$n)===null&&k(this,re,Uc).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(l(this,Br)||l(this,Ee)||l(this,Gn)||l(this,zr)||l(this,li)||l(this,so))}get isResizable(){return!0}render(){if(this.div)return this.div;let e,i;return this._isCopy&&(e=this.x,i=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),l(this,so)||(l(this,Ee)?k(this,re,Hc).call(this):k(this,re,Uc).call(this)),this._isCopy&&this._moveAfterPaste(e,i),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,i){const{id:s,bitmap:n}=this._uiManager.imageManager.getFromCanvas(e,i);i.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(x(this,li,s),n&&x(this,Ee,n),x(this,so,!1),k(this,re,Hc).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;l(this,dn)!==null&&clearTimeout(l(this,dn)),x(this,dn,setTimeout(()=>{x(this,dn,null),k(this,re,ig).call(this)},200))}copyCanvas(e,i,s=!1){var p;e||(e=224);const{width:n,height:r}=l(this,Ee),a=new sr;let o=l(this,Ee),h=n,u=r,c=null;if(i){if(n>i||r>i){const P=Math.min(i/n,i/r);h=Math.floor(n*P),u=Math.floor(r*P)}c=document.createElement("canvas");const _=c.width=Math.ceil(h*a.sx),v=c.height=Math.ceil(u*a.sy);l(this,as)||(o=k(this,re,qc).call(this,_,v));const g=c.getContext("2d");g.filter=this._uiManager.hcmFilter;let b="white",w="#cfcfd8";this._uiManager.hcmFilter!=="none"?w="black":(p=window.matchMedia)!=null&&p.call(window,"(prefers-color-scheme: dark)").matches&&(b="#8f8f9d",w="#42414d");const S=15,T=S*a.sx,A=S*a.sy,C=new OffscreenCanvas(T*2,A*2),R=C.getContext("2d");R.fillStyle=b,R.fillRect(0,0,T*2,A*2),R.fillStyle=w,R.fillRect(0,0,T,A),R.fillRect(T,A,T,A),g.fillStyle=g.createPattern(C,"repeat"),g.fillRect(0,0,_,v),g.drawImage(o,0,0,o.width,o.height,0,0,_,v)}let f=null;if(s){let _,v;if(a.symmetric&&o.width<e&&o.height<e)_=o.width,v=o.height;else if(o=l(this,Ee),n>e||r>e){const w=Math.min(e/n,e/r);_=Math.floor(n*w),v=Math.floor(r*w),l(this,as)||(o=k(this,re,qc).call(this,_,v))}const b=new OffscreenCanvas(_,v).getContext("2d",{willReadFrequently:!0});b.drawImage(o,0,0,o.width,o.height,0,0,_,v),f={width:_,height:v,data:b.getImageData(0,0,_,v).data}}return{canvas:c,width:h,height:u,imageData:f}}static async deserialize(e,i,s){var g;let n=null,r=!1;if(e instanceof K0){const{data:{rect:b,rotation:w,id:S,structParent:T,popupRef:A},container:C,parent:{page:{pageNumber:R}},canvas:P}=e;let N,F;P?(delete e.canvas,{id:N,bitmap:F}=s.imageManager.getFromCanvas(C.id,P),P.remove()):(r=!0,e._hasNoCanvas=!0);const z=((g=await i._structTree.getAriaAttributes(`${yg}${S}`))==null?void 0:g.get("aria-label"))||"";n=e={annotationType:Bt.STAMP,bitmapId:N,bitmap:F,pageIndex:R-1,rect:b.slice(0),rotation:w,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:z},isSvg:!1,structParent:T,popupRef:A}}const a=await super.deserialize(e,i,s),{rect:o,bitmap:h,bitmapUrl:u,bitmapId:c,isSvg:f,accessibilityData:p}=e;r?(s.addMissingCanvas(e.id,a),x(a,so,!0)):c&&s.imageManager.isValidId(c)?(x(a,li,c),h&&x(a,Ee,h)):x(a,Gn,u),x(a,as,f);const[_,v]=a.pageDimensions;return a.width=(o[2]-o[0])/_,a.height=(o[3]-o[1])/v,a.annotationElementId=e.id||null,p&&(a.altTextData=p),a._initialData=n,x(a,zl,!!n),a}serialize(e=!1,i=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s={annotationType:Bt.STAMP,bitmapId:l(this,li),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:l(this,as),structTreeParentId:this._structTreeParentId};if(e)return s.bitmapUrl=k(this,re,jc).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:n,altText:r}=this.serializeAltText(!1);if(!n&&r&&(s.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const o=k(this,re,Ob).call(this,s);if(o.isSame)return null;o.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,i===null)return s;i.stamps||(i.stamps=new Map);const a=l(this,as)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!i.stamps.has(l(this,li)))i.stamps.set(l(this,li),{area:a,serialized:s}),s.bitmap=k(this,re,jc).call(this,!1);else if(l(this,as)){const o=i.stamps.get(l(this,li));a>o.area&&(o.area=a,o.serialized.bitmap.close(),o.serialized.bitmap=k(this,re,jc).call(this,!1))}return s}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}Ee=new WeakMap,li=new WeakMap,Br=new WeakMap,Gn=new WeakMap,zr=new WeakMap,Bl=new WeakMap,$n=new WeakMap,so=new WeakMap,dn=new WeakMap,as=new WeakMap,zl=new WeakMap,re=new WeakSet,mh=function(e,i=!1){if(!e){this.remove();return}x(this,Ee,e.bitmap),i||(x(this,li,e.id),x(this,as,e.isSvg)),e.file&&x(this,Bl,e.file.name),k(this,re,Hc).call(this)},vh=function(){if(x(this,Br,null),this._uiManager.enableWaiting(!1),!!l(this,$n)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,Ee)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,Ee)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Uc=function(){if(l(this,li)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(l(this,li)).then(s=>k(this,re,mh).call(this,s,!0)).finally(()=>k(this,re,vh).call(this));return}if(l(this,Gn)){const s=l(this,Gn);x(this,Gn,null),this._uiManager.enableWaiting(!0),x(this,Br,this._uiManager.imageManager.getFromUrl(s).then(n=>k(this,re,mh).call(this,n)).finally(()=>k(this,re,vh).call(this)));return}if(l(this,zr)){const s=l(this,zr);x(this,zr,null),this._uiManager.enableWaiting(!0),x(this,Br,this._uiManager.imageManager.getFromFile(s).then(n=>k(this,re,mh).call(this,n)).finally(()=>k(this,re,vh).call(this)));return}const e=document.createElement("input");e.type="file",e.accept=Xf.join(",");const i=this._uiManager._signal;x(this,Br,new Promise(s=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),k(this,re,mh).call(this,n)}s()},{signal:i}),e.addEventListener("cancel",()=>{this.remove(),s()},{signal:i})}).finally(()=>k(this,re,vh).call(this))),e.click()},Hc=function(){var c;const{div:e}=this;let{width:i,height:s}=l(this,Ee);const[n,r]=this.pageDimensions,a=.75;if(this.width)i=this.width*n,s=this.height*r;else if(i>a*n||s>a*r){const f=Math.min(a*n/i,a*r/s);i*=f,s*=f}const[o,h]=this.parentDimensions;this.setDims(i*o/n,s*h/r),this._uiManager.enableWaiting(!1);const u=x(this,$n,document.createElement("canvas"));u.setAttribute("role","img"),this.addContainer(u),this.width=i/n,this.height=s/r,(c=this._initialOptions)!=null&&c.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),k(this,re,ig).call(this),l(this,zl)||(this.parent.addUndoableEditor(this),x(this,zl,!0)),this._reportTelemetry({action:"inserted_image"}),l(this,Bl)&&this.div.setAttribute("aria-description",l(this,Bl))},qc=function(e,i){const{width:s,height:n}=l(this,Ee);let r=s,a=n,o=l(this,Ee);for(;r>2*e||a>2*i;){const h=r,u=a;r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),a>2*i&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const c=new OffscreenCanvas(r,a);c.getContext("2d").drawImage(o,0,0,h,u,0,0,r,a),o=c.transferToImageBitmap()}return o},ig=function(){const[e,i]=this.parentDimensions,{width:s,height:n}=this,r=new sr,a=Math.ceil(s*e*r.sx),o=Math.ceil(n*i*r.sy),h=l(this,$n);if(!h||h.width===a&&h.height===o)return;h.width=a,h.height=o;const u=l(this,as)?l(this,Ee):k(this,re,qc).call(this,a,o),c=h.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(u,0,0,u.width,u.height,0,0,a,o)},jc=function(e){if(e){if(l(this,as)){const n=this._uiManager.imageManager.getSvgUrl(l(this,li));if(n)return n}const i=document.createElement("canvas");return{width:i.width,height:i.height}=l(this,Ee),i.getContext("2d").drawImage(l(this,Ee),0,0),i.toDataURL()}if(l(this,as)){const[i,s]=this.pageDimensions,n=Math.round(this.width*i*Gr.PDF_TO_CSS_UNITS),r=Math.round(this.height*s*Gr.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(n,r);return a.getContext("2d").drawImage(l(this,Ee),0,0,l(this,Ee).width,l(this,Ee).height,0,0,n,r),a.transferToImageBitmap()}return structuredClone(l(this,Ee))},Ob=function(e){var a;const{pageIndex:i,accessibilityData:{altText:s}}=this._initialData,n=e.pageIndex===i,r=(((a=e.accessibilityData)==null?void 0:a.alt)||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&n&&r,isSameAltText:r}},At(eg,"_type","stamp"),At(eg,"_editorType",Bt.STAMP);var no,Ul,fn,Ur,Xn,As,Hr,Hl,ro,qs,Yn,Ci,Kn,Tt,qr,Se,Mb,Ks,ng,rg,Wc;const Rs=class Rs{constructor({uiManager:t,pageIndex:e,div:i,structTreeLayer:s,accessibilityManager:n,annotationLayer:r,drawLayer:a,textLayer:o,viewport:h,l10n:u}){D(this,Se);D(this,no);D(this,Ul,!1);D(this,fn,null);D(this,Ur,null);D(this,Xn,null);D(this,As,new Map);D(this,Hr,!1);D(this,Hl,!1);D(this,ro,!1);D(this,qs,null);D(this,Yn,null);D(this,Ci,null);D(this,Kn,null);D(this,Tt);const c=[...l(Rs,qr).values()];if(!Rs._initialized){Rs._initialized=!0;for(const f of c)f.initialize(u,t)}t.registerEditorTypes(c),x(this,Tt,t),this.pageIndex=e,this.div=i,x(this,no,n),x(this,fn,r),this.viewport=h,x(this,Ci,o),this.drawLayer=a,this._structTree=s,l(this,Tt).addLayer(this)}get isEmpty(){return l(this,As).size===0}get isInvisible(){return this.isEmpty&&l(this,Tt).getMode()===Bt.NONE}updateToolbar(t){l(this,Tt).updateToolbar(t)}updateMode(t=l(this,Tt).getMode()){switch(k(this,Se,Wc).call(this),t){case Bt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Bt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Bt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const i of l(Rs,qr).values())e.toggle(`${i._type}Editing`,t===i._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=l(this,Ci))==null?void 0:e.div)}setEditingState(t){l(this,Tt).setEditingState(t)}addCommands(t){l(this,Tt).addCommands(t)}cleanUndoStack(t){l(this,Tt).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=l(this,fn))==null||e.div.classList.toggle("disabled",!t)}async enable(){x(this,ro,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const i of l(this,As).values())i.enableEditing(),i.show(!0),i.annotationElementId&&(l(this,Tt).removeChangedExistingAnnotation(i),t.add(i.annotationElementId));if(!l(this,fn)){x(this,ro,!1);return}const e=l(this,fn).getEditableAnnotations();for(const i of e){if(i.hide(),l(this,Tt).isDeletedAnnotationElement(i.data.id)||t.has(i.data.id))continue;const s=await this.deserialize(i);s&&(this.addOrRebuild(s),s.enableEditing())}x(this,ro,!1)}disable(){var s;x(this,Hl,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,e=new Map;for(const n of l(this,As).values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){t.set(n.annotationElementId,n);continue}else e.set(n.annotationElementId,n);(s=this.getEditableAnnotation(n.annotationElementId))==null||s.show(),n.remove()}if(l(this,fn)){const n=l(this,fn).getEditableAnnotations();for(const r of n){const{id:a}=r.data;if(l(this,Tt).isDeletedAnnotationElement(a))continue;let o=e.get(a);if(o){o.resetAnnotationElement(r),o.show(!1),r.show();continue}o=t.get(a),o&&(l(this,Tt).addChangedExistingAnnotation(o),o.renderAnnotationElement(r)&&o.show(!1)),r.show()}}k(this,Se,Wc).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const n of l(Rs,qr).values())i.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),x(this,Hl,!1)}getEditableAnnotation(t){var e;return((e=l(this,fn))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){l(this,Tt).getActive()!==t&&l(this,Tt).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=l(this,Ci))!=null&&t.div&&!l(this,Kn)){x(this,Kn,new AbortController);const e=l(this,Tt).combinedSignal(l(this,Kn));l(this,Ci).div.addEventListener("pointerdown",k(this,Se,Mb).bind(this),{signal:e}),l(this,Ci).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=l(this,Ci))!=null&&t.div&&l(this,Kn)&&(l(this,Kn).abort(),x(this,Kn,null),l(this,Ci).div.classList.remove("highlighting"))}enableClick(){if(l(this,Ur))return;x(this,Ur,new AbortController);const t=l(this,Tt).combinedSignal(l(this,Ur));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=l(this,Ur))==null||t.abort(),x(this,Ur,null)}attach(t){l(this,As).set(t.id,t);const{annotationElementId:e}=t;e&&l(this,Tt).isDeletedAnnotationElement(e)&&l(this,Tt).removeDeletedAnnotationElement(t)}detach(t){var e;l(this,As).delete(t.id),(e=l(this,no))==null||e.removePointerInTextLayer(t.contentDiv),!l(this,Hl)&&t.annotationElementId&&l(this,Tt).addDeletedAnnotationElement(t)}remove(t){this.detach(t),l(this,Tt).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(l(this,Tt).addDeletedAnnotationElement(t.annotationElementId),Ce.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),l(this,Tt).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!l(this,ro)),l(this,Tt).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var i;if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!l(this,Xn)&&(t._focusEventsAllowed=!1,x(this,Xn,setTimeout(()=>{x(this,Xn,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:l(this,Tt)._signal}),e.focus())},0))),t._structTreeParentId=(i=l(this,no))==null?void 0:i.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:e,undo:i,mustExec:!1})}getNextId(){return l(this,Tt).getId()}combinedSignal(t){return l(this,Tt).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=l(this,Se,Ks))==null?void 0:t.canCreateNewEmptyEditor()}async pasteEditor(t,e){l(this,Tt).updateToolbar(t),await l(this,Tt).updateMode(t);const{offsetX:i,offsetY:s}=k(this,Se,rg).call(this),n=this.getNextId(),r=k(this,Se,ng).call(this,{parent:this,id:n,x:i,y:s,uiManager:l(this,Tt),isCentered:!0,...e});r&&this.add(r)}async deserialize(t){var e;return await((e=l(Rs,qr).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,l(this,Tt)))||null}createAndAddNewEditor(t,e,i={}){const s=this.getNextId(),n=k(this,Se,ng).call(this,{parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:l(this,Tt),isCentered:e,...i});return n&&this.add(n),n}addNewEditor(t={}){this.createAndAddNewEditor(k(this,Se,rg).call(this),!0,t)}setSelected(t){l(this,Tt).setSelected(t)}toggleSelected(t){l(this,Tt).toggleSelected(t)}unselect(t){l(this,Tt).unselect(t)}pointerup(t){var s;const{isMac:e}=wi.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!l(this,Hr)||(x(this,Hr,!1),(s=l(this,Se,Ks))!=null&&s.isDrawer&&l(this,Se,Ks).supportMultipleDrawings))return;if(!l(this,Ul)){x(this,Ul,!0);return}const i=l(this,Tt).getMode();if(i===Bt.STAMP||i===Bt.SIGNATURE){l(this,Tt).unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){var s;if(l(this,Tt).getMode()===Bt.HIGHLIGHT&&this.enableTextSelection(),l(this,Hr)){x(this,Hr,!1);return}const{isMac:e}=wi.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(x(this,Hr,!0),(s=l(this,Se,Ks))!=null&&s.isDrawer){this.startDrawingSession(t);return}const i=l(this,Tt).getActive();x(this,Ul,!i||i.isEmpty())}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),l(this,qs)){l(this,Se,Ks).startDrawing(this,l(this,Tt),!1,t);return}l(this,Tt).setCurrentDrawingSession(this),x(this,qs,new AbortController);const e=l(this,Tt).combinedSignal(l(this,qs));this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(x(this,Yn,null),this.commitOrRemove())},{signal:e}),l(this,Se,Ks).startDrawing(this,l(this,Tt),!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&x(this,Yn,e);return}l(this,Yn)&&setTimeout(()=>{var e;(e=l(this,Yn))==null||e.focus(),x(this,Yn,null)},0)}endDrawingSession(t=!1){return l(this,qs)?(l(this,Tt).setCurrentDrawingSession(null),l(this,qs).abort(),x(this,qs,null),x(this,Yn,null),l(this,Se,Ks).endDrawing(t)):null}findNewParent(t,e,i){const s=l(this,Tt).findParent(e,i);return s===null||s===this?!1:(s.changeParent(t),!0)}commitOrRemove(){return l(this,qs)?(this.endDrawingSession(),!0):!1}onScaleChanging(){l(this,qs)&&l(this,Se,Ks).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=l(this,Tt).getActive())==null?void 0:t.parent)===this&&(l(this,Tt).commitOrRemove(),l(this,Tt).setActiveEditor(null)),l(this,Xn)&&(clearTimeout(l(this,Xn)),x(this,Xn,null));for(const i of l(this,As).values())(e=l(this,no))==null||e.removePointerInTextLayer(i.contentDiv),i.setParent(null),i.isAttachedToDOM=!1,i.div.remove();this.div=null,l(this,As).clear(),l(this,Tt).removeLayer(this)}render({viewport:t}){this.viewport=t,oo(this.div,t);for(const e of l(this,Tt).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){l(this,Tt).commitOrRemove(),k(this,Se,Wc).call(this);const e=this.viewport.rotation,i=t.rotation;if(this.viewport=t,oo(this.div,{rotation:i}),e!==i)for(const s of l(this,As).values())s.rotate(i)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return l(this,Tt).viewParameters.realScale}};no=new WeakMap,Ul=new WeakMap,fn=new WeakMap,Ur=new WeakMap,Xn=new WeakMap,As=new WeakMap,Hr=new WeakMap,Hl=new WeakMap,ro=new WeakMap,qs=new WeakMap,Yn=new WeakMap,Ci=new WeakMap,Kn=new WeakMap,Tt=new WeakMap,qr=new WeakMap,Se=new WeakSet,Mb=function(t){l(this,Tt).unselectAll();const{target:e}=t;if(e===l(this,Ci).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&l(this,Ci).div.contains(e)){const{isMac:i}=wi.platform;if(t.button!==0||t.ctrlKey&&i)return;l(this,Tt).showAllEditors("highlight",!0,!0),l(this,Ci).div.classList.add("free"),this.toggleDrawing(),ad.startHighlighting(this,l(this,Tt).direction==="ltr",{target:l(this,Ci).div,x:t.x,y:t.y}),l(this,Ci).div.addEventListener("pointerup",()=>{l(this,Ci).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:l(this,Tt)._signal}),t.preventDefault()}},Ks=function(){return l(Rs,qr).get(l(this,Tt).getMode())},ng=function(t){const e=l(this,Se,Ks);return e?new e.prototype.constructor(t):null},rg=function(){const{x:t,y:e,width:i,height:s}=this.div.getBoundingClientRect(),n=Math.max(0,t),r=Math.max(0,e),a=Math.min(window.innerWidth,t+i),o=Math.min(window.innerHeight,e+s),h=(n+a)/2-t,u=(r+o)/2-e,[c,f]=this.viewport.rotation%180===0?[h,u]:[u,h];return{offsetX:c,offsetY:f}},Wc=function(){for(const t of l(this,As).values())t.isEmpty()&&t.remove()},At(Rs,"_initialized",!1),D(Rs,qr,new Map([Op,Xp,eg,ad,tg].map(t=>[t._editorType,t])));let sg=Rs;var js,Pi,ao,Vu,Cd,Fb,gn,og,Bb,lg;const Ze=class Ze{constructor({pageIndex:t}){D(this,gn);D(this,js,null);D(this,Pi,new Map);D(this,ao,new Map);this.pageIndex=t}setParent(t){if(!l(this,js)){x(this,js,t);return}if(l(this,js)!==t){if(l(this,Pi).size>0)for(const e of l(this,Pi).values())e.remove(),t.append(e);x(this,js,t)}}static get _svgFactory(){return Zt(this,"_svgFactory",new sd)}draw(t,e=!1,i=!1){const s=ki(Ze,Vu)._++,n=k(this,gn,og).call(this),r=Ze._svgFactory.createElement("defs");n.append(r);const a=Ze._svgFactory.createElement("path");r.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke"),e&&l(this,ao).set(s,a);const h=i?k(this,gn,Bb).call(this,r,o):null,u=Ze._svgFactory.createElement("use");return n.append(u),u.setAttribute("href",`#${o}`),this.updateProperties(n,t),l(this,Pi).set(s,n),{id:s,clipPathId:`url(#${h})`}}drawOutline(t,e){const i=ki(Ze,Vu)._++,s=k(this,gn,og).call(this),n=Ze._svgFactory.createElement("defs");s.append(n);const r=Ze._svgFactory.createElement("path");n.append(r);const a=`path_p${this.pageIndex}_${i}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let o;if(e){const c=Ze._svgFactory.createElement("mask");n.append(c),o=`mask_p${this.pageIndex}_${i}`,c.setAttribute("id",o),c.setAttribute("maskUnits","objectBoundingBox");const f=Ze._svgFactory.createElement("rect");c.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=Ze._svgFactory.createElement("use");c.append(p),p.setAttribute("href",`#${a}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const h=Ze._svgFactory.createElement("use");s.append(h),h.setAttribute("href",`#${a}`),o&&h.setAttribute("mask",`url(#${o})`);const u=h.cloneNode();return s.append(u),h.classList.add("mainOutline"),u.classList.add("secondaryOutline"),this.updateProperties(s,t),l(this,Pi).set(i,s),i}finalizeDraw(t,e){l(this,ao).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var o;if(!e)return;const{root:i,bbox:s,rootClass:n,path:r}=e,a=typeof t=="number"?l(this,Pi).get(t):t;if(a){if(i&&k(this,gn,lg).call(this,a,i),s&&k(o=Ze,Cd,Fb).call(o,a,s),n){const{classList:h}=a;for(const[u,c]of Object.entries(n))h.toggle(u,c)}if(r){const u=a.firstChild.firstChild;k(this,gn,lg).call(this,u,r)}}}updateParent(t,e){if(e===this)return;const i=l(this,Pi).get(t);i&&(l(e,js).append(i),l(this,Pi).delete(t),l(e,Pi).set(t,i))}remove(t){l(this,ao).delete(t),l(this,js)!==null&&(l(this,Pi).get(t).remove(),l(this,Pi).delete(t))}destroy(){x(this,js,null);for(const t of l(this,Pi).values())t.remove();l(this,Pi).clear(),l(this,ao).clear()}};js=new WeakMap,Pi=new WeakMap,ao=new WeakMap,Vu=new WeakMap,Cd=new WeakSet,Fb=function(t,[e,i,s,n]){const{style:r}=t;r.top=`${100*i}%`,r.left=`${100*e}%`,r.width=`${100*s}%`,r.height=`${100*n}%`},gn=new WeakSet,og=function(){const t=Ze._svgFactory.create(1,1,!0);return l(this,js).append(t),t.setAttribute("aria-hidden",!0),t},Bb=function(t,e){const i=Ze._svgFactory.createElement("clipPath");t.append(i);const s=`clip_${e}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");const n=Ze._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),s},lg=function(t,e){for(const[i,s]of Object.entries(e))s===null?t.removeAttribute(i):t.setAttribute(i,s)},D(Ze,Cd),D(Ze,Vu,0);let ag=Ze;globalThis.pdfjsTestingUtils={HighlightOutliner:Fp};Nt.AbortException;Nt.AnnotationEditorLayer;Nt.AnnotationEditorParamsType;Nt.AnnotationEditorType;Nt.AnnotationEditorUIManager;Nt.AnnotationLayer;Nt.AnnotationMode;Nt.AnnotationType;Nt.ColorPicker;Nt.DOMSVGFactory;Nt.DrawLayer;Nt.FeatureTest;var w_=Nt.GlobalWorkerOptions;Nt.ImageKind;Nt.InvalidPDFException;Nt.MathClamp;Nt.OPS;Nt.OutputScale;Nt.PDFDataRangeTransport;Nt.PDFDateString;Nt.PDFWorker;Nt.PasswordResponses;Nt.PermissionFlag;Nt.PixelsPerInch;Nt.RenderingCancelledException;Nt.ResponseException;Nt.SignatureExtractor;Nt.SupportedImageMimeTypes;Nt.TextLayer;Nt.TouchManager;Nt.Util;Nt.VerbosityLevel;Nt.XfaLayer;Nt.build;Nt.createValidAbsoluteUrl;Nt.fetchData;var __=Nt.getDocument;Nt.getFilenameFromUrl;Nt.getPdfFilenameFromUrl;Nt.getUuid;Nt.getXfaPageViewport;Nt.isDataScheme;Nt.isPdfFile;Nt.isValidExplicitDest;Nt.noContextMenu;Nt.normalizeUnicode;Nt.setLayerDimensions;Nt.shadow;Nt.stopEvent;Nt.version;const A_={class:"flex-container"},E_={class:"flex-item"},x_={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},S_={class:"font-semibold truncate"},C_={class:"text-sm text-gray-500 truncate"},T_={class:"mt-2 flex gap-2"},D_=["onClick"],k_=["onClick"],R_={key:0,class:"flex-item"},I_={class:"text-xl font-bold mb-2"},N_={key:0,class:"relative border rounded h-[80vh]",style:{background:"#aaaa"}},zf="my-books",L_={__name:"ReadEpub",setup(d){w_.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";const t=ec("https://aleah.oss-cn-heyuan.aliyuncs.com/epub/%E5%BD%B1%E5%93%8D%E5%8A%9B%20%28%E7%BB%8F%E5%85%B8%E7%89%88%29%20%3D%20Influence%20The%20Psychology%20of%20Persuasion%20%28%5B%E7%BE%8E%5D%20%E8%A5%BF%E5%A5%A5%E8%BF%AA%E5%B0%BC%20%28Robert%20B.%20Cialdini%29%20%E8%91%97%20%20%E9%97%BE%E4%BD%B3%20%E8%AF%91%29%20%28Z-Library%29.epub"),e=ec([]),i=ec(null),s=ec(null);let n=null,r=null;Kb(()=>{const p=localStorage.getItem(zf);p&&(e.value=JSON.parse(p))});function a(){if(!t.value)return;const p=t.value.endsWith(".epub")?"epub":t.value.endsWith(".pdf")?"pdf":"unknown";if(p==="unknown"){alert("暂不支持的文件类型");return}e.value.push({url:t.value,type:p}),localStorage.setItem(zf,JSON.stringify(e.value)),t.value=""}function o(p){e.value.splice(p,1),localStorage.setItem(zf,JSON.stringify(e.value))}async function h(p){if(i.value=p,await ey(),p.type==="epub")setTimeout(()=>{const _=document.getElementById("epub-viewer");_&&(_.innerHTML="",_.style.height="80vh",_.style.background="#aaaa",r=uo(p.url),n=r.renderTo("epub-viewer",{width:"100%",height:"100%",flow:"scrolled",spread:!1,snap:!0,allowScriptedContent:!0}),n.hooks.render.register(()=>{const v=_.querySelector("iframe");v&&v.removeAttribute("sandbox")}),n.display(),r.loaded.navigation.then(v=>{console.log("TOC:",v.toc)}))},50);else if(p.type==="pdf"){const v=await(await __(p.url).promise).getPage(1),g=s.value,b=g.getContext("2d"),w=v.getViewport({scale:1.5});g.height=w.height,g.width=w.width,v.render({canvasContext:b,viewport:w})}}function u(){n&&n.next()}function c(){n&&n.prev()}function f(p){return decodeURIComponent(p.split("/").pop())}return(p,_)=>($l(),Gl("div",A_,[ui("div",E_,[_[1]||(_[1]=ui("h2",null,"📚在线书架",-1)),ui("div",null,[Zb(ui("input",{"onUpdate:modelValue":_[0]||(_[0]=v=>t.value=v),placeholder:"输入阿里云 OSS 书籍链接",class:"flex-1 border rounded-lg p-2"},null,512),[[Jb,t.value]]),ui("button",{onClick:a,class:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"}," 添加 ")]),ui("div",x_,[($l(!0),Gl(Qb,null,ty(e.value,(v,g)=>($l(),Gl("div",{key:g,class:"p-3 bg-white rounded-lg shadow"},[ui("p",S_,Hd(f(v.url)),1),ui("p",C_,Hd(v.type),1),ui("div",T_,[ui("button",{onClick:b=>h(v),class:"bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600"}," 阅读 ",8,D_),ui("button",{onClick:b=>o(g),class:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600"}," 删除 ",8,k_)])]))),128))])]),i.value?($l(),Gl("div",R_,[ui("h2",I_,Hd(f(i.value.url)),1),i.value.type==="epub"?($l(),Gl("div",N_,[_[2]||(_[2]=ui("div",{id:"epub-viewer",class:"w-full h-full"},null,-1)),ui("div",{class:"absolute top-1/2 left-2 transform -translate-y-1/2"},[ui("button",{onClick:c,class:"bg-gray-700 text-white px-3 py-1 rounded hover:bg-gray-800"},"上一页")]),ui("div",{class:"absolute top-1/2 right-2 transform -translate-y-1/2"},[ui("button",{onClick:u,class:"bg-gray-700 text-white px-3 py-1 rounded hover:bg-gray-800"},"下一页")])])):Ug("",!0)])):Ug("",!0)]))}},U_=iy(L_,[["__scopeId","data-v-dfa03894"]]);export{U_ as default};
